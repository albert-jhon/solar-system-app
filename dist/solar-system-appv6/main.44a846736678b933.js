"use strict";(self.webpackChunksolar_system_appv6=self.webpackChunksolar_system_appv6||[]).push([[179],{11:(Um,Zu,Ju)=>{function Tn(n){return"function"==typeof n}function zn(n){const t=n(i=>{Error.call(i),i.stack=(new Error).stack});return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}const _i=zn(n=>function(t){n(this),this.message=t?`${t.length} errors occurred during unsubscription:\n${t.map((i,r)=>`${r+1}) ${i.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=t});function wl(n,e){if(n){const t=n.indexOf(e);0<=t&&n.splice(t,1)}}class er{constructor(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let e;if(!this.closed){this.closed=!0;const{_parentage:t}=this;if(t)if(this._parentage=null,Array.isArray(t))for(const o of t)o.remove(this);else t.remove(this);const{initialTeardown:i}=this;if(Tn(i))try{i()}catch(o){e=o instanceof _i?o.errors:[o]}const{_finalizers:r}=this;if(r){this._finalizers=null;for(const o of r)try{Qu(o)}catch(a){e=e??[],a instanceof _i?e=[...e,...a.errors]:e.push(a)}}if(e)throw new _i(e)}}add(e){var t;if(e&&e!==this)if(this.closed)Qu(e);else{if(e instanceof er){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=null!==(t=this._finalizers)&&void 0!==t?t:[]).push(e)}}_hasParent(e){const{_parentage:t}=this;return t===e||Array.isArray(t)&&t.includes(e)}_addParent(e){const{_parentage:t}=this;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e}_removeParent(e){const{_parentage:t}=this;t===e?this._parentage=null:Array.isArray(t)&&wl(t,e)}remove(e){const{_finalizers:t}=this;t&&wl(t,e),e instanceof er&&e._removeParent(this)}}er.EMPTY=(()=>{const n=new er;return n.closed=!0,n})();const Ga=er.EMPTY;function Ku(n){return n instanceof er||n&&"closed"in n&&Tn(n.remove)&&Tn(n.add)&&Tn(n.unsubscribe)}function Qu(n){Tn(n)?n():n.unsubscribe()}const _s={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},ti={setTimeout(n,e,...t){const{delegate:i}=ti;return i?.setTimeout?i.setTimeout(n,e,...t):setTimeout(n,e,...t)},clearTimeout(n){const{delegate:e}=ti;return(e?.clearTimeout||clearTimeout)(n)},delegate:void 0};function qn(n){ti.setTimeout(()=>{const{onUnhandledError:e}=_s;if(!e)throw n;e(n)})}function Ur(){}const xs=Ms("C",void 0,void 0);function Ms(n,e,t){return{kind:n,value:e,error:t}}let ss=null;function ro(n){if(_s.useDeprecatedSynchronousErrorHandling){const e=!ss;if(e&&(ss={errorThrown:!1,error:null}),n(),e){const{errorThrown:t,error:i}=ss;if(ss=null,t)throw i}}else n()}class ca extends er{constructor(e){super(),this.isStopped=!1,e?(this.destination=e,Ku(e)&&e.add(this)):this.destination=Vm}static create(e,t,i){return new bl(e,t,i)}next(e){this.isStopped?jd(function Nt(n){return Ms("N",n,void 0)}(e),this):this._next(e)}error(e){this.isStopped?jd(function ie(n){return Ms("E",void 0,n)}(e),this):(this.isStopped=!0,this._error(e))}complete(){this.isStopped?jd(xs,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(e){this.destination.next(e)}_error(e){try{this.destination.error(e)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const th=Function.prototype.bind;function Wa(n,e){return th.call(n,e)}class Bm{constructor(e){this.partialObserver=e}next(e){const{partialObserver:t}=this;if(t.next)try{t.next(e)}catch(i){Dc(i)}}error(e){const{partialObserver:t}=this;if(t.error)try{t.error(e)}catch(i){Dc(i)}else Dc(e)}complete(){const{partialObserver:e}=this;if(e.complete)try{e.complete()}catch(t){Dc(t)}}}class bl extends ca{constructor(e,t,i){let r;if(super(),Tn(e)||!e)r={next:e??void 0,error:t??void 0,complete:i??void 0};else{let o;this&&_s.useDeprecatedNextContext?(o=Object.create(e),o.unsubscribe=()=>this.unsubscribe(),r={next:e.next&&Wa(e.next,o),error:e.error&&Wa(e.error,o),complete:e.complete&&Wa(e.complete,o)}):r=e}this.destination=new Bm(r)}}function Dc(n){_s.useDeprecatedSynchronousErrorHandling?function eh(n){_s.useDeprecatedSynchronousErrorHandling&&ss&&(ss.errorThrown=!0,ss.error=n)}(n):qn(n)}function jd(n,e){const{onStoppedNotification:t}=_s;t&&ti.setTimeout(()=>t(n,e))}const Vm={closed:!0,next:Ur,error:function km(n){throw n},complete:Ur},$d="function"==typeof Symbol&&Symbol.observable||"@@observable";function ua(n){return n}function Xd(n){return 0===n.length?ua:1===n.length?n[0]:function(t){return n.reduce((i,r)=>r(i),t)}}let tr=(()=>{class n{constructor(t){t&&(this._subscribe=t)}lift(t){const i=new n;return i.source=this,i.operator=t,i}subscribe(t,i,r){const o=function gy(n){return n&&n instanceof ca||function my(n){return n&&Tn(n.next)&&Tn(n.error)&&Tn(n.complete)}(n)&&Ku(n)}(t)?t:new bl(t,i,r);return ro(()=>{const{operator:a,source:u}=this;o.add(a?a.call(o,u):u?this._subscribe(o):this._trySubscribe(o))}),o}_trySubscribe(t){try{return this._subscribe(t)}catch(i){t.error(i)}}forEach(t,i){return new(i=Hm(i))((r,o)=>{const a=new bl({next:u=>{try{t(u)}catch(h){o(h),a.unsubscribe()}},error:o,complete:r});this.subscribe(a)})}_subscribe(t){var i;return null===(i=this.source)||void 0===i?void 0:i.subscribe(t)}[$d](){return this}pipe(...t){return Xd(t)(this)}toPromise(t){return new(t=Hm(t))((i,r)=>{let o;this.subscribe(a=>o=a,a=>r(a),()=>i(o))})}}return n.create=e=>new n(e),n})();function Hm(n){var e;return null!==(e=n??_s.Promise)&&void 0!==e?e:Promise}const Gm=zn(n=>function(){n(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let Os=(()=>{class n extends tr{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(t){const i=new Wm(this,this);return i.operator=t,i}_throwIfClosed(){if(this.closed)throw new Gm}next(t){ro(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const i of this.currentObservers)i.next(t)}})}error(t){ro(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=t;const{observers:i}=this;for(;i.length;)i.shift().error(t)}})}complete(){ro(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:t}=this;for(;t.length;)t.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var t;return(null===(t=this.observers)||void 0===t?void 0:t.length)>0}_trySubscribe(t){return this._throwIfClosed(),super._trySubscribe(t)}_subscribe(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)}_innerSubscribe(t){const{hasError:i,isStopped:r,observers:o}=this;return i||r?Ga:(this.currentObservers=null,o.push(t),new er(()=>{this.currentObservers=null,wl(o,t)}))}_checkFinalizedStatuses(t){const{hasError:i,thrownError:r,isStopped:o}=this;i?t.error(r):o&&t.complete()}asObservable(){const t=new tr;return t.source=this,t}}return n.create=(e,t)=>new Wm(e,t),n})();class Wm extends Os{constructor(e,t){super(),this.destination=e,this.source=t}next(e){var t,i;null===(i=null===(t=this.destination)||void 0===t?void 0:t.next)||void 0===i||i.call(t,e)}error(e){var t,i;null===(i=null===(t=this.destination)||void 0===t?void 0:t.error)||void 0===i||i.call(t,e)}complete(){var e,t;null===(t=null===(e=this.destination)||void 0===e?void 0:e.complete)||void 0===t||t.call(e)}_subscribe(e){var t,i;return null!==(i=null===(t=this.source)||void 0===t?void 0:t.subscribe(e))&&void 0!==i?i:Ga}}function jm(n){return Tn(n?.lift)}function hr(n){return e=>{if(jm(e))return e.lift(function(t){try{return n(t,this)}catch(i){this.error(i)}});throw new TypeError("Unable to lift unknown Observable type")}}function nr(n,e,t,i,r){return new vy(n,e,t,i,r)}class vy extends ca{constructor(e,t,i,r,o,a){super(e),this.onFinalize=o,this.shouldUnsubscribe=a,this._next=t?function(u){try{t(u)}catch(h){e.error(h)}}:super._next,this._error=r?function(u){try{r(u)}catch(h){e.error(h)}finally{this.unsubscribe()}}:super._error,this._complete=i?function(){try{i()}catch(u){e.error(u)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var e;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:t}=this;super.unsubscribe(),!t&&(null===(e=this.onFinalize)||void 0===e||e.call(this))}}}function hi(n,e){return hr((t,i)=>{let r=0;t.subscribe(nr(i,o=>{i.next(n.call(e,o,r++))}))})}function Vo(n){return this instanceof Vo?(this.v=n,this):new Vo(n)}function Xm(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,e=n[Symbol.asyncIterator];return e?e.call(n):(n=function Ic(n){var e="function"==typeof Symbol&&Symbol.iterator,t=e&&n[e],i=0;if(t)return t.call(n);if(n&&"number"==typeof n.length)return{next:function(){return n&&i>=n.length&&(n=void 0),{value:n&&n[i++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(n),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(o){t[o]=n[o]&&function(a){return new Promise(function(u,h){!function r(o,a,u,h){Promise.resolve(h).then(function(f){o({value:f,done:u})},a)}(u,h,(a=n[o](a)).done,a.value)})}}}"function"==typeof SuppressedError&&SuppressedError;const sh=n=>n&&"number"==typeof n.length&&"function"!=typeof n;function Zm(n){return Tn(n?.then)}function Jm(n){return Tn(n[$d])}function Pc(n){return Symbol.asyncIterator&&Tn(n?.[Symbol.asyncIterator])}function Km(n){return new TypeError(`You provided ${null!==n&&"object"==typeof n?"an invalid object":`'${n}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const Sl=function Qm(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function oh(n){return Tn(n?.[Sl])}function eg(n){return function ih(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,i=t.apply(n,e||[]),o=[];return r={},u("next"),u("throw"),u("return",function a(M){return function(E){return Promise.resolve(E).then(M,_)}}),r[Symbol.asyncIterator]=function(){return this},r;function u(M,E){i[M]&&(r[M]=function(D){return new Promise(function(C,S){o.push([M,D,C,S])>1||h(M,D)})},E&&(r[M]=E(r[M])))}function h(M,E){try{!function f(M){M.value instanceof Vo?Promise.resolve(M.value.v).then(g,_):x(o[0][2],M)}(i[M](E))}catch(D){x(o[0][3],D)}}function g(M){h("next",M)}function _(M){h("throw",M)}function x(M,E){M(E),o.shift(),o.length&&h(o[0][0],o[0][1])}}(this,arguments,function*(){const t=n.getReader();try{for(;;){const{value:i,done:r}=yield Vo(t.read());if(r)return yield Vo(void 0);yield yield Vo(i)}}finally{t.releaseLock()}})}function tg(n){return Tn(n?.getReader)}function bs(n){if(n instanceof tr)return n;if(null!=n){if(Jm(n))return function ah(n){return new tr(e=>{const t=n[$d]();if(Tn(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(n);if(sh(n))return function Sy(n){return new tr(e=>{for(let t=0;t<n.length&&!e.closed;t++)e.next(n[t]);e.complete()})}(n);if(Zm(n))return function Lc(n){return new tr(e=>{n.then(t=>{e.closed||(e.next(t),e.complete())},t=>e.error(t)).then(null,qn)})}(n);if(Pc(n))return ng(n);if(oh(n))return function zo(n){return new tr(e=>{for(const t of n)if(e.next(t),e.closed)return;e.complete()})}(n);if(tg(n))return function Ty(n){return ng(eg(n))}(n)}throw Km(n)}function ng(n){return new tr(e=>{(function BM(n,e){var t,i,r,o;return function Jd(n,e,t,i){return new(t||(t=Promise))(function(o,a){function u(g){try{f(i.next(g))}catch(_){a(_)}}function h(g){try{f(i.throw(g))}catch(_){a(_)}}function f(g){g.done?o(g.value):function r(o){return o instanceof t?o:new t(function(a){a(o)})}(g.value).then(u,h)}f((i=i.apply(n,e||[])).next())})}(this,void 0,void 0,function*(){try{for(t=Xm(n);!(i=yield t.next()).done;)if(e.next(i.value),e.closed)return}catch(a){r={error:a}}finally{try{i&&!i.done&&(o=t.return)&&(yield o.call(t))}finally{if(r)throw r.error}}e.complete()})})(n,e).catch(t=>e.error(t))})}function os(n,e,t,i=0,r=!1){const o=e.schedule(function(){t(),r?n.add(this.schedule(null,i)):this.unsubscribe()},i);if(n.add(o),!r)return o}function Mr(n,e,t=1/0){return Tn(e)?Mr((i,r)=>hi((o,a)=>e(i,o,r,a))(bs(n(i,r))),t):("number"==typeof e&&(t=e),hr((i,r)=>function Nc(n,e,t,i,r,o,a,u){const h=[];let f=0,g=0,_=!1;const x=()=>{_&&!h.length&&!f&&e.complete()},M=D=>f<i?E(D):h.push(D),E=D=>{o&&e.next(D),f++;let C=!1;bs(t(D,g++)).subscribe(nr(e,S=>{r?.(S),o?M(S):e.next(S)},()=>{C=!0},void 0,()=>{if(C)try{for(f--;h.length&&f<i;){const S=h.shift();a?os(e,a,()=>E(S)):E(S)}x()}catch(S){e.error(S)}}))};return n.subscribe(nr(e,M,()=>{_=!0,x()})),()=>{u?.()}}(i,r,n,t)))}function ja(n=1/0){return Mr(ua,n)}const so=new tr(n=>n.complete());function lh(n){return n[n.length-1]}function Oc(n){return function rg(n){return n&&Tn(n.schedule)}(lh(n))?n.pop():void 0}function sg(n,e=0){return hr((t,i)=>{t.subscribe(nr(i,r=>os(i,n,()=>i.next(r),e),()=>os(i,n,()=>i.complete(),e),r=>os(i,n,()=>i.error(r),e)))})}function og(n,e=0){return hr((t,i)=>{i.add(n.schedule(()=>t.subscribe(i),e))})}function $a(n,e){if(!n)throw new Error("Iterable cannot be null");return new tr(t=>{os(t,e,()=>{const i=n[Symbol.asyncIterator]();os(t,e,()=>{i.next().then(r=>{r.done?t.complete():t.next(r.value)})},0,!0)})})}function wr(n,e){return e?function ag(n,e){if(null!=n){if(Jm(n))return function ch(n,e){return bs(n).pipe(og(e),sg(e))}(n,e);if(sh(n))return function af(n,e){return new tr(t=>{let i=0;return e.schedule(function(){i===n.length?t.complete():(t.next(n[i++]),t.closed||this.schedule())})})}(n,e);if(Zm(n))return function uh(n,e){return bs(n).pipe(og(e),sg(e))}(n,e);if(Pc(n))return $a(n,e);if(oh(n))return function Tl(n,e){return new tr(t=>{let i;return os(t,e,()=>{i=n[Sl](),os(t,e,()=>{let r,o;try{({value:r,done:o}=i.next())}catch(a){return void t.error(a)}o?t.complete():t.next(r)},0,!0)}),()=>Tn(i?.return)&&i.return()})}(n,e);if(tg(n))return function hh(n,e){return $a(eg(n),e)}(n,e)}throw Km(n)}(n,e):bs(n)}class Jr extends Os{constructor(e){super(),this._value=e}get value(){return this.getValue()}_subscribe(e){const t=super._subscribe(e);return!t.closed&&e.next(this._value),t}getValue(){const{hasError:e,thrownError:t,_value:i}=this;if(e)throw t;return this._throwIfClosed(),i}next(e){super.next(this._value=e)}}function on(...n){return wr(n,Oc(n))}function lf(n={}){const{connector:e=(()=>new Os),resetOnError:t=!0,resetOnComplete:i=!0,resetOnRefCountZero:r=!0}=n;return o=>{let a,u,h,f=0,g=!1,_=!1;const x=()=>{u?.unsubscribe(),u=void 0},M=()=>{x(),a=h=void 0,g=_=!1},E=()=>{const D=a;M(),D?.unsubscribe()};return hr((D,C)=>{f++,!_&&!g&&x();const S=h=h??e();C.add(()=>{f--,0===f&&!_&&!g&&(u=cf(E,r))}),S.subscribe(C),!a&&f>0&&(a=new bl({next:I=>S.next(I),error:I=>{_=!0,x(),u=cf(M,t,I),S.error(I)},complete:()=>{g=!0,x(),u=cf(M,i),S.complete()}}),bs(D).subscribe(a))})(o)}}function cf(n,e,...t){if(!0===e)return void n();if(!1===e)return;const i=new bl({next:()=>{i.unsubscribe(),n()}});return bs(e(...t)).subscribe(i)}function Ho(n,e){return hr((t,i)=>{let r=null,o=0,a=!1;const u=()=>a&&!r&&i.complete();t.subscribe(nr(i,h=>{r?.unsubscribe();let f=0;const g=o++;bs(n(h,g)).subscribe(r=nr(i,_=>i.next(e?e(h,_,g,f++):_),()=>{r=null,u()}))},()=>{a=!0,u()}))})}function Iy(n,e){return n===e}function ni(n){for(let e in n)if(n[e]===ni)return e;throw Error("Could not find renamed property on target object.")}function dr(n){if("string"==typeof n)return n;if(Array.isArray(n))return"["+n.map(dr).join(", ")+"]";if(null==n)return""+n;if(n.overriddenName)return`${n.overriddenName}`;if(n.name)return`${n.name}`;const e=n.toString();if(null==e)return""+e;const t=e.indexOf("\n");return-1===t?e:e.substring(0,t)}function dn(n,e){return null==n||""===n?null===e?"":e:null==e||""===e?n:n+" "+e}const ut=ni({__forward_ref__:ni});function bi(n){return n.__forward_ref__=bi,n.toString=function(){return dr(this())},n}function mt(n){return ri(n)?n():n}function ri(n){return"function"==typeof n&&n.hasOwnProperty(ut)&&n.__forward_ref__===bi}function Xa(n){return n&&!!n.\u0275providers}const fr="https://g.co/ng/security#xss";class z extends Error{constructor(e,t){super(function Wt(n,e){return`NG0${Math.abs(n)}${e?": "+e:""}`}(e,t)),this.code=e}}function qt(n){return"string"==typeof n?n:null==n?"":String(n)}function uf(n,e){throw new z(-201,!1)}function Bs(n,e){null==n&&function en(n,e,t,i){throw new Error(`ASSERTION ERROR: ${n}`+(null==i?"":` [Expected=> ${t} ${i} ${e} <=Actual]`))}(e,n,null,"!=")}function Zt(n){return{token:n.token,providedIn:n.providedIn||null,factory:n.factory,value:void 0}}function _o(n){return{providers:n.providers||[],imports:n.imports||[]}}function hf(n){return Ny(n,ff)||Ny(n,Oy)}function Ny(n,e){return n.hasOwnProperty(e)?n[e]:null}function df(n){return n&&(n.hasOwnProperty(lg)||n.hasOwnProperty(Fy))?n[lg]:null}const ff=ni({\u0275prov:ni}),lg=ni({\u0275inj:ni}),Oy=ni({ngInjectableDef:ni}),Fy=ni({ngInjectorDef:ni});var In=function(n){return n[n.Default=0]="Default",n[n.Host=1]="Host",n[n.Self=2]="Self",n[n.SkipSelf=4]="SkipSelf",n[n.Optional=8]="Optional",n}(In||{});let pf;function ir(n){const e=pf;return pf=n,e}function as(n,e,t){const i=hf(n);return i&&"root"==i.providedIn?void 0===i.value?i.value=i.factory():i.value:t&In.Optional?null:void 0!==e?e:void uf(dr(n))}const Ei=globalThis;class Ot{constructor(e,t){this._desc=e,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof t?this.__NG_ELEMENT_ID__=t:void 0!==t&&(this.\u0275prov=Zt({token:this,providedIn:t.providedIn||"root",factory:t.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}const ph={},fg="__NG_DI_FLAG__",mf="ngTempTokenPath",YM=/\n/gm,ky="__source";let Fc;function qa(n){const e=Fc;return Fc=n,e}function KM(n,e=In.Default){if(void 0===Fc)throw new z(-203,!1);return null===Fc?as(n,void 0,e):Fc.get(n,e&In.Optional?null:void 0,e)}function Kt(n,e=In.Default){return(function Uy(){return pf}()||KM)(mt(n),e)}function St(n,e=In.Default){return Kt(n,gf(e))}function gf(n){return typeof n>"u"||"number"==typeof n?n:0|(n.optional&&8)|(n.host&&1)|(n.self&&2)|(n.skipSelf&&4)}function pg(n){const e=[];for(let t=0;t<n.length;t++){const i=mt(n[t]);if(Array.isArray(i)){if(0===i.length)throw new z(900,!1);let r,o=In.Default;for(let a=0;a<i.length;a++){const u=i[a],h=QM(u);"number"==typeof h?-1===h?r=u.token:o|=h:r=u}e.push(Kt(r,o))}else e.push(Kt(i))}return e}function mh(n,e){return n[fg]=e,n.prototype[fg]=e,n}function QM(n){return n[fg]}function da(n){return{toString:n}.toString()}var vf=function(n){return n[n.OnPush=0]="OnPush",n[n.Default=1]="Default",n}(vf||{}),xo=function(n){return n[n.Emulated=0]="Emulated",n[n.None=2]="None",n[n.ShadowDom=3]="ShadowDom",n}(xo||{});const Go={},Yn=[],yf=ni({\u0275cmp:ni}),mg=ni({\u0275dir:ni}),gg=ni({\u0275pipe:ni}),zy=ni({\u0275mod:ni}),fa=ni({\u0275fac:ni}),gh=ni({__NG_ELEMENT_ID__:ni}),Hy=ni({__NG_ENV_ID__:ni});function Gy(n,e,t){let i=n.length;for(;;){const r=n.indexOf(e,t);if(-1===r)return r;if(0===r||n.charCodeAt(r-1)<=32){const o=e.length;if(r+o===i||n.charCodeAt(r+o)<=32)return r}t=r+1}}function vg(n,e,t){let i=0;for(;i<t.length;){const r=t[i];if("number"==typeof r){if(0!==r)break;i++;const o=t[i++],a=t[i++],u=t[i++];n.setAttribute(e,a,u,o)}else{const o=r,a=t[++i];jy(o)?n.setProperty(e,o,a):n.setAttribute(e,o,a),i++}}return i}function Wy(n){return 3===n||4===n||6===n}function jy(n){return 64===n.charCodeAt(0)}function vh(n,e){if(null!==e&&0!==e.length)if(null===n||0===n.length)n=e.slice();else{let t=-1;for(let i=0;i<e.length;i++){const r=e[i];"number"==typeof r?t=r:0===t||$y(n,t,r,null,-1===t||2===t?e[++i]:null)}}return n}function $y(n,e,t,i,r){let o=0,a=n.length;if(-1===e)a=-1;else for(;o<n.length;){const u=n[o++];if("number"==typeof u){if(u===e){a=-1;break}if(u>e){a=o-1;break}}}for(;o<n.length;){const u=n[o];if("number"==typeof u)break;if(u===t){if(null===i)return void(null!==r&&(n[o+1]=r));if(i===n[o+1])return void(n[o+2]=r)}o++,null!==i&&o++,null!==r&&o++}-1!==a&&(n.splice(a,0,e),o=a+1),n.splice(o++,0,t),null!==i&&n.splice(o++,0,i),null!==r&&n.splice(o++,0,r)}const Xy="ng-template";function nw(n,e,t){let i=0,r=!0;for(;i<n.length;){let o=n[i++];if("string"==typeof o&&r){const a=n[i++];if(t&&"class"===o&&-1!==Gy(a.toLowerCase(),e,0))return!0}else{if(1===o){for(;i<n.length&&"string"==typeof(o=n[i++]);)if(o.toLowerCase()===e)return!0;return!1}"number"==typeof o&&(r=!1)}}return!1}function qy(n){return 4===n.type&&n.value!==Xy}function iw(n,e,t){return e===(4!==n.type||t?n.value:Xy)}function rw(n,e,t){let i=4;const r=n.attrs||[],o=function aw(n){for(let e=0;e<n.length;e++)if(Wy(n[e]))return e;return n.length}(r);let a=!1;for(let u=0;u<e.length;u++){const h=e[u];if("number"!=typeof h){if(!a)if(4&i){if(i=2|1&i,""!==h&&!iw(n,h,t)||""===h&&1===e.length){if(Mo(i))return!1;a=!0}}else{const f=8&i?h:e[++u];if(8&i&&null!==n.attrs){if(!nw(n.attrs,f,t)){if(Mo(i))return!1;a=!0}continue}const _=sw(8&i?"class":h,r,qy(n),t);if(-1===_){if(Mo(i))return!1;a=!0;continue}if(""!==f){let x;x=_>o?"":r[_+1].toLowerCase();const M=8&i?x:null;if(M&&-1!==Gy(M,f,0)||2&i&&f!==x){if(Mo(i))return!1;a=!0}}}}else{if(!a&&!Mo(i)&&!Mo(h))return!1;if(a&&Mo(h))continue;a=!1,i=h|1&i}}return Mo(i)||a}function Mo(n){return 0==(1&n)}function sw(n,e,t,i){if(null===e)return-1;let r=0;if(i||!t){let o=!1;for(;r<e.length;){const a=e[r];if(a===n)return r;if(3===a||6===a)o=!0;else{if(1===a||2===a){let u=e[++r];for(;"string"==typeof u;)u=e[++r];continue}if(4===a)break;if(0===a){r+=4;continue}}r+=o?1:2}return-1}return function lw(n,e){let t=n.indexOf(4);if(t>-1)for(t++;t<n.length;){const i=n[t];if("number"==typeof i)return-1;if(i===e)return t;t++}return-1}(e,n)}function Yy(n,e,t=!1){for(let i=0;i<e.length;i++)if(rw(n,e[i],t))return!0;return!1}function Zy(n,e){return n?":not("+e.trim()+")":e}function uw(n){let e=n[0],t=1,i=2,r="",o=!1;for(;t<n.length;){let a=n[t];if("string"==typeof a)if(2&i){const u=n[++t];r+="["+a+(u.length>0?'="'+u+'"':"")+"]"}else 8&i?r+="."+a:4&i&&(r+=" "+a);else""!==r&&!Mo(a)&&(e+=Zy(o,r),r=""),i=a,o=o||!Mo(i);t++}return""!==r&&(e+=Zy(o,r)),e}function Al(n){return da(()=>{const e=Ky(n),t={...e,decls:n.decls,vars:n.vars,template:n.template,consts:n.consts||null,ngContentSelectors:n.ngContentSelectors,onPush:n.changeDetection===vf.OnPush,directiveDefs:null,pipeDefs:null,dependencies:e.standalone&&n.dependencies||null,getStandaloneInjector:null,signals:n.signals??!1,data:n.data||{},encapsulation:n.encapsulation||xo.Emulated,styles:n.styles||Yn,_:null,schemas:n.schemas||null,tView:null,id:""};Qy(t);const i=n.dependencies;return t.directiveDefs=_f(i,!1),t.pipeDefs=_f(i,!0),t.id=function yw(n){let e=0;const t=[n.selectors,n.ngContentSelectors,n.hostVars,n.hostAttrs,n.consts,n.vars,n.decls,n.encapsulation,n.standalone,n.signals,n.exportAs,JSON.stringify(n.inputs),JSON.stringify(n.outputs),Object.getOwnPropertyNames(n.type.prototype),!!n.contentQueries,!!n.viewQuery].join("|");for(const r of t)e=Math.imul(31,e)+r.charCodeAt(0)<<0;return e+=2147483648,"c"+e}(t),t})}function pw(n){return jn(n)||Br(n)}function mw(n){return null!==n}function Wo(n){return da(()=>({type:n.type,bootstrap:n.bootstrap||Yn,declarations:n.declarations||Yn,imports:n.imports||Yn,exports:n.exports||Yn,transitiveCompileScopes:null,schemas:n.schemas||null,id:n.id||null}))}function Jy(n,e){if(null==n)return Go;const t={};for(const i in n)if(n.hasOwnProperty(i)){let r=n[i],o=r;Array.isArray(r)&&(o=r[1],r=r[0]),t[r]=i,e&&(e[r]=o)}return t}function an(n){return da(()=>{const e=Ky(n);return Qy(e),e})}function jn(n){return n[yf]||null}function Br(n){return n[mg]||null}function ls(n){return n[gg]||null}function ks(n,e){const t=n[zy]||null;if(!t&&!0===e)throw new Error(`Type ${dr(n)} does not have '\u0275mod' property.`);return t}function Ky(n){const e={};return{type:n.type,providersResolver:null,factory:null,hostBindings:n.hostBindings||null,hostVars:n.hostVars||0,hostAttrs:n.hostAttrs||null,contentQueries:n.contentQueries||null,declaredInputs:e,inputTransforms:null,inputConfig:n.inputs||Go,exportAs:n.exportAs||null,standalone:!0===n.standalone,signals:!0===n.signals,selectors:n.selectors||Yn,viewQuery:n.viewQuery||null,features:n.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:Jy(n.inputs,e),outputs:Jy(n.outputs)}}function Qy(n){n.features?.forEach(e=>e(n))}function _f(n,e){if(!n)return null;const t=e?ls:pw;return()=>("function"==typeof n?n():n).map(i=>t(i)).filter(mw)}const qi=0,ht=1,xn=2,Fi=3,wo=4,yh=5,Kr=6,Bc=7,rr=8,Ya=9,kc=10,pn=11,_h=12,e_=13,Vc=14,sr=15,xh=16,Wn=17,Tt=18,Mh=19,Za=20,Qt=21,Ss=22,pa=23,wh=24,Un=25,wn=1,Qr=2,kr=7,or=9,si=11;function cs(n){return Array.isArray(n)&&"object"==typeof n[wn]}function Yi(n){return Array.isArray(n)&&!0===n[wn]}function jo(n){return 0!=(4&n.flags)}function $o(n){return n.componentOffset>-1}function Mf(n){return 1==(1&n.flags)}function at(n){return!!n.template}function ma(n){return 0!=(512&n[xn])}function Zi(n,e){return n.hasOwnProperty(fa)?n[fa]:null}let Vr=null,Cf=!1;function Ws(n){const e=Vr;return Vr=n,e}const n_={version:0,dirty:!1,producerNode:void 0,producerLastReadVersion:void 0,producerIndexOfThis:void 0,nextProducerIndex:0,liveConsumerNode:void 0,liveConsumerIndexOfThis:void 0,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{}};function Af(n){if(!Sh(n)||n.dirty){if(!n.producerMustRecompute(n)&&!Gc(n))return void(n.dirty=!1);n.producerRecomputeValue(n),n.dirty=!1}}function r_(n){n.dirty=!0,function i_(n){if(void 0===n.liveConsumerNode)return;const e=Cf;Cf=!0;try{for(const t of n.liveConsumerNode)t.dirty||r_(t)}finally{Cf=e}}(n),n.consumerMarkedDirty?.(n)}function xg(n){return n&&(n.nextProducerIndex=0),Ws(n)}function Mg(n,e){if(Ws(e),n&&void 0!==n.producerNode&&void 0!==n.producerIndexOfThis&&void 0!==n.producerLastReadVersion){if(Sh(n))for(let t=n.nextProducerIndex;t<n.producerNode.length;t++)Eh(n.producerNode[t],n.producerIndexOfThis[t]);for(;n.producerNode.length>n.nextProducerIndex;)n.producerNode.pop(),n.producerLastReadVersion.pop(),n.producerIndexOfThis.pop()}}function Gc(n){Wc(n);for(let e=0;e<n.producerNode.length;e++){const t=n.producerNode[e],i=n.producerLastReadVersion[e];if(i!==t.version||(Af(t),i!==t.version))return!0}return!1}function wg(n){if(Wc(n),Sh(n))for(let e=0;e<n.producerNode.length;e++)Eh(n.producerNode[e],n.producerIndexOfThis[e]);n.producerNode.length=n.producerLastReadVersion.length=n.producerIndexOfThis.length=0,n.liveConsumerNode&&(n.liveConsumerNode.length=n.liveConsumerIndexOfThis.length=0)}function Eh(n,e){if(function s_(n){n.liveConsumerNode??=[],n.liveConsumerIndexOfThis??=[]}(n),Wc(n),1===n.liveConsumerNode.length)for(let i=0;i<n.producerNode.length;i++)Eh(n.producerNode[i],n.producerIndexOfThis[i]);const t=n.liveConsumerNode.length-1;if(n.liveConsumerNode[e]=n.liveConsumerNode[t],n.liveConsumerIndexOfThis[e]=n.liveConsumerIndexOfThis[t],n.liveConsumerNode.length--,n.liveConsumerIndexOfThis.length--,e<n.liveConsumerNode.length){const i=n.liveConsumerIndexOfThis[e],r=n.liveConsumerNode[e];Wc(r),r.producerIndexOfThis[i]=e}}function Sh(n){return n.consumerIsAlwaysLive||(n?.liveConsumerNode?.length??0)>0}function Wc(n){n.producerNode??=[],n.producerIndexOfThis??=[],n.producerLastReadVersion??=[]}let o_=null;const Di=()=>{},bo=(()=>({...n_,consumerIsAlwaysLive:!0,consumerAllowSignalWrites:!1,consumerMarkedDirty:n=>{n.schedule(n.ref)},hasRun:!1,cleanupFn:Di}))();class Ah{constructor(e,t,i){this.previousValue=e,this.currentValue=t,this.firstChange=i}isFirstChange(){return this.firstChange}}function hs(){return Rl}function Rl(n){return n.type.prototype.ngOnChanges&&(n.setInput=Dh),Lf}function Lf(){const n=Pl(this),e=n?.current;if(e){const t=n.previous;if(t===Go)n.previous=e;else for(let i in e)t[i]=e[i];n.current=null,this.ngOnChanges(e)}}function Dh(n,e,t,i){const r=this.declaredInputs[t],o=Pl(n)||function Rh(n,e){return n[Il]=e}(n,{previous:Go,current:null}),a=o.current||(o.current={}),u=o.previous,h=u[r];a[r]=new Ah(h&&h.currentValue,e,u===Go),n[i]=e}hs.ngInherit=!0;const Il="__ngSimpleChanges__";function Pl(n){return n[Il]||null}const Ts=function(n,e,t){};function Qn(n){for(;Array.isArray(n);)n=n[qi];return n}function Rr(n,e){return Qn(e[n.index])}function Nl(n,e){return n.data[e]}function Ir(n,e){const t=e[n];return cs(t)?t:t[qi]}function Ui(n,e){return null==e?null:n[e]}function js(n){n[Wn]=0}function Nh(n){1024&n[xn]||(n[xn]|=1024,Kc(n,1))}function tl(n){1024&n[xn]&&(n[xn]&=-1025,Kc(n,-1))}function Kc(n,e){let t=n[Fi];if(null===t)return;t[yh]+=e;let i=t;for(t=t[Fi];null!==t&&(1===e&&1===i[yh]||-1===e&&0===i[yh]);)t[yh]+=e,i=t,t=t[Fi]}const Yt={lFrame:Hh(null),bindingsEnabled:!0,skipHydrationRootTNode:null};function qo(){return Yt.bindingsEnabled}function Re(){return Yt.lFrame.lView}function Pn(){return Yt.lFrame.tView}function Si(){let n=nl();for(;null!==n&&64===n.type;)n=n.parent;return n}function nl(){return Yt.lFrame.currentTNode}function ns(n,e){const t=Yt.lFrame;t.currentTNode=n,t.isParent=e}function ya(){return Yt.lFrame.isParent}function Bl(){return Yt.lFrame.bindingIndex++}function Eg(n,e){const t=Yt.lFrame;t.bindingIndex=t.bindingRootIndex=n,zi(e)}function zi(n){Yt.lFrame.currentDirectiveIndex=n}function il(){return Yt.lFrame.currentQueryIndex}function au(n){Yt.lFrame.currentQueryIndex=n}function Uf(n){const e=n[ht];return 2===e.type?e.declTNode:1===e.type?n[Kr]:null}function Vh(n,e,t){if(t&In.SkipSelf){let r=e,o=n;for(;!(r=r.parent,null!==r||t&In.Host||(r=Uf(o),null===r||(o=o[Vc],10&r.type))););if(null===r)return!1;e=r,n=o}const i=Yt.lFrame=zh();return i.currentTNode=e,i.lView=n,!0}function lu(n){const e=zh(),t=n[ht];Yt.lFrame=e,e.currentTNode=t.firstChild,e.lView=n,e.tView=t,e.contextLView=n,e.bindingIndex=t.bindingStartIndex,e.inI18n=!1}function zh(){const n=Yt.lFrame,e=null===n?null:n.child;return null===e?Hh(n):e}function Hh(n){const e={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:n,child:null,inI18n:!1};return null!==n&&(n.child=e),e}function Hr(){const n=Yt.lFrame;return Yt.lFrame=n.parent,n.currentTNode=null,n.lView=null,n}const fs=Hr;function cu(){const n=Hr();n.isParent=!0,n.tView=null,n.selectedIndex=-1,n.contextLView=null,n.elementDepthCount=0,n.currentDirectiveIndex=-1,n.currentNamespace=null,n.bindingRootIndex=-1,n.bindingIndex=-1,n.currentQueryIndex=0}function Hi(){return Yt.lFrame.selectedIndex}function Xs(n){Yt.lFrame.selectedIndex=n}function di(){const n=Yt.lFrame;return Nl(n.tView,n.selectedIndex)}let $h=!0;function Yo(){return $h}function pr(n){$h=n}function hu(n,e){for(let t=e.directiveStart,i=e.directiveEnd;t<i;t++){const o=n.data[t].type.prototype,{ngAfterContentInit:a,ngAfterContentChecked:u,ngAfterViewInit:h,ngAfterViewChecked:f,ngOnDestroy:g}=o;a&&(n.contentHooks??=[]).push(-t,a),u&&((n.contentHooks??=[]).push(t,u),(n.contentCheckHooks??=[]).push(t,u)),h&&(n.viewHooks??=[]).push(-t,h),f&&((n.viewHooks??=[]).push(t,f),(n.viewCheckHooks??=[]).push(t,f)),null!=g&&(n.destroyHooks??=[]).push(t,g)}}function Zo(n,e,t){Gr(n,e,3,t)}function du(n,e,t,i){(3&n[xn])===t&&Gr(n,e,t,i)}function Hf(n,e){let t=n[xn];(3&t)===e&&(t&=8191,t+=1,n[xn]=t)}function Gr(n,e,t,i){const o=i??-1,a=e.length-1;let u=0;for(let h=void 0!==i?65535&n[Wn]:0;h<a;h++)if("number"==typeof e[h+1]){if(u=e[h],null!=i&&u>=i)break}else e[h]<0&&(n[Wn]+=65536),(u<o||-1==o)&&(Xh(n,t,e,h),n[Wn]=(4294901760&n[Wn])+h+2),h++}function Eo(n,e){Ts(4,n,e);const t=Ws(null);try{e.call(n)}finally{Ws(t),Ts(5,n,e)}}function Xh(n,e,t,i){const r=t[i]<0,o=t[i+1],u=n[r?-t[i]:t[i]];r?n[xn]>>13<n[Wn]>>16&&(3&n[xn])===e&&(n[xn]+=8192,Eo(u,o)):Eo(u,o)}const Cs=-1;class Ma{constructor(e,t,i){this.factory=e,this.resolving=!1,this.canSeeViewProviders=t,this.injectImpl=i}}function Gf(n){return n!==Cs}function rl(n){return 32767&n}function zl(n,e){let t=function Sg(n){return n>>16}(n),i=e;for(;t>0;)i=i[Vc],t--;return i}let Yh=!0;function Zh(n){const e=Yh;return Yh=n,e}const Wf=255,Hl=5;let Cg=0;const lo={};function Ri(n,e){const t=$f(n,e);if(-1!==t)return t;const i=e[ht];i.firstCreatePass&&(n.injectorIndex=e.length,Jh(i.data,n),Jh(e,null),Jh(i.blueprint,null));const r=pu(n,e),o=n.injectorIndex;if(Gf(r)){const a=rl(r),u=zl(r,e),h=u[ht].data;for(let f=0;f<8;f++)e[o+f]=u[a+f]|h[a+f]}return e[o+8]=r,o}function Jh(n,e){n.push(0,0,0,0,0,0,0,0,e)}function $f(n,e){return-1===n.injectorIndex||n.parent&&n.parent.injectorIndex===n.injectorIndex||null===e[n.injectorIndex+8]?-1:n.injectorIndex}function pu(n,e){if(n.parent&&-1!==n.parent.injectorIndex)return n.parent.injectorIndex;let t=0,i=null,r=e;for(;null!==r;){if(i=ql(r),null===i)return Cs;if(t++,r=r[Vc],-1!==i.injectorIndex)return i.injectorIndex|t<<16}return Cs}function mu(n,e,t){!function jf(n,e,t){let i;"string"==typeof t?i=t.charCodeAt(0)||0:t.hasOwnProperty(gh)&&(i=t[gh]),null==i&&(i=t[gh]=Cg++);const r=i&Wf;e.data[n+(r>>Hl)]|=1<<r}(n,e,t)}function Xf(n,e,t){if(t&In.Optional||void 0!==n)return n;uf()}function Wl(n,e,t,i){if(t&In.Optional&&void 0===i&&(i=null),!(t&(In.Self|In.Host))){const r=n[Ya],o=ir(void 0);try{return r?r.get(e,i,t&In.Optional):as(e,i,t&In.Optional)}finally{ir(o)}}return Xf(i,0,t)}function jl(n,e,t,i=In.Default,r){if(null!==n){if(2048&e[xn]&&!(i&In.Self)){const a=function gu(n,e,t,i,r){let o=n,a=e;for(;null!==o&&null!==a&&2048&a[xn]&&!(512&a[xn]);){const u=$l(o,a,t,i|In.Self,lo);if(u!==lo)return u;let h=o.parent;if(!h){const f=a[Za];if(f){const g=f.get(t,lo,i);if(g!==lo)return g}h=ql(a),a=a[Vc]}o=h}return r}(n,e,t,i,lo);if(a!==lo)return a}const o=$l(n,e,t,i,lo);if(o!==lo)return o}return Wl(e,t,i,r)}function $l(n,e,t,i,r){const o=function Dg(n){if("string"==typeof n)return n.charCodeAt(0)||0;const e=n.hasOwnProperty(gh)?n[gh]:void 0;return"number"==typeof e?e>=0?e&Wf:Qh:e}(t);if("function"==typeof o){if(!Vh(e,n,i))return i&In.Host?Xf(r,0,i):Wl(e,t,i,r);try{let a;if(a=o(i),null!=a||i&In.Optional)return a;uf()}finally{fs()}}else if("number"==typeof o){let a=null,u=$f(n,e),h=Cs,f=i&In.Host?e[sr][Kr]:null;for((-1===u||i&In.SkipSelf)&&(h=-1===u?pu(n,e):e[u+8],h!==Cs&&qf(i,!1)?(a=e[ht],u=rl(h),e=zl(h,e)):u=-1);-1!==u;){const g=e[ht];if(h_(o,u,g.data)){const _=Ag(u,e,t,a,i,f);if(_!==lo)return _}h=e[u+8],h!==Cs&&qf(i,e[ht].data[u+8]===f)&&h_(o,u,e)?(a=g,u=rl(h),e=zl(h,e)):u=-1}}return r}function Ag(n,e,t,i,r,o){const a=e[ht],u=a.data[n+8],g=Kh(u,a,t,null==i?$o(u)&&Yh:i!=a&&0!=(3&u.type),r&In.Host&&o===u);return null!==g?ba(e,a,g,u):lo}function Kh(n,e,t,i,r){const o=n.providerIndexes,a=e.data,u=1048575&o,h=n.directiveStart,g=o>>20,x=r?u+g:n.directiveEnd;for(let M=i?u:u+g;M<x;M++){const E=a[M];if(M<h&&t===E||M>=h&&E.type===t)return M}if(r){const M=a[h];if(M&&at(M)&&M.type===t)return h}return null}function ba(n,e,t,i){let r=n[t];const o=e.data;if(function kl(n){return n instanceof Ma}(r)){const a=r;a.resolving&&function Py(n,e){const t=e?`. Dependency path: ${e.join(" > ")} > ${n}`:"";throw new z(-200,`Circular dependency in DI detected for ${n}${t}`)}(function Kn(n){return"function"==typeof n?n.name||n.toString():"object"==typeof n&&null!=n&&"function"==typeof n.type?n.type.name||n.type.toString():qt(n)}(o[t]));const u=Zh(a.canSeeViewProviders);a.resolving=!0;const f=a.injectImpl?ir(a.injectImpl):null;Vh(n,i,In.Default);try{r=n[t]=a.factory(void 0,o,n,i),e.firstCreatePass&&t>=i.directiveStart&&function zf(n,e,t){const{ngOnChanges:i,ngOnInit:r,ngDoCheck:o}=e.type.prototype;if(i){const a=Rl(e);(t.preOrderHooks??=[]).push(n,a),(t.preOrderCheckHooks??=[]).push(n,a)}r&&(t.preOrderHooks??=[]).push(0-n,r),o&&((t.preOrderHooks??=[]).push(n,o),(t.preOrderCheckHooks??=[]).push(n,o))}(t,o[t],e)}finally{null!==f&&ir(f),Zh(u),a.resolving=!1,fs()}}return r}function h_(n,e,t){return!!(t[e+(n>>Hl)]&1<<n)}function qf(n,e){return!(n&In.Self||n&In.Host&&e)}class Er{constructor(e,t){this._tNode=e,this._lView=t}get(e,t,i){return jl(this._tNode,this._lView,e,gf(i),t)}}function Qh(){return new Er(Si(),Re())}function sl(n){return ri(n)?()=>{const e=sl(mt(n));return e&&e()}:Zi(n)}function ql(n){const e=n[ht],t=e.type;return 2===t?e.declTNode:1===t?n[Kr]:null}const Sa="__parameters__";function So(n,e,t){return da(()=>{const i=function Zl(n){return function(...t){if(n){const i=n(...t);for(const r in i)this[r]=i[r]}}}(e);function r(...o){if(this instanceof r)return i.apply(this,o),this;const a=new r(...o);return u.annotation=a,u;function u(h,f,g){const _=h.hasOwnProperty(Sa)?h[Sa]:Object.defineProperty(h,Sa,{value:[]})[Sa];for(;_.length<=g;)_.push(null);return(_[g]=_[g]||[]).push(a),h}}return t&&(r.prototype=Object.create(t.prototype)),r.prototype.ngMetadataName=n,r.annotationCls=r,r})}function _u(n,e){n.forEach(t=>Array.isArray(t)?_u(t,e):e(t))}function p_(n,e,t){e>=n.length?n.push(t):n.splice(e,0,t)}function Zf(n,e){return e>=n.length-1?n.pop():n.splice(e,1)[0]}const Kf=mh(So("Optional"),8),Qf=mh(So("SkipSelf"),4);function At(n){return 128==(128&n.flags)}var tn=function(n){return n[n.Important=1]="Important",n[n.DashCase=2]="DashCase",n}(tn||{});const Mt=new Map;let fi=0;const Ci="__ngContext__";function Ln(n,e){cs(e)?(n[Ci]=e[Mh],function fn(n){Mt.set(n[Mh],n)}(e)):n[Ci]=e}let jr;function mr(n,e){return jr(n,e)}function Li(n){const e=n[Fi];return Yi(e)?e[Fi]:e}function v_(n){return Ng(n[_h])}function Lg(n){return Ng(n[wo])}function Ng(n){for(;null!==n&&!Yi(n);)n=n[wo];return n}function Aa(n,e,t,i,r){if(null!=i){let o,a=!1;Yi(i)?o=i:cs(i)&&(a=!0,i=i[qi]);const u=Qn(i);0===n&&null!==t?null==r?k(e,t,u):uo(e,t,u,r||null,!0):1===n&&null!==t?uo(e,t,u,r||null,!0):2===n?function Ys(n,e,t){const i=Me(n,e);i&&function he(n,e,t,i){n.removeChild(e,t,i)}(n,i,e,t)}(e,u,a):3===n&&e.destroyNode(u),null!=o&&function w_(n,e,t,i,r){const o=t[kr];o!==Qn(t)&&Aa(e,n,i,o,r);for(let u=si;u<t.length;u++){const h=t[u];Ct(h[ht],h,n,e,i,o)}}(e,n,o,t,r)}}function np(n,e,t){return n.createElement(e,t)}function x_(n,e){const t=n[or],i=t.indexOf(e);tl(e),t.splice(i,1)}function nd(n,e){if(n.length<=si)return;const t=si+e,i=n[t];if(i){const r=i[xh];null!==r&&r!==n&&x_(r,i),e>0&&(n[t-1][wo]=i[wo]);const o=Zf(n,si+e);!function y_(n,e){Ct(n,e,e[pn],2,null,null),e[qi]=null,e[Kr]=null}(i[ht],i);const a=o[Tt];null!==a&&a.detachView(o[ht]),i[Fi]=null,i[wo]=null,i[xn]&=-129}return i}function Fg(n,e){if(!(256&e[xn])){const t=e[pn];e[pa]&&wg(e[pa]),e[wh]&&wg(e[wh]),t.destroyNode&&Ct(n,e,t,3,null,null),function Uw(n){let e=n[_h];if(!e)return Ug(n[ht],n);for(;e;){let t=null;if(cs(e))t=e[_h];else{const i=e[si];i&&(t=i)}if(!t){for(;e&&!e[wo]&&e!==n;)cs(e)&&Ug(e[ht],e),e=e[Fi];null===e&&(e=n),cs(e)&&Ug(e[ht],e),t=e&&e[wo]}e=t}}(e)}}function Ug(n,e){if(!(256&e[xn])){e[xn]&=-129,e[xn]|=256,function Vw(n,e){let t;if(null!=n&&null!=(t=n.destroyHooks))for(let i=0;i<t.length;i+=2){const r=e[t[i]];if(!(r instanceof Ma)){const o=t[i+1];if(Array.isArray(o))for(let a=0;a<o.length;a+=2){const u=r[o[a]],h=o[a+1];Ts(4,u,h);try{h.call(u)}finally{Ts(5,u,h)}}else{Ts(4,r,o);try{o.call(r)}finally{Ts(5,r,o)}}}}}(n,e),function kw(n,e){const t=n.cleanup,i=e[Bc];if(null!==t)for(let o=0;o<t.length-1;o+=2)if("string"==typeof t[o]){const a=t[o+3];a>=0?i[a]():i[-a].unsubscribe(),o+=2}else t[o].call(i[t[o+1]]);null!==i&&(e[Bc]=null);const r=e[Qt];if(null!==r){e[Qt]=null;for(let o=0;o<r.length;o++)(0,r[o])()}}(n,e),1===e[ht].type&&e[pn].destroy();const t=e[xh];if(null!==t&&Yi(e[Fi])){t!==e[Fi]&&x_(t,e);const i=e[Tt];null!==i&&i.detachView(n)}!function Zn(n){Mt.delete(n[Mh])}(e)}}function Bg(n,e,t){return function M_(n,e,t){let i=e;for(;null!==i&&40&i.type;)i=(e=i).parent;if(null===i)return t[qi];{const{componentOffset:r}=i;if(r>-1){const{encapsulation:o}=n.data[i.directiveStart+r];if(o===xo.None||o===xo.Emulated)return null}return Rr(i,t)}}(n,e.parent,t)}function uo(n,e,t,i,r){n.insertBefore(e,t,i,r)}function k(n,e,t){n.appendChild(e,t)}function te(n,e,t,i,r){null!==i?uo(n,e,t,i,r):k(n,e,t)}function Me(n,e){return n.parentNode(e)}let $t,Hw,S_,kn=function _t(n,e,t){return 40&n.type?Rr(n,t):null};function yt(n,e,t,i){const r=Bg(n,i,e),o=e[pn],u=function Bn(n,e,t){return kn(n,e,t)}(i.parent||e[Kr],i,e);if(null!=r)if(Array.isArray(t))for(let h=0;h<t.length;h++)te(o,r,t[h],u,!1);else te(o,r,t,u,!1);void 0!==$t&&$t(o,i,e,t,r)}function Ai(n,e){if(null!==e){const t=e.type;if(3&t)return Rr(e,n);if(4&t)return $r(-1,n[e.index]);if(8&t){const i=e.child;if(null!==i)return Ai(n,i);{const r=n[e.index];return Yi(r)?$r(-1,r):Qn(r)}}if(32&t)return mr(e,n)()||Qn(n[e.index]);{const i=Ni(n,e);return null!==i?Array.isArray(i)?i[0]:Ai(Li(n[sr]),i):Ai(n,e.next)}}return null}function Ni(n,e){return null!==e?n[sr][Kr].projection[e.projection]:null}function $r(n,e){const t=si+n+1;if(t<e.length){const i=e[t],r=i[ht].firstChild;if(null!==r)return Ai(i,r)}return e[kr]}function ps(n,e,t,i,r,o,a){for(;null!=t;){const u=i[t.index],h=t.type;if(a&&0===e&&(u&&Ln(Qn(u),i),t.flags|=2),32!=(32&t.flags))if(8&h)ps(n,e,t.child,i,r,o,!1),Aa(e,n,r,u,o);else if(32&h){const f=mr(t,i);let g;for(;g=f();)Aa(e,n,r,g,o);Aa(e,n,r,u,o)}else 16&h?Co(n,e,i,t,r,o):Aa(e,n,r,u,o);t=a?t.projectionNext:t.next}}function Ct(n,e,t,i,r,o){ps(t,i,n.firstChild,e,r,o,!1)}function Co(n,e,t,i,r,o){const a=t[sr],h=a[Kr].projection[i.projection];if(Array.isArray(h))for(let f=0;f<h.length;f++)Aa(e,n,r,h[f],o);else{let f=h;const g=a[Fi];At(i)&&(f.flags|=128),ps(n,e,f,g,r,o,!0)}}function E_(n,e,t){""===t?n.removeAttribute(e,"class"):n.setAttribute(e,"class",t)}function ip(n,e,t){const{mergedAttrs:i,classes:r,styles:o}=t;null!==i&&vg(n,e,i),null!==r&&E_(n,e,r),null!==o&&function b_(n,e,t){n.setAttribute(e,"style",t)}(n,e,o)}function XA(n){return function Gw(){if(void 0===S_&&(S_=null,Ei.trustedTypes))try{S_=Ei.trustedTypes.createPolicy("angular#unsafe-bypass",{createHTML:n=>n,createScript:n=>n,createScriptURL:n=>n})}catch{}return S_}()?.createScriptURL(n)||n}class qA{constructor(e){this.changingThisBreaksApplicationSecurity=e}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${fr})`}}function Mu(n){return n instanceof qA?n.changingThisBreaksApplicationSecurity:n}function kg(n,e){const t=function VU(n){return n instanceof qA&&n.getTypeName()||null}(n);if(null!=t&&t!==e){if("ResourceURL"===t&&"URL"===e)return!0;throw new Error(`Required a safe ${e}, got a ${t} (see ${fr})`)}return t===e}const WU=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:\/?#]*(?:[\/?#]|$))/i;var op=function(n){return n[n.NONE=0]="NONE",n[n.HTML=1]="HTML",n[n.STYLE=2]="STYLE",n[n.SCRIPT=3]="SCRIPT",n[n.URL=4]="URL",n[n.RESOURCE_URL=5]="RESOURCE_URL",n}(op||{});function qw(n){const e=zg();return e?e.sanitize(op.URL,n)||"":kg(n,"URL")?Mu(n):function Ww(n){return(n=String(n)).match(WU)?n:"unsafe:"+n}(qt(n))}function t1(n){const e=zg();if(e)return XA(e.sanitize(op.RESOURCE_URL,n)||"");if(kg(n,"ResourceURL"))return XA(Mu(n));throw new z(904,!1)}function zg(){const n=Re();return n&&n[kc].sanitizer}const Hg=new Ot("ENVIRONMENT_INITIALIZER"),i1=new Ot("INJECTOR",-1),r1=new Ot("INJECTOR_DEF_TYPES");class Yw{get(e,t=ph){if(t===ph){const i=new Error(`NullInjectorError: No provider for ${dr(e)}!`);throw i.name="NullInjectorError",i}return t}}function i3(...n){return{\u0275providers:o1(0,n),\u0275fromNgModule:!0}}function o1(n,...e){const t=[],i=new Set;let r;const o=a=>{t.push(a)};return _u(e,a=>{const u=a;C_(u,o,[],i)&&(r||=[],r.push(u))}),void 0!==r&&a1(r,o),t}function a1(n,e){for(let t=0;t<n.length;t++){const{ngModule:i,providers:r}=n[t];Zw(r,o=>{e(o,i)})}}function C_(n,e,t,i){if(!(n=mt(n)))return!1;let r=null,o=df(n);const a=!o&&jn(n);if(o||a){if(a&&!a.standalone)return!1;r=n}else{const h=n.ngModule;if(o=df(h),!o)return!1;r=h}const u=i.has(r);if(a){if(u)return!1;if(i.add(r),a.dependencies){const h="function"==typeof a.dependencies?a.dependencies():a.dependencies;for(const f of h)C_(f,e,t,i)}}else{if(!o)return!1;{if(null!=o.imports&&!u){let f;i.add(r);try{_u(o.imports,g=>{C_(g,e,t,i)&&(f||=[],f.push(g))})}finally{}void 0!==f&&a1(f,e)}if(!u){const f=Zi(r)||(()=>new r);e({provide:r,useFactory:f,deps:Yn},r),e({provide:r1,useValue:r,multi:!0},r),e({provide:Hg,useValue:()=>Kt(r),multi:!0},r)}const h=o.providers;if(null!=h&&!u){const f=n;Zw(h,g=>{e(g,f)})}}}return r!==n&&void 0!==n.providers}function Zw(n,e){for(let t of n)Xa(t)&&(t=t.\u0275providers),Array.isArray(t)?Zw(t,e):e(t)}const r3=ni({provide:String,useValue:ni});function Jw(n){return null!==n&&"object"==typeof n&&r3 in n}function rd(n){return"function"==typeof n}const Kw=new Ot("Set Injector scope."),A_={},o3={};let Qw;function D_(){return void 0===Qw&&(Qw=new Yw),Qw}class Qo{}class ap extends Qo{get destroyed(){return this._destroyed}constructor(e,t,i,r){super(),this.parent=t,this.source=i,this.scopes=r,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,tb(e,a=>this.processProvider(a)),this.records.set(i1,lp(void 0,this)),r.has("environment")&&this.records.set(Qo,lp(void 0,this));const o=this.records.get(Kw);null!=o&&"string"==typeof o.value&&this.scopes.add(o.value),this.injectorDefTypes=new Set(this.get(r1.multi,Yn,In.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{for(const t of this._ngOnDestroyHooks)t.ngOnDestroy();const e=this._onDestroyHooks;this._onDestroyHooks=[];for(const t of e)t()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear()}}onDestroy(e){return this.assertNotDestroyed(),this._onDestroyHooks.push(e),()=>this.removeOnDestroy(e)}runInContext(e){this.assertNotDestroyed();const t=qa(this),i=ir(void 0);try{return e()}finally{qa(t),ir(i)}}get(e,t=ph,i=In.Default){if(this.assertNotDestroyed(),e.hasOwnProperty(Hy))return e[Hy](this);i=gf(i);const o=qa(this),a=ir(void 0);try{if(!(i&In.SkipSelf)){let h=this.records.get(e);if(void 0===h){const f=function h3(n){return"function"==typeof n||"object"==typeof n&&n instanceof Ot}(e)&&hf(e);h=f&&this.injectableDefInScope(f)?lp(eb(e),A_):null,this.records.set(e,h)}if(null!=h)return this.hydrate(e,h)}return(i&In.Self?D_():this.parent).get(e,t=i&In.Optional&&t===ph?null:t)}catch(u){if("NullInjectorError"===u.name){if((u[mf]=u[mf]||[]).unshift(dr(e)),o)throw u;return function ew(n,e,t,i){const r=n[mf];throw e[ky]&&r.unshift(e[ky]),n.message=function tw(n,e,t,i=null){n=n&&"\n"===n.charAt(0)&&"\u0275"==n.charAt(1)?n.slice(2):n;let r=dr(e);if(Array.isArray(e))r=e.map(dr).join(" -> ");else if("object"==typeof e){let o=[];for(let a in e)if(e.hasOwnProperty(a)){let u=e[a];o.push(a+":"+("string"==typeof u?JSON.stringify(u):dr(u)))}r=`{${o.join(", ")}}`}return`${t}${i?"("+i+")":""}[${r}]: ${n.replace(YM,"\n  ")}`}("\n"+n.message,r,t,i),n.ngTokenPath=r,n[mf]=null,n}(u,e,"R3InjectorError",this.source)}throw u}finally{ir(a),qa(o)}}resolveInjectorInitializers(){const e=qa(this),t=ir(void 0);try{const r=this.get(Hg.multi,Yn,In.Self);for(const o of r)o()}finally{qa(e),ir(t)}}toString(){const e=[],t=this.records;for(const i of t.keys())e.push(dr(i));return`R3Injector[${e.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new z(205,!1)}processProvider(e){let t=rd(e=mt(e))?e:mt(e&&e.provide);const i=function l3(n){return Jw(n)?lp(void 0,n.useValue):lp(function u1(n,e,t){let i;if(rd(n)){const r=mt(n);return Zi(r)||eb(r)}if(Jw(n))i=()=>mt(n.useValue);else if(function c1(n){return!(!n||!n.useFactory)}(n))i=()=>n.useFactory(...pg(n.deps||[]));else if(function l1(n){return!(!n||!n.useExisting)}(n))i=()=>Kt(mt(n.useExisting));else{const r=mt(n&&(n.useClass||n.provide));if(!function c3(n){return!!n.deps}(n))return Zi(r)||eb(r);i=()=>new r(...pg(n.deps))}return i}(n),A_)}(e);if(rd(e)||!0!==e.multi)this.records.get(t);else{let r=this.records.get(t);r||(r=lp(void 0,A_,!0),r.factory=()=>pg(r.multi),this.records.set(t,r)),t=e,r.multi.push(e)}this.records.set(t,i)}hydrate(e,t){return t.value===A_&&(t.value=o3,t.value=t.factory()),"object"==typeof t.value&&t.value&&function u3(n){return null!==n&&"object"==typeof n&&"function"==typeof n.ngOnDestroy}(t.value)&&this._ngOnDestroyHooks.add(t.value),t.value}injectableDefInScope(e){if(!e.providedIn)return!1;const t=mt(e.providedIn);return"string"==typeof t?"any"===t||this.scopes.has(t):this.injectorDefTypes.has(t)}removeOnDestroy(e){const t=this._onDestroyHooks.indexOf(e);-1!==t&&this._onDestroyHooks.splice(t,1)}}function eb(n){const e=hf(n),t=null!==e?e.factory:Zi(n);if(null!==t)return t;if(n instanceof Ot)throw new z(204,!1);if(n instanceof Function)return function a3(n){const e=n.length;if(e>0)throw function td(n,e){const t=[];for(let i=0;i<n;i++)t.push(e);return t}(e,"?"),new z(204,!1);const t=function $M(n){return n&&(n[ff]||n[Oy])||null}(n);return null!==t?()=>t.factory(n):()=>new n}(n);throw new z(204,!1)}function lp(n,e,t=!1){return{factory:n,value:e,multi:t?[]:void 0}}function tb(n,e){for(const t of n)Array.isArray(t)?tb(t,e):t&&Xa(t)?tb(t.\u0275providers,e):e(t)}const R_=new Ot("AppId",{providedIn:"root",factory:()=>d3}),d3="ng",h1=new Ot("Platform Initializer"),cp=new Ot("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),d1=new Ot("CSP nonce",{providedIn:"root",factory:()=>function sp(){if(void 0!==Hw)return Hw;if(typeof document<"u")return document;throw new z(210,!1)}().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});let f1=(n,e,t)=>null;function cb(n,e,t=!1){return f1(n,e,t)}class w3{}class g1{}class E3{resolveComponentFactory(e){throw function b3(n){const e=Error(`No component factory found for ${dr(n)}.`);return e.ngComponent=n,e}(e)}}let F_=(()=>{class n{static#e=this.NULL=new E3}return n})();function S3(){return dp(Si(),Re())}function dp(n,e){return new Ao(Rr(n,e))}let Ao=(()=>{class n{constructor(t){this.nativeElement=t}static#e=this.__NG_ELEMENT_ID__=S3}return n})();function T3(n){return n instanceof Ao?n.nativeElement:n}class y1{}let ec=(()=>{class n{constructor(){this.destroyNode=null}static#e=this.__NG_ELEMENT_ID__=()=>function C3(){const n=Re(),t=Ir(Si().index,n);return(cs(t)?t:n)[pn]}()}return n})(),A3=(()=>{class n{static#e=this.\u0275prov=Zt({token:n,providedIn:"root",factory:()=>null})}return n})();class jg{constructor(e){this.full=e,this.major=e.split(".")[0],this.minor=e.split(".")[1],this.patch=e.split(".").slice(2).join(".")}}const D3=new jg("16.2.12"),db={};function w1(n,e=null,t=null,i){const r=b1(n,e,t,i);return r.resolveInjectorInitializers(),r}function b1(n,e=null,t=null,i,r=new Set){const o=[t||Yn,i3(n)];return i=i||("object"==typeof n?void 0:dr(n)),new ap(o,e||D_(),i||null,r)}let Do=(()=>{class n{static#e=this.THROW_IF_NOT_FOUND=ph;static#t=this.NULL=new Yw;static create(t,i){if(Array.isArray(t))return w1({name:""},i,t,"");{const r=t.name??"";return w1({name:r},t.parent,t.providers,r)}}static#n=this.\u0275prov=Zt({token:n,providedIn:"any",factory:()=>Kt(i1)});static#i=this.__NG_ELEMENT_ID__=-1}return n})();function pb(n){return n.ngOriginalError}class tc{constructor(){this._console=console}handleError(e){const t=this._findOriginalError(e);this._console.error("ERROR",e),t&&this._console.error("ORIGINAL ERROR",t)}_findOriginalError(e){let t=e&&pb(e);for(;t&&pb(t);)t=pb(t);return t||null}}function gb(n){return e=>{setTimeout(n,void 0,e)}}const gr=class F3 extends Os{constructor(e=!1){super(),this.__isAsync=e}emit(e){super.next(e)}subscribe(e,t,i){let r=e,o=t||(()=>null),a=i;if(e&&"object"==typeof e){const h=e;r=h.next?.bind(h),o=h.error?.bind(h),a=h.complete?.bind(h)}this.__isAsync&&(o=gb(o),r&&(r=gb(r)),a&&(a=gb(a)));const u=super.subscribe({next:r,error:o,complete:a});return e instanceof er&&e.add(u),u}};function S1(...n){}class Bi{constructor({enableLongStackTrace:e=!1,shouldCoalesceEventChangeDetection:t=!1,shouldCoalesceRunChangeDetection:i=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new gr(!1),this.onMicrotaskEmpty=new gr(!1),this.onStable=new gr(!1),this.onError=new gr(!1),typeof Zone>"u")throw new z(908,!1);Zone.assertZonePatched();const r=this;r._nesting=0,r._outer=r._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(r._inner=r._inner.fork(new Zone.TaskTrackingZoneSpec)),e&&Zone.longStackTraceZoneSpec&&(r._inner=r._inner.fork(Zone.longStackTraceZoneSpec)),r.shouldCoalesceEventChangeDetection=!i&&t,r.shouldCoalesceRunChangeDetection=i,r.lastRequestAnimationFrameId=-1,r.nativeRequestAnimationFrame=function U3(){const n="function"==typeof Ei.requestAnimationFrame;let e=Ei[n?"requestAnimationFrame":"setTimeout"],t=Ei[n?"cancelAnimationFrame":"clearTimeout"];if(typeof Zone<"u"&&e&&t){const i=e[Zone.__symbol__("OriginalDelegate")];i&&(e=i);const r=t[Zone.__symbol__("OriginalDelegate")];r&&(t=r)}return{nativeRequestAnimationFrame:e,nativeCancelAnimationFrame:t}}().nativeRequestAnimationFrame,function V3(n){const e=()=>{!function k3(n){n.isCheckStableRunning||-1!==n.lastRequestAnimationFrameId||(n.lastRequestAnimationFrameId=n.nativeRequestAnimationFrame.call(Ei,()=>{n.fakeTopEventTask||(n.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{n.lastRequestAnimationFrameId=-1,yb(n),n.isCheckStableRunning=!0,vb(n),n.isCheckStableRunning=!1},void 0,()=>{},()=>{})),n.fakeTopEventTask.invoke()}),yb(n))}(n)};n._inner=n._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(t,i,r,o,a,u)=>{if(function H3(n){return!(!Array.isArray(n)||1!==n.length)&&!0===n[0].data?.__ignore_ng_zone__}(u))return t.invokeTask(r,o,a,u);try{return T1(n),t.invokeTask(r,o,a,u)}finally{(n.shouldCoalesceEventChangeDetection&&"eventTask"===o.type||n.shouldCoalesceRunChangeDetection)&&e(),C1(n)}},onInvoke:(t,i,r,o,a,u,h)=>{try{return T1(n),t.invoke(r,o,a,u,h)}finally{n.shouldCoalesceRunChangeDetection&&e(),C1(n)}},onHasTask:(t,i,r,o)=>{t.hasTask(r,o),i===r&&("microTask"==o.change?(n._hasPendingMicrotasks=o.microTask,yb(n),vb(n)):"macroTask"==o.change&&(n.hasPendingMacrotasks=o.macroTask))},onHandleError:(t,i,r,o)=>(t.handleError(r,o),n.runOutsideAngular(()=>n.onError.emit(o)),!1)})}(r)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!Bi.isInAngularZone())throw new z(909,!1)}static assertNotInAngularZone(){if(Bi.isInAngularZone())throw new z(909,!1)}run(e,t,i){return this._inner.run(e,t,i)}runTask(e,t,i,r){const o=this._inner,a=o.scheduleEventTask("NgZoneEvent: "+r,e,B3,S1,S1);try{return o.runTask(a,t,i)}finally{o.cancelTask(a)}}runGuarded(e,t,i){return this._inner.runGuarded(e,t,i)}runOutsideAngular(e){return this._outer.run(e)}}const B3={};function vb(n){if(0==n._nesting&&!n.hasPendingMicrotasks&&!n.isStable)try{n._nesting++,n.onMicrotaskEmpty.emit(null)}finally{if(n._nesting--,!n.hasPendingMicrotasks)try{n.runOutsideAngular(()=>n.onStable.emit(null))}finally{n.isStable=!0}}}function yb(n){n.hasPendingMicrotasks=!!(n._hasPendingMicrotasks||(n.shouldCoalesceEventChangeDetection||n.shouldCoalesceRunChangeDetection)&&-1!==n.lastRequestAnimationFrameId)}function T1(n){n._nesting++,n.isStable&&(n.isStable=!1,n.onUnstable.emit(null))}function C1(n){n._nesting--,vb(n)}class z3{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new gr,this.onMicrotaskEmpty=new gr,this.onStable=new gr,this.onError=new gr}run(e,t,i){return e.apply(t,i)}runGuarded(e,t,i){return e.apply(t,i)}runOutsideAngular(e){return e()}runTask(e,t,i,r){return e.apply(t,i)}}const A1=new Ot("",{providedIn:"root",factory:D1});function D1(){const n=St(Bi);let e=!0;return function Dy(...n){const e=Oc(n),t=function Ay(n,e){return"number"==typeof lh(n)?n.pop():e}(n,1/0),i=n;return i.length?1===i.length?bs(i[0]):ja(t)(wr(i,e)):so}(new tr(r=>{e=n.isStable&&!n.hasPendingMacrotasks&&!n.hasPendingMicrotasks,n.runOutsideAngular(()=>{r.next(e),r.complete()})}),new tr(r=>{let o;n.runOutsideAngular(()=>{o=n.onStable.subscribe(()=>{Bi.assertNotInAngularZone(),queueMicrotask(()=>{!e&&!n.hasPendingMacrotasks&&!n.hasPendingMicrotasks&&(e=!0,r.next(!0))})})});const a=n.onUnstable.subscribe(()=>{Bi.assertInAngularZone(),e&&(e=!1,n.runOutsideAngular(()=>{r.next(!1)}))});return()=>{o.unsubscribe(),a.unsubscribe()}}).pipe(lf()))}function nc(n){return n instanceof Function?n():n}let _b=(()=>{class n{constructor(){this.renderDepth=0,this.handler=null}begin(){this.handler?.validateBegin(),this.renderDepth++}end(){this.renderDepth--,0===this.renderDepth&&this.handler?.execute()}ngOnDestroy(){this.handler?.destroy(),this.handler=null}static#e=this.\u0275prov=Zt({token:n,providedIn:"root",factory:()=>new n})}return n})();function $g(n){for(;n;){n[xn]|=64;const e=Li(n);if(ma(n)&&!e)return n;n=e}return null}const N1=new Ot("",{providedIn:"root",factory:()=>!1});let B_=null;function B1(n,e){return n[e]??z1()}function k1(n,e){const t=z1();t.producerNode?.length&&(n[e]=B_,t.lView=n,B_=V1())}const K3={...n_,consumerIsAlwaysLive:!0,consumerMarkedDirty:n=>{$g(n.lView)},lView:null};function V1(){return Object.create(K3)}function z1(){return B_??=V1(),B_}const bn={};function sd(n){H1(Pn(),Re(),Hi()+n,!1)}function H1(n,e,t,i){if(!i)if(3==(3&e[xn])){const o=n.preOrderCheckHooks;null!==o&&Zo(e,o,t)}else{const o=n.preOrderHooks;null!==o&&du(e,o,0,t)}Xs(t)}function $e(n,e=In.Default){const t=Re();return null===t?Kt(n,e):jl(Si(),t,mt(n),e)}function k_(n,e,t,i,r,o,a,u,h,f,g){const _=e.blueprint.slice();return _[qi]=r,_[xn]=140|i,(null!==f||n&&2048&n[xn])&&(_[xn]|=2048),js(_),_[Fi]=_[Vc]=n,_[rr]=t,_[kc]=a||n&&n[kc],_[pn]=u||n&&n[pn],_[Ya]=h||n&&n[Ya]||null,_[Kr]=o,_[Mh]=function sn(){return fi++}(),_[Ss]=g,_[Za]=f,_[sr]=2==e.type?n[sr]:_,_}function mp(n,e,t,i,r){let o=n.data[e];if(null===o)o=function xb(n,e,t,i,r){const o=nl(),a=ya(),h=n.data[e]=function oB(n,e,t,i,r,o){let a=e?e.injectorIndex:-1,u=0;return function ao(){return null!==Yt.skipHydrationRootTNode}()&&(u|=128),{type:t,index:i,insertBeforeIndex:null,injectorIndex:a,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:u,providerIndexes:0,value:r,attrs:o,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:e,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,a?o:o&&o.parent,t,e,i,r);return null===n.firstChild&&(n.firstChild=h),null!==o&&(a?null==o.child&&null!==h.parent&&(o.child=h):null===o.next&&(o.next=h,h.prev=o)),h}(n,e,t,i,r),function bg(){return Yt.lFrame.inI18n}()&&(o.flags|=32);else if(64&o.type){o.type=t,o.value=i,o.attrs=r;const a=function ds(){const n=Yt.lFrame,e=n.currentTNode;return n.isParent?e:e.parent}();o.injectorIndex=null===a?-1:a.injectorIndex}return ns(o,!0),o}function Xg(n,e,t,i){if(0===t)return-1;const r=e.length;for(let o=0;o<t;o++)e.push(i),n.blueprint.push(i),n.data.push(null);return r}function W1(n,e,t,i,r){const o=B1(e,pa),a=Hi(),u=2&i;try{Xs(-1),u&&e.length>Un&&H1(n,e,Un,!1),Ts(u?2:0,r);const f=u?o:null,g=xg(f);try{null!==f&&(f.dirty=!1),t(i,r)}finally{Mg(f,g)}}finally{u&&null===e[pa]&&k1(e,pa),Xs(a),Ts(u?3:1,r)}}function Mb(n,e,t){if(jo(e)){const i=Ws(null);try{const o=e.directiveEnd;for(let a=e.directiveStart;a<o;a++){const u=n.data[a];u.contentQueries&&u.contentQueries(1,t[a],a)}}finally{Ws(i)}}}function wb(n,e,t){qo()&&(function fB(n,e,t,i){const r=t.directiveStart,o=t.directiveEnd;$o(t)&&function xB(n,e,t){const i=Rr(e,n),r=j1(t);let a=16;t.signals?a=4096:t.onPush&&(a=64);const u=V_(n,k_(n,r,null,a,i,e,null,n[kc].rendererFactory.createRenderer(i,t),null,null,null));n[e.index]=u}(e,t,n.data[r+t.componentOffset]),n.firstCreatePass||Ri(t,e),Ln(i,e);const a=t.initialInputs;for(let u=r;u<o;u++){const h=n.data[u],f=ba(e,n,u,t);Ln(f,e),null!==a&&MB(0,u-r,f,h,0,a),at(h)&&(Ir(t.index,e)[rr]=ba(e,n,u,t))}}(n,e,t,Rr(t,e)),64==(64&t.flags)&&Z1(n,e,t))}function bb(n,e,t=Rr){const i=e.localNames;if(null!==i){let r=e.index+1;for(let o=0;o<i.length;o+=2){const a=i[o+1],u=-1===a?t(e,n):n[a];n[r++]=u}}}function j1(n){const e=n.tView;return null===e||e.incompleteFirstPass?n.tView=Eb(1,null,n.template,n.decls,n.vars,n.directiveDefs,n.pipeDefs,n.viewQuery,n.schemas,n.consts,n.id):e}function Eb(n,e,t,i,r,o,a,u,h,f,g){const _=Un+i,x=_+r,M=function eB(n,e){const t=[];for(let i=0;i<e;i++)t.push(i<n?null:bn);return t}(_,x),E="function"==typeof f?f():f;return M[ht]={type:n,blueprint:M,template:t,queries:null,viewQuery:u,declTNode:e,data:M.slice().fill(null,_),bindingStartIndex:_,expandoStartIndex:x,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof o?o():o,pipeRegistry:"function"==typeof a?a():a,firstChild:null,schemas:h,consts:E,incompleteFirstPass:!1,ssrId:g}}let $1=n=>null;function X1(n,e,t,i){for(let r in n)if(n.hasOwnProperty(r)){t=null===t?{}:t;const o=n[r];null===i?q1(t,e,r,o):i.hasOwnProperty(r)&&q1(t,e,i[r],o)}return t}function q1(n,e,t,i){n.hasOwnProperty(t)?n[t].push(e,i):n[t]=[e,i]}function Ro(n,e,t,i,r,o,a,u){const h=Rr(e,t);let g,f=e.inputs;!u&&null!=f&&(g=f[i])?(Db(n,t,g,i,r),$o(e)&&function cB(n,e){const t=Ir(e,n);16&t[xn]||(t[xn]|=64)}(t,e.index)):3&e.type&&(i=function lB(n){return"class"===n?"className":"for"===n?"htmlFor":"formaction"===n?"formAction":"innerHtml"===n?"innerHTML":"readonly"===n?"readOnly":"tabindex"===n?"tabIndex":n}(i),r=null!=a?a(r,e.value||"",i):r,o.setProperty(h,i,r))}function Sb(n,e,t,i){if(qo()){const r=null===i?null:{"":-1},o=function mB(n,e){const t=n.directiveRegistry;let i=null,r=null;if(t)for(let o=0;o<t.length;o++){const a=t[o];if(Yy(e,a.selectors,!1))if(i||(i=[]),at(a))if(null!==a.findHostDirectiveDefs){const u=[];r=r||new Map,a.findHostDirectiveDefs(a,u,r),i.unshift(...u,a),Tb(n,e,u.length)}else i.unshift(a),Tb(n,e,0);else r=r||new Map,a.findHostDirectiveDefs?.(a,i,r),i.push(a)}return null===i?null:[i,r]}(n,t);let a,u;null===o?a=u=null:[a,u]=o,null!==a&&Y1(n,e,t,a,r,u),r&&function gB(n,e,t){if(e){const i=n.localNames=[];for(let r=0;r<e.length;r+=2){const o=t[e[r+1]];if(null==o)throw new z(-301,!1);i.push(e[r],o)}}}(t,i,r)}t.mergedAttrs=vh(t.mergedAttrs,t.attrs)}function Y1(n,e,t,i,r,o){for(let f=0;f<i.length;f++)mu(Ri(t,e),n,i[f].type);!function yB(n,e,t){n.flags|=1,n.directiveStart=e,n.directiveEnd=e+t,n.providerIndexes=e}(t,n.data.length,i.length);for(let f=0;f<i.length;f++){const g=i[f];g.providersResolver&&g.providersResolver(g)}let a=!1,u=!1,h=Xg(n,e,i.length,null);for(let f=0;f<i.length;f++){const g=i[f];t.mergedAttrs=vh(t.mergedAttrs,g.hostAttrs),_B(n,t,e,h,g),vB(h,g,r),null!==g.contentQueries&&(t.flags|=4),(null!==g.hostBindings||null!==g.hostAttrs||0!==g.hostVars)&&(t.flags|=64);const _=g.type.prototype;!a&&(_.ngOnChanges||_.ngOnInit||_.ngDoCheck)&&((n.preOrderHooks??=[]).push(t.index),a=!0),!u&&(_.ngOnChanges||_.ngDoCheck)&&((n.preOrderCheckHooks??=[]).push(t.index),u=!0),h++}!function aB(n,e,t){const r=e.directiveEnd,o=n.data,a=e.attrs,u=[];let h=null,f=null;for(let g=e.directiveStart;g<r;g++){const _=o[g],x=t?t.get(_):null,E=x?x.outputs:null;h=X1(_.inputs,g,h,x?x.inputs:null),f=X1(_.outputs,g,f,E);const D=null===h||null===a||qy(e)?null:wB(h,g,a);u.push(D)}null!==h&&(h.hasOwnProperty("class")&&(e.flags|=8),h.hasOwnProperty("style")&&(e.flags|=16)),e.initialInputs=u,e.inputs=h,e.outputs=f}(n,t,o)}function Z1(n,e,t){const i=t.directiveStart,r=t.directiveEnd,o=t.index,a=function Ff(){return Yt.lFrame.currentDirectiveIndex}();try{Xs(o);for(let u=i;u<r;u++){const h=n.data[u],f=e[u];zi(u),(null!==h.hostBindings||0!==h.hostVars||null!==h.hostAttrs)&&pB(h,f)}}finally{Xs(-1),zi(a)}}function pB(n,e){null!==n.hostBindings&&n.hostBindings(1,e)}function Tb(n,e,t){e.componentOffset=t,(n.components??=[]).push(e.index)}function vB(n,e,t){if(t){if(e.exportAs)for(let i=0;i<e.exportAs.length;i++)t[e.exportAs[i]]=n;at(e)&&(t[""]=n)}}function _B(n,e,t,i,r){n.data[i]=r;const o=r.factory||(r.factory=Zi(r.type)),a=new Ma(o,at(r),$e);n.blueprint[i]=a,t[i]=a,function hB(n,e,t,i,r){const o=r.hostBindings;if(o){let a=n.hostBindingOpCodes;null===a&&(a=n.hostBindingOpCodes=[]);const u=~e.index;(function dB(n){let e=n.length;for(;e>0;){const t=n[--e];if("number"==typeof t&&t<0)return t}return 0})(a)!=u&&a.push(u),a.push(t,i,o)}}(n,e,i,Xg(n,t,r.hostVars,bn),r)}function cl(n,e,t,i,r,o){const a=Rr(n,e);!function Cb(n,e,t,i,r,o,a){if(null==o)n.removeAttribute(e,r,t);else{const u=null==a?qt(o):a(o,i||"",r);n.setAttribute(e,r,u,t)}}(e[pn],a,o,n.value,t,i,r)}function MB(n,e,t,i,r,o){const a=o[e];if(null!==a)for(let u=0;u<a.length;)J1(i,t,a[u++],a[u++],a[u++])}function J1(n,e,t,i,r){const o=Ws(null);try{const a=n.inputTransforms;null!==a&&a.hasOwnProperty(i)&&(r=a[i].call(e,r)),null!==n.setInput?n.setInput(e,r,t,i):e[i]=r}finally{Ws(o)}}function wB(n,e,t){let i=null,r=0;for(;r<t.length;){const o=t[r];if(0!==o)if(5!==o){if("number"==typeof o)break;if(n.hasOwnProperty(o)){null===i&&(i=[]);const a=n[o];for(let u=0;u<a.length;u+=2)if(a[u]===e){i.push(o,a[u+1],t[r+1]);break}}r+=2}else r+=2;else r+=4}return i}function K1(n,e,t,i){return[n,!0,!1,e,null,0,i,t,null,null,null]}function Q1(n,e){const t=n.contentQueries;if(null!==t)for(let i=0;i<t.length;i+=2){const o=t[i+1];if(-1!==o){const a=n.data[o];au(t[i]),a.contentQueries(2,e[o],o)}}}function V_(n,e){return n[_h]?n[e_][wo]=e:n[_h]=e,n[e_]=e,e}function Ab(n,e,t){au(0);const i=Ws(null);try{e(n,t)}finally{Ws(i)}}function eD(n){return n[Bc]||(n[Bc]=[])}function tD(n){return n.cleanup||(n.cleanup=[])}function iD(n,e){const t=n[Ya],i=t?t.get(tc,null):null;i&&i.handleError(e)}function Db(n,e,t,i,r){for(let o=0;o<t.length;){const a=t[o++],u=t[o++];J1(n.data[a],e[a],i,u,r)}}function ic(n,e,t){const i=function va(n,e){return Qn(e[n])}(e,n);!function Og(n,e,t){n.setValue(e,t)}(n[pn],i,t)}function bB(n,e){const t=Ir(e,n),i=t[ht];!function EB(n,e){for(let t=e.length;t<n.blueprint.length;t++)e.push(n.blueprint[t])}(i,t);const r=t[qi];null!==r&&null===t[Ss]&&(t[Ss]=cb(r,t[Ya])),Rb(i,t,t[rr])}function Rb(n,e,t){lu(e);try{const i=n.viewQuery;null!==i&&Ab(1,i,t);const r=n.template;null!==r&&W1(n,e,r,1,t),n.firstCreatePass&&(n.firstCreatePass=!1),n.staticContentQueries&&Q1(n,e),n.staticViewQueries&&Ab(2,n.viewQuery,t);const o=n.components;null!==o&&function SB(n,e){for(let t=0;t<e.length;t++)bB(n,e[t])}(e,o)}catch(i){throw n.firstCreatePass&&(n.incompleteFirstPass=!0,n.firstCreatePass=!1),i}finally{e[xn]&=-5,cu()}}let rD=(()=>{class n{constructor(){this.all=new Set,this.queue=new Map}create(t,i,r){const o=typeof Zone>"u"?null:Zone.current,a=function ga(n,e,t){const i=Object.create(bo);t&&(i.consumerAllowSignalWrites=!0),i.fn=n,i.schedule=e;const r=a=>{i.cleanupFn=a};return i.ref={notify:()=>r_(i),run:()=>{if(i.dirty=!1,i.hasRun&&!Gc(i))return;i.hasRun=!0;const a=xg(i);try{i.cleanupFn(),i.cleanupFn=Di,i.fn(r)}finally{Mg(i,a)}},cleanup:()=>i.cleanupFn()},i.ref}(t,f=>{this.all.has(f)&&this.queue.set(f,o)},r);let u;this.all.add(a),a.notify();const h=()=>{a.cleanup(),u?.(),this.all.delete(a),this.queue.delete(a)};return u=i?.onDestroy(h),{destroy:h}}flush(){if(0!==this.queue.size)for(const[t,i]of this.queue)this.queue.delete(t),i?i.run(()=>t.run()):t.run()}get isQueueEmpty(){return 0===this.queue.size}static#e=this.\u0275prov=Zt({token:n,providedIn:"root",factory:()=>new n})}return n})();function z_(n,e,t){let i=t?n.styles:null,r=t?n.classes:null,o=0;if(null!==e)for(let a=0;a<e.length;a++){const u=e[a];"number"==typeof u?o=u:1==o?r=dn(r,u):2==o&&(i=dn(i,u+": "+e[++a]+";"))}t?n.styles=i:n.stylesWithoutHost=i,t?n.classes=r:n.classesWithoutHost=r}function qg(n,e,t,i,r=!1){for(;null!==t;){const o=e[t.index];null!==o&&i.push(Qn(o)),Yi(o)&&sD(o,i);const a=t.type;if(8&a)qg(n,e,t.child,i);else if(32&a){const u=mr(t,e);let h;for(;h=u();)i.push(h)}else if(16&a){const u=Ni(e,t);if(Array.isArray(u))i.push(...u);else{const h=Li(e[sr]);qg(h[ht],h,u,i,!0)}}t=r?t.projectionNext:t.next}return i}function sD(n,e){for(let t=si;t<n.length;t++){const i=n[t],r=i[ht].firstChild;null!==r&&qg(i[ht],i,r,e)}n[kr]!==n[qi]&&e.push(n[kr])}function H_(n,e,t,i=!0){const r=e[kc],o=r.rendererFactory,a=r.afterRenderEventManager;o.begin?.(),a?.begin();try{oD(n,e,n.template,t)}catch(h){throw i&&iD(e,h),h}finally{o.end?.(),r.effectManager?.flush(),a?.end()}}function oD(n,e,t,i){const r=e[xn];if(256!=(256&r)){e[kc].effectManager?.flush(),lu(e);try{js(e),function $s(n){return Yt.lFrame.bindingIndex=n}(n.bindingStartIndex),null!==t&&W1(n,e,t,2,i);const a=3==(3&r);if(a){const f=n.preOrderCheckHooks;null!==f&&Zo(e,f,null)}else{const f=n.preOrderHooks;null!==f&&du(e,f,0,null),Hf(e,0)}if(function AB(n){for(let e=v_(n);null!==e;e=Lg(e)){if(!e[Qr])continue;const t=e[or];for(let i=0;i<t.length;i++){Nh(t[i])}}}(e),aD(e,2),null!==n.contentQueries&&Q1(n,e),a){const f=n.contentCheckHooks;null!==f&&Zo(e,f)}else{const f=n.contentHooks;null!==f&&du(e,f,1),Hf(e,1)}!function Q3(n,e){const t=n.hostBindingOpCodes;if(null===t)return;const i=B1(e,wh);try{for(let r=0;r<t.length;r++){const o=t[r];if(o<0)Xs(~o);else{const a=o,u=t[++r],h=t[++r];Eg(u,a),i.dirty=!1;const f=xg(i);try{h(2,e[a])}finally{Mg(i,f)}}}}finally{null===e[wh]&&k1(e,wh),Xs(-1)}}(n,e);const u=n.components;null!==u&&cD(e,u,0);const h=n.viewQuery;if(null!==h&&Ab(2,h,i),a){const f=n.viewCheckHooks;null!==f&&Zo(e,f)}else{const f=n.viewHooks;null!==f&&du(e,f,2),Hf(e,2)}!0===n.firstUpdatePass&&(n.firstUpdatePass=!1),e[xn]&=-73,tl(e)}finally{cu()}}}function aD(n,e){for(let t=v_(n);null!==t;t=Lg(t))for(let i=si;i<t.length;i++)lD(t[i],e)}function DB(n,e,t){lD(Ir(e,n),t)}function lD(n,e){if(!function Jc(n){return 128==(128&n[xn])}(n))return;const t=n[ht],i=n[xn];if(80&i&&0===e||1024&i||2===e)oD(t,n,t.template,n[rr]);else if(n[yh]>0){aD(n,1);const r=t.components;null!==r&&cD(n,r,1)}}function cD(n,e,t){for(let i=0;i<e.length;i++)DB(n,e[i],t)}class Yg{get rootNodes(){const e=this._lView,t=e[ht];return qg(t,e,t.firstChild,[])}constructor(e,t){this._lView=e,this._cdRefInjectingView=t,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[rr]}set context(e){this._lView[rr]=e}get destroyed(){return 256==(256&this._lView[xn])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const e=this._lView[Fi];if(Yi(e)){const t=e[8],i=t?t.indexOf(this):-1;i>-1&&(nd(e,i),Zf(t,i))}this._attachedToViewContainer=!1}Fg(this._lView[ht],this._lView)}onDestroy(e){!function Ol(n,e){if(256==(256&n[xn]))throw new z(911,!1);null===n[Qt]&&(n[Qt]=[]),n[Qt].push(e)}(this._lView,e)}markForCheck(){$g(this._cdRefInjectingView||this._lView)}detach(){this._lView[xn]&=-129}reattach(){this._lView[xn]|=128}detectChanges(){H_(this._lView[ht],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new z(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function Fw(n,e){Ct(n,e,e[pn],2,null,null)}(this._lView[ht],this._lView)}attachToAppRef(e){if(this._attachedToViewContainer)throw new z(902,!1);this._appRef=e}}class RB extends Yg{constructor(e){super(e),this._view=e}detectChanges(){const e=this._view;H_(e[ht],e,e[rr],!1)}checkNoChanges(){}get context(){return null}}class uD extends F_{constructor(e){super(),this.ngModule=e}resolveComponentFactory(e){const t=jn(e);return new Zg(t,this.ngModule)}}function hD(n){const e=[];for(let t in n)n.hasOwnProperty(t)&&e.push({propName:n[t],templateName:t});return e}class PB{constructor(e,t){this.injector=e,this.parentInjector=t}get(e,t,i){i=gf(i);const r=this.injector.get(e,db,i);return r!==db||t===db?r:this.parentInjector.get(e,t,i)}}class Zg extends g1{get inputs(){const e=this.componentDef,t=e.inputTransforms,i=hD(e.inputs);if(null!==t)for(const r of i)t.hasOwnProperty(r.propName)&&(r.transform=t[r.propName]);return i}get outputs(){return hD(this.componentDef.outputs)}constructor(e,t){super(),this.componentDef=e,this.ngModule=t,this.componentType=e.type,this.selector=function hw(n){return n.map(uw).join(",")}(e.selectors),this.ngContentSelectors=e.ngContentSelectors?e.ngContentSelectors:[],this.isBoundToModule=!!t}create(e,t,i,r){let o=(r=r||this.ngModule)instanceof Qo?r:r?.injector;o&&null!==this.componentDef.getStandaloneInjector&&(o=this.componentDef.getStandaloneInjector(o)||o);const a=o?new PB(e,o):e,u=a.get(y1,null);if(null===u)throw new z(407,!1);const _={rendererFactory:u,sanitizer:a.get(A3,null),effectManager:a.get(rD,null),afterRenderEventManager:a.get(_b,null)},x=u.createRenderer(null,this.componentDef),M=this.componentDef.selectors[0][0]||"div",E=i?function tB(n,e,t,i){const o=i.get(N1,!1)||t===xo.ShadowDom,a=n.selectRootElement(e,o);return function nB(n){$1(n)}(a),a}(x,i,this.componentDef.encapsulation,a):np(x,M,function IB(n){const e=n.toLowerCase();return"svg"===e?"svg":"math"===e?"math":null}(M)),S=this.componentDef.signals?4608:this.componentDef.onPush?576:528;let I=null;null!==E&&(I=cb(E,a,!0));const N=Eb(0,null,null,1,0,null,null,null,null,null,null),O=k_(null,N,null,S,null,null,_,x,a,null,I);let ne,$;lu(O);try{const K=this.componentDef;let oe,j=null;K.findHostDirectiveDefs?(oe=[],j=new Map,K.findHostDirectiveDefs(K,oe,j),oe.push(K)):oe=[K];const G=function NB(n,e){const t=n[ht],i=Un;return n[i]=e,mp(t,i,2,"#host",null)}(O,E),ce=function OB(n,e,t,i,r,o,a){const u=r[ht];!function FB(n,e,t,i){for(const r of n)e.mergedAttrs=vh(e.mergedAttrs,r.hostAttrs);null!==e.mergedAttrs&&(z_(e,e.mergedAttrs,!0),null!==t&&ip(i,t,e))}(i,n,e,a);let h=null;null!==e&&(h=cb(e,r[Ya]));const f=o.rendererFactory.createRenderer(e,t);let g=16;t.signals?g=4096:t.onPush&&(g=64);const _=k_(r,j1(t),null,g,r[n.index],n,o,f,null,null,h);return u.firstCreatePass&&Tb(u,n,i.length-1),V_(r,_),r[n.index]=_}(G,E,K,oe,O,_,x);$=Nl(N,Un),E&&function BB(n,e,t,i){if(i)vg(n,t,["ng-version",D3.full]);else{const{attrs:r,classes:o}=function dw(n){const e=[],t=[];let i=1,r=2;for(;i<n.length;){let o=n[i];if("string"==typeof o)2===r?""!==o&&e.push(o,n[++i]):8===r&&t.push(o);else{if(!Mo(r))break;r=o}i++}return{attrs:e,classes:t}}(e.selectors[0]);r&&vg(n,t,r),o&&o.length>0&&E_(n,t,o.join(" "))}}(x,K,E,i),void 0!==t&&function kB(n,e,t){const i=n.projection=[];for(let r=0;r<e.length;r++){const o=t[r];i.push(null!=o?Array.from(o):null)}}($,this.ngContentSelectors,t),ne=function UB(n,e,t,i,r,o){const a=Si(),u=r[ht],h=Rr(a,r);Y1(u,r,a,t,null,i);for(let g=0;g<t.length;g++)Ln(ba(r,u,a.directiveStart+g,a),r);Z1(u,r,a),h&&Ln(h,r);const f=ba(r,u,a.directiveStart+a.componentOffset,a);if(n[rr]=r[rr]=f,null!==o)for(const g of o)g(f,e);return Mb(u,a,n),f}(ce,K,oe,j,O,[VB]),Rb(N,O,null)}finally{cu()}return new LB(this.componentType,ne,dp($,O),O,$)}}class LB extends w3{constructor(e,t,i,r,o){super(),this.location=i,this._rootLView=r,this._tNode=o,this.previousInputValues=null,this.instance=t,this.hostView=this.changeDetectorRef=new RB(r),this.componentType=e}setInput(e,t){const i=this._tNode.inputs;let r;if(null!==i&&(r=i[e])){if(this.previousInputValues??=new Map,this.previousInputValues.has(e)&&Object.is(this.previousInputValues.get(e),t))return;const o=this._rootLView;Db(o[ht],o,r,e,t),this.previousInputValues.set(e,t),$g(Ir(this._tNode.index,o))}}get injector(){return new Er(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(e){this.hostView.onDestroy(e)}}function VB(){const n=Si();hu(Re()[ht],n)}function gD(n){const e=n.inputConfig,t={};for(const i in e)if(e.hasOwnProperty(i)){const r=e[i];Array.isArray(r)&&r[2]&&(t[i]=r[2])}n.inputTransforms=t}function W_(n){return!!function Ib(n){return null!==n&&("function"==typeof n||"object"==typeof n)}(n)&&(Array.isArray(n)||!(n instanceof Map)&&Symbol.iterator in n)}function Ds(n,e,t){return!Object.is(n[e],t)&&(n[e]=t,!0)}function hl(n,e,t,i){const r=Re();return Ds(r,Bl(),e)&&(Pn(),cl(di(),r,n,e,t,i)),hl}function vp(n,e,t,i){return Ds(n,Bl(),t)?e+qt(t)+i:bn}let RD=function ID(n,e,t,i){return pr(!0),e[pn].createComment("")};function Sp(n,e,t){const i=Re();return Ds(i,Bl(),e)&&Ro(Pn(),di(),i,n,e,i[pn],t,!1),Sp}function Ub(n,e,t,i,r){const a=r?"class":"style";Db(n,t,e.inputs[a],a,i)}function Da(n,e,t,i){const r=Re(),o=Pn(),a=Un+n,u=r[pn],h=o.firstCreatePass?function xk(n,e,t,i,r,o){const a=e.consts,h=mp(e,n,2,i,Ui(a,r));return Sb(e,t,h,Ui(a,o)),null!==h.attrs&&z_(h,h.attrs,!1),null!==h.mergedAttrs&&z_(h,h.mergedAttrs,!0),null!==e.queries&&e.queries.elementStart(e,h),h}(a,o,r,e,t,i):o.data[a],f=PD(o,r,h,u,e,n);r[a]=f;const g=Mf(h);return ns(h,!0),ip(u,f,h),32!=(32&h.flags)&&Yo()&&yt(o,r,f,h),0===function Qc(){return Yt.lFrame.elementDepthCount}()&&Ln(f,r),function eu(){Yt.lFrame.elementDepthCount++}(),g&&(wb(o,r,h),Mb(o,h,r)),null!==i&&bb(r,h),Da}function Ra(){let n=Si();ya()?function _a(){Yt.lFrame.isParent=!1}():(n=n.parent,ns(n,!1));const e=n;(function Fh(n){return Yt.skipHydrationRootTNode===n})(e)&&function iu(){Yt.skipHydrationRootTNode=null}(),function tu(){Yt.lFrame.elementDepthCount--}();const t=Pn();return t.firstCreatePass&&(hu(t,n),jo(n)&&t.queries.elementEnd(n)),null!=e.classesWithoutHost&&function Vl(n){return 0!=(8&n.flags)}(e)&&Ub(t,e,Re(),e.classesWithoutHost,!0),null!=e.stylesWithoutHost&&function qh(n){return 0!=(16&n.flags)}(e)&&Ub(t,e,Re(),e.stylesWithoutHost,!1),Ra}function ad(n,e,t,i){return Da(n,e,t,i),Ra(),ad}let PD=(n,e,t,i,r,o)=>(pr(!0),np(i,r,function jh(){return Yt.lFrame.currentNamespace}()));function tv(n){return!!n&&"function"==typeof n.then}function OD(n){return!!n&&"function"==typeof n.subscribe}function ta(n,e,t,i){const r=Re(),o=Pn(),a=Si();return function UD(n,e,t,i,r,o,a){const u=Mf(i),f=n.firstCreatePass&&tD(n),g=e[rr],_=eD(e);let x=!0;if(3&i.type||a){const D=Rr(i,e),C=a?a(D):D,S=_.length,I=a?O=>a(Qn(O[i.index])):i.index;let N=null;if(!a&&u&&(N=function Ck(n,e,t,i){const r=n.cleanup;if(null!=r)for(let o=0;o<r.length-1;o+=2){const a=r[o];if(a===t&&r[o+1]===i){const u=e[Bc],h=r[o+2];return u.length>h?u[h]:null}"string"==typeof a&&(o+=2)}return null}(n,e,r,i.index)),null!==N)(N.__ngLastListenerFn__||N).__ngNextListenerFn__=o,N.__ngLastListenerFn__=o,x=!1;else{o=kD(i,e,g,o,!1);const O=t.listen(C,r,o);_.push(o,O),f&&f.push(r,I,S,S+1)}}else o=kD(i,e,g,o,!1);const M=i.outputs;let E;if(x&&null!==M&&(E=M[r])){const D=E.length;if(D)for(let C=0;C<D;C+=2){const ne=e[E[C]][E[C+1]].subscribe(o),$=_.length;_.push(o,ne),f&&f.push(r,i.index,$,-($+1))}}}(o,r,r[pn],a,n,e,i),ta}function BD(n,e,t,i){try{return Ts(6,e,t),!1!==t(i)}catch(r){return iD(n,r),!1}finally{Ts(7,e,t)}}function kD(n,e,t,i,r){return function o(a){if(a===Function)return i;$g(n.componentOffset>-1?Ir(n.index,e):e);let h=BD(e,t,i,a),f=o.__ngNextListenerFn__;for(;f;)h=BD(e,t,f,a)&&h,f=f.__ngNextListenerFn__;return r&&!1===h&&a.preventDefault(),h}}function Vb(n,e,t){return zb(n,"",e,"",t),Vb}function zb(n,e,t,i,r){const o=Re(),a=vp(o,e,t,i);return a!==bn&&Ro(Pn(),di(),o,n,a,o[pn],r,!1),zb}function cd(n,e=""){const t=Re(),i=Pn(),r=n+Un,o=i.firstCreatePass?mp(i,r,1,e,null):i.data[r],a=lR(i,t,o,e,n);t[r]=a,Yo()&&yt(i,t,a,o),ns(o,!1)}let lR=(n,e,t,i,r)=>(pr(!0),function ep(n,e){return n.createText(e)}(e[pn],i));function K_(n){return $b("",n,""),K_}function $b(n,e,t){const i=Re(),r=vp(i,n,e,t);return r!==bn&&ic(i,Hi(),r),$b}const Ap="en-US";let RR=Ap;class hd{}class nI{}class Qb extends hd{constructor(e,t,i){super(),this._parent=t,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new uD(this);const r=ks(e);this._bootstrapComponents=nc(r.bootstrap),this._r3Injector=b1(e,t,[{provide:hd,useValue:this},{provide:F_,useValue:this.componentFactoryResolver},...i],dr(e),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(e)}get injector(){return this._r3Injector}destroy(){const e=this._r3Injector;!e.destroyed&&e.destroy(),this.destroyCbs.forEach(t=>t()),this.destroyCbs=null}onDestroy(e){this.destroyCbs.push(e)}}class eE extends nI{constructor(e){super(),this.moduleType=e}create(e){return new Qb(this.moduleType,e,[])}}class iI extends hd{constructor(e){super(),this.componentFactoryResolver=new uD(this),this.instance=null;const t=new ap([...e.providers,{provide:hd,useValue:this},{provide:F_,useValue:this.componentFactoryResolver}],e.parent||D_(),e.debugName,new Set(["environment"]));this.injector=t,e.runEnvironmentInitializers&&t.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(e){this.injector.onDestroy(e)}}function tE(n,e,t=null){return new iI({providers:n,parent:e,debugName:t,runEnvironmentInitializers:!0}).injector}let bz=(()=>{class n{constructor(t){this._injector=t,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(t){if(!t.standalone)return null;if(!this.cachedInjectors.has(t)){const i=o1(0,t.type),r=i.length>0?tE([i],this._injector,`Standalone[${t.type.name}]`):null;this.cachedInjectors.set(t,r)}return this.cachedInjectors.get(t)}ngOnDestroy(){try{for(const t of this.cachedInjectors.values())null!==t&&t.destroy()}finally{this.cachedInjectors.clear()}}static#e=this.\u0275prov=Zt({token:n,providedIn:"environment",factory:()=>new n(Kt(Qo))})}return n})();function rI(n){n.getStandaloneInjector=e=>e.get(bz).getOrCreateStandaloneInjector(n)}function iE(n,e,t,i){return function hI(n,e,t,i,r,o){const a=e+t;return Ds(n,a,r)?function ul(n,e,t){return n[e]=t}(n,a+1,o?i.call(o,r):i(r)):function lv(n,e){const t=n[e];return t===bn?void 0:t}(n,a+1)}(Re(),function zr(){const n=Yt.lFrame;let e=n.bindingRootIndex;return-1===e&&(e=n.bindingRootIndex=n.tView.bindingStartIndex),e}(),n,e,t,i)}function qz(){return this._results[Symbol.iterator]()}class rE{static#e=Symbol.iterator;get changes(){return this._changes||(this._changes=new gr)}constructor(e=!1){this._emitDistinctChangesOnly=e,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const t=rE.prototype;t[Symbol.iterator]||(t[Symbol.iterator]=qz)}get(e){return this._results[e]}map(e){return this._results.map(e)}filter(e){return this._results.filter(e)}find(e){return this._results.find(e)}reduce(e,t){return this._results.reduce(e,t)}forEach(e){this._results.forEach(e)}some(e){return this._results.some(e)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(e,t){const i=this;i.dirty=!1;const r=function co(n){return n.flat(Number.POSITIVE_INFINITY)}(e);(this._changesDetected=!function Sw(n,e,t){if(n.length!==e.length)return!1;for(let i=0;i<n.length;i++){let r=n[i],o=e[i];if(t&&(r=t(r),o=t(o)),o!==r)return!1}return!0}(i._results,r,t))&&(i._results=r,i.length=r.length,i.last=r[this.length-1],i.first=r[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}function Zz(n,e,t,i=!0){const r=e[ht];if(function Bw(n,e,t,i){const r=si+i,o=t.length;i>0&&(t[r-1][wo]=e),i<o-si?(e[wo]=t[r],p_(t,si+i,e)):(t.push(e),e[wo]=null),e[Fi]=t;const a=e[xh];null!==a&&t!==a&&function __(n,e){const t=n[or];e[sr]!==e[Fi][Fi][sr]&&(n[Qr]=!0),null===t?n[or]=[e]:t.push(e)}(a,e);const u=e[Tt];null!==u&&u.insertView(n),e[xn]|=128}(r,e,n,t),i){const o=$r(t,n),a=e[pn],u=Me(a,n[kr]);null!==u&&function Ow(n,e,t,i,r,o){i[qi]=r,i[Kr]=e,Ct(n,i,t,1,r,o)}(r,n[Kr],a,e,u,o)}}let rc=(()=>{class n{static#e=this.__NG_ELEMENT_ID__=Qz}return n})();const Jz=rc,Kz=class extends Jz{constructor(e,t,i){super(),this._declarationLView=e,this._declarationTContainer=t,this.elementRef=i}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(e,t){return this.createEmbeddedViewImpl(e,t)}createEmbeddedViewImpl(e,t,i){const r=function Yz(n,e,t,i){const r=e.tView,u=k_(n,r,t,4096&n[xn]?4096:16,null,e,null,null,null,i?.injector??null,i?.hydrationInfo??null);u[xh]=n[e.index];const f=n[Tt];return null!==f&&(u[Tt]=f.createEmbeddedView(r)),Rb(r,u,t),u}(this._declarationLView,this._declarationTContainer,e,{injector:t,hydrationInfo:i});return new Yg(r)}};function Qz(){return r0(Si(),Re())}function r0(n,e){return 4&n.type?new Kz(e,n,dp(n,e)):null}let La=(()=>{class n{static#e=this.__NG_ELEMENT_ID__=sH}return n})();function sH(){return wI(Si(),Re())}const oH=La,xI=class extends oH{constructor(e,t,i){super(),this._lContainer=e,this._hostTNode=t,this._hostLView=i}get element(){return dp(this._hostTNode,this._hostLView)}get injector(){return new Er(this._hostTNode,this._hostLView)}get parentInjector(){const e=pu(this._hostTNode,this._hostLView);if(Gf(e)){const t=zl(e,this._hostLView),i=rl(e);return new Er(t[ht].data[i+8],t)}return new Er(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(e){const t=MI(this._lContainer);return null!==t&&t[e]||null}get length(){return this._lContainer.length-si}createEmbeddedView(e,t,i){let r,o;"number"==typeof i?r=i:null!=i&&(r=i.index,o=i.injector);const u=e.createEmbeddedViewImpl(t||{},o,null);return this.insertImpl(u,r,false),u}createComponent(e,t,i,r,o){const a=e&&!function ed(n){return"function"==typeof n}(e);let u;if(a)u=t;else{const D=t||{};u=D.index,i=D.injector,r=D.projectableNodes,o=D.environmentInjector||D.ngModuleRef}const h=a?e:new Zg(jn(e)),f=i||this.parentInjector;if(!o&&null==h.ngModule){const C=(a?f:this.parentInjector).get(Qo,null);C&&(o=C)}jn(h.componentType??{});const M=h.create(f,r,null,o);return this.insertImpl(M.hostView,u,false),M}insert(e,t){return this.insertImpl(e,t,!1)}insertImpl(e,t,i){const r=e._lView;if(function Lh(n){return Yi(n[Fi])}(r)){const h=this.indexOf(e);if(-1!==h)this.detach(h);else{const f=r[Fi],g=new xI(f,f[Kr],f[Fi]);g.detach(g.indexOf(e))}}const a=this._adjustIndex(t),u=this._lContainer;return Zz(u,r,a,!i),e.attachToViewContainerRef(),p_(sE(u),a,e),e}move(e,t){return this.insert(e,t)}indexOf(e){const t=MI(this._lContainer);return null!==t?t.indexOf(e):-1}remove(e){const t=this._adjustIndex(e,-1),i=nd(this._lContainer,t);i&&(Zf(sE(this._lContainer),t),Fg(i[ht],i))}detach(e){const t=this._adjustIndex(e,-1),i=nd(this._lContainer,t);return i&&null!=Zf(sE(this._lContainer),t)?new Yg(i):null}_adjustIndex(e,t=0){return e??this.length+t}};function MI(n){return n[8]}function sE(n){return n[8]||(n[8]=[])}function wI(n,e){let t;const i=e[n.index];return Yi(i)?t=i:(t=K1(i,e,null,n),e[n.index]=t,V_(e,t)),bI(t,e,n,i),new xI(t,n,e)}let bI=function EI(n,e,t,i){if(n[kr])return;let r;r=8&t.type?Qn(i):function aH(n,e){const t=n[pn],i=t.createComment(""),r=Rr(e,n);return uo(t,Me(t,r),i,function jt(n,e){return n.nextSibling(e)}(t,r),!1),i}(e,t),n[kr]=r};class oE{constructor(e){this.queryList=e,this.matches=null}clone(){return new oE(this.queryList)}setDirty(){this.queryList.setDirty()}}class aE{constructor(e=[]){this.queries=e}createEmbeddedView(e){const t=e.queries;if(null!==t){const i=null!==e.contentQueries?e.contentQueries[0]:t.length,r=[];for(let o=0;o<i;o++){const a=t.getByIndex(o);r.push(this.queries[a.indexInDeclarationView].clone())}return new aE(r)}return null}insertView(e){this.dirtyQueriesWithMatches(e)}detachView(e){this.dirtyQueriesWithMatches(e)}dirtyQueriesWithMatches(e){for(let t=0;t<this.queries.length;t++)null!==PI(e,t).matches&&this.queries[t].setDirty()}}class SI{constructor(e,t,i=null){this.predicate=e,this.flags=t,this.read=i}}class lE{constructor(e=[]){this.queries=e}elementStart(e,t){for(let i=0;i<this.queries.length;i++)this.queries[i].elementStart(e,t)}elementEnd(e){for(let t=0;t<this.queries.length;t++)this.queries[t].elementEnd(e)}embeddedTView(e){let t=null;for(let i=0;i<this.length;i++){const r=null!==t?t.length:0,o=this.getByIndex(i).embeddedTView(e,r);o&&(o.indexInDeclarationView=i,null!==t?t.push(o):t=[o])}return null!==t?new lE(t):null}template(e,t){for(let i=0;i<this.queries.length;i++)this.queries[i].template(e,t)}getByIndex(e){return this.queries[e]}get length(){return this.queries.length}track(e){this.queries.push(e)}}class cE{constructor(e,t=-1){this.metadata=e,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=t}elementStart(e,t){this.isApplyingToNode(t)&&this.matchTNode(e,t)}elementEnd(e){this._declarationNodeIndex===e.index&&(this._appliesToNextNode=!1)}template(e,t){this.elementStart(e,t)}embeddedTView(e,t){return this.isApplyingToNode(e)?(this.crossesNgTemplate=!0,this.addMatch(-e.index,t),new cE(this.metadata)):null}isApplyingToNode(e){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const t=this._declarationNodeIndex;let i=e.parent;for(;null!==i&&8&i.type&&i.index!==t;)i=i.parent;return t===(null!==i?i.index:-1)}return this._appliesToNextNode}matchTNode(e,t){const i=this.metadata.predicate;if(Array.isArray(i))for(let r=0;r<i.length;r++){const o=i[r];this.matchTNodeWithReadOption(e,t,uH(t,o)),this.matchTNodeWithReadOption(e,t,Kh(t,e,o,!1,!1))}else i===rc?4&t.type&&this.matchTNodeWithReadOption(e,t,-1):this.matchTNodeWithReadOption(e,t,Kh(t,e,i,!1,!1))}matchTNodeWithReadOption(e,t,i){if(null!==i){const r=this.metadata.read;if(null!==r)if(r===Ao||r===La||r===rc&&4&t.type)this.addMatch(t.index,-2);else{const o=Kh(t,e,r,!1,!1);null!==o&&this.addMatch(t.index,o)}else this.addMatch(t.index,i)}}addMatch(e,t){null===this.matches?this.matches=[e,t]:this.matches.push(e,t)}}function uH(n,e){const t=n.localNames;if(null!==t)for(let i=0;i<t.length;i+=2)if(t[i]===e)return t[i+1];return null}function dH(n,e,t,i){return-1===t?function hH(n,e){return 11&n.type?dp(n,e):4&n.type?r0(n,e):null}(e,n):-2===t?function fH(n,e,t){return t===Ao?dp(e,n):t===rc?r0(e,n):t===La?wI(e,n):void 0}(n,e,i):ba(n,n[ht],t,e)}function TI(n,e,t,i){const r=e[Tt].queries[i];if(null===r.matches){const o=n.data,a=t.matches,u=[];for(let h=0;h<a.length;h+=2){const f=a[h];u.push(f<0?null:dH(e,o[f],a[h+1],t.metadata.read))}r.matches=u}return r.matches}function uE(n,e,t,i){const r=n.queries.getByIndex(t),o=r.matches;if(null!==o){const a=TI(n,e,r,t);for(let u=0;u<o.length;u+=2){const h=o[u];if(h>0)i.push(a[u/2]);else{const f=o[u+1],g=e[-h];for(let _=si;_<g.length;_++){const x=g[_];x[xh]===x[Fi]&&uE(x[ht],x,f,i)}if(null!==g[or]){const _=g[or];for(let x=0;x<_.length;x++){const M=_[x];uE(M[ht],M,f,i)}}}}}return i}function CI(n){const e=Re(),t=Pn(),i=il();au(i+1);const r=PI(t,i);if(n.dirty&&function Ph(n){return 4==(4&n[xn])}(e)===(2==(2&r.metadata.flags))){if(null===r.matches)n.reset([]);else{const o=r.crossesNgTemplate?uE(t,e,i,[]):TI(t,e,r,i);n.reset(o,T3),n.notifyOnChanges()}return!0}return!1}function AI(n,e,t,i){const r=Pn();if(r.firstCreatePass){const o=Si();(function II(n,e,t){null===n.queries&&(n.queries=new lE),n.queries.track(new cE(e,t))})(r,new SI(e,t,i),o.index),function gH(n,e){const t=n.contentQueries||(n.contentQueries=[]);e!==(t.length?t[t.length-1]:-1)&&t.push(n.queries.length-1,e)}(r,n),2==(2&t)&&(r.staticContentQueries=!0)}!function RI(n,e,t){const i=new rE(4==(4&t));(function sB(n,e,t,i){const r=eD(e);r.push(t),n.firstCreatePass&&tD(n).push(i,r.length-1)})(n,e,i,i.destroy),null===e[Tt]&&(e[Tt]=new aE),e[Tt].queries.push(new oE(i))}(r,Re(),t)}function PI(n,e){return n.queries.getByIndex(e)}const gE=new Ot("Application Initializer");let vE=(()=>{class n{constructor(){this.initialized=!1,this.done=!1,this.donePromise=new Promise((t,i)=>{this.resolve=t,this.reject=i}),this.appInits=St(gE,{optional:!0})??[]}runInitializers(){if(this.initialized)return;const t=[];for(const r of this.appInits){const o=r();if(tv(o))t.push(o);else if(OD(o)){const a=new Promise((u,h)=>{o.subscribe({complete:u,error:h})});t.push(a)}}const i=()=>{this.done=!0,this.resolve()};Promise.all(t).then(()=>{i()}).catch(r=>{this.reject(r)}),0===t.length&&i(),this.initialized=!0}static#e=this.\u0275fac=function(i){return new(i||n)};static#t=this.\u0275prov=Zt({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),YI=(()=>{class n{log(t){console.log(t)}warn(t){console.warn(t)}static#e=this.\u0275fac=function(i){return new(i||n)};static#t=this.\u0275prov=Zt({token:n,factory:n.\u0275fac,providedIn:"platform"})}return n})();const sc=new Ot("LocaleId",{providedIn:"root",factory:()=>St(sc,In.Optional|In.SkipSelf)||function BH(){return typeof $localize<"u"&&$localize.locale||Ap}()});let ZI=(()=>{class n{constructor(){this.taskId=0,this.pendingTasks=new Set,this.hasPendingTasks=new Jr(!1)}add(){this.hasPendingTasks.next(!0);const t=this.taskId++;return this.pendingTasks.add(t),t}remove(t){this.pendingTasks.delete(t),0===this.pendingTasks.size&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this.hasPendingTasks.next(!1)}static#e=this.\u0275fac=function(i){return new(i||n)};static#t=this.\u0275prov=Zt({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();class zH{constructor(e,t){this.ngModuleFactory=e,this.componentFactories=t}}let JI=(()=>{class n{compileModuleSync(t){return new eE(t)}compileModuleAsync(t){return Promise.resolve(this.compileModuleSync(t))}compileModuleAndAllComponentsSync(t){const i=this.compileModuleSync(t),o=nc(ks(t).declarations).reduce((a,u)=>{const h=jn(u);return h&&a.push(new Zg(h)),a},[]);return new zH(i,o)}compileModuleAndAllComponentsAsync(t){return Promise.resolve(this.compileModuleAndAllComponentsSync(t))}clearCache(){}clearCacheFor(t){}getModuleId(t){}static#e=this.\u0275fac=function(i){return new(i||n)};static#t=this.\u0275prov=Zt({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();const tP=new Ot(""),l0=new Ot("");let wE,xE=(()=>{class n{constructor(t,i,r){this._ngZone=t,this.registry=i,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,wE||(function cG(n){wE=n}(r),r.addToWindow(i)),this._watchAngularEvents(),t.run(()=>{this.taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{Bi.assertNotInAngularZone(),queueMicrotask(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())queueMicrotask(()=>{for(;0!==this._callbacks.length;){let t=this._callbacks.pop();clearTimeout(t.timeoutId),t.doneCb(this._didWork)}this._didWork=!1});else{let t=this.getPendingTasks();this._callbacks=this._callbacks.filter(i=>!i.updateCb||!i.updateCb(t)||(clearTimeout(i.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(t=>({source:t.source,creationLocation:t.creationLocation,data:t.data})):[]}addCallback(t,i,r){let o=-1;i&&i>0&&(o=setTimeout(()=>{this._callbacks=this._callbacks.filter(a=>a.timeoutId!==o),t(this._didWork,this.getPendingTasks())},i)),this._callbacks.push({doneCb:t,timeoutId:o,updateCb:r})}whenStable(t,i,r){if(r&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(t,i,r),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}registerApplication(t){this.registry.registerApplication(t,this)}unregisterApplication(t){this.registry.unregisterApplication(t)}findProviders(t,i,r){return[]}static#e=this.\u0275fac=function(i){return new(i||n)(Kt(Bi),Kt(ME),Kt(l0))};static#t=this.\u0275prov=Zt({token:n,factory:n.\u0275fac})}return n})(),ME=(()=>{class n{constructor(){this._applications=new Map}registerApplication(t,i){this._applications.set(t,i)}unregisterApplication(t){this._applications.delete(t)}unregisterAllApplications(){this._applications.clear()}getTestability(t){return this._applications.get(t)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(t,i=!0){return wE?.findTestabilityInTree(this,t,i)??null}static#e=this.\u0275fac=function(i){return new(i||n)};static#t=this.\u0275prov=Zt({token:n,factory:n.\u0275fac,providedIn:"platform"})}return n})(),bu=null;const nP=new Ot("AllowMultipleToken"),bE=new Ot("PlatformDestroyListeners"),EE=new Ot("appBootstrapListener");class rP{constructor(e,t){this.name=e,this.token=t}}function oP(n,e,t=[]){const i=`Platform: ${e}`,r=new Ot(i);return(o=[])=>{let a=SE();if(!a||a.injector.get(nP,!1)){const u=[...t,...o,{provide:r,useValue:!0}];n?n(u):function dG(n){if(bu&&!bu.get(nP,!1))throw new z(400,!1);(function iP(){!function jc(n){o_=n}(()=>{throw new z(600,!1)})})(),bu=n;const e=n.get(lP);(function sP(n){n.get(h1,null)?.forEach(t=>t())})(n)}(function aP(n=[],e){return Do.create({name:e,providers:[{provide:Kw,useValue:"platform"},{provide:bE,useValue:new Set([()=>bu=null])},...n]})}(u,i))}return function pG(n){const e=SE();if(!e)throw new z(401,!1);return e}()}}function SE(){return bu?.get(lP)??null}let lP=(()=>{class n{constructor(t){this._injector=t,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(t,i){const r=function mG(n="zone.js",e){return"noop"===n?new z3:"zone.js"===n?new Bi(e):n}(i?.ngZone,function cP(n){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:n?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:n?.runCoalescing??!1}}({eventCoalescing:i?.ngZoneEventCoalescing,runCoalescing:i?.ngZoneRunCoalescing}));return r.run(()=>{const o=function wz(n,e,t){return new Qb(n,e,t)}(t.moduleType,this.injector,function pP(n){return[{provide:Bi,useFactory:n},{provide:Hg,multi:!0,useFactory:()=>{const e=St(vG,{optional:!0});return()=>e.initialize()}},{provide:fP,useFactory:gG},{provide:A1,useFactory:D1}]}(()=>r)),a=o.injector.get(tc,null);return r.runOutsideAngular(()=>{const u=r.onError.subscribe({next:h=>{a.handleError(h)}});o.onDestroy(()=>{c0(this._modules,o),u.unsubscribe()})}),function uP(n,e,t){try{const i=t();return tv(i)?i.catch(r=>{throw e.runOutsideAngular(()=>n.handleError(r)),r}):i}catch(i){throw e.runOutsideAngular(()=>n.handleError(i)),i}}(a,r,()=>{const u=o.injector.get(vE);return u.runInitializers(),u.donePromise.then(()=>(function IR(n){Bs(n,"Expected localeId to be defined"),"string"==typeof n&&(RR=n.toLowerCase().replace(/_/g,"-"))}(o.injector.get(sc,Ap)||Ap),this._moduleDoBootstrap(o),o))})})}bootstrapModule(t,i=[]){const r=hP({},i);return function uG(n,e,t){const i=new eE(t);return Promise.resolve(i)}(0,0,t).then(o=>this.bootstrapModuleFactory(o,r))}_moduleDoBootstrap(t){const i=t.injector.get(Ip);if(t._bootstrapComponents.length>0)t._bootstrapComponents.forEach(r=>i.bootstrap(r));else{if(!t.instance.ngDoBootstrap)throw new z(-403,!1);t.instance.ngDoBootstrap(i)}this._modules.push(t)}onDestroy(t){this._destroyListeners.push(t)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new z(404,!1);this._modules.slice().forEach(i=>i.destroy()),this._destroyListeners.forEach(i=>i());const t=this._injector.get(bE,null);t&&(t.forEach(i=>i()),t.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}static#e=this.\u0275fac=function(i){return new(i||n)(Kt(Do))};static#t=this.\u0275prov=Zt({token:n,factory:n.\u0275fac,providedIn:"platform"})}return n})();function hP(n,e){return Array.isArray(e)?e.reduce(hP,n):{...n,...e}}let Ip=(()=>{class n{constructor(){this._bootstrapListeners=[],this._runningTick=!1,this._destroyed=!1,this._destroyListeners=[],this._views=[],this.internalErrorHandler=St(fP),this.zoneIsStable=St(A1),this.componentTypes=[],this.components=[],this.isStable=St(ZI).hasPendingTasks.pipe(Ho(t=>t?on(!1):this.zoneIsStable),function Ry(n,e=ua){return n=n??Iy,hr((t,i)=>{let r,o=!0;t.subscribe(nr(i,a=>{const u=e(a);(o||!n(r,u))&&(o=!1,r=u,i.next(a))}))})}(),lf()),this._injector=St(Qo)}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(t,i){const r=t instanceof g1;if(!this._injector.get(vE).done)throw!r&&function Uc(n){const e=jn(n)||Br(n)||ls(n);return null!==e&&e.standalone}(t),new z(405,!1);let a;a=r?t:this._injector.get(F_).resolveComponentFactory(t),this.componentTypes.push(a.componentType);const u=function hG(n){return n.isBoundToModule}(a)?void 0:this._injector.get(hd),f=a.create(Do.NULL,[],i||a.selector,u),g=f.location.nativeElement,_=f.injector.get(tP,null);return _?.registerApplication(g),f.onDestroy(()=>{this.detachView(f.hostView),c0(this.components,f),_?.unregisterApplication(g)}),this._loadComponent(f),f}tick(){if(this._runningTick)throw new z(101,!1);try{this._runningTick=!0;for(let t of this._views)t.detectChanges()}catch(t){this.internalErrorHandler(t)}finally{this._runningTick=!1}}attachView(t){const i=t;this._views.push(i),i.attachToAppRef(this)}detachView(t){const i=t;c0(this._views,i),i.detachFromAppRef()}_loadComponent(t){this.attachView(t.hostView),this.tick(),this.components.push(t);const i=this._injector.get(EE,[]);i.push(...this._bootstrapListeners),i.forEach(r=>r(t))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(t=>t()),this._views.slice().forEach(t=>t.destroy())}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(t){return this._destroyListeners.push(t),()=>c0(this._destroyListeners,t)}destroy(){if(this._destroyed)throw new z(406,!1);const t=this._injector;t.destroy&&!t.destroyed&&t.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}static#e=this.\u0275fac=function(i){return new(i||n)};static#t=this.\u0275prov=Zt({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function c0(n,e){const t=n.indexOf(e);t>-1&&n.splice(t,1)}const fP=new Ot("",{providedIn:"root",factory:()=>St(tc).handleError.bind(void 0)});function gG(){const n=St(Bi),e=St(tc);return t=>n.runOutsideAngular(()=>e.handleError(t))}let vG=(()=>{class n{constructor(){this.zone=St(Bi),this.applicationRef=St(Ip)}initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}static#e=this.\u0275fac=function(i){return new(i||n)};static#t=this.\u0275prov=Zt({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();let u0=(()=>{class n{static#e=this.__NG_ELEMENT_ID__=_G}return n})();function _G(n){return function xG(n,e,t){if($o(n)&&!t){const i=Ir(n.index,e);return new Yg(i,i)}return 47&n.type?new Yg(e[sr],e):null}(Si(),Re(),16==(16&n))}class yP{constructor(){}supports(e){return W_(e)}create(e){return new TG(e)}}const SG=(n,e)=>e;class TG{constructor(e){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=e||SG}forEachItem(e){let t;for(t=this._itHead;null!==t;t=t._next)e(t)}forEachOperation(e){let t=this._itHead,i=this._removalsHead,r=0,o=null;for(;t||i;){const a=!i||t&&t.currentIndex<xP(i,r,o)?t:i,u=xP(a,r,o),h=a.currentIndex;if(a===i)r--,i=i._nextRemoved;else if(t=t._next,null==a.previousIndex)r++;else{o||(o=[]);const f=u-r,g=h-r;if(f!=g){for(let x=0;x<f;x++){const M=x<o.length?o[x]:o[x]=0,E=M+x;g<=E&&E<f&&(o[x]=M+1)}o[a.previousIndex]=g-f}}u!==h&&e(a,u,h)}}forEachPreviousItem(e){let t;for(t=this._previousItHead;null!==t;t=t._nextPrevious)e(t)}forEachAddedItem(e){let t;for(t=this._additionsHead;null!==t;t=t._nextAdded)e(t)}forEachMovedItem(e){let t;for(t=this._movesHead;null!==t;t=t._nextMoved)e(t)}forEachRemovedItem(e){let t;for(t=this._removalsHead;null!==t;t=t._nextRemoved)e(t)}forEachIdentityChange(e){let t;for(t=this._identityChangesHead;null!==t;t=t._nextIdentityChange)e(t)}diff(e){if(null==e&&(e=[]),!W_(e))throw new z(900,!1);return this.check(e)?this:null}onDestroy(){}check(e){this._reset();let r,o,a,t=this._itHead,i=!1;if(Array.isArray(e)){this.length=e.length;for(let u=0;u<this.length;u++)o=e[u],a=this._trackByFn(u,o),null!==t&&Object.is(t.trackById,a)?(i&&(t=this._verifyReinsertion(t,o,a,u)),Object.is(t.item,o)||this._addIdentityChange(t,o)):(t=this._mismatch(t,o,a,u),i=!0),t=t._next}else r=0,function JB(n,e){if(Array.isArray(n))for(let t=0;t<n.length;t++)e(n[t]);else{const t=n[Symbol.iterator]();let i;for(;!(i=t.next()).done;)e(i.value)}}(e,u=>{a=this._trackByFn(r,u),null!==t&&Object.is(t.trackById,a)?(i&&(t=this._verifyReinsertion(t,u,a,r)),Object.is(t.item,u)||this._addIdentityChange(t,u)):(t=this._mismatch(t,u,a,r),i=!0),t=t._next,r++}),this.length=r;return this._truncate(t),this.collection=e,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let e;for(e=this._previousItHead=this._itHead;null!==e;e=e._next)e._nextPrevious=e._next;for(e=this._additionsHead;null!==e;e=e._nextAdded)e.previousIndex=e.currentIndex;for(this._additionsHead=this._additionsTail=null,e=this._movesHead;null!==e;e=e._nextMoved)e.previousIndex=e.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(e,t,i,r){let o;return null===e?o=this._itTail:(o=e._prev,this._remove(e)),null!==(e=null===this._unlinkedRecords?null:this._unlinkedRecords.get(i,null))?(Object.is(e.item,t)||this._addIdentityChange(e,t),this._reinsertAfter(e,o,r)):null!==(e=null===this._linkedRecords?null:this._linkedRecords.get(i,r))?(Object.is(e.item,t)||this._addIdentityChange(e,t),this._moveAfter(e,o,r)):e=this._addAfter(new CG(t,i),o,r),e}_verifyReinsertion(e,t,i,r){let o=null===this._unlinkedRecords?null:this._unlinkedRecords.get(i,null);return null!==o?e=this._reinsertAfter(o,e._prev,r):e.currentIndex!=r&&(e.currentIndex=r,this._addToMoves(e,r)),e}_truncate(e){for(;null!==e;){const t=e._next;this._addToRemovals(this._unlink(e)),e=t}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(e,t,i){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(e);const r=e._prevRemoved,o=e._nextRemoved;return null===r?this._removalsHead=o:r._nextRemoved=o,null===o?this._removalsTail=r:o._prevRemoved=r,this._insertAfter(e,t,i),this._addToMoves(e,i),e}_moveAfter(e,t,i){return this._unlink(e),this._insertAfter(e,t,i),this._addToMoves(e,i),e}_addAfter(e,t,i){return this._insertAfter(e,t,i),this._additionsTail=null===this._additionsTail?this._additionsHead=e:this._additionsTail._nextAdded=e,e}_insertAfter(e,t,i){const r=null===t?this._itHead:t._next;return e._next=r,e._prev=t,null===r?this._itTail=e:r._prev=e,null===t?this._itHead=e:t._next=e,null===this._linkedRecords&&(this._linkedRecords=new _P),this._linkedRecords.put(e),e.currentIndex=i,e}_remove(e){return this._addToRemovals(this._unlink(e))}_unlink(e){null!==this._linkedRecords&&this._linkedRecords.remove(e);const t=e._prev,i=e._next;return null===t?this._itHead=i:t._next=i,null===i?this._itTail=t:i._prev=t,e}_addToMoves(e,t){return e.previousIndex===t||(this._movesTail=null===this._movesTail?this._movesHead=e:this._movesTail._nextMoved=e),e}_addToRemovals(e){return null===this._unlinkedRecords&&(this._unlinkedRecords=new _P),this._unlinkedRecords.put(e),e.currentIndex=null,e._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=e,e._prevRemoved=null):(e._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=e),e}_addIdentityChange(e,t){return e.item=t,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=e:this._identityChangesTail._nextIdentityChange=e,e}}class CG{constructor(e,t){this.item=e,this.trackById=t,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class AG{constructor(){this._head=null,this._tail=null}add(e){null===this._head?(this._head=this._tail=e,e._nextDup=null,e._prevDup=null):(this._tail._nextDup=e,e._prevDup=this._tail,e._nextDup=null,this._tail=e)}get(e,t){let i;for(i=this._head;null!==i;i=i._nextDup)if((null===t||t<=i.currentIndex)&&Object.is(i.trackById,e))return i;return null}remove(e){const t=e._prevDup,i=e._nextDup;return null===t?this._head=i:t._nextDup=i,null===i?this._tail=t:i._prevDup=t,null===this._head}}class _P{constructor(){this.map=new Map}put(e){const t=e.trackById;let i=this.map.get(t);i||(i=new AG,this.map.set(t,i)),i.add(e)}get(e,t){const r=this.map.get(e);return r?r.get(e,t):null}remove(e){const t=e.trackById;return this.map.get(t).remove(e)&&this.map.delete(t),e}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function xP(n,e,t){const i=n.previousIndex;if(null===i)return i;let r=0;return t&&i<t.length&&(r=t[i]),i+e+r}function wP(){return new f0([new yP])}let f0=(()=>{class n{static#e=this.\u0275prov=Zt({token:n,providedIn:"root",factory:wP});constructor(t){this.factories=t}static create(t,i){if(null!=i){const r=i.factories.slice();t=t.concat(r)}return new n(t)}static extend(t){return{provide:n,useFactory:i=>n.create(t,i||wP()),deps:[[n,new Qf,new Kf]]}}find(t){const i=this.factories.find(r=>r.supports(t));if(null!=i)return i;throw new z(901,!1)}}return n})();const LG=oP(null,"core",[]);let NG=(()=>{class n{constructor(t){}static#e=this.\u0275fac=function(i){return new(i||n)(Kt(Ip))};static#t=this.\u0275mod=Wo({type:n});static#n=this.\u0275inj=_o({})}return n})();function Pp(n){return"boolean"==typeof n?n:null!=n&&"false"!==n}let IE=null;function Eu(){return IE}class qG{}const na=new Ot("DocumentToken");let PE=(()=>{class n{historyGo(t){throw new Error("Not implemented")}static#e=this.\u0275fac=function(i){return new(i||n)};static#t=this.\u0275prov=Zt({token:n,factory:function(){return St(ZG)},providedIn:"platform"})}return n})();const YG=new Ot("Location Initialized");let ZG=(()=>{class n extends PE{constructor(){super(),this._doc=St(na),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return Eu().getBaseHref(this._doc)}onPopState(t){const i=Eu().getGlobalEventTarget(this._doc,"window");return i.addEventListener("popstate",t,!1),()=>i.removeEventListener("popstate",t)}onHashChange(t){const i=Eu().getGlobalEventTarget(this._doc,"window");return i.addEventListener("hashchange",t,!1),()=>i.removeEventListener("hashchange",t)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(t){this._location.pathname=t}pushState(t,i,r){this._history.pushState(t,i,r)}replaceState(t,i,r){this._history.replaceState(t,i,r)}forward(){this._history.forward()}back(){this._history.back()}historyGo(t=0){this._history.go(t)}getState(){return this._history.state}static#e=this.\u0275fac=function(i){return new(i||n)};static#t=this.\u0275prov=Zt({token:n,factory:function(){return new n},providedIn:"platform"})}return n})();function LE(n,e){if(0==n.length)return e;if(0==e.length)return n;let t=0;return n.endsWith("/")&&t++,e.startsWith("/")&&t++,2==t?n+e.substring(1):1==t?n+e:n+"/"+e}function PP(n){const e=n.match(/#|\?|$/),t=e&&e.index||n.length;return n.slice(0,t-("/"===n[t-1]?1:0))+n.slice(t)}function oc(n){return n&&"?"!==n[0]?"?"+n:n}let fd=(()=>{class n{historyGo(t){throw new Error("Not implemented")}static#e=this.\u0275fac=function(i){return new(i||n)};static#t=this.\u0275prov=Zt({token:n,factory:function(){return St(NP)},providedIn:"root"})}return n})();const LP=new Ot("appBaseHref");let NP=(()=>{class n extends fd{constructor(t,i){super(),this._platformLocation=t,this._removeListenerFns=[],this._baseHref=i??this._platformLocation.getBaseHrefFromDOM()??St(na).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(t){this._removeListenerFns.push(this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t))}getBaseHref(){return this._baseHref}prepareExternalUrl(t){return LE(this._baseHref,t)}path(t=!1){const i=this._platformLocation.pathname+oc(this._platformLocation.search),r=this._platformLocation.hash;return r&&t?`${i}${r}`:i}pushState(t,i,r,o){const a=this.prepareExternalUrl(r+oc(o));this._platformLocation.pushState(t,i,a)}replaceState(t,i,r,o){const a=this.prepareExternalUrl(r+oc(o));this._platformLocation.replaceState(t,i,a)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(t=0){this._platformLocation.historyGo?.(t)}static#e=this.\u0275fac=function(i){return new(i||n)(Kt(PE),Kt(LP,8))};static#t=this.\u0275prov=Zt({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),JG=(()=>{class n extends fd{constructor(t,i){super(),this._platformLocation=t,this._baseHref="",this._removeListenerFns=[],null!=i&&(this._baseHref=i)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(t){this._removeListenerFns.push(this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t))}getBaseHref(){return this._baseHref}path(t=!1){let i=this._platformLocation.hash;return null==i&&(i="#"),i.length>0?i.substring(1):i}prepareExternalUrl(t){const i=LE(this._baseHref,t);return i.length>0?"#"+i:i}pushState(t,i,r,o){let a=this.prepareExternalUrl(r+oc(o));0==a.length&&(a=this._platformLocation.pathname),this._platformLocation.pushState(t,i,a)}replaceState(t,i,r,o){let a=this.prepareExternalUrl(r+oc(o));0==a.length&&(a=this._platformLocation.pathname),this._platformLocation.replaceState(t,i,a)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(t=0){this._platformLocation.historyGo?.(t)}static#e=this.\u0275fac=function(i){return new(i||n)(Kt(PE),Kt(LP,8))};static#t=this.\u0275prov=Zt({token:n,factory:n.\u0275fac})}return n})(),NE=(()=>{class n{constructor(t){this._subject=new gr,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=t;const i=this._locationStrategy.getBaseHref();this._basePath=function e4(n){if(new RegExp("^(https?:)?//").test(n)){const[,t]=n.split(/\/\/[^\/]+/);return t}return n}(PP(OP(i))),this._locationStrategy.onPopState(r=>{this._subject.emit({url:this.path(!0),pop:!0,state:r.state,type:r.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(t=!1){return this.normalize(this._locationStrategy.path(t))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(t,i=""){return this.path()==this.normalize(t+oc(i))}normalize(t){return n.stripTrailingSlash(function QG(n,e){if(!n||!e.startsWith(n))return e;const t=e.substring(n.length);return""===t||["/",";","?","#"].includes(t[0])?t:e}(this._basePath,OP(t)))}prepareExternalUrl(t){return t&&"/"!==t[0]&&(t="/"+t),this._locationStrategy.prepareExternalUrl(t)}go(t,i="",r=null){this._locationStrategy.pushState(r,"",t,i),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+oc(i)),r)}replaceState(t,i="",r=null){this._locationStrategy.replaceState(r,"",t,i),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+oc(i)),r)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(t=0){this._locationStrategy.historyGo?.(t)}onUrlChange(t){return this._urlChangeListeners.push(t),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(i=>{this._notifyUrlChangeListeners(i.url,i.state)})),()=>{const i=this._urlChangeListeners.indexOf(t);this._urlChangeListeners.splice(i,1),0===this._urlChangeListeners.length&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(t="",i){this._urlChangeListeners.forEach(r=>r(t,i))}subscribe(t,i,r){return this._subject.subscribe({next:t,error:i,complete:r})}static#e=this.normalizeQueryParams=oc;static#t=this.joinWithSlash=LE;static#n=this.stripTrailingSlash=PP;static#i=this.\u0275fac=function(i){return new(i||n)(Kt(fd))};static#r=this.\u0275prov=Zt({token:n,factory:function(){return function KG(){return new NE(Kt(fd))}()},providedIn:"root"})}return n})();function OP(n){return n.replace(/\/index.html$/,"")}class z4{constructor(e,t,i,r){this.$implicit=e,this.ngForOf=t,this.index=i,this.count=r}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let $P=(()=>{class n{set ngForOf(t){this._ngForOf=t,this._ngForOfDirty=!0}set ngForTrackBy(t){this._trackByFn=t}get ngForTrackBy(){return this._trackByFn}constructor(t,i,r){this._viewContainer=t,this._template=i,this._differs=r,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForTemplate(t){t&&(this._template=t)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const t=this._ngForOf;!this._differ&&t&&(this._differ=this._differs.find(t).create(this.ngForTrackBy))}if(this._differ){const t=this._differ.diff(this._ngForOf);t&&this._applyChanges(t)}}_applyChanges(t){const i=this._viewContainer;t.forEachOperation((r,o,a)=>{if(null==r.previousIndex)i.createEmbeddedView(this._template,new z4(r.item,this._ngForOf,-1,-1),null===a?void 0:a);else if(null==a)i.remove(null===o?void 0:o);else if(null!==o){const u=i.get(o);i.move(u,a),XP(u,r)}});for(let r=0,o=i.length;r<o;r++){const u=i.get(r).context;u.index=r,u.count=o,u.ngForOf=this._ngForOf}t.forEachIdentityChange(r=>{XP(i.get(r.currentIndex),r)})}static ngTemplateContextGuard(t,i){return!0}static#e=this.\u0275fac=function(i){return new(i||n)($e(La),$e(rc),$e(f0))};static#t=this.\u0275dir=an({type:n,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"},standalone:!0})}return n})();function XP(n,e){n.context.$implicit=e.item}let JP=(()=>{class n{static#e=this.\u0275fac=function(i){return new(i||n)};static#t=this.\u0275mod=Wo({type:n});static#n=this.\u0275inj=_o({})}return n})();function QP(n){return"server"===n}let v5=(()=>{class n{static#e=this.\u0275prov=Zt({token:n,providedIn:"root",factory:()=>new y5(Kt(na),window)})}return n})();class y5{constructor(e,t){this.document=e,this.window=t,this.offset=()=>[0,0]}setOffset(e){this.offset=Array.isArray(e)?()=>e:e}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(e){this.supportsScrolling()&&this.window.scrollTo(e[0],e[1])}scrollToAnchor(e){if(!this.supportsScrolling())return;const t=function _5(n,e){const t=n.getElementById(e)||n.getElementsByName(e)[0];if(t)return t;if("function"==typeof n.createTreeWalker&&n.body&&"function"==typeof n.body.attachShadow){const i=n.createTreeWalker(n.body,NodeFilter.SHOW_ELEMENT);let r=i.currentNode;for(;r;){const o=r.shadowRoot;if(o){const a=o.getElementById(e)||o.querySelector(`[name="${e}"]`);if(a)return a}r=i.nextNode()}}return null}(this.document,e);t&&(this.scrollToElement(t),t.focus())}setHistoryScrollRestoration(e){this.supportsScrolling()&&(this.window.history.scrollRestoration=e)}scrollToElement(e){const t=e.getBoundingClientRect(),i=t.left+this.window.pageXOffset,r=t.top+this.window.pageYOffset,o=this.offset();this.window.scrollTo(i-o[0],r-o[1])}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch{return!1}}}class G5 extends qG{constructor(){super(...arguments),this.supportsDOMEvents=!0}}class JE extends G5{static makeCurrent(){!function XG(n){IE||(IE=n)}(new JE)}onAndCancel(e,t,i){return e.addEventListener(t,i),()=>{e.removeEventListener(t,i)}}dispatchEvent(e,t){e.dispatchEvent(t)}remove(e){e.parentNode&&e.parentNode.removeChild(e)}createElement(e,t){return(t=t||this.getDefaultDocument()).createElement(e)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(e){return e.nodeType===Node.ELEMENT_NODE}isShadowRoot(e){return e instanceof DocumentFragment}getGlobalEventTarget(e,t){return"window"===t?window:"document"===t?e:"body"===t?e.body:null}getBaseHref(e){const t=function W5(){return gv=gv||document.querySelector("base"),gv?gv.getAttribute("href"):null}();return null==t?null:function j5(n){C0=C0||document.createElement("a"),C0.setAttribute("href",n);const e=C0.pathname;return"/"===e.charAt(0)?e:`/${e}`}(t)}resetBaseElement(){gv=null}getUserAgent(){return window.navigator.userAgent}getCookie(e){return function B4(n,e){e=encodeURIComponent(e);for(const t of n.split(";")){const i=t.indexOf("="),[r,o]=-1==i?[t,""]:[t.slice(0,i),t.slice(i+1)];if(r.trim()===e)return decodeURIComponent(o)}return null}(document.cookie,e)}}let C0,gv=null,X5=(()=>{class n{build(){return new XMLHttpRequest}static#e=this.\u0275fac=function(i){return new(i||n)};static#t=this.\u0275prov=Zt({token:n,factory:n.\u0275fac})}return n})();const KE=new Ot("EventManagerPlugins");let rL=(()=>{class n{constructor(t,i){this._zone=i,this._eventNameToPlugin=new Map,t.forEach(r=>{r.manager=this}),this._plugins=t.slice().reverse()}addEventListener(t,i,r){return this._findPluginFor(i).addEventListener(t,i,r)}getZone(){return this._zone}_findPluginFor(t){let i=this._eventNameToPlugin.get(t);if(i)return i;if(i=this._plugins.find(o=>o.supports(t)),!i)throw new z(5101,!1);return this._eventNameToPlugin.set(t,i),i}static#e=this.\u0275fac=function(i){return new(i||n)(Kt(KE),Kt(Bi))};static#t=this.\u0275prov=Zt({token:n,factory:n.\u0275fac})}return n})();class sL{constructor(e){this._doc=e}}const QE="ng-app-id";let oL=(()=>{class n{constructor(t,i,r,o={}){this.doc=t,this.appId=i,this.nonce=r,this.platformId=o,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=QP(o),this.resetHostNodes()}addStyles(t){for(const i of t)1===this.changeUsageCount(i,1)&&this.onStyleAdded(i)}removeStyles(t){for(const i of t)this.changeUsageCount(i,-1)<=0&&this.onStyleRemoved(i)}ngOnDestroy(){const t=this.styleNodesInDOM;t&&(t.forEach(i=>i.remove()),t.clear());for(const i of this.getAllStyles())this.onStyleRemoved(i);this.resetHostNodes()}addHost(t){this.hostNodes.add(t);for(const i of this.getAllStyles())this.addStyleToHost(t,i)}removeHost(t){this.hostNodes.delete(t)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(t){for(const i of this.hostNodes)this.addStyleToHost(i,t)}onStyleRemoved(t){const i=this.styleRef;i.get(t)?.elements?.forEach(r=>r.remove()),i.delete(t)}collectServerRenderedStyles(){const t=this.doc.head?.querySelectorAll(`style[${QE}="${this.appId}"]`);if(t?.length){const i=new Map;return t.forEach(r=>{null!=r.textContent&&i.set(r.textContent,r)}),i}return null}changeUsageCount(t,i){const r=this.styleRef;if(r.has(t)){const o=r.get(t);return o.usage+=i,o.usage}return r.set(t,{usage:i,elements:[]}),i}getStyleElement(t,i){const r=this.styleNodesInDOM,o=r?.get(i);if(o?.parentNode===t)return r.delete(i),o.removeAttribute(QE),o;{const a=this.doc.createElement("style");return this.nonce&&a.setAttribute("nonce",this.nonce),a.textContent=i,this.platformIsServer&&a.setAttribute(QE,this.appId),a}}addStyleToHost(t,i){const r=this.getStyleElement(t,i);t.appendChild(r);const o=this.styleRef,a=o.get(i)?.elements;a?a.push(r):o.set(i,{elements:[r],usage:1})}resetHostNodes(){const t=this.hostNodes;t.clear(),t.add(this.doc.head)}static#e=this.\u0275fac=function(i){return new(i||n)(Kt(na),Kt(R_),Kt(d1,8),Kt(cp))};static#t=this.\u0275prov=Zt({token:n,factory:n.\u0275fac})}return n})();const eS={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},tS=/%COMP%/g,J5=new Ot("RemoveStylesOnCompDestroy",{providedIn:"root",factory:()=>!1});function lL(n,e){return e.map(t=>t.replace(tS,n))}let cL=(()=>{class n{constructor(t,i,r,o,a,u,h,f=null){this.eventManager=t,this.sharedStylesHost=i,this.appId=r,this.removeStylesOnCompDestroy=o,this.doc=a,this.platformId=u,this.ngZone=h,this.nonce=f,this.rendererByCompId=new Map,this.platformIsServer=QP(u),this.defaultRenderer=new nS(t,a,h,this.platformIsServer)}createRenderer(t,i){if(!t||!i)return this.defaultRenderer;this.platformIsServer&&i.encapsulation===xo.ShadowDom&&(i={...i,encapsulation:xo.Emulated});const r=this.getOrCreateRenderer(t,i);return r instanceof hL?r.applyToHost(t):r instanceof iS&&r.applyStyles(),r}getOrCreateRenderer(t,i){const r=this.rendererByCompId;let o=r.get(i.id);if(!o){const a=this.doc,u=this.ngZone,h=this.eventManager,f=this.sharedStylesHost,g=this.removeStylesOnCompDestroy,_=this.platformIsServer;switch(i.encapsulation){case xo.Emulated:o=new hL(h,f,i,this.appId,g,a,u,_);break;case xo.ShadowDom:return new tW(h,f,t,i,a,u,this.nonce,_);default:o=new iS(h,f,i,g,a,u,_)}r.set(i.id,o)}return o}ngOnDestroy(){this.rendererByCompId.clear()}static#e=this.\u0275fac=function(i){return new(i||n)(Kt(rL),Kt(oL),Kt(R_),Kt(J5),Kt(na),Kt(cp),Kt(Bi),Kt(d1))};static#t=this.\u0275prov=Zt({token:n,factory:n.\u0275fac})}return n})();class nS{constructor(e,t,i,r){this.eventManager=e,this.doc=t,this.ngZone=i,this.platformIsServer=r,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(e,t){return t?this.doc.createElementNS(eS[t]||t,e):this.doc.createElement(e)}createComment(e){return this.doc.createComment(e)}createText(e){return this.doc.createTextNode(e)}appendChild(e,t){(uL(e)?e.content:e).appendChild(t)}insertBefore(e,t,i){e&&(uL(e)?e.content:e).insertBefore(t,i)}removeChild(e,t){e&&e.removeChild(t)}selectRootElement(e,t){let i="string"==typeof e?this.doc.querySelector(e):e;if(!i)throw new z(-5104,!1);return t||(i.textContent=""),i}parentNode(e){return e.parentNode}nextSibling(e){return e.nextSibling}setAttribute(e,t,i,r){if(r){t=r+":"+t;const o=eS[r];o?e.setAttributeNS(o,t,i):e.setAttribute(t,i)}else e.setAttribute(t,i)}removeAttribute(e,t,i){if(i){const r=eS[i];r?e.removeAttributeNS(r,t):e.removeAttribute(`${i}:${t}`)}else e.removeAttribute(t)}addClass(e,t){e.classList.add(t)}removeClass(e,t){e.classList.remove(t)}setStyle(e,t,i,r){r&(tn.DashCase|tn.Important)?e.style.setProperty(t,i,r&tn.Important?"important":""):e.style[t]=i}removeStyle(e,t,i){i&tn.DashCase?e.style.removeProperty(t):e.style[t]=""}setProperty(e,t,i){e[t]=i}setValue(e,t){e.nodeValue=t}listen(e,t,i){if("string"==typeof e&&!(e=Eu().getGlobalEventTarget(this.doc,e)))throw new Error(`Unsupported event target ${e} for event ${t}`);return this.eventManager.addEventListener(e,t,this.decoratePreventDefault(i))}decoratePreventDefault(e){return t=>{if("__ngUnwrap__"===t)return e;!1===(this.platformIsServer?this.ngZone.runGuarded(()=>e(t)):e(t))&&t.preventDefault()}}}function uL(n){return"TEMPLATE"===n.tagName&&void 0!==n.content}class tW extends nS{constructor(e,t,i,r,o,a,u,h){super(e,o,a,h),this.sharedStylesHost=t,this.hostEl=i,this.shadowRoot=i.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const f=lL(r.id,r.styles);for(const g of f){const _=document.createElement("style");u&&_.setAttribute("nonce",u),_.textContent=g,this.shadowRoot.appendChild(_)}}nodeOrShadowRoot(e){return e===this.hostEl?this.shadowRoot:e}appendChild(e,t){return super.appendChild(this.nodeOrShadowRoot(e),t)}insertBefore(e,t,i){return super.insertBefore(this.nodeOrShadowRoot(e),t,i)}removeChild(e,t){return super.removeChild(this.nodeOrShadowRoot(e),t)}parentNode(e){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(e)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}}class iS extends nS{constructor(e,t,i,r,o,a,u,h){super(e,o,a,u),this.sharedStylesHost=t,this.removeStylesOnCompDestroy=r,this.styles=h?lL(h,i.styles):i.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles)}}class hL extends iS{constructor(e,t,i,r,o,a,u,h){const f=r+"-"+i.id;super(e,t,i,o,a,u,h,f),this.contentAttr=function K5(n){return"_ngcontent-%COMP%".replace(tS,n)}(f),this.hostAttr=function Q5(n){return"_nghost-%COMP%".replace(tS,n)}(f)}applyToHost(e){this.applyStyles(),this.setAttribute(e,this.hostAttr,"")}createElement(e,t){const i=super.createElement(e,t);return super.setAttribute(i,this.contentAttr,""),i}}let nW=(()=>{class n extends sL{constructor(t){super(t)}supports(t){return!0}addEventListener(t,i,r){return t.addEventListener(i,r,!1),()=>this.removeEventListener(t,i,r)}removeEventListener(t,i,r){return t.removeEventListener(i,r)}static#e=this.\u0275fac=function(i){return new(i||n)(Kt(na))};static#t=this.\u0275prov=Zt({token:n,factory:n.\u0275fac})}return n})();const dL=["alt","control","meta","shift"],iW={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},rW={alt:n=>n.altKey,control:n=>n.ctrlKey,meta:n=>n.metaKey,shift:n=>n.shiftKey};let sW=(()=>{class n extends sL{constructor(t){super(t)}supports(t){return null!=n.parseEventName(t)}addEventListener(t,i,r){const o=n.parseEventName(i),a=n.eventCallback(o.fullKey,r,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>Eu().onAndCancel(t,o.domEventName,a))}static parseEventName(t){const i=t.toLowerCase().split("."),r=i.shift();if(0===i.length||"keydown"!==r&&"keyup"!==r)return null;const o=n._normalizeKey(i.pop());let a="",u=i.indexOf("code");if(u>-1&&(i.splice(u,1),a="code."),dL.forEach(f=>{const g=i.indexOf(f);g>-1&&(i.splice(g,1),a+=f+".")}),a+=o,0!=i.length||0===o.length)return null;const h={};return h.domEventName=r,h.fullKey=a,h}static matchEventFullKeyCode(t,i){let r=iW[t.key]||t.key,o="";return i.indexOf("code.")>-1&&(r=t.code,o="code."),!(null==r||!r)&&(r=r.toLowerCase()," "===r?r="space":"."===r&&(r="dot"),dL.forEach(a=>{a!==r&&(0,rW[a])(t)&&(o+=a+".")}),o+=r,o===i)}static eventCallback(t,i,r){return o=>{n.matchEventFullKeyCode(o,t)&&r.runGuarded(()=>i(o))}}static _normalizeKey(t){return"esc"===t?"escape":t}static#e=this.\u0275fac=function(i){return new(i||n)(Kt(na))};static#t=this.\u0275prov=Zt({token:n,factory:n.\u0275fac})}return n})();const cW=oP(LG,"browser",[{provide:cp,useValue:"browser"},{provide:h1,useValue:function oW(){JE.makeCurrent()},multi:!0},{provide:na,useFactory:function lW(){return function NU(n){Hw=n}(document),document},deps:[]}]),uW=new Ot(""),mL=[{provide:l0,useClass:class $5{addToWindow(e){Ei.getAngularTestability=(i,r=!0)=>{const o=e.findTestabilityInTree(i,r);if(null==o)throw new z(5103,!1);return o},Ei.getAllAngularTestabilities=()=>e.getAllTestabilities(),Ei.getAllAngularRootElements=()=>e.getAllRootElements(),Ei.frameworkStabilizers||(Ei.frameworkStabilizers=[]),Ei.frameworkStabilizers.push(i=>{const r=Ei.getAllAngularTestabilities();let o=r.length,a=!1;const u=function(h){a=a||h,o--,0==o&&i(a)};r.forEach(h=>{h.whenStable(u)})})}findTestabilityInTree(e,t,i){return null==t?null:e.getTestability(t)??(i?Eu().isShadowRoot(t)?this.findTestabilityInTree(e,t.host,!0):this.findTestabilityInTree(e,t.parentElement,!0):null)}},deps:[]},{provide:tP,useClass:xE,deps:[Bi,ME,l0]},{provide:xE,useClass:xE,deps:[Bi,ME,l0]}],gL=[{provide:Kw,useValue:"root"},{provide:tc,useFactory:function aW(){return new tc},deps:[]},{provide:KE,useClass:nW,multi:!0,deps:[na,Bi,cp]},{provide:KE,useClass:sW,multi:!0,deps:[na]},cL,oL,rL,{provide:y1,useExisting:cL},{provide:class x5{},useClass:X5,deps:[]},[]];let hW=(()=>{class n{constructor(t){}static withServerTransition(t){return{ngModule:n,providers:[{provide:R_,useValue:t.appId}]}}static#e=this.\u0275fac=function(i){return new(i||n)(Kt(uW,12))};static#t=this.\u0275mod=Wo({type:n});static#n=this.\u0275inj=_o({providers:[...gL,...mL],imports:[JP,NG]})}return n})(),vL=(()=>{class n{constructor(t){this._doc=t}getTitle(){return this._doc.title}setTitle(t){this._doc.title=t||""}static#e=this.\u0275fac=function(i){return new(i||n)(Kt(na))};static#t=this.\u0275prov=Zt({token:n,factory:function(i){let r=null;return r=i?new i:function fW(){return new vL(Kt(na))}(),r},providedIn:"root"})}return n})();typeof window<"u"&&window;const{isArray:yW}=Array,{getPrototypeOf:_W,prototype:xW,keys:MW}=Object;const{isArray:bW}=Array;const Op=new Ot("CallSetDisabledState",{providedIn:"root",factory:()=>L0}),L0="always";let uN=(()=>{class n{static#e=this.\u0275fac=function(i){return new(i||n)};static#t=this.\u0275mod=Wo({type:n});static#n=this.\u0275inj=_o({})}return n})(),w8=(()=>{class n{static#e=this.\u0275fac=function(i){return new(i||n)};static#t=this.\u0275mod=Wo({type:n});static#n=this.\u0275inj=_o({imports:[uN]})}return n})(),E8=(()=>{class n{static withConfig(t){return{ngModule:n,providers:[{provide:Op,useValue:t.callSetDisabledState??L0}]}}static#e=this.\u0275fac=function(i){return new(i||n)};static#t=this.\u0275mod=Wo({type:n});static#n=this.\u0275inj=_o({imports:[w8]})}return n})();function SS(...n){const e=Oc(n),t=function sf(n){return Tn(lh(n))?n.pop():void 0}(n),{args:i,keys:r}=function ML(n){if(1===n.length){const e=n[0];if(yW(e))return{args:e,keys:null};if(function wW(n){return n&&"object"==typeof n&&_W(n)===xW}(e)){const t=MW(e);return{args:t.map(i=>e[i]),keys:t}}}return{args:n,keys:null}}(n);if(0===i.length)return wr([],e);const o=new tr(function T8(n,e,t=ua){return i=>{AN(e,()=>{const{length:r}=n,o=new Array(r);let a=r,u=r;for(let h=0;h<r;h++)AN(e,()=>{const f=wr(n[h],e);let g=!1;f.subscribe(nr(i,_=>{o[h]=_,g||(g=!0,u--),u||i.next(t(o.slice()))},()=>{--a||i.complete()}))},i)},i)}}(i,e,r?a=>function bL(n,e){return n.reduce((t,i,r)=>(t[i]=e[r],t),{})}(r,a):ua));return t?o.pipe(function wL(n){return hi(e=>function EW(n,e){return bW(e)?n(...e):n(e)}(n,e))}(t)):o}function AN(n,e,t){n?os(t,n,e):e()}const B0=zn(n=>function(){n(this),this.name="EmptyError",this.message="no elements in sequence"});function TS(...n){return function C8(){return ja(1)}()(wr(n,Oc(n)))}function DN(n){return new tr(e=>{bs(n()).subscribe(e)})}function Mv(n,e){const t=Tn(n)?n:()=>n,i=r=>r.error(t());return new tr(e?r=>e.schedule(i,0,r):i)}function CS(){return hr((n,e)=>{let t=null;n._refCount++;const i=nr(e,void 0,void 0,void 0,()=>{if(!n||n._refCount<=0||0<--n._refCount)return void(t=null);const r=n._connection,o=t;t=null,r&&(!o||r===o)&&r.unsubscribe(),e.unsubscribe()});n.subscribe(i),i.closed||(t=n.connect())})}class RN extends tr{constructor(e,t){super(),this.source=e,this.subjectFactory=t,this._subject=null,this._refCount=0,this._connection=null,jm(e)&&(this.lift=e.lift)}_subscribe(e){return this.getSubject().subscribe(e)}getSubject(){const e=this._subject;return(!e||e.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:e}=this;this._subject=this._connection=null,e?.unsubscribe()}connect(){let e=this._connection;if(!e){e=this._connection=new er;const t=this.getSubject();e.add(this.source.subscribe(nr(t,void 0,()=>{this._teardown(),t.complete()},i=>{this._teardown(),t.error(i)},()=>this._teardown()))),e.closed&&(this._connection=null,e=er.EMPTY)}return e}refCount(){return CS()(this)}}function Fp(n){return n<=0?()=>so:hr((e,t)=>{let i=0;e.subscribe(nr(t,r=>{++i<=n&&(t.next(r),n<=i&&t.complete())}))})}function Du(n,e){return hr((t,i)=>{let r=0;t.subscribe(nr(i,o=>n.call(e,o,r++)&&i.next(o)))})}function k0(n){return hr((e,t)=>{let i=!1;e.subscribe(nr(t,r=>{i=!0,t.next(r)},()=>{i||t.next(n),t.complete()}))})}function IN(n=D8){return hr((e,t)=>{let i=!1;e.subscribe(nr(t,r=>{i=!0,t.next(r)},()=>i?t.complete():t.error(n())))})}function D8(){return new B0}function gd(n,e){const t=arguments.length>=2;return i=>i.pipe(n?Du((r,o)=>n(r,o,i)):ua,Fp(1),t?k0(e):IN(()=>new B0))}function wv(n,e){return Tn(e)?Mr(n,e,1):Mr(n,1)}function Is(n,e,t){const i=Tn(n)||e||t?{next:n,error:e,complete:t}:n;return i?hr((r,o)=>{var a;null===(a=i.subscribe)||void 0===a||a.call(i);let u=!0;r.subscribe(nr(o,h=>{var f;null===(f=i.next)||void 0===f||f.call(i,h),o.next(h)},()=>{var h;u=!1,null===(h=i.complete)||void 0===h||h.call(i),o.complete()},h=>{var f;u=!1,null===(f=i.error)||void 0===f||f.call(i,h),o.error(h)},()=>{var h,f;u&&(null===(h=i.unsubscribe)||void 0===h||h.call(i)),null===(f=i.finalize)||void 0===f||f.call(i)}))}):ua}function vd(n){return hr((e,t)=>{let o,i=null,r=!1;i=e.subscribe(nr(t,void 0,void 0,a=>{o=bs(n(a,vd(n)(e))),i?(i.unsubscribe(),i=null,o.subscribe(t)):r=!0})),r&&(i.unsubscribe(),i=null,o.subscribe(t))})}function AS(n){return n<=0?()=>so:hr((e,t)=>{let i=[];e.subscribe(nr(t,r=>{i.push(r),n<i.length&&i.shift()},()=>{for(const r of i)t.next(r);t.complete()},void 0,()=>{i=null}))})}function DS(n){return hr((e,t)=>{try{e.subscribe(t)}finally{t.add(n)}})}const Cn="primary",bv=Symbol("RouteTitle");class O8{constructor(e){this.params=e||{}}has(e){return Object.prototype.hasOwnProperty.call(this.params,e)}get(e){if(this.has(e)){const t=this.params[e];return Array.isArray(t)?t[0]:t}return null}getAll(e){if(this.has(e)){const t=this.params[e];return Array.isArray(t)?t:[t]}return[]}get keys(){return Object.keys(this.params)}}function Up(n){return new O8(n)}function F8(n,e,t){const i=t.path.split("/");if(i.length>n.length||"full"===t.pathMatch&&(e.hasChildren()||i.length<n.length))return null;const r={};for(let o=0;o<i.length;o++){const a=i[o],u=n[o];if(a.startsWith(":"))r[a.substring(1)]=u;else if(a!==u.path)return null}return{consumed:n.slice(0,i.length),posParams:r}}function ml(n,e){const t=n?Object.keys(n):void 0,i=e?Object.keys(e):void 0;if(!t||!i||t.length!=i.length)return!1;let r;for(let o=0;o<t.length;o++)if(r=t[o],!PN(n[r],e[r]))return!1;return!0}function PN(n,e){if(Array.isArray(n)&&Array.isArray(e)){if(n.length!==e.length)return!1;const t=[...n].sort(),i=[...e].sort();return t.every((r,o)=>i[o]===r)}return n===e}function LN(n){return n.length>0?n[n.length-1]:null}function Ru(n){return function S8(n){return!!n&&(n instanceof tr||Tn(n.lift)&&Tn(n.subscribe))}(n)?n:tv(n)?wr(Promise.resolve(n)):on(n)}const B8={exact:function FN(n,e,t){if(!yd(n.segments,e.segments)||!V0(n.segments,e.segments,t)||n.numberOfChildren!==e.numberOfChildren)return!1;for(const i in e.children)if(!n.children[i]||!FN(n.children[i],e.children[i],t))return!1;return!0},subset:UN},NN={exact:function k8(n,e){return ml(n,e)},subset:function V8(n,e){return Object.keys(e).length<=Object.keys(n).length&&Object.keys(e).every(t=>PN(n[t],e[t]))},ignored:()=>!0};function ON(n,e,t){return B8[t.paths](n.root,e.root,t.matrixParams)&&NN[t.queryParams](n.queryParams,e.queryParams)&&!("exact"===t.fragment&&n.fragment!==e.fragment)}function UN(n,e,t){return BN(n,e,e.segments,t)}function BN(n,e,t,i){if(n.segments.length>t.length){const r=n.segments.slice(0,t.length);return!(!yd(r,t)||e.hasChildren()||!V0(r,t,i))}if(n.segments.length===t.length){if(!yd(n.segments,t)||!V0(n.segments,t,i))return!1;for(const r in e.children)if(!n.children[r]||!UN(n.children[r],e.children[r],i))return!1;return!0}{const r=t.slice(0,n.segments.length),o=t.slice(n.segments.length);return!!(yd(n.segments,r)&&V0(n.segments,r,i)&&n.children[Cn])&&BN(n.children[Cn],e,o,i)}}function V0(n,e,t){return e.every((i,r)=>NN[t](n[r].parameters,i.parameters))}class Bp{constructor(e=new Mi([],{}),t={},i=null){this.root=e,this.queryParams=t,this.fragment=i}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Up(this.queryParams)),this._queryParamMap}toString(){return G8.serialize(this)}}class Mi{constructor(e,t){this.segments=e,this.children=t,this.parent=null,Object.values(t).forEach(i=>i.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return z0(this)}}class Ev{constructor(e,t){this.path=e,this.parameters=t}get parameterMap(){return this._parameterMap||(this._parameterMap=Up(this.parameters)),this._parameterMap}toString(){return zN(this)}}function yd(n,e){return n.length===e.length&&n.every((t,i)=>t.path===e[i].path)}let Sv=(()=>{class n{static#e=this.\u0275fac=function(i){return new(i||n)};static#t=this.\u0275prov=Zt({token:n,factory:function(){return new RS},providedIn:"root"})}return n})();class RS{parse(e){const t=new e6(e);return new Bp(t.parseRootSegment(),t.parseQueryParams(),t.parseFragment())}serialize(e){const t=`/${Tv(e.root,!0)}`,i=function $8(n){const e=Object.keys(n).map(t=>{const i=n[t];return Array.isArray(i)?i.map(r=>`${H0(t)}=${H0(r)}`).join("&"):`${H0(t)}=${H0(i)}`}).filter(t=>!!t);return e.length?`?${e.join("&")}`:""}(e.queryParams);return`${t}${i}${"string"==typeof e.fragment?`#${function W8(n){return encodeURI(n)}(e.fragment)}`:""}`}}const G8=new RS;function z0(n){return n.segments.map(e=>zN(e)).join("/")}function Tv(n,e){if(!n.hasChildren())return z0(n);if(e){const t=n.children[Cn]?Tv(n.children[Cn],!1):"",i=[];return Object.entries(n.children).forEach(([r,o])=>{r!==Cn&&i.push(`${r}:${Tv(o,!1)}`)}),i.length>0?`${t}(${i.join("//")})`:t}{const t=function H8(n,e){let t=[];return Object.entries(n.children).forEach(([i,r])=>{i===Cn&&(t=t.concat(e(r,i)))}),Object.entries(n.children).forEach(([i,r])=>{i!==Cn&&(t=t.concat(e(r,i)))}),t}(n,(i,r)=>r===Cn?[Tv(n.children[Cn],!1)]:[`${r}:${Tv(i,!1)}`]);return 1===Object.keys(n.children).length&&null!=n.children[Cn]?`${z0(n)}/${t[0]}`:`${z0(n)}/(${t.join("//")})`}}function kN(n){return encodeURIComponent(n).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function H0(n){return kN(n).replace(/%3B/gi,";")}function IS(n){return kN(n).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function G0(n){return decodeURIComponent(n)}function VN(n){return G0(n.replace(/\+/g,"%20"))}function zN(n){return`${IS(n.path)}${function j8(n){return Object.keys(n).map(e=>`;${IS(e)}=${IS(n[e])}`).join("")}(n.parameters)}`}const X8=/^[^\/()?;#]+/;function PS(n){const e=n.match(X8);return e?e[0]:""}const q8=/^[^\/()?;=#]+/,Z8=/^[^=?&#]+/,K8=/^[^&#]+/;class e6{constructor(e){this.url=e,this.remaining=e}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new Mi([],{}):new Mi([],this.parseChildren())}parseQueryParams(){const e={};if(this.consumeOptional("?"))do{this.parseQueryParam(e)}while(this.consumeOptional("&"));return e}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const e=[];for(this.peekStartsWith("(")||e.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),e.push(this.parseSegment());let t={};this.peekStartsWith("/(")&&(this.capture("/"),t=this.parseParens(!0));let i={};return this.peekStartsWith("(")&&(i=this.parseParens(!1)),(e.length>0||Object.keys(t).length>0)&&(i[Cn]=new Mi(e,t)),i}parseSegment(){const e=PS(this.remaining);if(""===e&&this.peekStartsWith(";"))throw new z(4009,!1);return this.capture(e),new Ev(G0(e),this.parseMatrixParams())}parseMatrixParams(){const e={};for(;this.consumeOptional(";");)this.parseParam(e);return e}parseParam(e){const t=function Y8(n){const e=n.match(q8);return e?e[0]:""}(this.remaining);if(!t)return;this.capture(t);let i="";if(this.consumeOptional("=")){const r=PS(this.remaining);r&&(i=r,this.capture(i))}e[G0(t)]=G0(i)}parseQueryParam(e){const t=function J8(n){const e=n.match(Z8);return e?e[0]:""}(this.remaining);if(!t)return;this.capture(t);let i="";if(this.consumeOptional("=")){const a=function Q8(n){const e=n.match(K8);return e?e[0]:""}(this.remaining);a&&(i=a,this.capture(i))}const r=VN(t),o=VN(i);if(e.hasOwnProperty(r)){let a=e[r];Array.isArray(a)||(a=[a],e[r]=a),a.push(o)}else e[r]=o}parseParens(e){const t={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const i=PS(this.remaining),r=this.remaining[i.length];if("/"!==r&&")"!==r&&";"!==r)throw new z(4010,!1);let o;i.indexOf(":")>-1?(o=i.slice(0,i.indexOf(":")),this.capture(o),this.capture(":")):e&&(o=Cn);const a=this.parseChildren();t[o]=1===Object.keys(a).length?a[Cn]:new Mi([],a),this.consumeOptional("//")}return t}peekStartsWith(e){return this.remaining.startsWith(e)}consumeOptional(e){return!!this.peekStartsWith(e)&&(this.remaining=this.remaining.substring(e.length),!0)}capture(e){if(!this.consumeOptional(e))throw new z(4011,!1)}}function HN(n){return n.segments.length>0?new Mi([],{[Cn]:n}):n}function GN(n){const e={};for(const i of Object.keys(n.children)){const o=GN(n.children[i]);if(i===Cn&&0===o.segments.length&&o.hasChildren())for(const[a,u]of Object.entries(o.children))e[a]=u;else(o.segments.length>0||o.hasChildren())&&(e[i]=o)}return function t6(n){if(1===n.numberOfChildren&&n.children[Cn]){const e=n.children[Cn];return new Mi(n.segments.concat(e.segments),e.children)}return n}(new Mi(n.segments,e))}function _d(n){return n instanceof Bp}function WN(n){let e;const r=HN(function t(o){const a={};for(const h of o.children){const f=t(h);a[h.outlet]=f}const u=new Mi(o.url,a);return o===n&&(e=u),u}(n.root));return e??r}function jN(n,e,t,i){let r=n;for(;r.parent;)r=r.parent;if(0===e.length)return LS(r,r,r,t,i);const o=function i6(n){if("string"==typeof n[0]&&1===n.length&&"/"===n[0])return new XN(!0,0,n);let e=0,t=!1;const i=n.reduce((r,o,a)=>{if("object"==typeof o&&null!=o){if(o.outlets){const u={};return Object.entries(o.outlets).forEach(([h,f])=>{u[h]="string"==typeof f?f.split("/"):f}),[...r,{outlets:u}]}if(o.segmentPath)return[...r,o.segmentPath]}return"string"!=typeof o?[...r,o]:0===a?(o.split("/").forEach((u,h)=>{0==h&&"."===u||(0==h&&""===u?t=!0:".."===u?e++:""!=u&&r.push(u))}),r):[...r,o]},[]);return new XN(t,e,i)}(e);if(o.toRoot())return LS(r,r,new Mi([],{}),t,i);const a=function r6(n,e,t){if(n.isAbsolute)return new j0(e,!0,0);if(!t)return new j0(e,!1,NaN);if(null===t.parent)return new j0(t,!0,0);const i=W0(n.commands[0])?0:1;return function s6(n,e,t){let i=n,r=e,o=t;for(;o>r;){if(o-=r,i=i.parent,!i)throw new z(4005,!1);r=i.segments.length}return new j0(i,!1,r-o)}(t,t.segments.length-1+i,n.numberOfDoubleDots)}(o,r,n),u=a.processChildren?Av(a.segmentGroup,a.index,o.commands):qN(a.segmentGroup,a.index,o.commands);return LS(r,a.segmentGroup,u,t,i)}function W0(n){return"object"==typeof n&&null!=n&&!n.outlets&&!n.segmentPath}function Cv(n){return"object"==typeof n&&null!=n&&n.outlets}function LS(n,e,t,i,r){let a,o={};i&&Object.entries(i).forEach(([h,f])=>{o[h]=Array.isArray(f)?f.map(g=>`${g}`):`${f}`}),a=n===e?t:$N(n,e,t);const u=HN(GN(a));return new Bp(u,o,r)}function $N(n,e,t){const i={};return Object.entries(n.children).forEach(([r,o])=>{i[r]=o===e?t:$N(o,e,t)}),new Mi(n.segments,i)}class XN{constructor(e,t,i){if(this.isAbsolute=e,this.numberOfDoubleDots=t,this.commands=i,e&&i.length>0&&W0(i[0]))throw new z(4003,!1);const r=i.find(Cv);if(r&&r!==LN(i))throw new z(4004,!1)}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class j0{constructor(e,t,i){this.segmentGroup=e,this.processChildren=t,this.index=i}}function qN(n,e,t){if(n||(n=new Mi([],{})),0===n.segments.length&&n.hasChildren())return Av(n,e,t);const i=function a6(n,e,t){let i=0,r=e;const o={match:!1,pathIndex:0,commandIndex:0};for(;r<n.segments.length;){if(i>=t.length)return o;const a=n.segments[r],u=t[i];if(Cv(u))break;const h=`${u}`,f=i<t.length-1?t[i+1]:null;if(r>0&&void 0===h)break;if(h&&f&&"object"==typeof f&&void 0===f.outlets){if(!ZN(h,f,a))return o;i+=2}else{if(!ZN(h,{},a))return o;i++}r++}return{match:!0,pathIndex:r,commandIndex:i}}(n,e,t),r=t.slice(i.commandIndex);if(i.match&&i.pathIndex<n.segments.length){const o=new Mi(n.segments.slice(0,i.pathIndex),{});return o.children[Cn]=new Mi(n.segments.slice(i.pathIndex),n.children),Av(o,0,r)}return i.match&&0===r.length?new Mi(n.segments,{}):i.match&&!n.hasChildren()?NS(n,e,t):i.match?Av(n,0,r):NS(n,e,t)}function Av(n,e,t){if(0===t.length)return new Mi(n.segments,{});{const i=function o6(n){return Cv(n[0])?n[0].outlets:{[Cn]:n}}(t),r={};if(Object.keys(i).some(o=>o!==Cn)&&n.children[Cn]&&1===n.numberOfChildren&&0===n.children[Cn].segments.length){const o=Av(n.children[Cn],e,t);return new Mi(n.segments,o.children)}return Object.entries(i).forEach(([o,a])=>{"string"==typeof a&&(a=[a]),null!==a&&(r[o]=qN(n.children[o],e,a))}),Object.entries(n.children).forEach(([o,a])=>{void 0===i[o]&&(r[o]=a)}),new Mi(n.segments,r)}}function NS(n,e,t){const i=n.segments.slice(0,e);let r=0;for(;r<t.length;){const o=t[r];if(Cv(o)){const h=l6(o.outlets);return new Mi(i,h)}if(0===r&&W0(t[0])){i.push(new Ev(n.segments[e].path,YN(t[0]))),r++;continue}const a=Cv(o)?o.outlets[Cn]:`${o}`,u=r<t.length-1?t[r+1]:null;a&&u&&W0(u)?(i.push(new Ev(a,YN(u))),r+=2):(i.push(new Ev(a,{})),r++)}return new Mi(i,{})}function l6(n){const e={};return Object.entries(n).forEach(([t,i])=>{"string"==typeof i&&(i=[i]),null!==i&&(e[t]=NS(new Mi([],{}),0,i))}),e}function YN(n){const e={};return Object.entries(n).forEach(([t,i])=>e[t]=`${i}`),e}function ZN(n,e,t){return n==t.path&&ml(e,t.parameters)}const Dv="imperative";class gl{constructor(e,t){this.id=e,this.url=t}}class $0 extends gl{constructor(e,t,i="imperative",r=null){super(e,t),this.type=0,this.navigationTrigger=i,this.restoredState=r}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class Iu extends gl{constructor(e,t,i){super(e,t),this.urlAfterRedirects=i,this.type=1}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class Rv extends gl{constructor(e,t,i,r){super(e,t),this.reason=i,this.code=r,this.type=2}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class kp extends gl{constructor(e,t,i,r){super(e,t),this.reason=i,this.code=r,this.type=16}}class X0 extends gl{constructor(e,t,i,r){super(e,t),this.error=i,this.target=r,this.type=3}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class JN extends gl{constructor(e,t,i,r){super(e,t),this.urlAfterRedirects=i,this.state=r,this.type=4}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class c6 extends gl{constructor(e,t,i,r){super(e,t),this.urlAfterRedirects=i,this.state=r,this.type=7}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class u6 extends gl{constructor(e,t,i,r,o){super(e,t),this.urlAfterRedirects=i,this.state=r,this.shouldActivate=o,this.type=8}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class h6 extends gl{constructor(e,t,i,r){super(e,t),this.urlAfterRedirects=i,this.state=r,this.type=5}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class d6 extends gl{constructor(e,t,i,r){super(e,t),this.urlAfterRedirects=i,this.state=r,this.type=6}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class f6{constructor(e){this.route=e,this.type=9}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class p6{constructor(e){this.route=e,this.type=10}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class m6{constructor(e){this.snapshot=e,this.type=11}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class g6{constructor(e){this.snapshot=e,this.type=12}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class v6{constructor(e){this.snapshot=e,this.type=13}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class y6{constructor(e){this.snapshot=e,this.type=14}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class KN{constructor(e,t,i){this.routerEvent=e,this.position=t,this.anchor=i,this.type=15}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}class OS{}class FS{constructor(e){this.url=e}}class _6{constructor(){this.outlet=null,this.route=null,this.injector=null,this.children=new Iv,this.attachRef=null}}let Iv=(()=>{class n{constructor(){this.contexts=new Map}onChildOutletCreated(t,i){const r=this.getOrCreateContext(t);r.outlet=i,this.contexts.set(t,r)}onChildOutletDestroyed(t){const i=this.getContext(t);i&&(i.outlet=null,i.attachRef=null)}onOutletDeactivated(){const t=this.contexts;return this.contexts=new Map,t}onOutletReAttached(t){this.contexts=t}getOrCreateContext(t){let i=this.getContext(t);return i||(i=new _6,this.contexts.set(t,i)),i}getContext(t){return this.contexts.get(t)||null}static#e=this.\u0275fac=function(i){return new(i||n)};static#t=this.\u0275prov=Zt({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();class QN{constructor(e){this._root=e}get root(){return this._root.value}parent(e){const t=this.pathFromRoot(e);return t.length>1?t[t.length-2]:null}children(e){const t=US(e,this._root);return t?t.children.map(i=>i.value):[]}firstChild(e){const t=US(e,this._root);return t&&t.children.length>0?t.children[0].value:null}siblings(e){const t=BS(e,this._root);return t.length<2?[]:t[t.length-2].children.map(r=>r.value).filter(r=>r!==e)}pathFromRoot(e){return BS(e,this._root).map(t=>t.value)}}function US(n,e){if(n===e.value)return e;for(const t of e.children){const i=US(n,t);if(i)return i}return null}function BS(n,e){if(n===e.value)return[e];for(const t of e.children){const i=BS(n,t);if(i.length)return i.unshift(e),i}return[]}class cc{constructor(e,t){this.value=e,this.children=t}toString(){return`TreeNode(${this.value})`}}function Vp(n){const e={};return n&&n.children.forEach(t=>e[t.value.outlet]=t),e}class eO extends QN{constructor(e,t){super(e),this.snapshot=t,kS(this,e)}toString(){return this.snapshot.toString()}}function tO(n,e){const t=function x6(n,e){const a=new q0([],{},{},"",{},Cn,e,null,{});return new iO("",new cc(a,[]))}(0,e),i=new Jr([new Ev("",{})]),r=new Jr({}),o=new Jr({}),a=new Jr({}),u=new Jr(""),h=new xd(i,r,a,u,o,Cn,e,t.root);return h.snapshot=t.root,new eO(new cc(h,[]),t)}class xd{constructor(e,t,i,r,o,a,u,h){this.urlSubject=e,this.paramsSubject=t,this.queryParamsSubject=i,this.fragmentSubject=r,this.dataSubject=o,this.outlet=a,this.component=u,this._futureSnapshot=h,this.title=this.dataSubject?.pipe(hi(f=>f[bv]))??on(void 0),this.url=e,this.params=t,this.queryParams=i,this.fragment=r,this.data=o}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe(hi(e=>Up(e)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(hi(e=>Up(e)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function nO(n,e="emptyOnly"){const t=n.pathFromRoot;let i=0;if("always"!==e)for(i=t.length-1;i>=1;){const r=t[i],o=t[i-1];if(r.routeConfig&&""===r.routeConfig.path)i--;else{if(o.component)break;i--}}return function M6(n){return n.reduce((e,t)=>({params:{...e.params,...t.params},data:{...e.data,...t.data},resolve:{...t.data,...e.resolve,...t.routeConfig?.data,...t._resolvedData}}),{params:{},data:{},resolve:{}})}(t.slice(i))}class q0{get title(){return this.data?.[bv]}constructor(e,t,i,r,o,a,u,h,f){this.url=e,this.params=t,this.queryParams=i,this.fragment=r,this.data=o,this.outlet=a,this.component=u,this.routeConfig=h,this._resolve=f}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=Up(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Up(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(i=>i.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class iO extends QN{constructor(e,t){super(t),this.url=e,kS(this,t)}toString(){return rO(this._root)}}function kS(n,e){e.value._routerState=n,e.children.forEach(t=>kS(n,t))}function rO(n){const e=n.children.length>0?` { ${n.children.map(rO).join(", ")} } `:"";return`${n.value}${e}`}function VS(n){if(n.snapshot){const e=n.snapshot,t=n._futureSnapshot;n.snapshot=t,ml(e.queryParams,t.queryParams)||n.queryParamsSubject.next(t.queryParams),e.fragment!==t.fragment&&n.fragmentSubject.next(t.fragment),ml(e.params,t.params)||n.paramsSubject.next(t.params),function U8(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;++t)if(!ml(n[t],e[t]))return!1;return!0}(e.url,t.url)||n.urlSubject.next(t.url),ml(e.data,t.data)||n.dataSubject.next(t.data)}else n.snapshot=n._futureSnapshot,n.dataSubject.next(n._futureSnapshot.data)}function zS(n,e){const t=ml(n.params,e.params)&&function z8(n,e){return yd(n,e)&&n.every((t,i)=>ml(t.parameters,e[i].parameters))}(n.url,e.url);return t&&!(!n.parent!=!e.parent)&&(!n.parent||zS(n.parent,e.parent))}let HS=(()=>{class n{constructor(){this.activated=null,this._activatedRoute=null,this.name=Cn,this.activateEvents=new gr,this.deactivateEvents=new gr,this.attachEvents=new gr,this.detachEvents=new gr,this.parentContexts=St(Iv),this.location=St(La),this.changeDetector=St(u0),this.environmentInjector=St(Qo),this.inputBinder=St(Y0,{optional:!0}),this.supportsBindingToComponentInputs=!0}get activatedComponentRef(){return this.activated}ngOnChanges(t){if(t.name){const{firstChange:i,previousValue:r}=t.name;if(i)return;this.isTrackedInParentContexts(r)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(r)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(t){return this.parentContexts.getContext(t)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;const t=this.parentContexts.getContext(this.name);t?.route&&(t.attachRef?this.attach(t.attachRef,t.route):this.activateWith(t.route,t.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new z(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new z(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new z(4012,!1);this.location.detach();const t=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(t.instance),t}attach(t,i){this.activated=t,this._activatedRoute=i,this.location.insert(t.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(t.instance)}deactivate(){if(this.activated){const t=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(t)}}activateWith(t,i){if(this.isActivated)throw new z(4013,!1);this._activatedRoute=t;const r=this.location,a=t.snapshot.component,u=this.parentContexts.getOrCreateContext(this.name).children,h=new w6(t,u,r.injector);this.activated=r.createComponent(a,{index:r.length,injector:h,environmentInjector:i??this.environmentInjector}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}static#e=this.\u0275fac=function(i){return new(i||n)};static#t=this.\u0275dir=an({type:n,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[hs]})}return n})();class w6{constructor(e,t,i){this.route=e,this.childContexts=t,this.parent=i}get(e,t){return e===xd?this.route:e===Iv?this.childContexts:this.parent.get(e,t)}}const Y0=new Ot("");let sO=(()=>{class n{constructor(){this.outletDataSubscriptions=new Map}bindActivatedRouteToOutletComponent(t){this.unsubscribeFromRouteData(t),this.subscribeToRouteData(t)}unsubscribeFromRouteData(t){this.outletDataSubscriptions.get(t)?.unsubscribe(),this.outletDataSubscriptions.delete(t)}subscribeToRouteData(t){const{activatedRoute:i}=t,r=SS([i.queryParams,i.params,i.data]).pipe(Ho(([o,a,u],h)=>(u={...o,...a,...u},0===h?on(u):Promise.resolve(u)))).subscribe(o=>{if(!t.isActivated||!t.activatedComponentRef||t.activatedRoute!==i||null===i.component)return void this.unsubscribeFromRouteData(t);const a=function $G(n){const e=jn(n);if(!e)return null;const t=new Zg(e);return{get selector(){return t.selector},get type(){return t.componentType},get inputs(){return t.inputs},get outputs(){return t.outputs},get ngContentSelectors(){return t.ngContentSelectors},get isStandalone(){return e.standalone},get isSignal(){return e.signals}}}(i.component);if(a)for(const{templateName:u}of a.inputs)t.activatedComponentRef.setInput(u,o[u]);else this.unsubscribeFromRouteData(t)});this.outletDataSubscriptions.set(t,r)}static#e=this.\u0275fac=function(i){return new(i||n)};static#t=this.\u0275prov=Zt({token:n,factory:n.\u0275fac})}return n})();function Pv(n,e,t){if(t&&n.shouldReuseRoute(e.value,t.value.snapshot)){const i=t.value;i._futureSnapshot=e.value;const r=function E6(n,e,t){return e.children.map(i=>{for(const r of t.children)if(n.shouldReuseRoute(i.value,r.value.snapshot))return Pv(n,i,r);return Pv(n,i)})}(n,e,t);return new cc(i,r)}{if(n.shouldAttach(e.value)){const o=n.retrieve(e.value);if(null!==o){const a=o.route;return a.value._futureSnapshot=e.value,a.children=e.children.map(u=>Pv(n,u)),a}}const i=function S6(n){return new xd(new Jr(n.url),new Jr(n.params),new Jr(n.queryParams),new Jr(n.fragment),new Jr(n.data),n.outlet,n.component,n)}(e.value),r=e.children.map(o=>Pv(n,o));return new cc(i,r)}}const GS="ngNavigationCancelingError";function oO(n,e){const{redirectTo:t,navigationBehaviorOptions:i}=_d(e)?{redirectTo:e,navigationBehaviorOptions:void 0}:e,r=aO(!1,0,e);return r.url=t,r.navigationBehaviorOptions=i,r}function aO(n,e,t){const i=new Error("NavigationCancelingError: "+(n||""));return i[GS]=!0,i.cancellationCode=e,t&&(i.url=t),i}function lO(n){return n&&n[GS]}let cO=(()=>{class n{static#e=this.\u0275fac=function(i){return new(i||n)};static#t=this.\u0275cmp=Al({type:n,selectors:[["ng-component"]],standalone:!0,features:[rI],decls:1,vars:0,template:function(i,r){1&i&&ad(0,"router-outlet")},dependencies:[HS],encapsulation:2})}return n})();function WS(n){const e=n.children&&n.children.map(WS),t=e?{...n,children:e}:{...n};return!t.component&&!t.loadComponent&&(e||t.loadChildren)&&t.outlet&&t.outlet!==Cn&&(t.component=cO),t}function Fa(n){return n.outlet||Cn}function Lv(n){if(!n)return null;if(n.routeConfig?._injector)return n.routeConfig._injector;for(let e=n.parent;e;e=e.parent){const t=e.routeConfig;if(t?._loadedInjector)return t._loadedInjector;if(t?._injector)return t._injector}return null}class L6{constructor(e,t,i,r,o){this.routeReuseStrategy=e,this.futureState=t,this.currState=i,this.forwardEvent=r,this.inputBindingEnabled=o}activate(e){const t=this.futureState._root,i=this.currState?this.currState._root:null;this.deactivateChildRoutes(t,i,e),VS(this.futureState.root),this.activateChildRoutes(t,i,e)}deactivateChildRoutes(e,t,i){const r=Vp(t);e.children.forEach(o=>{const a=o.value.outlet;this.deactivateRoutes(o,r[a],i),delete r[a]}),Object.values(r).forEach(o=>{this.deactivateRouteAndItsChildren(o,i)})}deactivateRoutes(e,t,i){const r=e.value,o=t?t.value:null;if(r===o)if(r.component){const a=i.getContext(r.outlet);a&&this.deactivateChildRoutes(e,t,a.children)}else this.deactivateChildRoutes(e,t,i);else o&&this.deactivateRouteAndItsChildren(t,i)}deactivateRouteAndItsChildren(e,t){e.value.component&&this.routeReuseStrategy.shouldDetach(e.value.snapshot)?this.detachAndStoreRouteSubtree(e,t):this.deactivateRouteAndOutlet(e,t)}detachAndStoreRouteSubtree(e,t){const i=t.getContext(e.value.outlet),r=i&&e.value.component?i.children:t,o=Vp(e);for(const a of Object.keys(o))this.deactivateRouteAndItsChildren(o[a],r);if(i&&i.outlet){const a=i.outlet.detach(),u=i.children.onOutletDeactivated();this.routeReuseStrategy.store(e.value.snapshot,{componentRef:a,route:e,contexts:u})}}deactivateRouteAndOutlet(e,t){const i=t.getContext(e.value.outlet),r=i&&e.value.component?i.children:t,o=Vp(e);for(const a of Object.keys(o))this.deactivateRouteAndItsChildren(o[a],r);i&&(i.outlet&&(i.outlet.deactivate(),i.children.onOutletDeactivated()),i.attachRef=null,i.route=null)}activateChildRoutes(e,t,i){const r=Vp(t);e.children.forEach(o=>{this.activateRoutes(o,r[o.value.outlet],i),this.forwardEvent(new y6(o.value.snapshot))}),e.children.length&&this.forwardEvent(new g6(e.value.snapshot))}activateRoutes(e,t,i){const r=e.value,o=t?t.value:null;if(VS(r),r===o)if(r.component){const a=i.getOrCreateContext(r.outlet);this.activateChildRoutes(e,t,a.children)}else this.activateChildRoutes(e,t,i);else if(r.component){const a=i.getOrCreateContext(r.outlet);if(this.routeReuseStrategy.shouldAttach(r.snapshot)){const u=this.routeReuseStrategy.retrieve(r.snapshot);this.routeReuseStrategy.store(r.snapshot,null),a.children.onOutletReAttached(u.contexts),a.attachRef=u.componentRef,a.route=u.route.value,a.outlet&&a.outlet.attach(u.componentRef,u.route.value),VS(u.route.value),this.activateChildRoutes(e,null,a.children)}else{const u=Lv(r.snapshot);a.attachRef=null,a.route=r,a.injector=u,a.outlet&&a.outlet.activateWith(r,a.injector),this.activateChildRoutes(e,null,a.children)}}else this.activateChildRoutes(e,null,i)}}class uO{constructor(e){this.path=e,this.route=this.path[this.path.length-1]}}class Z0{constructor(e,t){this.component=e,this.route=t}}function N6(n,e,t){const i=n._root;return Nv(i,e?e._root:null,t,[i.value])}function zp(n,e){const t=Symbol(),i=e.get(n,t);return i===t?"function"!=typeof n||function jM(n){return null!==hf(n)}(n)?e.get(n):n:i}function Nv(n,e,t,i,r={canDeactivateChecks:[],canActivateChecks:[]}){const o=Vp(e);return n.children.forEach(a=>{(function F6(n,e,t,i,r={canDeactivateChecks:[],canActivateChecks:[]}){const o=n.value,a=e?e.value:null,u=t?t.getContext(n.value.outlet):null;if(a&&o.routeConfig===a.routeConfig){const h=function U6(n,e,t){if("function"==typeof t)return t(n,e);switch(t){case"pathParamsChange":return!yd(n.url,e.url);case"pathParamsOrQueryParamsChange":return!yd(n.url,e.url)||!ml(n.queryParams,e.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!zS(n,e)||!ml(n.queryParams,e.queryParams);default:return!zS(n,e)}}(a,o,o.routeConfig.runGuardsAndResolvers);h?r.canActivateChecks.push(new uO(i)):(o.data=a.data,o._resolvedData=a._resolvedData),Nv(n,e,o.component?u?u.children:null:t,i,r),h&&u&&u.outlet&&u.outlet.isActivated&&r.canDeactivateChecks.push(new Z0(u.outlet.component,a))}else a&&Ov(e,u,r),r.canActivateChecks.push(new uO(i)),Nv(n,null,o.component?u?u.children:null:t,i,r)})(a,o[a.value.outlet],t,i.concat([a.value]),r),delete o[a.value.outlet]}),Object.entries(o).forEach(([a,u])=>Ov(u,t.getContext(a),r)),r}function Ov(n,e,t){const i=Vp(n),r=n.value;Object.entries(i).forEach(([o,a])=>{Ov(a,r.component?e?e.children.getContext(o):null:e,t)}),t.canDeactivateChecks.push(new Z0(r.component&&e&&e.outlet&&e.outlet.isActivated?e.outlet.component:null,r))}function Fv(n){return"function"==typeof n}function hO(n){return n instanceof B0||"EmptyError"===n?.name}const J0=Symbol("INITIAL_VALUE");function Hp(){return Ho(n=>SS(n.map(e=>e.pipe(Fp(1),function A8(...n){const e=Oc(n);return hr((t,i)=>{(e?TS(n,t,e):TS(n,t)).subscribe(i)})}(J0)))).pipe(hi(e=>{for(const t of e)if(!0!==t){if(t===J0)return J0;if(!1===t||t instanceof Bp)return t}return!0}),Du(e=>e!==J0),Fp(1)))}function dO(n){return function zm(...n){return Xd(n)}(Is(e=>{if(_d(e))throw oO(0,e)}),hi(e=>!0===e))}class K0{constructor(e){this.segmentGroup=e||null}}class fO{constructor(e){this.urlTree=e}}function Gp(n){return Mv(new K0(n))}function pO(n){return Mv(new fO(n))}class ij{constructor(e,t){this.urlSerializer=e,this.urlTree=t}noMatchError(e){return new z(4002,!1)}lineralizeSegments(e,t){let i=[],r=t.root;for(;;){if(i=i.concat(r.segments),0===r.numberOfChildren)return on(i);if(r.numberOfChildren>1||!r.children[Cn])return Mv(new z(4e3,!1));r=r.children[Cn]}}applyRedirectCommands(e,t,i){return this.applyRedirectCreateUrlTree(t,this.urlSerializer.parse(t),e,i)}applyRedirectCreateUrlTree(e,t,i,r){const o=this.createSegmentGroup(e,t.root,i,r);return new Bp(o,this.createQueryParams(t.queryParams,this.urlTree.queryParams),t.fragment)}createQueryParams(e,t){const i={};return Object.entries(e).forEach(([r,o])=>{if("string"==typeof o&&o.startsWith(":")){const u=o.substring(1);i[r]=t[u]}else i[r]=o}),i}createSegmentGroup(e,t,i,r){const o=this.createSegments(e,t.segments,i,r);let a={};return Object.entries(t.children).forEach(([u,h])=>{a[u]=this.createSegmentGroup(e,h,i,r)}),new Mi(o,a)}createSegments(e,t,i,r){return t.map(o=>o.path.startsWith(":")?this.findPosParam(e,o,r):this.findOrReturn(o,i))}findPosParam(e,t,i){const r=i[t.path.substring(1)];if(!r)throw new z(4001,!1);return r}findOrReturn(e,t){let i=0;for(const r of t){if(r.path===e.path)return t.splice(i),r;i++}return e}}const jS={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function rj(n,e,t,i,r){const o=$S(n,e,t);return o.matched?(i=function C6(n,e){return n.providers&&!n._injector&&(n._injector=tE(n.providers,e,`Route: ${n.path}`)),n._injector??e}(e,i),function ej(n,e,t,i){const r=e.canMatch;return r&&0!==r.length?on(r.map(a=>{const u=zp(a,n);return Ru(function G6(n){return n&&Fv(n.canMatch)}(u)?u.canMatch(e,t):n.runInContext(()=>u(e,t)))})).pipe(Hp(),dO()):on(!0)}(i,e,t).pipe(hi(a=>!0===a?o:{...jS}))):on(o)}function $S(n,e,t){if(""===e.path)return"full"===e.pathMatch&&(n.hasChildren()||t.length>0)?{...jS}:{matched:!0,consumedSegments:[],remainingSegments:t,parameters:{},positionalParamSegments:{}};const r=(e.matcher||F8)(t,n,e);if(!r)return{...jS};const o={};Object.entries(r.posParams??{}).forEach(([u,h])=>{o[u]=h.path});const a=r.consumed.length>0?{...o,...r.consumed[r.consumed.length-1].parameters}:o;return{matched:!0,consumedSegments:r.consumed,remainingSegments:t.slice(r.consumed.length),parameters:a,positionalParamSegments:r.posParams??{}}}function mO(n,e,t,i){return t.length>0&&function aj(n,e,t){return t.some(i=>Q0(n,e,i)&&Fa(i)!==Cn)}(n,t,i)?{segmentGroup:new Mi(e,oj(i,new Mi(t,n.children))),slicedSegments:[]}:0===t.length&&function lj(n,e,t){return t.some(i=>Q0(n,e,i))}(n,t,i)?{segmentGroup:new Mi(n.segments,sj(n,0,t,i,n.children)),slicedSegments:t}:{segmentGroup:new Mi(n.segments,n.children),slicedSegments:t}}function sj(n,e,t,i,r){const o={};for(const a of i)if(Q0(n,t,a)&&!r[Fa(a)]){const u=new Mi([],{});o[Fa(a)]=u}return{...r,...o}}function oj(n,e){const t={};t[Cn]=e;for(const i of n)if(""===i.path&&Fa(i)!==Cn){const r=new Mi([],{});t[Fa(i)]=r}return t}function Q0(n,e,t){return(!(n.hasChildren()||e.length>0)||"full"!==t.pathMatch)&&""===t.path}class dj{constructor(e,t,i,r,o,a,u){this.injector=e,this.configLoader=t,this.rootComponentType=i,this.config=r,this.urlTree=o,this.paramsInheritanceStrategy=a,this.urlSerializer=u,this.allowRedirects=!0,this.applyRedirects=new ij(this.urlSerializer,this.urlTree)}noMatchError(e){return new z(4002,!1)}recognize(){const e=mO(this.urlTree.root,[],[],this.config).segmentGroup;return this.processSegmentGroup(this.injector,this.config,e,Cn).pipe(vd(t=>{if(t instanceof fO)return this.allowRedirects=!1,this.urlTree=t.urlTree,this.match(t.urlTree);throw t instanceof K0?this.noMatchError(t):t}),hi(t=>{const i=new q0([],Object.freeze({}),Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,{},Cn,this.rootComponentType,null,{}),r=new cc(i,t),o=new iO("",r),a=function n6(n,e,t=null,i=null){return jN(WN(n),e,t,i)}(i,[],this.urlTree.queryParams,this.urlTree.fragment);return a.queryParams=this.urlTree.queryParams,o.url=this.urlSerializer.serialize(a),this.inheritParamsAndData(o._root),{state:o,tree:a}}))}match(e){return this.processSegmentGroup(this.injector,this.config,e.root,Cn).pipe(vd(i=>{throw i instanceof K0?this.noMatchError(i):i}))}inheritParamsAndData(e){const t=e.value,i=nO(t,this.paramsInheritanceStrategy);t.params=Object.freeze(i.params),t.data=Object.freeze(i.data),e.children.forEach(r=>this.inheritParamsAndData(r))}processSegmentGroup(e,t,i,r){return 0===i.segments.length&&i.hasChildren()?this.processChildren(e,t,i):this.processSegment(e,t,i,i.segments,r,!0)}processChildren(e,t,i){const r=[];for(const o of Object.keys(i.children))"primary"===o?r.unshift(o):r.push(o);return wr(r).pipe(wv(o=>{const a=i.children[o],u=function I6(n,e){const t=n.filter(i=>Fa(i)===e);return t.push(...n.filter(i=>Fa(i)!==e)),t}(t,o);return this.processSegmentGroup(e,u,a,o)}),function I8(n,e){return hr(function R8(n,e,t,i,r){return(o,a)=>{let u=t,h=e,f=0;o.subscribe(nr(a,g=>{const _=f++;h=u?n(h,g,_):(u=!0,g),i&&a.next(h)},r&&(()=>{u&&a.next(h),a.complete()})))}}(n,e,arguments.length>=2,!0))}((o,a)=>(o.push(...a),o)),k0(null),function P8(n,e){const t=arguments.length>=2;return i=>i.pipe(n?Du((r,o)=>n(r,o,i)):ua,AS(1),t?k0(e):IN(()=>new B0))}(),Mr(o=>{if(null===o)return Gp(i);const a=gO(o);return function fj(n){n.sort((e,t)=>e.value.outlet===Cn?-1:t.value.outlet===Cn?1:e.value.outlet.localeCompare(t.value.outlet))}(a),on(a)}))}processSegment(e,t,i,r,o,a){return wr(t).pipe(wv(u=>this.processSegmentAgainstRoute(u._injector??e,t,u,i,r,o,a).pipe(vd(h=>{if(h instanceof K0)return on(null);throw h}))),gd(u=>!!u),vd(u=>{if(hO(u))return function uj(n,e,t){return 0===e.length&&!n.children[t]}(i,r,o)?on([]):Gp(i);throw u}))}processSegmentAgainstRoute(e,t,i,r,o,a,u){return function cj(n,e,t,i){return!!(Fa(n)===i||i!==Cn&&Q0(e,t,n))&&("**"===n.path||$S(e,n,t).matched)}(i,r,o,a)?void 0===i.redirectTo?this.matchSegmentAgainstRoute(e,r,i,o,a,u):u&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(e,r,t,i,o,a):Gp(r):Gp(r)}expandSegmentAgainstRouteUsingRedirect(e,t,i,r,o,a){return"**"===r.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(e,i,r,a):this.expandRegularSegmentAgainstRouteUsingRedirect(e,t,i,r,o,a)}expandWildCardWithParamsAgainstRouteUsingRedirect(e,t,i,r){const o=this.applyRedirects.applyRedirectCommands([],i.redirectTo,{});return i.redirectTo.startsWith("/")?pO(o):this.applyRedirects.lineralizeSegments(i,o).pipe(Mr(a=>{const u=new Mi(a,{});return this.processSegment(e,t,u,a,r,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(e,t,i,r,o,a){const{matched:u,consumedSegments:h,remainingSegments:f,positionalParamSegments:g}=$S(t,r,o);if(!u)return Gp(t);const _=this.applyRedirects.applyRedirectCommands(h,r.redirectTo,g);return r.redirectTo.startsWith("/")?pO(_):this.applyRedirects.lineralizeSegments(r,_).pipe(Mr(x=>this.processSegment(e,i,t,x.concat(f),a,!1)))}matchSegmentAgainstRoute(e,t,i,r,o,a){let u;if("**"===i.path){const h=r.length>0?LN(r).parameters:{};u=on({snapshot:new q0(r,h,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,vO(i),Fa(i),i.component??i._loadedComponent??null,i,yO(i)),consumedSegments:[],remainingSegments:[]}),t.children={}}else u=rj(t,i,r,e).pipe(hi(({matched:h,consumedSegments:f,remainingSegments:g,parameters:_})=>h?{snapshot:new q0(f,_,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,vO(i),Fa(i),i.component??i._loadedComponent??null,i,yO(i)),consumedSegments:f,remainingSegments:g}:null));return u.pipe(Ho(h=>null===h?Gp(t):this.getChildConfig(e=i._injector??e,i,r).pipe(Ho(({routes:f})=>{const g=i._loadedInjector??e,{snapshot:_,consumedSegments:x,remainingSegments:M}=h,{segmentGroup:E,slicedSegments:D}=mO(t,x,M,f);if(0===D.length&&E.hasChildren())return this.processChildren(g,f,E).pipe(hi(S=>null===S?null:[new cc(_,S)]));if(0===f.length&&0===D.length)return on([new cc(_,[])]);const C=Fa(i)===o;return this.processSegment(g,f,E,D,C?Cn:o,!0).pipe(hi(S=>[new cc(_,S)]))}))))}getChildConfig(e,t,i){return t.children?on({routes:t.children,injector:e}):t.loadChildren?void 0!==t._loadedRoutes?on({routes:t._loadedRoutes,injector:t._loadedInjector}):function Q6(n,e,t,i){const r=e.canLoad;return void 0===r||0===r.length?on(!0):on(r.map(a=>{const u=zp(a,n);return Ru(function k6(n){return n&&Fv(n.canLoad)}(u)?u.canLoad(e,t):n.runInContext(()=>u(e,t)))})).pipe(Hp(),dO())}(e,t,i).pipe(Mr(r=>r?this.configLoader.loadChildren(e,t).pipe(Is(o=>{t._loadedRoutes=o.routes,t._loadedInjector=o.injector})):function nj(n){return Mv(aO(!1,3))}())):on({routes:[],injector:e})}}function pj(n){const e=n.value.routeConfig;return e&&""===e.path}function gO(n){const e=[],t=new Set;for(const i of n){if(!pj(i)){e.push(i);continue}const r=e.find(o=>i.value.routeConfig===o.value.routeConfig);void 0!==r?(r.children.push(...i.children),t.add(r)):e.push(i)}for(const i of t){const r=gO(i.children);e.push(new cc(i.value,r))}return e.filter(i=>!t.has(i))}function vO(n){return n.data||{}}function yO(n){return n.resolve||{}}function _O(n){return"string"==typeof n.title||null===n.title}function XS(n){return Ho(e=>{const t=n(e);return t?wr(t).pipe(hi(()=>e)):on(e)})}const Wp=new Ot("ROUTES");let qS=(()=>{class n{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=St(JI)}loadComponent(t){if(this.componentLoaders.get(t))return this.componentLoaders.get(t);if(t._loadedComponent)return on(t._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(t);const i=Ru(t.loadComponent()).pipe(hi(xO),Is(o=>{this.onLoadEndListener&&this.onLoadEndListener(t),t._loadedComponent=o}),DS(()=>{this.componentLoaders.delete(t)})),r=new RN(i,()=>new Os).pipe(CS());return this.componentLoaders.set(t,r),r}loadChildren(t,i){if(this.childrenLoaders.get(i))return this.childrenLoaders.get(i);if(i._loadedRoutes)return on({routes:i._loadedRoutes,injector:i._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(i);const o=function Mj(n,e,t,i){return Ru(n.loadChildren()).pipe(hi(xO),Mr(r=>r instanceof nI||Array.isArray(r)?on(r):wr(e.compileModuleAsync(r))),hi(r=>{i&&i(n);let o,a,u=!1;return Array.isArray(r)?(a=r,!0):(o=r.create(t).injector,a=o.get(Wp,[],{optional:!0,self:!0}).flat()),{routes:a.map(WS),injector:o}}))}(i,this.compiler,t,this.onLoadEndListener).pipe(DS(()=>{this.childrenLoaders.delete(i)})),a=new RN(o,()=>new Os).pipe(CS());return this.childrenLoaders.set(i,a),a}static#e=this.\u0275fac=function(i){return new(i||n)};static#t=this.\u0275prov=Zt({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function xO(n){return function wj(n){return n&&"object"==typeof n&&"default"in n}(n)?n.default:n}let ex=(()=>{class n{get hasRequestedNavigation(){return 0!==this.navigationId}constructor(){this.currentNavigation=null,this.currentTransition=null,this.lastSuccessfulNavigation=null,this.events=new Os,this.transitionAbortSubject=new Os,this.configLoader=St(qS),this.environmentInjector=St(Qo),this.urlSerializer=St(Sv),this.rootContexts=St(Iv),this.inputBindingEnabled=null!==St(Y0,{optional:!0}),this.navigationId=0,this.afterPreactivation=()=>on(void 0),this.rootComponentType=null,this.configLoader.onLoadEndListener=r=>this.events.next(new p6(r)),this.configLoader.onLoadStartListener=r=>this.events.next(new f6(r))}complete(){this.transitions?.complete()}handleNavigationRequest(t){const i=++this.navigationId;this.transitions?.next({...this.transitions.value,...t,id:i})}setupNavigations(t,i,r){return this.transitions=new Jr({id:0,currentUrlTree:i,currentRawUrl:i,currentBrowserUrl:i,extractedUrl:t.urlHandlingStrategy.extract(i),urlAfterRedirects:t.urlHandlingStrategy.extract(i),rawUrl:i,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:Dv,restoredState:null,currentSnapshot:r.snapshot,targetSnapshot:null,currentRouterState:r,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(Du(o=>0!==o.id),hi(o=>({...o,extractedUrl:t.urlHandlingStrategy.extract(o.rawUrl)})),Ho(o=>{this.currentTransition=o;let a=!1,u=!1;return on(o).pipe(Is(h=>{this.currentNavigation={id:h.id,initialUrl:h.rawUrl,extractedUrl:h.extractedUrl,trigger:h.source,extras:h.extras,previousNavigation:this.lastSuccessfulNavigation?{...this.lastSuccessfulNavigation,previousNavigation:null}:null}}),Ho(h=>{const f=h.currentBrowserUrl.toString(),g=!t.navigated||h.extractedUrl.toString()!==f||f!==h.currentUrlTree.toString();if(!g&&"reload"!==(h.extras.onSameUrlNavigation??t.onSameUrlNavigation)){const x="";return this.events.next(new kp(h.id,this.urlSerializer.serialize(h.rawUrl),x,0)),h.resolve(null),so}if(t.urlHandlingStrategy.shouldProcessUrl(h.rawUrl))return on(h).pipe(Ho(x=>{const M=this.transitions?.getValue();return this.events.next(new $0(x.id,this.urlSerializer.serialize(x.extractedUrl),x.source,x.restoredState)),M!==this.transitions?.getValue()?so:Promise.resolve(x)}),function mj(n,e,t,i,r,o){return Mr(a=>function hj(n,e,t,i,r,o,a="emptyOnly"){return new dj(n,e,t,i,r,a,o).recognize()}(n,e,t,i,a.extractedUrl,r,o).pipe(hi(({state:u,tree:h})=>({...a,targetSnapshot:u,urlAfterRedirects:h}))))}(this.environmentInjector,this.configLoader,this.rootComponentType,t.config,this.urlSerializer,t.paramsInheritanceStrategy),Is(x=>{o.targetSnapshot=x.targetSnapshot,o.urlAfterRedirects=x.urlAfterRedirects,this.currentNavigation={...this.currentNavigation,finalUrl:x.urlAfterRedirects};const M=new JN(x.id,this.urlSerializer.serialize(x.extractedUrl),this.urlSerializer.serialize(x.urlAfterRedirects),x.targetSnapshot);this.events.next(M)}));if(g&&t.urlHandlingStrategy.shouldProcessUrl(h.currentRawUrl)){const{id:x,extractedUrl:M,source:E,restoredState:D,extras:C}=h,S=new $0(x,this.urlSerializer.serialize(M),E,D);this.events.next(S);const I=tO(0,this.rootComponentType).snapshot;return this.currentTransition=o={...h,targetSnapshot:I,urlAfterRedirects:M,extras:{...C,skipLocationChange:!1,replaceUrl:!1}},on(o)}{const x="";return this.events.next(new kp(h.id,this.urlSerializer.serialize(h.extractedUrl),x,1)),h.resolve(null),so}}),Is(h=>{const f=new c6(h.id,this.urlSerializer.serialize(h.extractedUrl),this.urlSerializer.serialize(h.urlAfterRedirects),h.targetSnapshot);this.events.next(f)}),hi(h=>(this.currentTransition=o={...h,guards:N6(h.targetSnapshot,h.currentSnapshot,this.rootContexts)},o)),function j6(n,e){return Mr(t=>{const{targetSnapshot:i,currentSnapshot:r,guards:{canActivateChecks:o,canDeactivateChecks:a}}=t;return 0===a.length&&0===o.length?on({...t,guardsResult:!0}):function $6(n,e,t,i){return wr(n).pipe(Mr(r=>function K6(n,e,t,i,r){const o=e&&e.routeConfig?e.routeConfig.canDeactivate:null;return o&&0!==o.length?on(o.map(u=>{const h=Lv(e)??r,f=zp(u,h);return Ru(function H6(n){return n&&Fv(n.canDeactivate)}(f)?f.canDeactivate(n,e,t,i):h.runInContext(()=>f(n,e,t,i))).pipe(gd())})).pipe(Hp()):on(!0)}(r.component,r.route,t,e,i)),gd(r=>!0!==r,!0))}(a,i,r,n).pipe(Mr(u=>u&&function B6(n){return"boolean"==typeof n}(u)?function X6(n,e,t,i){return wr(e).pipe(wv(r=>TS(function Y6(n,e){return null!==n&&e&&e(new m6(n)),on(!0)}(r.route.parent,i),function q6(n,e){return null!==n&&e&&e(new v6(n)),on(!0)}(r.route,i),function J6(n,e,t){const i=e[e.length-1],o=e.slice(0,e.length-1).reverse().map(a=>function O6(n){const e=n.routeConfig?n.routeConfig.canActivateChild:null;return e&&0!==e.length?{node:n,guards:e}:null}(a)).filter(a=>null!==a).map(a=>DN(()=>on(a.guards.map(h=>{const f=Lv(a.node)??t,g=zp(h,f);return Ru(function z6(n){return n&&Fv(n.canActivateChild)}(g)?g.canActivateChild(i,n):f.runInContext(()=>g(i,n))).pipe(gd())})).pipe(Hp())));return on(o).pipe(Hp())}(n,r.path,t),function Z6(n,e,t){const i=e.routeConfig?e.routeConfig.canActivate:null;if(!i||0===i.length)return on(!0);const r=i.map(o=>DN(()=>{const a=Lv(e)??t,u=zp(o,a);return Ru(function V6(n){return n&&Fv(n.canActivate)}(u)?u.canActivate(e,n):a.runInContext(()=>u(e,n))).pipe(gd())}));return on(r).pipe(Hp())}(n,r.route,t))),gd(r=>!0!==r,!0))}(i,o,n,e):on(u)),hi(u=>({...t,guardsResult:u})))})}(this.environmentInjector,h=>this.events.next(h)),Is(h=>{if(o.guardsResult=h.guardsResult,_d(h.guardsResult))throw oO(0,h.guardsResult);const f=new u6(h.id,this.urlSerializer.serialize(h.extractedUrl),this.urlSerializer.serialize(h.urlAfterRedirects),h.targetSnapshot,!!h.guardsResult);this.events.next(f)}),Du(h=>!!h.guardsResult||(this.cancelNavigationTransition(h,"",3),!1)),XS(h=>{if(h.guards.canActivateChecks.length)return on(h).pipe(Is(f=>{const g=new h6(f.id,this.urlSerializer.serialize(f.extractedUrl),this.urlSerializer.serialize(f.urlAfterRedirects),f.targetSnapshot);this.events.next(g)}),Ho(f=>{let g=!1;return on(f).pipe(function gj(n,e){return Mr(t=>{const{targetSnapshot:i,guards:{canActivateChecks:r}}=t;if(!r.length)return on(t);let o=0;return wr(r).pipe(wv(a=>function vj(n,e,t,i){const r=n.routeConfig,o=n._resolve;return void 0!==r?.title&&!_O(r)&&(o[bv]=r.title),function yj(n,e,t,i){const r=function _j(n){return[...Object.keys(n),...Object.getOwnPropertySymbols(n)]}(n);if(0===r.length)return on({});const o={};return wr(r).pipe(Mr(a=>function xj(n,e,t,i){const r=Lv(e)??i,o=zp(n,r);return Ru(o.resolve?o.resolve(e,t):r.runInContext(()=>o(e,t)))}(n[a],e,t,i).pipe(gd(),Is(u=>{o[a]=u}))),AS(1),function L8(n){return hi(()=>n)}(o),vd(a=>hO(a)?so:Mv(a)))}(o,n,e,i).pipe(hi(a=>(n._resolvedData=a,n.data=nO(n,t).resolve,r&&_O(r)&&(n.data[bv]=r.title),null)))}(a.route,i,n,e)),Is(()=>o++),AS(1),Mr(a=>o===r.length?on(t):so))})}(t.paramsInheritanceStrategy,this.environmentInjector),Is({next:()=>g=!0,complete:()=>{g||this.cancelNavigationTransition(f,"",2)}}))}),Is(f=>{const g=new d6(f.id,this.urlSerializer.serialize(f.extractedUrl),this.urlSerializer.serialize(f.urlAfterRedirects),f.targetSnapshot);this.events.next(g)}))}),XS(h=>{const f=g=>{const _=[];g.routeConfig?.loadComponent&&!g.routeConfig._loadedComponent&&_.push(this.configLoader.loadComponent(g.routeConfig).pipe(Is(x=>{g.component=x}),hi(()=>{})));for(const x of g.children)_.push(...f(x));return _};return SS(f(h.targetSnapshot.root)).pipe(k0(),Fp(1))}),XS(()=>this.afterPreactivation()),hi(h=>{const f=function b6(n,e,t){const i=Pv(n,e._root,t?t._root:void 0);return new eO(i,e)}(t.routeReuseStrategy,h.targetSnapshot,h.currentRouterState);return this.currentTransition=o={...h,targetRouterState:f},o}),Is(()=>{this.events.next(new OS)}),((n,e,t,i)=>hi(r=>(new L6(e,r.targetRouterState,r.currentRouterState,t,i).activate(n),r)))(this.rootContexts,t.routeReuseStrategy,h=>this.events.next(h),this.inputBindingEnabled),Fp(1),Is({next:h=>{a=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new Iu(h.id,this.urlSerializer.serialize(h.extractedUrl),this.urlSerializer.serialize(h.urlAfterRedirects))),t.titleStrategy?.updateTitle(h.targetRouterState.snapshot),h.resolve(!0)},complete:()=>{a=!0}}),function N8(n){return hr((e,t)=>{bs(n).subscribe(nr(t,()=>t.complete(),Ur)),!t.closed&&e.subscribe(t)})}(this.transitionAbortSubject.pipe(Is(h=>{throw h}))),DS(()=>{a||u||this.cancelNavigationTransition(o,"",1),this.currentNavigation?.id===o.id&&(this.currentNavigation=null)}),vd(h=>{if(u=!0,lO(h))this.events.next(new Rv(o.id,this.urlSerializer.serialize(o.extractedUrl),h.message,h.cancellationCode)),function T6(n){return lO(n)&&_d(n.url)}(h)?this.events.next(new FS(h.url)):o.resolve(!1);else{this.events.next(new X0(o.id,this.urlSerializer.serialize(o.extractedUrl),h,o.targetSnapshot??void 0));try{o.resolve(t.errorHandler(h))}catch(f){o.reject(f)}}return so}))}))}cancelNavigationTransition(t,i,r){const o=new Rv(t.id,this.urlSerializer.serialize(t.extractedUrl),i,r);this.events.next(o),t.resolve(!1)}static#e=this.\u0275fac=function(i){return new(i||n)};static#t=this.\u0275prov=Zt({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function MO(n){return n!==Dv}let wO=(()=>{class n{buildTitle(t){let i,r=t.root;for(;void 0!==r;)i=this.getResolvedTitleForRoute(r)??i,r=r.children.find(o=>o.outlet===Cn);return i}getResolvedTitleForRoute(t){return t.data[bv]}static#e=this.\u0275fac=function(i){return new(i||n)};static#t=this.\u0275prov=Zt({token:n,factory:function(){return St(bj)},providedIn:"root"})}return n})(),bj=(()=>{class n extends wO{constructor(t){super(),this.title=t}updateTitle(t){const i=this.buildTitle(t);void 0!==i&&this.title.setTitle(i)}static#e=this.\u0275fac=function(i){return new(i||n)(Kt(vL))};static#t=this.\u0275prov=Zt({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),Ej=(()=>{class n{static#e=this.\u0275fac=function(i){return new(i||n)};static#t=this.\u0275prov=Zt({token:n,factory:function(){return St(Tj)},providedIn:"root"})}return n})();class Sj{shouldDetach(e){return!1}store(e,t){}shouldAttach(e){return!1}retrieve(e){return null}shouldReuseRoute(e,t){return e.routeConfig===t.routeConfig}}let Tj=(()=>{class n extends Sj{static#e=this.\u0275fac=function(){let t;return function(r){return(t||(t=function Ki(n){return da(()=>{const e=n.prototype.constructor,t=e[fa]||sl(e),i=Object.prototype;let r=Object.getPrototypeOf(n.prototype).constructor;for(;r&&r!==i;){const o=r[fa]||sl(r);if(o&&o!==t)return o;r=Object.getPrototypeOf(r)}return o=>new o})}(n)))(r||n)}}();static#t=this.\u0275prov=Zt({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();const tx=new Ot("",{providedIn:"root",factory:()=>({})});let Cj=(()=>{class n{static#e=this.\u0275fac=function(i){return new(i||n)};static#t=this.\u0275prov=Zt({token:n,factory:function(){return St(Aj)},providedIn:"root"})}return n})(),Aj=(()=>{class n{shouldProcessUrl(t){return!0}extract(t){return t}merge(t,i){return t}static#e=this.\u0275fac=function(i){return new(i||n)};static#t=this.\u0275prov=Zt({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var Uv=function(n){return n[n.COMPLETE=0]="COMPLETE",n[n.FAILED=1]="FAILED",n[n.REDIRECTING=2]="REDIRECTING",n}(Uv||{});function bO(n,e){n.events.pipe(Du(t=>t instanceof Iu||t instanceof Rv||t instanceof X0||t instanceof kp),hi(t=>t instanceof Iu||t instanceof kp?Uv.COMPLETE:t instanceof Rv&&(0===t.code||1===t.code)?Uv.REDIRECTING:Uv.FAILED),Du(t=>t!==Uv.REDIRECTING),Fp(1)).subscribe(()=>{e()})}function Dj(n){throw n}function Rj(n,e,t){return e.parse("/")}const Ij={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},Pj={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let sa=(()=>{class n{get navigationId(){return this.navigationTransitions.navigationId}get browserPageId(){return"computed"!==this.canceledNavigationResolution?this.currentPageId:this.location.getState()?.\u0275routerPageId??this.currentPageId}get events(){return this._events}constructor(){this.disposed=!1,this.currentPageId=0,this.console=St(YI),this.isNgZoneEnabled=!1,this._events=new Os,this.options=St(tx,{optional:!0})||{},this.pendingTasks=St(ZI),this.errorHandler=this.options.errorHandler||Dj,this.malformedUriErrorHandler=this.options.malformedUriErrorHandler||Rj,this.navigated=!1,this.lastSuccessfulId=-1,this.urlHandlingStrategy=St(Cj),this.routeReuseStrategy=St(Ej),this.titleStrategy=St(wO),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.config=St(Wp,{optional:!0})?.flat()??[],this.navigationTransitions=St(ex),this.urlSerializer=St(Sv),this.location=St(NE),this.componentInputBindingEnabled=!!St(Y0,{optional:!0}),this.eventsSubscription=new er,this.isNgZoneEnabled=St(Bi)instanceof Bi&&Bi.isInAngularZone(),this.resetConfig(this.config),this.currentUrlTree=new Bp,this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.routerState=tO(0,null),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe(t=>{this.lastSuccessfulId=t.id,this.currentPageId=this.browserPageId},t=>{this.console.warn(`Unhandled Navigation Error: ${t}`)}),this.subscribeToNavigationEvents()}subscribeToNavigationEvents(){const t=this.navigationTransitions.events.subscribe(i=>{try{const{currentTransition:r}=this.navigationTransitions;if(null===r)return void(EO(i)&&this._events.next(i));if(i instanceof $0)MO(r.source)&&(this.browserUrlTree=r.extractedUrl);else if(i instanceof kp)this.rawUrlTree=r.rawUrl;else if(i instanceof JN){if("eager"===this.urlUpdateStrategy){if(!r.extras.skipLocationChange){const o=this.urlHandlingStrategy.merge(r.urlAfterRedirects,r.rawUrl);this.setBrowserUrl(o,r)}this.browserUrlTree=r.urlAfterRedirects}}else if(i instanceof OS)this.currentUrlTree=r.urlAfterRedirects,this.rawUrlTree=this.urlHandlingStrategy.merge(r.urlAfterRedirects,r.rawUrl),this.routerState=r.targetRouterState,"deferred"===this.urlUpdateStrategy&&(r.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,r),this.browserUrlTree=r.urlAfterRedirects);else if(i instanceof Rv)0!==i.code&&1!==i.code&&(this.navigated=!0),(3===i.code||2===i.code)&&this.restoreHistory(r);else if(i instanceof FS){const o=this.urlHandlingStrategy.merge(i.url,r.currentRawUrl),a={skipLocationChange:r.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||MO(r.source)};this.scheduleNavigation(o,Dv,null,a,{resolve:r.resolve,reject:r.reject,promise:r.promise})}i instanceof X0&&this.restoreHistory(r,!0),i instanceof Iu&&(this.navigated=!0),EO(i)&&this._events.next(i)}catch(r){this.navigationTransitions.transitionAbortSubject.next(r)}});this.eventsSubscription.add(t)}resetRootComponentType(t){this.routerState.root.component=t,this.navigationTransitions.rootComponentType=t}initialNavigation(){if(this.setUpLocationChangeListener(),!this.navigationTransitions.hasRequestedNavigation){const t=this.location.getState();this.navigateToSyncWithBrowser(this.location.path(!0),Dv,t)}}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(t=>{const i="popstate"===t.type?"popstate":"hashchange";"popstate"===i&&setTimeout(()=>{this.navigateToSyncWithBrowser(t.url,i,t.state)},0)}))}navigateToSyncWithBrowser(t,i,r){const o={replaceUrl:!0},a=r?.navigationId?r:null;if(r){const h={...r};delete h.navigationId,delete h.\u0275routerPageId,0!==Object.keys(h).length&&(o.state=h)}const u=this.parseUrl(t);this.scheduleNavigation(u,i,a,o)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(t){this.config=t.map(WS),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(t,i={}){const{relativeTo:r,queryParams:o,fragment:a,queryParamsHandling:u,preserveFragment:h}=i,f=h?this.currentUrlTree.fragment:a;let _,g=null;switch(u){case"merge":g={...this.currentUrlTree.queryParams,...o};break;case"preserve":g=this.currentUrlTree.queryParams;break;default:g=o||null}null!==g&&(g=this.removeEmptyProps(g));try{_=WN(r?r.snapshot:this.routerState.snapshot.root)}catch{("string"!=typeof t[0]||!t[0].startsWith("/"))&&(t=[]),_=this.currentUrlTree.root}return jN(_,t,g,f??null)}navigateByUrl(t,i={skipLocationChange:!1}){const r=_d(t)?t:this.parseUrl(t),o=this.urlHandlingStrategy.merge(r,this.rawUrlTree);return this.scheduleNavigation(o,Dv,null,i)}navigate(t,i={skipLocationChange:!1}){return function Lj(n){for(let e=0;e<n.length;e++)if(null==n[e])throw new z(4008,!1)}(t),this.navigateByUrl(this.createUrlTree(t,i),i)}serializeUrl(t){return this.urlSerializer.serialize(t)}parseUrl(t){let i;try{i=this.urlSerializer.parse(t)}catch(r){i=this.malformedUriErrorHandler(r,this.urlSerializer,t)}return i}isActive(t,i){let r;if(r=!0===i?{...Ij}:!1===i?{...Pj}:i,_d(t))return ON(this.currentUrlTree,t,r);const o=this.parseUrl(t);return ON(this.currentUrlTree,o,r)}removeEmptyProps(t){return Object.keys(t).reduce((i,r)=>{const o=t[r];return null!=o&&(i[r]=o),i},{})}scheduleNavigation(t,i,r,o,a){if(this.disposed)return Promise.resolve(!1);let u,h,f;a?(u=a.resolve,h=a.reject,f=a.promise):f=new Promise((_,x)=>{u=_,h=x});const g=this.pendingTasks.add();return bO(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(g))}),this.navigationTransitions.handleNavigationRequest({source:i,restoredState:r,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,currentBrowserUrl:this.browserUrlTree,rawUrl:t,extras:o,resolve:u,reject:h,promise:f,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),f.catch(_=>Promise.reject(_))}setBrowserUrl(t,i){const r=this.urlSerializer.serialize(t);if(this.location.isCurrentPathEqualTo(r)||i.extras.replaceUrl){const a={...i.extras.state,...this.generateNgRouterState(i.id,this.browserPageId)};this.location.replaceState(r,"",a)}else{const o={...i.extras.state,...this.generateNgRouterState(i.id,this.browserPageId+1)};this.location.go(r,"",o)}}restoreHistory(t,i=!1){if("computed"===this.canceledNavigationResolution){const o=this.currentPageId-this.browserPageId;0!==o?this.location.historyGo(o):this.currentUrlTree===this.getCurrentNavigation()?.finalUrl&&0===o&&(this.resetState(t),this.browserUrlTree=t.currentUrlTree,this.resetUrlToCurrentUrlTree())}else"replace"===this.canceledNavigationResolution&&(i&&this.resetState(t),this.resetUrlToCurrentUrlTree())}resetState(t){this.routerState=t.currentRouterState,this.currentUrlTree=t.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,t.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(t,i){return"computed"===this.canceledNavigationResolution?{navigationId:t,\u0275routerPageId:i}:{navigationId:t}}static#e=this.\u0275fac=function(i){return new(i||n)};static#t=this.\u0275prov=Zt({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function EO(n){return!(n instanceof OS||n instanceof FS)}let Bv=(()=>{class n{constructor(t,i,r,o,a,u){this.router=t,this.route=i,this.tabIndexAttribute=r,this.renderer=o,this.el=a,this.locationStrategy=u,this.href=null,this.commands=null,this.onChanges=new Os,this.preserveFragment=!1,this.skipLocationChange=!1,this.replaceUrl=!1;const h=a.nativeElement.tagName?.toLowerCase();this.isAnchorElement="a"===h||"area"===h,this.isAnchorElement?this.subscription=t.events.subscribe(f=>{f instanceof Iu&&this.updateHref()}):this.setTabIndexIfNotOnNativeEl("0")}setTabIndexIfNotOnNativeEl(t){null!=this.tabIndexAttribute||this.isAnchorElement||this.applyAttributeValue("tabindex",t)}ngOnChanges(t){this.isAnchorElement&&this.updateHref(),this.onChanges.next(this)}set routerLink(t){null!=t?(this.commands=Array.isArray(t)?t:[t],this.setTabIndexIfNotOnNativeEl("0")):(this.commands=null,this.setTabIndexIfNotOnNativeEl(null))}onClick(t,i,r,o,a){return!!(null===this.urlTree||this.isAnchorElement&&(0!==t||i||r||o||a||"string"==typeof this.target&&"_self"!=this.target))||(this.router.navigateByUrl(this.urlTree,{skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state}),!this.isAnchorElement)}ngOnDestroy(){this.subscription?.unsubscribe()}updateHref(){this.href=null!==this.urlTree&&this.locationStrategy?this.locationStrategy?.prepareExternalUrl(this.router.serializeUrl(this.urlTree)):null;const t=null===this.href?null:function n1(n,e,t){return function n3(n,e){return"src"===e&&("embed"===n||"frame"===n||"iframe"===n||"media"===n||"script"===n)||"href"===e&&("base"===n||"link"===n)?t1:qw}(e,t)(n)}(this.href,this.el.nativeElement.tagName.toLowerCase(),"href");this.applyAttributeValue("href",t)}applyAttributeValue(t,i){const r=this.renderer,o=this.el.nativeElement;null!==i?r.setAttribute(o,t,i):r.removeAttribute(o,t)}get urlTree(){return null===this.commands?null:this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}static#e=this.\u0275fac=function(i){return new(i||n)($e(sa),$e(xd),function Ea(n){return function Gl(n,e){if("class"===e)return n.classes;if("style"===e)return n.styles;const t=n.attrs;if(t){const i=t.length;let r=0;for(;r<i;){const o=t[r];if(Wy(o))break;if(0===o)r+=2;else if("number"==typeof o)for(r++;r<i&&"string"==typeof t[r];)r++;else{if(o===e)return t[r+1];r+=2}}}return null}(Si(),n)}("tabindex"),$e(ec),$e(Ao),$e(fd))};static#t=this.\u0275dir=an({type:n,selectors:[["","routerLink",""]],hostVars:1,hostBindings:function(i,r){1&i&&ta("click",function(a){return r.onClick(a.button,a.ctrlKey,a.shiftKey,a.altKey,a.metaKey)}),2&i&&hl("target",r.target)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",relativeTo:"relativeTo",preserveFragment:["preserveFragment","preserveFragment",Pp],skipLocationChange:["skipLocationChange","skipLocationChange",Pp],replaceUrl:["replaceUrl","replaceUrl",Pp],routerLink:"routerLink"},standalone:!0,features:[gD,hs]})}return n})(),YS=(()=>{class n{get isActive(){return this._isActive}constructor(t,i,r,o,a){this.router=t,this.element=i,this.renderer=r,this.cdr=o,this.link=a,this.classes=[],this._isActive=!1,this.routerLinkActiveOptions={exact:!1},this.isActiveChange=new gr,this.routerEventsSubscription=t.events.subscribe(u=>{u instanceof Iu&&this.update()})}ngAfterContentInit(){on(this.links.changes,on(null)).pipe(ja()).subscribe(t=>{this.update(),this.subscribeToEachLinkOnChanges()})}subscribeToEachLinkOnChanges(){this.linkInputChangesSubscription?.unsubscribe();const t=[...this.links.toArray(),this.link].filter(i=>!!i).map(i=>i.onChanges);this.linkInputChangesSubscription=wr(t).pipe(ja()).subscribe(i=>{this._isActive!==this.isLinkActive(this.router)(i)&&this.update()})}set routerLinkActive(t){const i=Array.isArray(t)?t:t.split(" ");this.classes=i.filter(r=>!!r)}ngOnChanges(t){this.update()}ngOnDestroy(){this.routerEventsSubscription.unsubscribe(),this.linkInputChangesSubscription?.unsubscribe()}update(){!this.links||!this.router.navigated||queueMicrotask(()=>{const t=this.hasActiveLinks();this._isActive!==t&&(this._isActive=t,this.cdr.markForCheck(),this.classes.forEach(i=>{t?this.renderer.addClass(this.element.nativeElement,i):this.renderer.removeClass(this.element.nativeElement,i)}),t&&void 0!==this.ariaCurrentWhenActive?this.renderer.setAttribute(this.element.nativeElement,"aria-current",this.ariaCurrentWhenActive.toString()):this.renderer.removeAttribute(this.element.nativeElement,"aria-current"),this.isActiveChange.emit(t))})}isLinkActive(t){const i=function Nj(n){return!!n.paths}(this.routerLinkActiveOptions)?this.routerLinkActiveOptions:this.routerLinkActiveOptions.exact||!1;return r=>!!r.urlTree&&t.isActive(r.urlTree,i)}hasActiveLinks(){const t=this.isLinkActive(this.router);return this.link&&t(this.link)||this.links.some(t)}static#e=this.\u0275fac=function(i){return new(i||n)($e(sa),$e(Ao),$e(ec),$e(u0),$e(Bv,8))};static#t=this.\u0275dir=an({type:n,selectors:[["","routerLinkActive",""]],contentQueries:function(i,r,o){if(1&i&&AI(o,Bv,5),2&i){let a;CI(a=function DI(){return function mH(n,e){return n[Tt].queries[e].queryList}(Re(),il())}())&&(r.links=a)}},inputs:{routerLinkActiveOptions:"routerLinkActiveOptions",ariaCurrentWhenActive:"ariaCurrentWhenActive",routerLinkActive:"routerLinkActive"},outputs:{isActiveChange:"isActiveChange"},exportAs:["routerLinkActive"],standalone:!0,features:[hs]})}return n})();class SO{}let Oj=(()=>{class n{constructor(t,i,r,o,a){this.router=t,this.injector=r,this.preloadingStrategy=o,this.loader=a}setUpPreloading(){this.subscription=this.router.events.pipe(Du(t=>t instanceof Iu),wv(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(t,i){const r=[];for(const o of i){o.providers&&!o._injector&&(o._injector=tE(o.providers,t,`Route: ${o.path}`));const a=o._injector??t,u=o._loadedInjector??a;(o.loadChildren&&!o._loadedRoutes&&void 0===o.canLoad||o.loadComponent&&!o._loadedComponent)&&r.push(this.preloadConfig(a,o)),(o.children||o._loadedRoutes)&&r.push(this.processRoutes(u,o.children??o._loadedRoutes))}return wr(r).pipe(ja())}preloadConfig(t,i){return this.preloadingStrategy.preload(i,()=>{let r;r=i.loadChildren&&void 0===i.canLoad?this.loader.loadChildren(t,i):on(null);const o=r.pipe(Mr(a=>null===a?on(void 0):(i._loadedRoutes=a.routes,i._loadedInjector=a.injector,this.processRoutes(a.injector??t,a.routes))));return i.loadComponent&&!i._loadedComponent?wr([o,this.loader.loadComponent(i)]).pipe(ja()):o})}static#e=this.\u0275fac=function(i){return new(i||n)(Kt(sa),Kt(JI),Kt(Qo),Kt(SO),Kt(qS))};static#t=this.\u0275prov=Zt({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();const ZS=new Ot("");let TO=(()=>{class n{constructor(t,i,r,o,a={}){this.urlSerializer=t,this.transitions=i,this.viewportScroller=r,this.zone=o,this.options=a,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},a.scrollPositionRestoration=a.scrollPositionRestoration||"disabled",a.anchorScrolling=a.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(t=>{t instanceof $0?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=t.navigationTrigger,this.restoredId=t.restoredState?t.restoredState.navigationId:0):t instanceof Iu?(this.lastId=t.id,this.scheduleScrollEvent(t,this.urlSerializer.parse(t.urlAfterRedirects).fragment)):t instanceof kp&&0===t.code&&(this.lastSource=void 0,this.restoredId=0,this.scheduleScrollEvent(t,this.urlSerializer.parse(t.url).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(t=>{t instanceof KN&&(t.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(t.position):t.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(t.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(t,i){this.zone.runOutsideAngular(()=>{setTimeout(()=>{this.zone.run(()=>{this.transitions.events.next(new KN(t,"popstate"===this.lastSource?this.store[this.restoredId]:null,i))})},0)})}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}static#e=this.\u0275fac=function(i){!function G1(){throw new Error("invalid")}()};static#t=this.\u0275prov=Zt({token:n,factory:n.\u0275fac})}return n})();function uc(n,e){return{\u0275kind:n,\u0275providers:e}}function AO(){const n=St(Do);return e=>{const t=n.get(Ip);if(e!==t.components[0])return;const i=n.get(sa),r=n.get(DO);1===n.get(JS)&&i.initialNavigation(),n.get(RO,null,In.Optional)?.setUpPreloading(),n.get(ZS,null,In.Optional)?.init(),i.resetRootComponentType(t.componentTypes[0]),r.closed||(r.next(),r.complete(),r.unsubscribe())}}const DO=new Ot("",{factory:()=>new Os}),JS=new Ot("",{providedIn:"root",factory:()=>1}),RO=new Ot("");function kj(n){return uc(0,[{provide:RO,useExisting:Oj},{provide:SO,useExisting:n}])}const IO=new Ot("ROUTER_FORROOT_GUARD"),zj=[NE,{provide:Sv,useClass:RS},sa,Iv,{provide:xd,useFactory:function CO(n){return n.routerState.root},deps:[sa]},qS,[]];function Hj(){return new rP("Router",sa)}let PO=(()=>{class n{constructor(t){}static forRoot(t,i){return{ngModule:n,providers:[zj,[],{provide:Wp,multi:!0,useValue:t},{provide:IO,useFactory:$j,deps:[[sa,new Kf,new Qf]]},{provide:tx,useValue:i||{}},i?.useHash?{provide:fd,useClass:JG}:{provide:fd,useClass:NP},{provide:ZS,useFactory:()=>{const n=St(v5),e=St(Bi),t=St(tx),i=St(ex),r=St(Sv);return t.scrollOffset&&n.setOffset(t.scrollOffset),new TO(r,i,n,e,t)}},i?.preloadingStrategy?kj(i.preloadingStrategy).\u0275providers:[],{provide:rP,multi:!0,useFactory:Hj},i?.initialNavigation?Xj(i):[],i?.bindToComponentInputs?uc(8,[sO,{provide:Y0,useExisting:sO}]).\u0275providers:[],[{provide:LO,useFactory:AO},{provide:EE,multi:!0,useExisting:LO}]]}}static forChild(t){return{ngModule:n,providers:[{provide:Wp,multi:!0,useValue:t}]}}static#e=this.\u0275fac=function(i){return new(i||n)(Kt(IO,8))};static#t=this.\u0275mod=Wo({type:n});static#n=this.\u0275inj=_o({})}return n})();function $j(n){return"guarded"}function Xj(n){return["disabled"===n.initialNavigation?uc(3,[{provide:gE,multi:!0,useFactory:()=>{const e=St(sa);return()=>{e.setUpLocationChangeListener()}}},{provide:JS,useValue:2}]).\u0275providers:[],"enabledBlocking"===n.initialNavigation?uc(2,[{provide:JS,useValue:0},{provide:gE,multi:!0,deps:[Do],useFactory:e=>{const t=e.get(YG,Promise.resolve());return()=>t.then(()=>new Promise(i=>{const r=e.get(sa),o=e.get(DO);bO(r,()=>{i(!0)}),e.get(ex).afterPreactivation=()=>(i(!0),o.closed?on(void 0):o),r.initialNavigation()}))}}]).\u0275providers:[]]}const LO=new Ot("");let Yj=(()=>{class n{static#e=this.\u0275fac=function(i){return new(i||n)};static#t=this.\u0275cmp=Al({type:n,selectors:[["app-navigation"]],decls:8,vars:0,consts:[[1,"header"],[1,"title"],[1,"nav"],["routerLink","/planets","routerLinkActive","active"],["routerLink","/system-solar","routerLinkActive","active"]],template:function(i,r){1&i&&(Da(0,"section",0)(1,"h1",1),cd(2,"Solar System"),Ra(),Da(3,"nav",2)(4,"a",3),cd(5,"Planets"),Ra(),Da(6,"a",4),cd(7,"Solar System"),Ra()()())},dependencies:[Bv,YS],styles:[".header[_ngcontent-%COMP%]{width:100%;position:fixed;height:auto;background-color:transparent;padding:1em;display:inline-flex;justify-content:space-between;align-items:center;font-family:system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;z-index:2000;-webkit-backdrop-filter:blur(5px);backdrop-filter:blur(5px)}.nav[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:none;padding:.4em;font-size:.9em;color:#fff}"]})}return n})(),Zj=(()=>{class n{constructor(){this.title="solar-system-appv6"}static#e=this.\u0275fac=function(i){return new(i||n)};static#t=this.\u0275cmp=Al({type:n,selectors:[["app-root"]],decls:2,vars:0,template:function(i,r){1&i&&ad(0,"app-navigation")(1,"router-outlet")},dependencies:[HS,Yj]})}return n})(),KS=(()=>{class n{constructor(){this.planets=[{name:"Mercurio",history:"Conocido desde la antig\xfcedad, Mercurio es el planeta m\xe1s cercano al Sol y el m\xe1s peque\xf1o del sistema solar.",orbitDistanceAU:.39,orbitalPeriodDays:88,imageUrl:"https://i.ibb.co/h1ZNh4c/Mercurio.webp"},{name:"Venus",history:"Nombrado por la diosa romana del amor y la belleza, Venus es el planeta m\xe1s caliente debido a su atm\xf3sfera densa.",orbitDistanceAU:.72,orbitalPeriodDays:225,imageUrl:"assets/Venus.png"},{name:"Tierra",history:"Nuestro hogar, la Tierra es el \xfanico planeta conocido que alberga vida.",orbitDistanceAU:1,orbitalPeriodDays:365.25,imageUrl:"https://i.ibb.co/5rpYZbF/earth-PNG15.png"},{name:"Marte",history:'Conocido como el "Planeta Rojo" debido a su color oxidado, Marte ha sido objeto de exploraci\xf3n en busca de vida.',orbitDistanceAU:1.52,orbitalPeriodDays:687,imageUrl:"https://i.ibb.co/gb2c2tR/Marte.png"},{name:"J\xfapiter",history:"Nombrado por el rey de los dioses romanos, J\xfapiter es el planeta m\xe1s grande del sistema solar.",orbitDistanceAU:5.2,orbitalPeriodDays:4331,imageUrl:"https://i.ibb.co/d4CMcFN/J-piter.webp"},{name:"Saturno",history:"Conocido por sus impresionantes anillos, Saturno es el segundo planeta m\xe1s grande y es visible a simple vista.",orbitDistanceAU:9.58,orbitalPeriodDays:10759,imageUrl:"https://i.ibb.co/mvrfqwV/Saturno.png"},{name:"Urano",history:"Descubierto en 1781 por William Herschel, Urano es notable por su inclinaci\xf3n extrema, casi en su lado.",orbitDistanceAU:19.22,orbitalPeriodDays:30688,imageUrl:"https://i.ibb.co/2hfYbkC/Urano.png"},{name:"Neptuno",history:"Descubierto en 1846, Neptuno es conocido por sus fuertes vientos y tormentas violentas.",orbitDistanceAU:30.05,orbitalPeriodDays:60190,imageUrl:"https://i.ibb.co/LNSPnPn/Neptuno.png"}]}GetPlanets(){return this.planets?this.planets:[]}getPlanetByName(t){return this.planets.find(i=>i.name.toLocaleLowerCase().trim()===t.toLocaleLowerCase().trim())||this.planets[2]}static#e=this.\u0275fac=function(i){return new(i||n)};static#t=this.\u0275prov=Zt({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();const NO=function(n){return{name:n}};let Jj=(()=>{class n{static#e=this.\u0275fac=function(i){return new(i||n)};static#t=this.\u0275cmp=Al({type:n,selectors:[["app-cart-planet"]],inputs:{planet:"planet"},decls:12,vars:9,consts:[[1,"container"],["routerLink","/system-solar","routerLinkActive","active",3,"queryParams"],[1,"card"],[1,"imgBx"],["loading","lazy","alt","nike-air-shoe",3,"src"],[1,"contentBx"]],template:function(i,r){1&i&&(Da(0,"div",0)(1,"a",1)(2,"div",2)(3,"div",3),ad(4,"img",4),Ra(),Da(5,"div",5)(6,"h2"),cd(7),Ra(),Da(8,"span"),cd(9),Ra(),Da(10,"a",1),cd(11,"Ver sistema solar"),Ra()()()()()),2&i&&(sd(1),Sp("queryParams",iE(5,NO,r.planet.name)),sd(3),Vb("src",r.planet.imageUrl,qw),sd(3),K_(r.planet.name),sd(2),K_(r.planet.history),sd(1),Sp("queryParams",iE(7,NO,r.planet.name)))},dependencies:[Bv,YS],styles:['*[_ngcontent-%COMP%]{padding:0;margin:0;font-family:Poppins,sans-serif}.container[_ngcontent-%COMP%]{position:relative}.container[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]{position:relative;width:250px;height:300px;background-image:url(https://i.ibb.co/dmQp5C5/bg.jpg);background-position:center;background-size:cover;border-radius:20px;overflow:hidden;cursor:pointer}.container[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]:before{content:"";position:absolute;top:-40px;left:-20;width:100%;height:100%;background:#1bc0e956;clip-path:circle(75px at 80% 20%);transition:.5s ease-in-out}.container[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]:hover:before{clip-path:circle(240px at 80% -20%)}.container[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]:after{content:"Espacio";position:absolute;top:30%;left:-20%;font-size:6em;font-weight:800;font-style:italic;color:#ffffff18;transform:rotate(10deg);transition:all ease-in-out .5s}.container[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]:hover:after{transform:rotate(50deg)}.container[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .imgBx[_ngcontent-%COMP%]{position:absolute;top:50%;transform:translateY(-60%);z-index:1000;width:100%;height:100%;transition:.5s}.container[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]:hover   .imgBx[_ngcontent-%COMP%]{top:0%;transform:translateY(-30%)}.container[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .imgBx[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%) rotate(20deg);width:150px}.container[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .contentBx[_ngcontent-%COMP%]{position:absolute;bottom:0;width:100%;height:78px;text-align:center;transition:1s;z-index:90;padding-top:3em}.container[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]:hover   .contentBx[_ngcontent-%COMP%]{height:200px}.container[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .contentBx[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{position:relative;font-weight:600;letter-spacing:1px;color:#fff}.container[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .contentBx[_ngcontent-%COMP%]   .size[_ngcontent-%COMP%], .container[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .contentBx[_ngcontent-%COMP%]   .color[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;padding:8px 20px;transition:.5s;opacity:0;visibility:hidden}.container[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]:hover   .contentBx[_ngcontent-%COMP%]   .size[_ngcontent-%COMP%]{opacity:1;visibility:visible;transition-delay:.5s}.container[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]:hover   .contentBx[_ngcontent-%COMP%]   .color[_ngcontent-%COMP%]{opacity:1;visibility:visible;transition-delay:.6s}.container[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .contentBx[_ngcontent-%COMP%]   .size[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%], .container[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .contentBx[_ngcontent-%COMP%]   .color[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:#fff;font-weight:300;font-size:14px;text-transform:uppercase;letter-spacing:2px;margin-right:10px}.container[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .contentBx[_ngcontent-%COMP%]   .size[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{width:26px;height:26px;text-align:center;line-height:26px;font-size:14px;display:inline-block;background:#fff;margin:0 5px;transition:.5s;color:#111;border-radius:4px;cursor:pointer}.container[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .contentBx[_ngcontent-%COMP%]   .size[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:hover{background:#b90000}.container[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .contentBx[_ngcontent-%COMP%]   .color[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{width:20px;height:20px;background:#ff0;border-radius:50%;margin:0 5px;cursor:pointer}.container[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .contentBx[_ngcontent-%COMP%]   .color[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(2){background:#1bbfe9}.container[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .contentBx[_ngcontent-%COMP%]   .color[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(3){background:#1b2fe9}.container[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .contentBx[_ngcontent-%COMP%]   .color[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(4){background:#080481}.container[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .contentBx[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{display:inline-block;padding:10px 20px;background:#fff;border-radius:4px;margin-top:10px;text-decoration:none;font-weight:600;color:#111;opacity:0;transform:translateY(50px);transition:.5s}.container[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]:hover   .contentBx[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{opacity:1;transform:translateY(0);transition-delay:.7s}a[_ngcontent-%COMP%]{color:#fff}']})}return n})();function Kj(n,e){1&n&&ad(0,"app-cart-planet",2),2&n&&Sp("planet",e.$implicit)}let Qj=(()=>{class n{constructor(t){this.planetsServiceService=t,this.Planets=[]}ngOnInit(){this.GetPlanets()}GetPlanets(){this.Planets=this.planetsServiceService.GetPlanets()}static#e=this.\u0275fac=function(i){return new(i||n)($e(KS))};static#t=this.\u0275cmp=Al({type:n,selectors:[["app-planets"]],decls:2,vars:1,consts:[[1,"planets-grid"],[3,"planet",4,"ngFor","ngForOf"],[3,"planet"]],template:function(i,r){1&i&&(Da(0,"section",0),function DD(n,e,t,i,r,o,a,u){const h=Re(),f=Pn(),g=n+Un,_=f.firstCreatePass?function mk(n,e,t,i,r,o,a,u,h){const f=e.consts,g=mp(e,n,4,a||null,Ui(f,u));Sb(e,t,g,Ui(f,h)),hu(e,g);const _=g.tView=Eb(2,g,i,r,o,e.directiveRegistry,e.pipeRegistry,null,e.schemas,f,null);return null!==e.queries&&(e.queries.template(e,g),_.queries=e.queries.embeddedTView(g)),g}(g,f,h,e,t,i,r,o,a):f.data[g];ns(_,!1);const x=RD(f,h,_,n);Yo()&&yt(f,h,x,_),Ln(x,h),V_(h,h[g]=K1(x,h,x,_)),Mf(_)&&wb(f,h,_),null!=a&&bb(h,_,u)}(1,Kj,1,1,"app-cart-planet",1),Ra()),2&i&&(sd(1),Sp("ngForOf",r.Planets))},dependencies:[$P,Jj],styles:[".planets-grid[_ngcontent-%COMP%]{width:100%;max-width:100vw;flex-wrap:wrap;padding:4em 1em 1em;display:flex;justify-content:center;align-items:center;gap:15px}"]})}return n})();function OO(n,e,t,i,r,o,a){try{var u=n[o](a),h=u.value}catch(f){return void t(f)}u.done?e(h):Promise.resolve(h).then(i,r)}function FO(n){return function(){var e=this,t=arguments;return new Promise(function(i,r){var o=n.apply(e,t);function a(h){OO(o,i,r,a,u,"next",h)}function u(h){OO(o,i,r,a,u,"throw",h)}a(void 0)})}}const BO=1,n$=2,hc=3,ix=0,A$=1,D$=2,Nu=0,R$=1,I$=2,P$=3,L$=4,N$=5,O$=6,F$=7,Ou=301,wd=302,kv=306,$p=1e3,Ua=1001,ms=1003,qr=1006,fc=1008,pc=1009,GO=1010,WO=1011,zv=1012,rT=1013,Fu=1014,Po=1015,Hv=1016,sT=1017,oT=1018,Xp=1020,jO=35902,$O=1021,XO=1022,mo=1023,qO=1024,YO=1025,qp=1026,Yp=1027,aT=1028,lx=1029,ZO=1030,lT=1031,cT=1033,cx=33776,ux=33777,hx=33778,dx=33779,uT=35840,hT=35841,dT=35842,fT=35843,pT=36196,mT=37492,gT=37496,vT=37808,yT=37809,_T=37810,xT=37811,MT=37812,wT=37813,bT=37814,ET=37815,ST=37816,TT=37817,CT=37818,AT=37819,DT=37820,RT=37821,fx=36492,IT=36494,PT=36495,JO=36283,LT=36284,NT=36285,OT=36286,Ba="srgb",Bu="srgb-linear",kT="display-p3",gx="display-p3-linear",vx="linear",ji="srgb",yx="rec709",_x="p3",Kp=7680,t2="300 es",mc=2e3;class Qp{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const i=this._listeners;void 0===i[e]&&(i[e]=[]),-1===i[e].indexOf(t)&&i[e].push(t)}hasEventListener(e,t){if(void 0===this._listeners)return!1;const i=this._listeners;return void 0!==i[e]&&-1!==i[e].indexOf(t)}removeEventListener(e,t){if(void 0===this._listeners)return;const r=this._listeners[e];if(void 0!==r){const o=r.indexOf(t);-1!==o&&r.splice(o,1)}}dispatchEvent(e){if(void 0===this._listeners)return;const i=this._listeners[e.type];if(void 0!==i){e.target=this;const r=i.slice(0);for(let o=0,a=r.length;o<a;o++)r[o].call(this,e);e.target=null}}}const Ps=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],Ed=Math.PI/180,em=180/Math.PI;function Lo(){const n=4294967295*Math.random()|0,e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(Ps[255&n]+Ps[n>>8&255]+Ps[n>>16&255]+Ps[n>>24&255]+"-"+Ps[255&e]+Ps[e>>8&255]+"-"+Ps[e>>16&15|64]+Ps[e>>24&255]+"-"+Ps[63&t|128]+Ps[t>>8&255]+"-"+Ps[t>>16&255]+Ps[t>>24&255]+Ps[255&i]+Ps[i>>8&255]+Ps[i>>16&255]+Ps[i>>24&255]).toLowerCase()}function yr(n,e,t){return Math.max(e,Math.min(t,n))}function Gv(n,e,t){return(1-t)*n+t*e}function eo(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return n/4294967295;case Uint16Array:return n/65535;case Uint8Array:return n/255;case Int32Array:return Math.max(n/2147483647,-1);case Int16Array:return Math.max(n/32767,-1);case Int8Array:return Math.max(n/127,-1);default:throw new Error("Invalid component type.")}}function An(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return Math.round(4294967295*n);case Uint16Array:return Math.round(65535*n);case Uint8Array:return Math.round(255*n);case Int32Array:return Math.round(2147483647*n);case Int16Array:return Math.round(32767*n);case Int8Array:return Math.round(127*n);default:throw new Error("Invalid component type.")}}class Ve{constructor(e=0,t=0){Ve.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,i=this.y,r=e.elements;return this.x=r[0]*t+r[3]*i+r[6],this.y=r[1]*t+r[4]*i+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(yr(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y;return t*t+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const i=Math.cos(t),r=Math.sin(t),o=this.x-e.x,a=this.y-e.y;return this.x=o*i-a*r+e.x,this.y=o*r+a*i+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Nn{constructor(e,t,i,r,o,a,u,h,f){Nn.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],void 0!==e&&this.set(e,t,i,r,o,a,u,h,f)}set(e,t,i,r,o,a,u,h,f){const g=this.elements;return g[0]=e,g[1]=r,g[2]=u,g[3]=t,g[4]=o,g[5]=h,g[6]=i,g[7]=a,g[8]=f,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this}extractBasis(e,t,i){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,r=t.elements,o=this.elements,a=i[0],u=i[3],h=i[6],f=i[1],g=i[4],_=i[7],x=i[2],M=i[5],E=i[8],D=r[0],C=r[3],S=r[6],I=r[1],N=r[4],O=r[7],ne=r[2],$=r[5],K=r[8];return o[0]=a*D+u*I+h*ne,o[3]=a*C+u*N+h*$,o[6]=a*S+u*O+h*K,o[1]=f*D+g*I+_*ne,o[4]=f*C+g*N+_*$,o[7]=f*S+g*O+_*K,o[2]=x*D+M*I+E*ne,o[5]=x*C+M*N+E*$,o[8]=x*S+M*O+E*K,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[1],r=e[2],o=e[3],a=e[4],u=e[5],h=e[6],f=e[7],g=e[8];return t*a*g-t*u*f-i*o*g+i*u*h+r*o*f-r*a*h}invert(){const e=this.elements,t=e[0],i=e[1],r=e[2],o=e[3],a=e[4],u=e[5],h=e[6],f=e[7],g=e[8],_=g*a-u*f,x=u*h-g*o,M=f*o-a*h,E=t*_+i*x+r*M;if(0===E)return this.set(0,0,0,0,0,0,0,0,0);const D=1/E;return e[0]=_*D,e[1]=(r*f-g*i)*D,e[2]=(u*i-r*a)*D,e[3]=x*D,e[4]=(g*t-r*h)*D,e[5]=(r*o-u*t)*D,e[6]=M*D,e[7]=(i*h-f*t)*D,e[8]=(a*t-i*o)*D,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,i,r,o,a,u){const h=Math.cos(o),f=Math.sin(o);return this.set(i*h,i*f,-i*(h*a+f*u)+a+e,-r*f,r*h,-r*(-f*a+h*u)+u+t,0,0,1),this}scale(e,t){return this.premultiply(zT.makeScale(e,t)),this}rotate(e){return this.premultiply(zT.makeRotation(-e)),this}translate(e,t){return this.premultiply(zT.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,i,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,i=e.elements;for(let r=0;r<9;r++)if(t[r]!==i[r])return!1;return!0}fromArray(e,t=0){for(let i=0;i<9;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}clone(){return(new this.constructor).fromArray(this.elements)}}const zT=new Nn;function i2(n){for(let e=n.length-1;e>=0;--e)if(n[e]>=65535)return!0;return!1}function Wv(n){return document.createElementNS("http://www.w3.org/1999/xhtml",n)}function pX(){const n=Wv("canvas");return n.style.display="block",n}Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array;const r2={};function HT(n){n in r2||(r2[n]=!0,console.warn(n))}const s2=(new Nn).set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),o2=(new Nn).set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),wx={[Bu]:{transfer:vx,primaries:yx,toReference:n=>n,fromReference:n=>n},[Ba]:{transfer:ji,primaries:yx,toReference:n=>n.convertSRGBToLinear(),fromReference:n=>n.convertLinearToSRGB()},[gx]:{transfer:vx,primaries:_x,toReference:n=>n.applyMatrix3(o2),fromReference:n=>n.applyMatrix3(s2)},[kT]:{transfer:ji,primaries:_x,toReference:n=>n.convertSRGBToLinear().applyMatrix3(o2),fromReference:n=>n.applyMatrix3(s2).convertLinearToSRGB()}},gX=new Set([Bu,gx]),mi={enabled:!0,_workingColorSpace:Bu,get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(n){if(!gX.has(n))throw new Error(`Unsupported working color space, "${n}".`);this._workingColorSpace=n},convert:function(n,e,t){return!1!==this.enabled&&e!==t&&e&&t?(0,wx[t].fromReference)((0,wx[e].toReference)(n)):n},fromWorkingColorSpace:function(n,e){return this.convert(n,this._workingColorSpace,e)},toWorkingColorSpace:function(n,e){return this.convert(n,e,this._workingColorSpace)},getPrimaries:function(n){return wx[n].primaries},getTransfer:function(n){return""===n?vx:wx[n].transfer}};function nm(n){return n<.04045?.0773993808*n:Math.pow(.9478672986*n+.0521327014,2.4)}function GT(n){return n<.0031308?12.92*n:1.055*Math.pow(n,.41666)-.055}let im;class vX{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===im&&(im=Wv("canvas")),im.width=e.width,im.height=e.height;const i=im.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),t=im}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=Wv("canvas");t.width=e.width,t.height=e.height;const i=t.getContext("2d");i.drawImage(e,0,0,e.width,e.height);const r=i.getImageData(0,0,e.width,e.height),o=r.data;for(let a=0;a<o.length;a++)o[a]=255*nm(o[a]/255);return i.putImageData(r,0,0),t}if(e.data){const t=e.data.slice(0);for(let i=0;i<t.length;i++)t[i]=t instanceof Uint8Array||t instanceof Uint8ClampedArray?Math.floor(255*nm(t[i]/255)):nm(t[i]);return{data:t,width:e.width,height:e.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let yX=0;class rm{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:yX++}),this.uuid=Lo(),this.data=e,this.dataReady=!0,this.version=0}set needsUpdate(e){!0===e&&this.version++}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.images[this.uuid])return e.images[this.uuid];const i={uuid:this.uuid,url:""},r=this.data;if(null!==r){let o;if(Array.isArray(r)){o=[];for(let a=0,u=r.length;a<u;a++)o.push(WT(r[a].isDataTexture?r[a].image:r[a]))}else o=WT(r);i.url=o}return t||(e.images[this.uuid]=i),i}}function WT(n){return typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&n instanceof ImageBitmap?vX.getDataURL(n):n.data?{data:Array.from(n.data),width:n.width,height:n.height,type:n.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let _X=0,gc=(()=>{class n extends Qp{constructor(t=n.DEFAULT_IMAGE,i=n.DEFAULT_MAPPING,r=Ua,o=Ua,a=qr,u=fc,h=mo,f=pc,g=n.DEFAULT_ANISOTROPY,_=""){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:_X++}),this.uuid=Lo(),this.name="",this.source=new rm(t),this.mipmaps=[],this.mapping=i,this.channel=0,this.wrapS=r,this.wrapT=o,this.magFilter=a,this.minFilter=u,this.anisotropy=g,this.format=h,this.internalFormat=null,this.type=f,this.offset=new Ve(0,0),this.repeat=new Ve(1,1),this.center=new Ve(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Nn,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=_,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(t=null){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.channel=t.channel,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.colorSpace=t.colorSpace,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}toJSON(t){const i=void 0===t||"string"==typeof t;if(!i&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];const r={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(r.userData=this.userData),i||(t.textures[this.uuid]=r),r}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(300!==this.mapping)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case $p:t.x=t.x-Math.floor(t.x);break;case Ua:t.x=t.x<0?0:1;break;case 1002:t.x=1===Math.abs(Math.floor(t.x)%2)?Math.ceil(t.x)-t.x:t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case $p:t.y=t.y-Math.floor(t.y);break;case Ua:t.y=t.y<0?0:1;break;case 1002:t.y=1===Math.abs(Math.floor(t.y)%2)?Math.ceil(t.y)-t.y:t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){!0===t&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(t){!0===t&&this.pmremVersion++}}return n.DEFAULT_IMAGE=null,n.DEFAULT_MAPPING=300,n.DEFAULT_ANISOTROPY=1,n})();class wi{constructor(e=0,t=0,i=0,r=1){wi.prototype.isVector4=!0,this.x=e,this.y=t,this.z=i,this.w=r}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,i,r){return this.x=e,this.y=t,this.z=i,this.w=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,i=this.y,r=this.z,o=this.w,a=e.elements;return this.x=a[0]*t+a[4]*i+a[8]*r+a[12]*o,this.y=a[1]*t+a[5]*i+a[9]*r+a[13]*o,this.z=a[2]*t+a[6]*i+a[10]*r+a[14]*o,this.w=a[3]*t+a[7]*i+a[11]*r+a[15]*o,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,i,r,o;const h=e.elements,f=h[0],g=h[4],_=h[8],x=h[1],M=h[5],E=h[9],D=h[2],C=h[6],S=h[10];if(Math.abs(g-x)<.01&&Math.abs(_-D)<.01&&Math.abs(E-C)<.01){if(Math.abs(g+x)<.1&&Math.abs(_+D)<.1&&Math.abs(E+C)<.1&&Math.abs(f+M+S-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const N=(f+1)/2,O=(M+1)/2,ne=(S+1)/2,$=(g+x)/4,K=(_+D)/4,oe=(E+C)/4;return N>O&&N>ne?N<.01?(i=0,r=.707106781,o=.707106781):(i=Math.sqrt(N),r=$/i,o=K/i):O>ne?O<.01?(i=.707106781,r=0,o=.707106781):(r=Math.sqrt(O),i=$/r,o=oe/r):ne<.01?(i=.707106781,r=.707106781,o=0):(o=Math.sqrt(ne),i=K/o,r=oe/o),this.set(i,r,o,t),this}let I=Math.sqrt((C-E)*(C-E)+(_-D)*(_-D)+(x-g)*(x-g));return Math.abs(I)<.001&&(I=1),this.x=(C-E)/I,this.y=(_-D)/I,this.z=(x-g)/I,this.w=Math.acos((f+M+S-1)/2),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this.w=t[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this.w=e.w+(t.w-e.w)*i,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class xX extends Qp{constructor(e=1,t=1,i={}){super(),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new wi(0,0,e,t),this.scissorTest=!1,this.viewport=new wi(0,0,e,t);const r={width:e,height:t,depth:1};i=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:qr,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1},i);const o=new gc(r,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.colorSpace);o.flipY=!1,o.generateMipmaps=i.generateMipmaps,o.internalFormat=i.internalFormat,this.textures=[];const a=i.count;for(let u=0;u<a;u++)this.textures[u]=o.clone(),this.textures[u].isRenderTargetTexture=!0;this.depthBuffer=i.depthBuffer,this.stencilBuffer=i.stencilBuffer,this.resolveDepthBuffer=i.resolveDepthBuffer,this.resolveStencilBuffer=i.resolveStencilBuffer,this.depthTexture=i.depthTexture,this.samples=i.samples}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}setSize(e,t,i=1){if(this.width!==e||this.height!==t||this.depth!==i){this.width=e,this.height=t,this.depth=i;for(let r=0,o=this.textures.length;r<o;r++)this.textures[r].image.width=e,this.textures[r].image.height=t,this.textures[r].image.depth=i;this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return(new this.constructor).copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let i=0,r=e.textures.length;i<r;i++)this.textures[i]=e.textures[i].clone(),this.textures[i].isRenderTargetTexture=!0;const t=Object.assign({},e.texture.image);return this.texture.source=new rm(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class Sd extends xX{constructor(e=1,t=1,i={}){super(e,t,i),this.isWebGLRenderTarget=!0}}class jT extends gc{constructor(e=null,t=1,i=1,r=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:i,depth:r},this.magFilter=ms,this.minFilter=ms,this.wrapR=Ua,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class a2 extends gc{constructor(e=null,t=1,i=1,r=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:i,depth:r},this.magFilter=ms,this.minFilter=ms,this.wrapR=Ua,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class No{constructor(e=0,t=0,i=0,r=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=i,this._w=r}static slerpFlat(e,t,i,r,o,a,u){let h=i[r+0],f=i[r+1],g=i[r+2],_=i[r+3];const x=o[a+0],M=o[a+1],E=o[a+2],D=o[a+3];if(0===u)return e[t+0]=h,e[t+1]=f,e[t+2]=g,void(e[t+3]=_);if(1===u)return e[t+0]=x,e[t+1]=M,e[t+2]=E,void(e[t+3]=D);if(_!==D||h!==x||f!==M||g!==E){let C=1-u;const S=h*x+f*M+g*E+_*D,I=S>=0?1:-1,N=1-S*S;if(N>Number.EPSILON){const ne=Math.sqrt(N),$=Math.atan2(ne,S*I);C=Math.sin(C*$)/ne,u=Math.sin(u*$)/ne}const O=u*I;if(h=h*C+x*O,f=f*C+M*O,g=g*C+E*O,_=_*C+D*O,C===1-u){const ne=1/Math.sqrt(h*h+f*f+g*g+_*_);h*=ne,f*=ne,g*=ne,_*=ne}}e[t]=h,e[t+1]=f,e[t+2]=g,e[t+3]=_}static multiplyQuaternionsFlat(e,t,i,r,o,a){const u=i[r],h=i[r+1],f=i[r+2],g=i[r+3],_=o[a],x=o[a+1],M=o[a+2],E=o[a+3];return e[t]=u*E+g*_+h*M-f*x,e[t+1]=h*E+g*x+f*_-u*M,e[t+2]=f*E+g*M+u*x-h*_,e[t+3]=g*E-u*_-h*x-f*M,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,i,r){return this._x=e,this._y=t,this._z=i,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const i=e._x,r=e._y,o=e._z,a=e._order,u=Math.cos,h=Math.sin,f=u(i/2),g=u(r/2),_=u(o/2),x=h(i/2),M=h(r/2),E=h(o/2);switch(a){case"XYZ":this._x=x*g*_+f*M*E,this._y=f*M*_-x*g*E,this._z=f*g*E+x*M*_,this._w=f*g*_-x*M*E;break;case"YXZ":this._x=x*g*_+f*M*E,this._y=f*M*_-x*g*E,this._z=f*g*E-x*M*_,this._w=f*g*_+x*M*E;break;case"ZXY":this._x=x*g*_-f*M*E,this._y=f*M*_+x*g*E,this._z=f*g*E+x*M*_,this._w=f*g*_-x*M*E;break;case"ZYX":this._x=x*g*_-f*M*E,this._y=f*M*_+x*g*E,this._z=f*g*E-x*M*_,this._w=f*g*_+x*M*E;break;case"YZX":this._x=x*g*_+f*M*E,this._y=f*M*_+x*g*E,this._z=f*g*E-x*M*_,this._w=f*g*_-x*M*E;break;case"XZY":this._x=x*g*_-f*M*E,this._y=f*M*_-x*g*E,this._z=f*g*E+x*M*_,this._w=f*g*_+x*M*E;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+a)}return!0===t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const i=t/2,r=Math.sin(i);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,i=t[0],r=t[4],o=t[8],a=t[1],u=t[5],h=t[9],f=t[2],g=t[6],_=t[10],x=i+u+_;if(x>0){const M=.5/Math.sqrt(x+1);this._w=.25/M,this._x=(g-h)*M,this._y=(o-f)*M,this._z=(a-r)*M}else if(i>u&&i>_){const M=2*Math.sqrt(1+i-u-_);this._w=(g-h)/M,this._x=.25*M,this._y=(r+a)/M,this._z=(o+f)/M}else if(u>_){const M=2*Math.sqrt(1+u-i-_);this._w=(o-f)/M,this._x=(r+a)/M,this._y=.25*M,this._z=(h+g)/M}else{const M=2*Math.sqrt(1+_-i-u);this._w=(a-r)/M,this._x=(o+f)/M,this._y=(h+g)/M,this._z=.25*M}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let i=e.dot(t)+1;return i<Number.EPSILON?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=i),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(yr(this.dot(e),-1,1)))}rotateTowards(e,t){const i=this.angleTo(e);if(0===i)return this;const r=Math.min(1,t/i);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const i=e._x,r=e._y,o=e._z,a=e._w,u=t._x,h=t._y,f=t._z,g=t._w;return this._x=i*g+a*u+r*f-o*h,this._y=r*g+a*h+o*u-i*f,this._z=o*g+a*f+i*h-r*u,this._w=a*g-i*u-r*h-o*f,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);const i=this._x,r=this._y,o=this._z,a=this._w;let u=a*e._w+i*e._x+r*e._y+o*e._z;if(u<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,u=-u):this.copy(e),u>=1)return this._w=a,this._x=i,this._y=r,this._z=o,this;const h=1-u*u;if(h<=Number.EPSILON){const M=1-t;return this._w=M*a+t*this._w,this._x=M*i+t*this._x,this._y=M*r+t*this._y,this._z=M*o+t*this._z,this.normalize(),this}const f=Math.sqrt(h),g=Math.atan2(f,u),_=Math.sin((1-t)*g)/f,x=Math.sin(t*g)/f;return this._w=a*_+this._w*x,this._x=i*_+this._x*x,this._y=r*_+this._y*x,this._z=o*_+this._z*x,this._onChangeCallback(),this}slerpQuaternions(e,t,i){return this.copy(e).slerp(t,i)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),i=Math.random(),r=Math.sqrt(1-i),o=Math.sqrt(i);return this.set(r*Math.sin(e),r*Math.cos(e),o*Math.sin(t),o*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class Q{constructor(e=0,t=0,i=0){Q.prototype.isVector3=!0,this.x=e,this.y=t,this.z=i}set(e,t,i){return void 0===i&&(i=this.z),this.x=e,this.y=t,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(l2.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(l2.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,i=this.y,r=this.z,o=e.elements;return this.x=o[0]*t+o[3]*i+o[6]*r,this.y=o[1]*t+o[4]*i+o[7]*r,this.z=o[2]*t+o[5]*i+o[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,i=this.y,r=this.z,o=e.elements,a=1/(o[3]*t+o[7]*i+o[11]*r+o[15]);return this.x=(o[0]*t+o[4]*i+o[8]*r+o[12])*a,this.y=(o[1]*t+o[5]*i+o[9]*r+o[13])*a,this.z=(o[2]*t+o[6]*i+o[10]*r+o[14])*a,this}applyQuaternion(e){const t=this.x,i=this.y,r=this.z,o=e.x,a=e.y,u=e.z,h=e.w,f=2*(a*r-u*i),g=2*(u*t-o*r),_=2*(o*i-a*t);return this.x=t+h*f+a*_-u*g,this.y=i+h*g+u*f-o*_,this.z=r+h*_+o*g-a*f,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,i=this.y,r=this.z,o=e.elements;return this.x=o[0]*t+o[4]*i+o[8]*r,this.y=o[1]*t+o[5]*i+o[9]*r,this.z=o[2]*t+o[6]*i+o[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const i=e.x,r=e.y,o=e.z,a=t.x,u=t.y,h=t.z;return this.x=r*h-o*u,this.y=o*a-i*h,this.z=i*u-r*a,this}projectOnVector(e){const t=e.lengthSq();if(0===t)return this.set(0,0,0);const i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return $T.copy(this).projectOnVector(e),this.sub($T)}reflect(e){return this.sub($T.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(yr(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y,r=this.z-e.z;return t*t+i*i+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,i){const r=Math.sin(t)*e;return this.x=r*Math.sin(i),this.y=Math.cos(t)*e,this.z=r*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=r,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=2*Math.random()-1,i=Math.sqrt(1-t*t);return this.x=i*Math.cos(e),this.y=t,this.z=i*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const $T=new Q,l2=new No;class go{constructor(e=new Q(1/0,1/0,1/0),t=new Q(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t+=3)this.expandByPoint(ka.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,i=e.count;t<i;t++)this.expandByPoint(ka.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const i=ka.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const i=e.geometry;if(void 0!==i){const o=i.getAttribute("position");if(!0===t&&void 0!==o&&!0!==e.isInstancedMesh)for(let a=0,u=o.count;a<u;a++)!0===e.isMesh?e.getVertexPosition(a,ka):ka.fromBufferAttribute(o,a),ka.applyMatrix4(e.matrixWorld),this.expandByPoint(ka);else void 0!==e.boundingBox?(null===e.boundingBox&&e.computeBoundingBox(),bx.copy(e.boundingBox)):(null===i.boundingBox&&i.computeBoundingBox(),bx.copy(i.boundingBox)),bx.applyMatrix4(e.matrixWorld),this.union(bx)}const r=e.children;for(let o=0,a=r.length;o<a;o++)this.expandByObject(r[o],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,ka),ka.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=-e.constant&&i>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(jv),Ex.subVectors(this.max,jv),sm.subVectors(e.a,jv),om.subVectors(e.b,jv),am.subVectors(e.c,jv),ku.subVectors(om,sm),Vu.subVectors(am,om),Td.subVectors(sm,am);let t=[0,-ku.z,ku.y,0,-Vu.z,Vu.y,0,-Td.z,Td.y,ku.z,0,-ku.x,Vu.z,0,-Vu.x,Td.z,0,-Td.x,-ku.y,ku.x,0,-Vu.y,Vu.x,0,-Td.y,Td.x,0];return!(!XT(t,sm,om,am,Ex)||(t=[1,0,0,0,1,0,0,0,1],!XT(t,sm,om,am,Ex)))&&(Sx.crossVectors(ku,Vu),t=[Sx.x,Sx.y,Sx.z],XT(t,sm,om,am,Ex))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,ka).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=.5*this.getSize(ka).length()),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(vc[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),vc[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),vc[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),vc[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),vc[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),vc[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),vc[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),vc[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(vc)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const vc=[new Q,new Q,new Q,new Q,new Q,new Q,new Q,new Q],ka=new Q,bx=new go,sm=new Q,om=new Q,am=new Q,ku=new Q,Vu=new Q,Td=new Q,jv=new Q,Ex=new Q,Sx=new Q,Cd=new Q;function XT(n,e,t,i,r){for(let o=0,a=n.length-3;o<=a;o+=3){Cd.fromArray(n,o);const u=r.x*Math.abs(Cd.x)+r.y*Math.abs(Cd.y)+r.z*Math.abs(Cd.z),h=e.dot(Cd),f=t.dot(Cd),g=i.dot(Cd);if(Math.max(-Math.max(h,f,g),Math.min(h,f,g))>u)return!1}return!0}const MX=new go,$v=new Q,qT=new Q;class to{constructor(e=new Q,t=-1){this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const i=this.center;void 0!==t?i.copy(t):MX.setFromPoints(e).getCenter(i);let r=0;for(let o=0,a=e.length;o<a;o++)r=Math.max(r,i.distanceToSquared(e[o]));return this.radius=Math.sqrt(r),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const i=this.center.distanceToSquared(e);return t.copy(e),i>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;$v.subVectors(e,this.center);const t=$v.lengthSq();if(t>this.radius*this.radius){const i=Math.sqrt(t),r=.5*(i-this.radius);this.center.addScaledVector($v,r/i),this.radius+=r}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(!0===this.center.equals(e.center)?this.radius=Math.max(this.radius,e.radius):(qT.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint($v.copy(e.center).add(qT)),this.expandByPoint($v.copy(e.center).sub(qT))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const yc=new Q,YT=new Q,Tx=new Q,zu=new Q,ZT=new Q,Cx=new Q,JT=new Q;class Xv{constructor(e=new Q,t=new Q(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,yc)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const i=t.dot(this.direction);return i<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,i)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=yc.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(yc.copy(this.origin).addScaledVector(this.direction,t),yc.distanceToSquared(e))}distanceSqToSegment(e,t,i,r){YT.copy(e).add(t).multiplyScalar(.5),Tx.copy(t).sub(e).normalize(),zu.copy(this.origin).sub(YT);const o=.5*e.distanceTo(t),a=-this.direction.dot(Tx),u=zu.dot(this.direction),h=-zu.dot(Tx),f=zu.lengthSq(),g=Math.abs(1-a*a);let _,x,M,E;if(g>0)if(_=a*h-u,x=a*u-h,E=o*g,_>=0)if(x>=-E)if(x<=E){const D=1/g;_*=D,x*=D,M=_*(_+a*x+2*u)+x*(a*_+x+2*h)+f}else x=o,_=Math.max(0,-(a*x+u)),M=-_*_+x*(x+2*h)+f;else x=-o,_=Math.max(0,-(a*x+u)),M=-_*_+x*(x+2*h)+f;else x<=-E?(_=Math.max(0,-(-a*o+u)),x=_>0?-o:Math.min(Math.max(-o,-h),o),M=-_*_+x*(x+2*h)+f):x<=E?(_=0,x=Math.min(Math.max(-o,-h),o),M=x*(x+2*h)+f):(_=Math.max(0,-(a*o+u)),x=_>0?o:Math.min(Math.max(-o,-h),o),M=-_*_+x*(x+2*h)+f);else x=a>0?-o:o,_=Math.max(0,-(a*x+u)),M=-_*_+x*(x+2*h)+f;return i&&i.copy(this.origin).addScaledVector(this.direction,_),r&&r.copy(YT).addScaledVector(Tx,x),M}intersectSphere(e,t){yc.subVectors(e.center,this.origin);const i=yc.dot(this.direction),r=yc.dot(yc)-i*i,o=e.radius*e.radius;if(r>o)return null;const a=Math.sqrt(o-r),u=i-a,h=i+a;return h<0?null:this.at(u<0?h:u,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;const i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null}intersectPlane(e,t){const i=this.distanceToPlane(e);return null===i?null:this.at(i,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let i,r,o,a,u,h;const f=1/this.direction.x,g=1/this.direction.y,_=1/this.direction.z,x=this.origin;return f>=0?(i=(e.min.x-x.x)*f,r=(e.max.x-x.x)*f):(i=(e.max.x-x.x)*f,r=(e.min.x-x.x)*f),g>=0?(o=(e.min.y-x.y)*g,a=(e.max.y-x.y)*g):(o=(e.max.y-x.y)*g,a=(e.min.y-x.y)*g),i>a||o>r||((o>i||isNaN(i))&&(i=o),(a<r||isNaN(r))&&(r=a),_>=0?(u=(e.min.z-x.z)*_,h=(e.max.z-x.z)*_):(u=(e.max.z-x.z)*_,h=(e.min.z-x.z)*_),i>h||u>r)||((u>i||i!=i)&&(i=u),(h<r||r!=r)&&(r=h),r<0)?null:this.at(i>=0?i:r,t)}intersectsBox(e){return null!==this.intersectBox(e,yc)}intersectTriangle(e,t,i,r,o){ZT.subVectors(t,e),Cx.subVectors(i,e),JT.crossVectors(ZT,Cx);let u,a=this.direction.dot(JT);if(a>0){if(r)return null;u=1}else{if(!(a<0))return null;u=-1,a=-a}zu.subVectors(this.origin,e);const h=u*this.direction.dot(Cx.crossVectors(zu,Cx));if(h<0)return null;const f=u*this.direction.dot(ZT.cross(zu));if(f<0||h+f>a)return null;const g=-u*zu.dot(JT);return g<0?null:this.at(g/a,o)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class cn{constructor(e,t,i,r,o,a,u,h,f,g,_,x,M,E,D,C){cn.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],void 0!==e&&this.set(e,t,i,r,o,a,u,h,f,g,_,x,M,E,D,C)}set(e,t,i,r,o,a,u,h,f,g,_,x,M,E,D,C){const S=this.elements;return S[0]=e,S[4]=t,S[8]=i,S[12]=r,S[1]=o,S[5]=a,S[9]=u,S[13]=h,S[2]=f,S[6]=g,S[10]=_,S[14]=x,S[3]=M,S[7]=E,S[11]=D,S[15]=C,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new cn).fromArray(this.elements)}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this}copyPosition(e){const t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,i=e.elements,r=1/lm.setFromMatrixColumn(e,0).length(),o=1/lm.setFromMatrixColumn(e,1).length(),a=1/lm.setFromMatrixColumn(e,2).length();return t[0]=i[0]*r,t[1]=i[1]*r,t[2]=i[2]*r,t[3]=0,t[4]=i[4]*o,t[5]=i[5]*o,t[6]=i[6]*o,t[7]=0,t[8]=i[8]*a,t[9]=i[9]*a,t[10]=i[10]*a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,i=e.x,r=e.y,o=e.z,a=Math.cos(i),u=Math.sin(i),h=Math.cos(r),f=Math.sin(r),g=Math.cos(o),_=Math.sin(o);if("XYZ"===e.order){const x=a*g,M=a*_,E=u*g,D=u*_;t[0]=h*g,t[4]=-h*_,t[8]=f,t[1]=M+E*f,t[5]=x-D*f,t[9]=-u*h,t[2]=D-x*f,t[6]=E+M*f,t[10]=a*h}else if("YXZ"===e.order){const x=h*g,M=h*_,E=f*g,D=f*_;t[0]=x+D*u,t[4]=E*u-M,t[8]=a*f,t[1]=a*_,t[5]=a*g,t[9]=-u,t[2]=M*u-E,t[6]=D+x*u,t[10]=a*h}else if("ZXY"===e.order){const x=h*g,M=h*_,E=f*g,D=f*_;t[0]=x-D*u,t[4]=-a*_,t[8]=E+M*u,t[1]=M+E*u,t[5]=a*g,t[9]=D-x*u,t[2]=-a*f,t[6]=u,t[10]=a*h}else if("ZYX"===e.order){const x=a*g,M=a*_,E=u*g,D=u*_;t[0]=h*g,t[4]=E*f-M,t[8]=x*f+D,t[1]=h*_,t[5]=D*f+x,t[9]=M*f-E,t[2]=-f,t[6]=u*h,t[10]=a*h}else if("YZX"===e.order){const x=a*h,M=a*f,E=u*h,D=u*f;t[0]=h*g,t[4]=D-x*_,t[8]=E*_+M,t[1]=_,t[5]=a*g,t[9]=-u*g,t[2]=-f*g,t[6]=M*_+E,t[10]=x-D*_}else if("XZY"===e.order){const x=a*h,M=a*f,E=u*h,D=u*f;t[0]=h*g,t[4]=-_,t[8]=f*g,t[1]=x*_+D,t[5]=a*g,t[9]=M*_-E,t[2]=E*_-M,t[6]=u*g,t[10]=D*_+x}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(wX,e,bX)}lookAt(e,t,i){const r=this.elements;return Oo.subVectors(e,t),0===Oo.lengthSq()&&(Oo.z=1),Oo.normalize(),Hu.crossVectors(i,Oo),0===Hu.lengthSq()&&(1===Math.abs(i.z)?Oo.x+=1e-4:Oo.z+=1e-4,Oo.normalize(),Hu.crossVectors(i,Oo)),Hu.normalize(),Ax.crossVectors(Oo,Hu),r[0]=Hu.x,r[4]=Ax.x,r[8]=Oo.x,r[1]=Hu.y,r[5]=Ax.y,r[9]=Oo.y,r[2]=Hu.z,r[6]=Ax.z,r[10]=Oo.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,r=t.elements,o=this.elements,a=i[0],u=i[4],h=i[8],f=i[12],g=i[1],_=i[5],x=i[9],M=i[13],E=i[2],D=i[6],C=i[10],S=i[14],I=i[3],N=i[7],O=i[11],ne=i[15],$=r[0],K=r[4],oe=r[8],j=r[12],G=r[1],ce=r[5],Se=r[9],xe=r[13],Ce=r[2],Be=r[6],Ae=r[10],Ke=r[14],De=r[3],bt=r[7],Ut=r[11],Rt=r[15];return o[0]=a*$+u*G+h*Ce+f*De,o[4]=a*K+u*ce+h*Be+f*bt,o[8]=a*oe+u*Se+h*Ae+f*Ut,o[12]=a*j+u*xe+h*Ke+f*Rt,o[1]=g*$+_*G+x*Ce+M*De,o[5]=g*K+_*ce+x*Be+M*bt,o[9]=g*oe+_*Se+x*Ae+M*Ut,o[13]=g*j+_*xe+x*Ke+M*Rt,o[2]=E*$+D*G+C*Ce+S*De,o[6]=E*K+D*ce+C*Be+S*bt,o[10]=E*oe+D*Se+C*Ae+S*Ut,o[14]=E*j+D*xe+C*Ke+S*Rt,o[3]=I*$+N*G+O*Ce+ne*De,o[7]=I*K+N*ce+O*Be+ne*bt,o[11]=I*oe+N*Se+O*Ae+ne*Ut,o[15]=I*j+N*xe+O*Ke+ne*Rt,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[4],r=e[8],o=e[12],a=e[1],u=e[5],h=e[9],f=e[13],g=e[2],_=e[6],x=e[10],M=e[14];return e[3]*(+o*h*_-r*f*_-o*u*x+i*f*x+r*u*M-i*h*M)+e[7]*(+t*h*M-t*f*x+o*a*x-r*a*M+r*f*g-o*h*g)+e[11]*(+t*f*_-t*u*M-o*a*_+i*a*M+o*u*g-i*f*g)+e[15]*(-r*u*g-t*h*_+t*u*x+r*a*_-i*a*x+i*h*g)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,i){const r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=i),this}invert(){const e=this.elements,t=e[0],i=e[1],r=e[2],o=e[3],a=e[4],u=e[5],h=e[6],f=e[7],g=e[8],_=e[9],x=e[10],M=e[11],E=e[12],D=e[13],C=e[14],S=e[15],I=_*C*f-D*x*f+D*h*M-u*C*M-_*h*S+u*x*S,N=E*x*f-g*C*f-E*h*M+a*C*M+g*h*S-a*x*S,O=g*D*f-E*_*f+E*u*M-a*D*M-g*u*S+a*_*S,ne=E*_*h-g*D*h-E*u*x+a*D*x+g*u*C-a*_*C,$=t*I+i*N+r*O+o*ne;if(0===$)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const K=1/$;return e[0]=I*K,e[1]=(D*x*o-_*C*o-D*r*M+i*C*M+_*r*S-i*x*S)*K,e[2]=(u*C*o-D*h*o+D*r*f-i*C*f-u*r*S+i*h*S)*K,e[3]=(_*h*o-u*x*o-_*r*f+i*x*f+u*r*M-i*h*M)*K,e[4]=N*K,e[5]=(g*C*o-E*x*o+E*r*M-t*C*M-g*r*S+t*x*S)*K,e[6]=(E*h*o-a*C*o-E*r*f+t*C*f+a*r*S-t*h*S)*K,e[7]=(a*x*o-g*h*o+g*r*f-t*x*f-a*r*M+t*h*M)*K,e[8]=O*K,e[9]=(E*_*o-g*D*o-E*i*M+t*D*M+g*i*S-t*_*S)*K,e[10]=(a*D*o-E*u*o+E*i*f-t*D*f-a*i*S+t*u*S)*K,e[11]=(g*u*o-a*_*o-g*i*f+t*_*f+a*i*M-t*u*M)*K,e[12]=ne*K,e[13]=(g*D*r-E*_*r+E*i*x-t*D*x-g*i*C+t*_*C)*K,e[14]=(E*u*r-a*D*r-E*i*h+t*D*h+a*i*C-t*u*C)*K,e[15]=(a*_*r-g*u*r+g*i*h-t*_*h-a*i*x+t*u*x)*K,this}scale(e){const t=this.elements,i=e.x,r=e.y,o=e.z;return t[0]*=i,t[4]*=r,t[8]*=o,t[1]*=i,t[5]*=r,t[9]*=o,t[2]*=i,t[6]*=r,t[10]*=o,t[3]*=i,t[7]*=r,t[11]*=o,this}getMaxScaleOnAxis(){const e=this.elements;return Math.sqrt(Math.max(e[0]*e[0]+e[1]*e[1]+e[2]*e[2],e[4]*e[4]+e[5]*e[5]+e[6]*e[6],e[8]*e[8]+e[9]*e[9]+e[10]*e[10]))}makeTranslation(e,t,i){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const i=Math.cos(t),r=Math.sin(t),o=1-i,a=e.x,u=e.y,h=e.z,f=o*a,g=o*u;return this.set(f*a+i,f*u-r*h,f*h+r*u,0,f*u+r*h,g*u+i,g*h-r*a,0,f*h-r*u,g*h+r*a,o*h*h+i,0,0,0,0,1),this}makeScale(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this}makeShear(e,t,i,r,o,a){return this.set(1,i,o,0,e,1,a,0,t,r,1,0,0,0,0,1),this}compose(e,t,i){const r=this.elements,o=t._x,a=t._y,u=t._z,h=t._w,f=o+o,g=a+a,_=u+u,x=o*f,M=o*g,E=o*_,D=a*g,C=a*_,S=u*_,I=h*f,N=h*g,O=h*_,ne=i.x,$=i.y,K=i.z;return r[0]=(1-(D+S))*ne,r[1]=(M+O)*ne,r[2]=(E-N)*ne,r[3]=0,r[4]=(M-O)*$,r[5]=(1-(x+S))*$,r[6]=(C+I)*$,r[7]=0,r[8]=(E+N)*K,r[9]=(C-I)*K,r[10]=(1-(x+D))*K,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,t,i){const r=this.elements;let o=lm.set(r[0],r[1],r[2]).length();const a=lm.set(r[4],r[5],r[6]).length(),u=lm.set(r[8],r[9],r[10]).length();this.determinant()<0&&(o=-o),e.x=r[12],e.y=r[13],e.z=r[14],Va.copy(this);const f=1/o,g=1/a,_=1/u;return Va.elements[0]*=f,Va.elements[1]*=f,Va.elements[2]*=f,Va.elements[4]*=g,Va.elements[5]*=g,Va.elements[6]*=g,Va.elements[8]*=_,Va.elements[9]*=_,Va.elements[10]*=_,t.setFromRotationMatrix(Va),i.x=o,i.y=a,i.z=u,this}makePerspective(e,t,i,r,o,a,u=mc){const h=this.elements,f=2*o/(t-e),g=2*o/(i-r),_=(t+e)/(t-e),x=(i+r)/(i-r);let M,E;if(u===mc)M=-(a+o)/(a-o),E=-2*a*o/(a-o);else{if(2001!==u)throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+u);M=-a/(a-o),E=-a*o/(a-o)}return h[0]=f,h[4]=0,h[8]=_,h[12]=0,h[1]=0,h[5]=g,h[9]=x,h[13]=0,h[2]=0,h[6]=0,h[10]=M,h[14]=E,h[3]=0,h[7]=0,h[11]=-1,h[15]=0,this}makeOrthographic(e,t,i,r,o,a,u=mc){const h=this.elements,f=1/(t-e),g=1/(i-r),_=1/(a-o),x=(t+e)*f,M=(i+r)*g;let E,D;if(u===mc)E=(a+o)*_,D=-2*_;else{if(2001!==u)throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+u);E=o*_,D=-1*_}return h[0]=2*f,h[4]=0,h[8]=0,h[12]=-x,h[1]=0,h[5]=2*g,h[9]=0,h[13]=-M,h[2]=0,h[6]=0,h[10]=D,h[14]=-E,h[3]=0,h[7]=0,h[11]=0,h[15]=1,this}equals(e){const t=this.elements,i=e.elements;for(let r=0;r<16;r++)if(t[r]!==i[r])return!1;return!0}fromArray(e,t=0){for(let i=0;i<16;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}}const lm=new Q,Va=new cn,wX=new Q(0,0,0),bX=new Q(1,1,1),Hu=new Q,Ax=new Q,Oo=new Q,c2=new cn,u2=new No;let _c=(()=>{class n{constructor(t=0,i=0,r=0,o=n.DEFAULT_ORDER){this.isEuler=!0,this._x=t,this._y=i,this._z=r,this._order=o}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,i,r,o=this._order){return this._x=t,this._y=i,this._z=r,this._order=o,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,i=this._order,r=!0){const o=t.elements,a=o[0],u=o[4],h=o[8],f=o[1],g=o[5],_=o[9],x=o[2],M=o[6],E=o[10];switch(i){case"XYZ":this._y=Math.asin(yr(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(-_,E),this._z=Math.atan2(-u,a)):(this._x=Math.atan2(M,g),this._z=0);break;case"YXZ":this._x=Math.asin(-yr(_,-1,1)),Math.abs(_)<.9999999?(this._y=Math.atan2(h,E),this._z=Math.atan2(f,g)):(this._y=Math.atan2(-x,a),this._z=0);break;case"ZXY":this._x=Math.asin(yr(M,-1,1)),Math.abs(M)<.9999999?(this._y=Math.atan2(-x,E),this._z=Math.atan2(-u,g)):(this._y=0,this._z=Math.atan2(f,a));break;case"ZYX":this._y=Math.asin(-yr(x,-1,1)),Math.abs(x)<.9999999?(this._x=Math.atan2(M,E),this._z=Math.atan2(f,a)):(this._x=0,this._z=Math.atan2(-u,g));break;case"YZX":this._z=Math.asin(yr(f,-1,1)),Math.abs(f)<.9999999?(this._x=Math.atan2(-_,g),this._y=Math.atan2(-x,a)):(this._x=0,this._y=Math.atan2(h,E));break;case"XZY":this._z=Math.asin(-yr(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(M,g),this._y=Math.atan2(h,a)):(this._x=Math.atan2(-_,E),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+i)}return this._order=i,!0===r&&this._onChangeCallback(),this}setFromQuaternion(t,i,r){return c2.makeRotationFromQuaternion(t),this.setFromRotationMatrix(c2,i,r)}setFromVector3(t,i=this._order){return this.set(t.x,t.y,t.z,i)}reorder(t){return u2.setFromEuler(this),this.setFromQuaternion(u2,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],i=0){return t[i]=this._x,t[i+1]=this._y,t[i+2]=this._z,t[i+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}return n.DEFAULT_ORDER="XYZ",n})();class KT{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return 0!=(this.mask&e.mask)}isEnabled(e){return 0!=(this.mask&(1<<e|0))}}let EX=0;const h2=new Q,cm=new No,xc=new cn,Dx=new Q,qv=new Q,SX=new Q,TX=new No,d2=new Q(1,0,0),f2=new Q(0,1,0),p2=new Q(0,0,1),m2={type:"added"},CX={type:"removed"},um={type:"childadded",child:null},QT={type:"childremoved",child:null};let vo=(()=>{class n extends Qp{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:EX++}),this.uuid=Lo(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=n.DEFAULT_UP.clone();const t=new Q,i=new _c,r=new No,o=new Q(1,1,1);i._onChange(function a(){r.setFromEuler(i,!1)}),r._onChange(function u(){i.setFromQuaternion(r,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:i},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:o},modelViewMatrix:{value:new cn},normalMatrix:{value:new Nn}}),this.matrix=new cn,this.matrixWorld=new cn,this.matrixAutoUpdate=n.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=n.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new KT,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,i){this.quaternion.setFromAxisAngle(t,i)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,i){return cm.setFromAxisAngle(t,i),this.quaternion.multiply(cm),this}rotateOnWorldAxis(t,i){return cm.setFromAxisAngle(t,i),this.quaternion.premultiply(cm),this}rotateX(t){return this.rotateOnAxis(d2,t)}rotateY(t){return this.rotateOnAxis(f2,t)}rotateZ(t){return this.rotateOnAxis(p2,t)}translateOnAxis(t,i){return h2.copy(t).applyQuaternion(this.quaternion),this.position.add(h2.multiplyScalar(i)),this}translateX(t){return this.translateOnAxis(d2,t)}translateY(t){return this.translateOnAxis(f2,t)}translateZ(t){return this.translateOnAxis(p2,t)}localToWorld(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(xc.copy(this.matrixWorld).invert())}lookAt(t,i,r){t.isVector3?Dx.copy(t):Dx.set(t,i,r);const o=this.parent;this.updateWorldMatrix(!0,!1),qv.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?xc.lookAt(qv,Dx,this.up):xc.lookAt(Dx,qv,this.up),this.quaternion.setFromRotationMatrix(xc),o&&(xc.extractRotation(o.matrixWorld),cm.setFromRotationMatrix(xc),this.quaternion.premultiply(cm.invert()))}add(t){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.add(arguments[i]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(t.removeFromParent(),t.parent=this,this.children.push(t),t.dispatchEvent(m2),um.child=t,this.dispatchEvent(um),um.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let r=0;r<arguments.length;r++)this.remove(arguments[r]);return this}const i=this.children.indexOf(t);return-1!==i&&(t.parent=null,this.children.splice(i,1),t.dispatchEvent(CX),QT.child=t,this.dispatchEvent(QT),QT.child=null),this}removeFromParent(){const t=this.parent;return null!==t&&t.remove(this),this}clear(){return this.remove(...this.children)}attach(t){return this.updateWorldMatrix(!0,!1),xc.copy(this.matrixWorld).invert(),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),xc.multiply(t.parent.matrixWorld)),t.applyMatrix4(xc),t.removeFromParent(),t.parent=this,this.children.push(t),t.updateWorldMatrix(!1,!0),t.dispatchEvent(m2),um.child=t,this.dispatchEvent(um),um.child=null,this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,i){if(this[t]===i)return this;for(let r=0,o=this.children.length;r<o;r++){const u=this.children[r].getObjectByProperty(t,i);if(void 0!==u)return u}}getObjectsByProperty(t,i,r=[]){this[t]===i&&r.push(this);const o=this.children;for(let a=0,u=o.length;a<u;a++)o[a].getObjectsByProperty(t,i,r);return r}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(qv,t,SX),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(qv,TX,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const i=this.matrixWorld.elements;return t.set(i[8],i[9],i[10]).normalize()}raycast(){}traverse(t){t(this);const i=this.children;for(let r=0,o=i.length;r<o;r++)i[r].traverse(t)}traverseVisible(t){if(!1===this.visible)return;t(this);const i=this.children;for(let r=0,o=i.length;r<o;r++)i[r].traverseVisible(t)}traverseAncestors(t){const i=this.parent;null!==i&&(t(i),i.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(!0===this.matrixWorldAutoUpdate&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,t=!0);const i=this.children;for(let r=0,o=i.length;r<o;r++)i[r].updateMatrixWorld(t)}updateWorldMatrix(t,i){const r=this.parent;if(!0===t&&null!==r&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),!0===this.matrixWorldAutoUpdate&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),!0===i){const o=this.children;for(let a=0,u=o.length;a<u;a++)o[a].updateWorldMatrix(!1,!0)}}toJSON(t){const i=void 0===t||"string"==typeof t,r={};i&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},r.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const o={};function a(h,f){return void 0===h[f.uuid]&&(h[f.uuid]=f.toJSON(t)),f.uuid}if(o.uuid=this.uuid,o.type=this.type,""!==this.name&&(o.name=this.name),!0===this.castShadow&&(o.castShadow=!0),!0===this.receiveShadow&&(o.receiveShadow=!0),!1===this.visible&&(o.visible=!1),!1===this.frustumCulled&&(o.frustumCulled=!1),0!==this.renderOrder&&(o.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(o.userData=this.userData),o.layers=this.layers.mask,o.matrix=this.matrix.toArray(),o.up=this.up.toArray(),!1===this.matrixAutoUpdate&&(o.matrixAutoUpdate=!1),this.isInstancedMesh&&(o.type="InstancedMesh",o.count=this.count,o.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(o.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(o.type="BatchedMesh",o.perObjectFrustumCulled=this.perObjectFrustumCulled,o.sortObjects=this.sortObjects,o.drawRanges=this._drawRanges,o.reservedRanges=this._reservedRanges,o.visibility=this._visibility,o.active=this._active,o.bounds=this._bounds.map(h=>({boxInitialized:h.boxInitialized,boxMin:h.box.min.toArray(),boxMax:h.box.max.toArray(),sphereInitialized:h.sphereInitialized,sphereRadius:h.sphere.radius,sphereCenter:h.sphere.center.toArray()})),o.maxInstanceCount=this._maxInstanceCount,o.maxVertexCount=this._maxVertexCount,o.maxIndexCount=this._maxIndexCount,o.geometryInitialized=this._geometryInitialized,o.geometryCount=this._geometryCount,o.matricesTexture=this._matricesTexture.toJSON(t),null!==this._colorsTexture&&(o.colorsTexture=this._colorsTexture.toJSON(t)),null!==this.boundingSphere&&(o.boundingSphere={center:o.boundingSphere.center.toArray(),radius:o.boundingSphere.radius}),null!==this.boundingBox&&(o.boundingBox={min:o.boundingBox.min.toArray(),max:o.boundingBox.max.toArray()})),this.isScene)this.background&&(this.background.isColor?o.background=this.background.toJSON():this.background.isTexture&&(o.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(o.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){o.geometry=a(t.geometries,this.geometry);const h=this.geometry.parameters;if(void 0!==h&&void 0!==h.shapes){const f=h.shapes;if(Array.isArray(f))for(let g=0,_=f.length;g<_;g++)a(t.shapes,f[g]);else a(t.shapes,f)}}if(this.isSkinnedMesh&&(o.bindMode=this.bindMode,o.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(a(t.skeletons,this.skeleton),o.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const h=[];for(let f=0,g=this.material.length;f<g;f++)h.push(a(t.materials,this.material[f]));o.material=h}else o.material=a(t.materials,this.material);if(this.children.length>0){o.children=[];for(let h=0;h<this.children.length;h++)o.children.push(this.children[h].toJSON(t).object)}if(this.animations.length>0){o.animations=[];for(let h=0;h<this.animations.length;h++)o.animations.push(a(t.animations,this.animations[h]))}if(i){const h=u(t.geometries),f=u(t.materials),g=u(t.textures),_=u(t.images),x=u(t.shapes),M=u(t.skeletons),E=u(t.animations),D=u(t.nodes);h.length>0&&(r.geometries=h),f.length>0&&(r.materials=f),g.length>0&&(r.textures=g),_.length>0&&(r.images=_),x.length>0&&(r.shapes=x),M.length>0&&(r.skeletons=M),E.length>0&&(r.animations=E),D.length>0&&(r.nodes=D)}return r.object=o,r;function u(h){const f=[];for(const g in h){const _=h[g];delete _.metadata,f.push(_)}return f}}clone(t){return(new this.constructor).copy(this,t)}copy(t,i=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.animations=t.animations.slice(),this.userData=JSON.parse(JSON.stringify(t.userData)),!0===i)for(let r=0;r<t.children.length;r++)this.add(t.children[r].clone());return this}}return n.DEFAULT_UP=new Q(0,1,0),n.DEFAULT_MATRIX_AUTO_UPDATE=!0,n.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0,n})();const za=new Q,Mc=new Q,eC=new Q,wc=new Q,hm=new Q,dm=new Q,g2=new Q,tC=new Q,nC=new Q,iC=new Q;class oa{constructor(e=new Q,t=new Q,i=new Q){this.a=e,this.b=t,this.c=i}static getNormal(e,t,i,r){r.subVectors(i,t),za.subVectors(e,t),r.cross(za);const o=r.lengthSq();return o>0?r.multiplyScalar(1/Math.sqrt(o)):r.set(0,0,0)}static getBarycoord(e,t,i,r,o){za.subVectors(r,t),Mc.subVectors(i,t),eC.subVectors(e,t);const a=za.dot(za),u=za.dot(Mc),h=za.dot(eC),f=Mc.dot(Mc),g=Mc.dot(eC),_=a*f-u*u;if(0===_)return o.set(0,0,0),null;const x=1/_,M=(f*h-u*g)*x,E=(a*g-u*h)*x;return o.set(1-M-E,E,M)}static containsPoint(e,t,i,r){return null!==this.getBarycoord(e,t,i,r,wc)&&wc.x>=0&&wc.y>=0&&wc.x+wc.y<=1}static getInterpolation(e,t,i,r,o,a,u,h){return null===this.getBarycoord(e,t,i,r,wc)?(h.x=0,h.y=0,"z"in h&&(h.z=0),"w"in h&&(h.w=0),null):(h.setScalar(0),h.addScaledVector(o,wc.x),h.addScaledVector(a,wc.y),h.addScaledVector(u,wc.z),h)}static isFrontFacing(e,t,i,r){return za.subVectors(i,t),Mc.subVectors(e,t),za.cross(Mc).dot(r)<0}set(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this}setFromPointsAndIndices(e,t,i,r){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[r]),this}setFromAttributeAndIndices(e,t,i,r){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,i),this.c.fromBufferAttribute(e,r),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return za.subVectors(this.c,this.b),Mc.subVectors(this.a,this.b),.5*za.cross(Mc).length()}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return oa.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return oa.getBarycoord(e,this.a,this.b,this.c,t)}getInterpolation(e,t,i,r,o){return oa.getInterpolation(e,this.a,this.b,this.c,t,i,r,o)}containsPoint(e){return oa.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return oa.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const i=this.a,r=this.b,o=this.c;let a,u;hm.subVectors(r,i),dm.subVectors(o,i),tC.subVectors(e,i);const h=hm.dot(tC),f=dm.dot(tC);if(h<=0&&f<=0)return t.copy(i);nC.subVectors(e,r);const g=hm.dot(nC),_=dm.dot(nC);if(g>=0&&_<=g)return t.copy(r);const x=h*_-g*f;if(x<=0&&h>=0&&g<=0)return a=h/(h-g),t.copy(i).addScaledVector(hm,a);iC.subVectors(e,o);const M=hm.dot(iC),E=dm.dot(iC);if(E>=0&&M<=E)return t.copy(o);const D=M*f-h*E;if(D<=0&&f>=0&&E<=0)return u=f/(f-E),t.copy(i).addScaledVector(dm,u);const C=g*E-M*_;if(C<=0&&_-g>=0&&M-E>=0)return g2.subVectors(o,r),u=(_-g)/(_-g+(M-E)),t.copy(r).addScaledVector(g2,u);const S=1/(C+D+x);return a=D*S,u=x*S,t.copy(i).addScaledVector(hm,a).addScaledVector(dm,u)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const v2={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Gu={h:0,s:0,l:0},Rx={h:0,s:0,l:0};function rC(n,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?n+6*(e-n)*t:t<.5?e:t<2/3?n+6*(e-n)*(2/3-t):n}class wt{constructor(e,t,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,i)}set(e,t,i){if(void 0===t&&void 0===i){const r=e;r&&r.isColor?this.copy(r):"number"==typeof r?this.setHex(r):"string"==typeof r&&this.setStyle(r)}else this.setRGB(e,t,i);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=Ba){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,mi.toWorkingColorSpace(this,t),this}setRGB(e,t,i,r=mi.workingColorSpace){return this.r=e,this.g=t,this.b=i,mi.toWorkingColorSpace(this,r),this}setHSL(e,t,i,r=mi.workingColorSpace){if(e=function VT(n,e){return(n%e+e)%e}(e,1),t=yr(t,0,1),i=yr(i,0,1),0===t)this.r=this.g=this.b=i;else{const o=i<=.5?i*(1+t):i+t-i*t,a=2*i-o;this.r=rC(a,o,e+1/3),this.g=rC(a,o,e),this.b=rC(a,o,e-1/3)}return mi.toWorkingColorSpace(this,r),this}setStyle(e,t=Ba){function i(o){void 0!==o&&parseFloat(o)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let r;if(r=/^(\w+)\(([^\)]*)\)/.exec(e)){let o;const u=r[2];switch(r[1]){case"rgb":case"rgba":if(o=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(u))return i(o[4]),this.setRGB(Math.min(255,parseInt(o[1],10))/255,Math.min(255,parseInt(o[2],10))/255,Math.min(255,parseInt(o[3],10))/255,t);if(o=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(u))return i(o[4]),this.setRGB(Math.min(100,parseInt(o[1],10))/100,Math.min(100,parseInt(o[2],10))/100,Math.min(100,parseInt(o[3],10))/100,t);break;case"hsl":case"hsla":if(o=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(u))return i(o[4]),this.setHSL(parseFloat(o[1])/360,parseFloat(o[2])/100,parseFloat(o[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(e)){const o=r[1],a=o.length;if(3===a)return this.setRGB(parseInt(o.charAt(0),16)/15,parseInt(o.charAt(1),16)/15,parseInt(o.charAt(2),16)/15,t);if(6===a)return this.setHex(parseInt(o,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=Ba){const i=v2[e.toLowerCase()];return void 0!==i?this.setHex(i,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=nm(e.r),this.g=nm(e.g),this.b=nm(e.b),this}copyLinearToSRGB(e){return this.r=GT(e.r),this.g=GT(e.g),this.b=GT(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=Ba){return mi.fromWorkingColorSpace(Ls.copy(this),e),65536*Math.round(yr(255*Ls.r,0,255))+256*Math.round(yr(255*Ls.g,0,255))+Math.round(yr(255*Ls.b,0,255))}getHexString(e=Ba){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=mi.workingColorSpace){mi.fromWorkingColorSpace(Ls.copy(this),t);const i=Ls.r,r=Ls.g,o=Ls.b,a=Math.max(i,r,o),u=Math.min(i,r,o);let h,f;const g=(u+a)/2;if(u===a)h=0,f=0;else{const _=a-u;switch(f=g<=.5?_/(a+u):_/(2-a-u),a){case i:h=(r-o)/_+(r<o?6:0);break;case r:h=(o-i)/_+2;break;case o:h=(i-r)/_+4}h/=6}return e.h=h,e.s=f,e.l=g,e}getRGB(e,t=mi.workingColorSpace){return mi.fromWorkingColorSpace(Ls.copy(this),t),e.r=Ls.r,e.g=Ls.g,e.b=Ls.b,e}getStyle(e=Ba){mi.fromWorkingColorSpace(Ls.copy(this),e);const t=Ls.r,i=Ls.g,r=Ls.b;return e!==Ba?`color(${e} ${t.toFixed(3)} ${i.toFixed(3)} ${r.toFixed(3)})`:`rgb(${Math.round(255*t)},${Math.round(255*i)},${Math.round(255*r)})`}offsetHSL(e,t,i){return this.getHSL(Gu),this.setHSL(Gu.h+e,Gu.s+t,Gu.l+i)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,i){return this.r=e.r+(t.r-e.r)*i,this.g=e.g+(t.g-e.g)*i,this.b=e.b+(t.b-e.b)*i,this}lerpHSL(e,t){this.getHSL(Gu),e.getHSL(Rx);const i=Gv(Gu.h,Rx.h,t),r=Gv(Gu.s,Rx.s,t),o=Gv(Gu.l,Rx.l,t);return this.setHSL(i,r,o),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,i=this.g,r=this.b,o=e.elements;return this.r=o[0]*t+o[3]*i+o[6]*r,this.g=o[1]*t+o[4]*i+o[7]*r,this.b=o[2]*t+o[5]*i+o[8]*r,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const Ls=new wt;wt.NAMES=v2;let AX=0;class fm extends Qp{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:AX++}),this.uuid=Lo(),this.name="",this.type="Material",this.blending=1,this.side=0,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=100,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new wt(0,0,0),this.blendAlpha=0,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Kp,this.stencilZFail=Kp,this.stencilZPass=Kp,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(void 0!==e)for(const t in e){const i=e[t];if(void 0===i){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}const r=this[t];void 0!==r?r&&r.isColor?r.set(i):r&&r.isVector3&&i&&i.isVector3?r.copy(i):this[t]=i:console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`)}}toJSON(e){const t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});const i={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};function r(o){const a=[];for(const u in o){const h=o[u];delete h.metadata,a.push(h)}return a}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),void 0!==this.roughness&&(i.roughness=this.roughness),void 0!==this.metalness&&(i.metalness=this.metalness),void 0!==this.sheen&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),void 0!==this.emissiveIntensity&&1!==this.emissiveIntensity&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(i.shininess=this.shininess),void 0!==this.clearcoat&&(i.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.dispersion&&(i.dispersion=this.dispersion),void 0!==this.iridescence&&(i.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(i.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),void 0!==this.anisotropy&&(i.anisotropy=this.anisotropy),void 0!==this.anisotropyRotation&&(i.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(i.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(i.combine=this.combine)),void 0!==this.envMapRotation&&(i.envMapRotation=this.envMapRotation.toArray()),void 0!==this.envMapIntensity&&(i.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(i.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(i.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(i.size=this.size),null!==this.shadowSide&&(i.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(i.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(i.blending=this.blending),0!==this.side&&(i.side=this.side),!0===this.vertexColors&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),!0===this.transparent&&(i.transparent=!0),204!==this.blendSrc&&(i.blendSrc=this.blendSrc),205!==this.blendDst&&(i.blendDst=this.blendDst),100!==this.blendEquation&&(i.blendEquation=this.blendEquation),null!==this.blendSrcAlpha&&(i.blendSrcAlpha=this.blendSrcAlpha),null!==this.blendDstAlpha&&(i.blendDstAlpha=this.blendDstAlpha),null!==this.blendEquationAlpha&&(i.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(i.blendColor=this.blendColor.getHex()),0!==this.blendAlpha&&(i.blendAlpha=this.blendAlpha),3!==this.depthFunc&&(i.depthFunc=this.depthFunc),!1===this.depthTest&&(i.depthTest=this.depthTest),!1===this.depthWrite&&(i.depthWrite=this.depthWrite),!1===this.colorWrite&&(i.colorWrite=this.colorWrite),255!==this.stencilWriteMask&&(i.stencilWriteMask=this.stencilWriteMask),519!==this.stencilFunc&&(i.stencilFunc=this.stencilFunc),0!==this.stencilRef&&(i.stencilRef=this.stencilRef),255!==this.stencilFuncMask&&(i.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==Kp&&(i.stencilFail=this.stencilFail),this.stencilZFail!==Kp&&(i.stencilZFail=this.stencilZFail),this.stencilZPass!==Kp&&(i.stencilZPass=this.stencilZPass),!0===this.stencilWrite&&(i.stencilWrite=this.stencilWrite),void 0!==this.rotation&&0!==this.rotation&&(i.rotation=this.rotation),!0===this.polygonOffset&&(i.polygonOffset=!0),0!==this.polygonOffsetFactor&&(i.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(i.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(i.linewidth=this.linewidth),void 0!==this.dashSize&&(i.dashSize=this.dashSize),void 0!==this.gapSize&&(i.gapSize=this.gapSize),void 0!==this.scale&&(i.scale=this.scale),!0===this.dithering&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),!0===this.alphaHash&&(i.alphaHash=!0),!0===this.alphaToCoverage&&(i.alphaToCoverage=!0),!0===this.premultipliedAlpha&&(i.premultipliedAlpha=!0),!0===this.forceSinglePass&&(i.forceSinglePass=!0),!0===this.wireframe&&(i.wireframe=!0),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(i.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(i.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(i.flatShading=!0),!1===this.visible&&(i.visible=!1),!1===this.toneMapped&&(i.toneMapped=!1),!1===this.fog&&(i.fog=!1),Object.keys(this.userData).length>0&&(i.userData=this.userData),t){const o=r(e.textures),a=r(e.images);o.length>0&&(i.textures=o),a.length>0&&(i.images=a)}return i}clone(){return(new this.constructor).copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let i=null;if(null!==t){const r=t.length;i=new Array(r);for(let o=0;o!==r;++o)i[o]=t[o].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){!0===e&&this.version++}onBuild(){console.warn("Material: onBuild() has been removed.")}onBeforeRender(){console.warn("Material: onBeforeRender() has been removed.")}}class vl extends fm{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new wt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new _c,this.combine=ix,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const Lr=new Q,Ix=new Ve;class Nr{constructor(e,t,i=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=i,this.usage=35044,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.gpuType=Po,this.version=0}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}get updateRange(){return HT("THREE.BufferAttribute: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,i){e*=this.itemSize,i*=t.itemSize;for(let r=0,o=this.itemSize;r<o;r++)this.array[e+r]=t.array[i+r];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(2===this.itemSize)for(let t=0,i=this.count;t<i;t++)Ix.fromBufferAttribute(this,t),Ix.applyMatrix3(e),this.setXY(t,Ix.x,Ix.y);else if(3===this.itemSize)for(let t=0,i=this.count;t<i;t++)Lr.fromBufferAttribute(this,t),Lr.applyMatrix3(e),this.setXYZ(t,Lr.x,Lr.y,Lr.z);return this}applyMatrix4(e){for(let t=0,i=this.count;t<i;t++)Lr.fromBufferAttribute(this,t),Lr.applyMatrix4(e),this.setXYZ(t,Lr.x,Lr.y,Lr.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)Lr.fromBufferAttribute(this,t),Lr.applyNormalMatrix(e),this.setXYZ(t,Lr.x,Lr.y,Lr.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)Lr.fromBufferAttribute(this,t),Lr.transformDirection(e),this.setXYZ(t,Lr.x,Lr.y,Lr.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let i=this.array[e*this.itemSize+t];return this.normalized&&(i=eo(i,this.array)),i}setComponent(e,t,i){return this.normalized&&(i=An(i,this.array)),this.array[e*this.itemSize+t]=i,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=eo(t,this.array)),t}setX(e,t){return this.normalized&&(t=An(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=eo(t,this.array)),t}setY(e,t){return this.normalized&&(t=An(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=eo(t,this.array)),t}setZ(e,t){return this.normalized&&(t=An(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=eo(t,this.array)),t}setW(e,t){return this.normalized&&(t=An(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,i){return e*=this.itemSize,this.normalized&&(t=An(t,this.array),i=An(i,this.array)),this.array[e+0]=t,this.array[e+1]=i,this}setXYZ(e,t,i,r){return e*=this.itemSize,this.normalized&&(t=An(t,this.array),i=An(i,this.array),r=An(r,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this}setXYZW(e,t,i,r,o){return e*=this.itemSize,this.normalized&&(t=An(t,this.array),i=An(i,this.array),r=An(r,this.array),o=An(o,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this.array[e+3]=o,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),35044!==this.usage&&(e.usage=this.usage),e}}class y2 extends Nr{constructor(e,t,i){super(new Uint16Array(e),t,i)}}class _2 extends Nr{constructor(e,t,i){super(new Uint32Array(e),t,i)}}class Vt extends Nr{constructor(e,t,i){super(new Float32Array(e),t,i)}}let RX=0;const aa=new cn,sC=new vo,pm=new Q,Fo=new go,Zv=new go,is=new Q;class Hn extends Qp{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:RX++}),this.uuid=Lo(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return this.index=Array.isArray(e)?new(i2(e)?_2:y2)(e,1):e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,t,i=0){this.groups.push({start:e,count:t,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);const i=this.attributes.normal;if(void 0!==i){const o=(new Nn).getNormalMatrix(e);i.applyNormalMatrix(o),i.needsUpdate=!0}const r=this.attributes.tangent;return void 0!==r&&(r.transformDirection(e),r.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(e){return aa.makeRotationFromQuaternion(e),this.applyMatrix4(aa),this}rotateX(e){return aa.makeRotationX(e),this.applyMatrix4(aa),this}rotateY(e){return aa.makeRotationY(e),this.applyMatrix4(aa),this}rotateZ(e){return aa.makeRotationZ(e),this.applyMatrix4(aa),this}translate(e,t,i){return aa.makeTranslation(e,t,i),this.applyMatrix4(aa),this}scale(e,t,i){return aa.makeScale(e,t,i),this.applyMatrix4(aa),this}lookAt(e){return sC.lookAt(e),sC.updateMatrix(),this.applyMatrix4(sC.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(pm).negate(),this.translate(pm.x,pm.y,pm.z),this}setFromPoints(e){const t=[];for(let i=0,r=e.length;i<r;i++){const o=e[i];t.push(o.x,o.y,o.z||0)}return this.setAttribute("position",new Vt(t,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new go);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),void this.boundingBox.set(new Q(-1/0,-1/0,-1/0),new Q(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let i=0,r=t.length;i<r;i++)Fo.setFromBufferAttribute(t[i]),this.morphTargetsRelative?(is.addVectors(this.boundingBox.min,Fo.min),this.boundingBox.expandByPoint(is),is.addVectors(this.boundingBox.max,Fo.max),this.boundingBox.expandByPoint(is)):(this.boundingBox.expandByPoint(Fo.min),this.boundingBox.expandByPoint(Fo.max))}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new to);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),void this.boundingSphere.set(new Q,1/0);if(e){const i=this.boundingSphere.center;if(Fo.setFromBufferAttribute(e),t)for(let o=0,a=t.length;o<a;o++)Zv.setFromBufferAttribute(t[o]),this.morphTargetsRelative?(is.addVectors(Fo.min,Zv.min),Fo.expandByPoint(is),is.addVectors(Fo.max,Zv.max),Fo.expandByPoint(is)):(Fo.expandByPoint(Zv.min),Fo.expandByPoint(Zv.max));Fo.getCenter(i);let r=0;for(let o=0,a=e.count;o<a;o++)is.fromBufferAttribute(e,o),r=Math.max(r,i.distanceToSquared(is));if(t)for(let o=0,a=t.length;o<a;o++){const u=t[o],h=this.morphTargetsRelative;for(let f=0,g=u.count;f<g;f++)is.fromBufferAttribute(u,f),h&&(pm.fromBufferAttribute(e,f),is.add(pm)),r=Math.max(r,i.distanceToSquared(is))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(null===e||void 0===t.position||void 0===t.normal||void 0===t.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const i=t.position,r=t.normal,o=t.uv;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new Nr(new Float32Array(4*i.count),4));const a=this.getAttribute("tangent"),u=[],h=[];for(let oe=0;oe<i.count;oe++)u[oe]=new Q,h[oe]=new Q;const f=new Q,g=new Q,_=new Q,x=new Ve,M=new Ve,E=new Ve,D=new Q,C=new Q;function S(oe,j,G){f.fromBufferAttribute(i,oe),g.fromBufferAttribute(i,j),_.fromBufferAttribute(i,G),x.fromBufferAttribute(o,oe),M.fromBufferAttribute(o,j),E.fromBufferAttribute(o,G),g.sub(f),_.sub(f),M.sub(x),E.sub(x);const ce=1/(M.x*E.y-E.x*M.y);isFinite(ce)&&(D.copy(g).multiplyScalar(E.y).addScaledVector(_,-M.y).multiplyScalar(ce),C.copy(_).multiplyScalar(M.x).addScaledVector(g,-E.x).multiplyScalar(ce),u[oe].add(D),u[j].add(D),u[G].add(D),h[oe].add(C),h[j].add(C),h[G].add(C))}let I=this.groups;0===I.length&&(I=[{start:0,count:e.count}]);for(let oe=0,j=I.length;oe<j;++oe){const G=I[oe],ce=G.start;for(let xe=ce,Ce=ce+G.count;xe<Ce;xe+=3)S(e.getX(xe+0),e.getX(xe+1),e.getX(xe+2))}const N=new Q,O=new Q,ne=new Q,$=new Q;function K(oe){ne.fromBufferAttribute(r,oe),$.copy(ne);const j=u[oe];N.copy(j),N.sub(ne.multiplyScalar(ne.dot(j))).normalize(),O.crossVectors($,j);const ce=O.dot(h[oe])<0?-1:1;a.setXYZW(oe,N.x,N.y,N.z,ce)}for(let oe=0,j=I.length;oe<j;++oe){const G=I[oe],ce=G.start;for(let xe=ce,Ce=ce+G.count;xe<Ce;xe+=3)K(e.getX(xe+0)),K(e.getX(xe+1)),K(e.getX(xe+2))}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(void 0!==t){let i=this.getAttribute("normal");if(void 0===i)i=new Nr(new Float32Array(3*t.count),3),this.setAttribute("normal",i);else for(let x=0,M=i.count;x<M;x++)i.setXYZ(x,0,0,0);const r=new Q,o=new Q,a=new Q,u=new Q,h=new Q,f=new Q,g=new Q,_=new Q;if(e)for(let x=0,M=e.count;x<M;x+=3){const E=e.getX(x+0),D=e.getX(x+1),C=e.getX(x+2);r.fromBufferAttribute(t,E),o.fromBufferAttribute(t,D),a.fromBufferAttribute(t,C),g.subVectors(a,o),_.subVectors(r,o),g.cross(_),u.fromBufferAttribute(i,E),h.fromBufferAttribute(i,D),f.fromBufferAttribute(i,C),u.add(g),h.add(g),f.add(g),i.setXYZ(E,u.x,u.y,u.z),i.setXYZ(D,h.x,h.y,h.z),i.setXYZ(C,f.x,f.y,f.z)}else for(let x=0,M=t.count;x<M;x+=3)r.fromBufferAttribute(t,x+0),o.fromBufferAttribute(t,x+1),a.fromBufferAttribute(t,x+2),g.subVectors(a,o),_.subVectors(r,o),g.cross(_),i.setXYZ(x+0,g.x,g.y,g.z),i.setXYZ(x+1,g.x,g.y,g.z),i.setXYZ(x+2,g.x,g.y,g.z);this.normalizeNormals(),i.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,i=e.count;t<i;t++)is.fromBufferAttribute(e,t),is.normalize(),e.setXYZ(t,is.x,is.y,is.z)}toNonIndexed(){function e(u,h){const f=u.array,g=u.itemSize,_=u.normalized,x=new f.constructor(h.length*g);let M=0,E=0;for(let D=0,C=h.length;D<C;D++){M=u.isInterleavedBufferAttribute?h[D]*u.data.stride+u.offset:h[D]*g;for(let S=0;S<g;S++)x[E++]=f[M++]}return new Nr(x,g,_)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new Hn,i=this.index.array,r=this.attributes;for(const u in r){const f=e(r[u],i);t.setAttribute(u,f)}const o=this.morphAttributes;for(const u in o){const h=[],f=o[u];for(let g=0,_=f.length;g<_;g++){const M=e(f[g],i);h.push(M)}t.morphAttributes[u]=h}t.morphTargetsRelative=this.morphTargetsRelative;const a=this.groups;for(let u=0,h=a.length;u<h;u++){const f=a[u];t.addGroup(f.start,f.count,f.materialIndex)}return t}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){const h=this.parameters;for(const f in h)void 0!==h[f]&&(e[f]=h[f]);return e}e.data={attributes:{}};const t=this.index;null!==t&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const i=this.attributes;for(const h in i)e.data.attributes[h]=i[h].toJSON(e.data);const r={};let o=!1;for(const h in this.morphAttributes){const f=this.morphAttributes[h],g=[];for(let _=0,x=f.length;_<x;_++)g.push(f[_].toJSON(e.data));g.length>0&&(r[h]=g,o=!0)}o&&(e.data.morphAttributes=r,e.data.morphTargetsRelative=this.morphTargetsRelative);const a=this.groups;a.length>0&&(e.data.groups=JSON.parse(JSON.stringify(a)));const u=this.boundingSphere;return null!==u&&(e.data.boundingSphere={center:u.center.toArray(),radius:u.radius}),e}clone(){return(new this.constructor).copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const i=e.index;null!==i&&this.setIndex(i.clone(t));const r=e.attributes;for(const f in r)this.setAttribute(f,r[f].clone(t));const o=e.morphAttributes;for(const f in o){const g=[],_=o[f];for(let x=0,M=_.length;x<M;x++)g.push(_[x].clone(t));this.morphAttributes[f]=g}this.morphTargetsRelative=e.morphTargetsRelative;const a=e.groups;for(let f=0,g=a.length;f<g;f++){const _=a[f];this.addGroup(_.start,_.count,_.materialIndex)}const u=e.boundingBox;null!==u&&(this.boundingBox=u.clone());const h=e.boundingSphere;return null!==h&&(this.boundingSphere=h.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const x2=new cn,Ad=new Xv,Px=new to,M2=new Q,mm=new Q,gm=new Q,vm=new Q,oC=new Q,Lx=new Q,Nx=new Ve,Ox=new Ve,Fx=new Ve,w2=new Q,b2=new Q,E2=new Q,Ux=new Q,Bx=new Q;class rs extends vo{constructor(e=new Hn,t=new vl){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const r=t[i[0]];if(void 0!==r){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let o=0,a=r.length;o<a;o++){const u=r[o].name||String(o);this.morphTargetInfluences.push(0),this.morphTargetDictionary[u]=o}}}}getVertexPosition(e,t){const i=this.geometry,o=i.morphAttributes.position,a=i.morphTargetsRelative;t.fromBufferAttribute(i.attributes.position,e);const u=this.morphTargetInfluences;if(o&&u){Lx.set(0,0,0);for(let h=0,f=o.length;h<f;h++){const g=u[h];0!==g&&(oC.fromBufferAttribute(o[h],e),Lx.addScaledVector(a?oC:oC.sub(t),g))}t.add(Lx)}return t}raycast(e,t){const i=this.geometry,o=this.matrixWorld;void 0!==this.material&&(null===i.boundingSphere&&i.computeBoundingSphere(),Px.copy(i.boundingSphere),Px.applyMatrix4(o),Ad.copy(e.ray).recast(e.near),(!1!==Px.containsPoint(Ad.origin)||!(null===Ad.intersectSphere(Px,M2)||Ad.origin.distanceToSquared(M2)>(e.far-e.near)**2))&&(x2.copy(o).invert(),Ad.copy(e.ray).applyMatrix4(x2),(null===i.boundingBox||!1!==Ad.intersectsBox(i.boundingBox))&&this._computeIntersections(e,t,Ad)))}_computeIntersections(e,t,i){let r;const o=this.geometry,a=this.material,u=o.index,h=o.attributes.position,f=o.attributes.uv,g=o.attributes.uv1,_=o.attributes.normal,x=o.groups,M=o.drawRange;if(null!==u)if(Array.isArray(a))for(let E=0,D=x.length;E<D;E++){const C=x[E],S=a[C.materialIndex];for(let O=Math.max(C.start,M.start),ne=Math.min(u.count,Math.min(C.start+C.count,M.start+M.count));O<ne;O+=3)r=kx(this,S,e,i,f,g,_,u.getX(O),u.getX(O+1),u.getX(O+2)),r&&(r.faceIndex=Math.floor(O/3),r.face.materialIndex=C.materialIndex,t.push(r))}else for(let C=Math.max(0,M.start),S=Math.min(u.count,M.start+M.count);C<S;C+=3)r=kx(this,a,e,i,f,g,_,u.getX(C),u.getX(C+1),u.getX(C+2)),r&&(r.faceIndex=Math.floor(C/3),t.push(r));else if(void 0!==h)if(Array.isArray(a))for(let E=0,D=x.length;E<D;E++){const C=x[E],S=a[C.materialIndex];for(let O=Math.max(C.start,M.start),ne=Math.min(h.count,Math.min(C.start+C.count,M.start+M.count));O<ne;O+=3)r=kx(this,S,e,i,f,g,_,O,O+1,O+2),r&&(r.faceIndex=Math.floor(O/3),r.face.materialIndex=C.materialIndex,t.push(r))}else for(let C=Math.max(0,M.start),S=Math.min(h.count,M.start+M.count);C<S;C+=3)r=kx(this,a,e,i,f,g,_,C,C+1,C+2),r&&(r.faceIndex=Math.floor(C/3),t.push(r))}}function kx(n,e,t,i,r,o,a,u,h,f){n.getVertexPosition(u,mm),n.getVertexPosition(h,gm),n.getVertexPosition(f,vm);const g=function IX(n,e,t,i,r,o,a,u){let h;if(h=1===e.side?i.intersectTriangle(a,o,r,!0,u):i.intersectTriangle(r,o,a,0===e.side,u),null===h)return null;Bx.copy(u),Bx.applyMatrix4(n.matrixWorld);const f=t.ray.origin.distanceTo(Bx);return f<t.near||f>t.far?null:{distance:f,point:Bx.clone(),object:n}}(n,e,t,i,mm,gm,vm,Ux);if(g){r&&(Nx.fromBufferAttribute(r,u),Ox.fromBufferAttribute(r,h),Fx.fromBufferAttribute(r,f),g.uv=oa.getInterpolation(Ux,mm,gm,vm,Nx,Ox,Fx,new Ve)),o&&(Nx.fromBufferAttribute(o,u),Ox.fromBufferAttribute(o,h),Fx.fromBufferAttribute(o,f),g.uv1=oa.getInterpolation(Ux,mm,gm,vm,Nx,Ox,Fx,new Ve)),a&&(w2.fromBufferAttribute(a,u),b2.fromBufferAttribute(a,h),E2.fromBufferAttribute(a,f),g.normal=oa.getInterpolation(Ux,mm,gm,vm,w2,b2,E2,new Q),g.normal.dot(i.direction)>0&&g.normal.multiplyScalar(-1));const _={a:u,b:h,c:f,normal:new Q,materialIndex:0};oa.getNormal(mm,gm,vm,_.normal),g.face=_}return g}class ym extends Hn{constructor(e=1,t=1,i=1,r=1,o=1,a=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:r,heightSegments:o,depthSegments:a};const u=this;r=Math.floor(r),o=Math.floor(o),a=Math.floor(a);const h=[],f=[],g=[],_=[];let x=0,M=0;function E(D,C,S,I,N,O,ne,$,K,oe,j){const G=O/K,ce=ne/oe,Se=O/2,xe=ne/2,Ce=$/2,Be=K+1,Ae=oe+1;let Ke=0,De=0;const bt=new Q;for(let Ut=0;Ut<Ae;Ut++){const Rt=Ut*ce-xe;for(let Vn=0;Vn<Be;Vn++)bt[D]=(Vn*G-Se)*I,bt[C]=Rt*N,bt[S]=Ce,f.push(bt.x,bt.y,bt.z),bt[D]=0,bt[C]=0,bt[S]=$>0?1:-1,g.push(bt.x,bt.y,bt.z),_.push(Vn/K),_.push(1-Ut/oe),Ke+=1}for(let Ut=0;Ut<oe;Ut++)for(let Rt=0;Rt<K;Rt++){const ci=x+Rt+Be*(Ut+1),Pe=x+(Rt+1)+Be*(Ut+1),nt=x+(Rt+1)+Be*Ut;h.push(x+Rt+Be*Ut,ci,nt),h.push(ci,Pe,nt),De+=6}u.addGroup(M,De,j),M+=De,x+=Ke}E("z","y","x",-1,-1,i,t,e,a,o,0),E("z","y","x",1,-1,i,t,-e,a,o,1),E("x","z","y",1,1,e,i,t,r,a,2),E("x","z","y",1,-1,e,i,-t,r,a,3),E("x","y","z",1,-1,e,t,i,r,o,4),E("x","y","z",-1,-1,e,t,-i,r,o,5),this.setIndex(h),this.setAttribute("position",new Vt(f,3)),this.setAttribute("normal",new Vt(g,3)),this.setAttribute("uv",new Vt(_,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new ym(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function _m(n){const e={};for(const t in n){e[t]={};for(const i in n[t]){const r=n[t][i];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?r.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[t][i]=null):e[t][i]=r.clone():e[t][i]=Array.isArray(r)?r.slice():r}}return e}function no(n){const e={};for(let t=0;t<n.length;t++){const i=_m(n[t]);for(const r in i)e[r]=i[r]}return e}function S2(n){const e=n.getRenderTarget();return null===e?n.outputColorSpace:!0===e.isXRRenderTarget?e.texture.colorSpace:mi.workingColorSpace}const LX={clone:_m,merge:no};class Ec extends fm{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=_m(e.uniforms),this.uniformsGroups=function PX(n){const e=[];for(let t=0;t<n.length;t++)e.push(n[t].clone());return e}(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const r in this.uniforms){const a=this.uniforms[r].value;t.uniforms[r]=a&&a.isTexture?{type:"t",value:a.toJSON(e).uuid}:a&&a.isColor?{type:"c",value:a.getHex()}:a&&a.isVector2?{type:"v2",value:a.toArray()}:a&&a.isVector3?{type:"v3",value:a.toArray()}:a&&a.isVector4?{type:"v4",value:a.toArray()}:a&&a.isMatrix3?{type:"m3",value:a.toArray()}:a&&a.isMatrix4?{type:"m4",value:a.toArray()}:{value:a}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const i={};for(const r in this.extensions)!0===this.extensions[r]&&(i[r]=!0);return Object.keys(i).length>0&&(t.extensions=i),t}}class aC extends vo{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new cn,this.projectionMatrix=new cn,this.projectionMatrixInverse=new cn,this.coordinateSystem=mc}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}const Wu=new Q,T2=new Ve,C2=new Ve;class gs extends aC{constructor(e=50,t=1,i=.1,r=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=i,this.far=r,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=2*em*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(.5*Ed*this.fov);return.5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*em*Math.atan(Math.tan(.5*Ed*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,t,i){Wu.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set(Wu.x,Wu.y).multiplyScalar(-e/Wu.z),Wu.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),i.set(Wu.x,Wu.y).multiplyScalar(-e/Wu.z)}getViewSize(e,t){return this.getViewBounds(e,T2,C2),t.subVectors(C2,T2)}setViewOffset(e,t,i,r,o,a){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=r,this.view.width=o,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(.5*Ed*this.fov)/this.zoom,i=2*t,r=this.aspect*i,o=-.5*r;const a=this.view;if(null!==this.view&&this.view.enabled){const h=a.fullWidth,f=a.fullHeight;o+=a.offsetX*r/h,t-=a.offsetY*i/f,r*=a.width/h,i*=a.height/f}const u=this.filmOffset;0!==u&&(o+=e*u/this.getFilmWidth()),this.projectionMatrix.makePerspective(o,o+r,t,t-i,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}class FX extends vo{constructor(e,t,i){super(),this.type="CubeCamera",this.renderTarget=i,this.coordinateSystem=null,this.activeMipmapLevel=0;const r=new gs(-90,1,e,t);r.layers=this.layers,this.add(r);const o=new gs(-90,1,e,t);o.layers=this.layers,this.add(o);const a=new gs(-90,1,e,t);a.layers=this.layers,this.add(a);const u=new gs(-90,1,e,t);u.layers=this.layers,this.add(u);const h=new gs(-90,1,e,t);h.layers=this.layers,this.add(h);const f=new gs(-90,1,e,t);f.layers=this.layers,this.add(f)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[i,r,o,a,u,h]=t;for(const f of t)this.remove(f);if(e===mc)i.up.set(0,1,0),i.lookAt(1,0,0),r.up.set(0,1,0),r.lookAt(-1,0,0),o.up.set(0,0,-1),o.lookAt(0,1,0),a.up.set(0,0,1),a.lookAt(0,-1,0),u.up.set(0,1,0),u.lookAt(0,0,1),h.up.set(0,1,0),h.lookAt(0,0,-1);else{if(2001!==e)throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);i.up.set(0,-1,0),i.lookAt(-1,0,0),r.up.set(0,-1,0),r.lookAt(1,0,0),o.up.set(0,0,1),o.lookAt(0,1,0),a.up.set(0,0,-1),a.lookAt(0,-1,0),u.up.set(0,-1,0),u.lookAt(0,0,1),h.up.set(0,-1,0),h.lookAt(0,0,-1)}for(const f of t)this.add(f),f.updateMatrixWorld()}update(e,t){null===this.parent&&this.updateMatrixWorld();const{renderTarget:i,activeMipmapLevel:r}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[o,a,u,h,f,g]=this.children,_=e.getRenderTarget(),x=e.getActiveCubeFace(),M=e.getActiveMipmapLevel(),E=e.xr.enabled;e.xr.enabled=!1;const D=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,e.setRenderTarget(i,0,r),e.render(t,o),e.setRenderTarget(i,1,r),e.render(t,a),e.setRenderTarget(i,2,r),e.render(t,u),e.setRenderTarget(i,3,r),e.render(t,h),e.setRenderTarget(i,4,r),e.render(t,f),i.texture.generateMipmaps=D,e.setRenderTarget(i,5,r),e.render(t,g),e.setRenderTarget(_,x,M),e.xr.enabled=E,i.texture.needsPMREMUpdate=!0}}class Vx extends gc{constructor(e,t,i,r,o,a,u,h,f,g){super(e=void 0!==e?e:[],t=void 0!==t?t:Ou,i,r,o,a,u,h,f,g),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class UX extends Sd{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const i={width:e,height:e,depth:1};this.texture=new Vx([i,i,i,i,i,i],t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==t.generateMipmaps&&t.generateMipmaps,this.texture.minFilter=void 0!==t.minFilter?t.minFilter:qr}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const i_uniforms={tEquirect:{value:null}},i_vertexShader="\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",i_fragmentShader="\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t",r=new ym(5,5,5),o=new Ec({name:"CubemapFromEquirect",uniforms:_m(i_uniforms),vertexShader:i_vertexShader,fragmentShader:i_fragmentShader,side:1,blending:0});o.uniforms.tEquirect.value=t;const a=new rs(r,o),u=t.minFilter;return t.minFilter===fc&&(t.minFilter=qr),new FX(1,10,this).update(e,a),t.minFilter=u,a.geometry.dispose(),a.material.dispose(),this}clear(e,t,i,r){const o=e.getRenderTarget();for(let a=0;a<6;a++)e.setRenderTarget(this,a),e.clear(t,i,r);e.setRenderTarget(o)}}const lC=new Q,BX=new Q,kX=new Nn;class Dd{constructor(e=new Q(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,i,r){return this.normal.set(e,t,i),this.constant=r,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,i){const r=lC.subVectors(i,t).cross(BX.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const i=e.delta(lC),r=this.normal.dot(i);if(0===r)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;const o=-(e.start.dot(this.normal)+this.constant)/r;return o<0||o>1?null:t.copy(e.start).addScaledVector(i,o)}intersectsLine(e){const t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const i=t||kX.getNormalMatrix(e),r=this.coplanarPoint(lC).applyMatrix4(e),o=this.normal.applyMatrix3(i).normalize();return this.constant=-r.dot(o),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return(new this.constructor).copy(this)}}const Rd=new to,zx=new Q;class Hx{constructor(e=new Dd,t=new Dd,i=new Dd,r=new Dd,o=new Dd,a=new Dd){this.planes=[e,t,i,r,o,a]}set(e,t,i,r,o,a){const u=this.planes;return u[0].copy(e),u[1].copy(t),u[2].copy(i),u[3].copy(r),u[4].copy(o),u[5].copy(a),this}copy(e){const t=this.planes;for(let i=0;i<6;i++)t[i].copy(e.planes[i]);return this}setFromProjectionMatrix(e,t=mc){const i=this.planes,r=e.elements,o=r[0],a=r[1],u=r[2],h=r[3],f=r[4],g=r[5],_=r[6],x=r[7],M=r[8],E=r[9],D=r[10],C=r[11],S=r[12],I=r[13],N=r[14],O=r[15];if(i[0].setComponents(h-o,x-f,C-M,O-S).normalize(),i[1].setComponents(h+o,x+f,C+M,O+S).normalize(),i[2].setComponents(h+a,x+g,C+E,O+I).normalize(),i[3].setComponents(h-a,x-g,C-E,O-I).normalize(),i[4].setComponents(h-u,x-_,C-D,O-N).normalize(),t===mc)i[5].setComponents(h+u,x+_,C+D,O+N).normalize();else{if(2001!==t)throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);i[5].setComponents(u,_,D,N).normalize()}return this}intersectsObject(e){if(void 0!==e.boundingSphere)null===e.boundingSphere&&e.computeBoundingSphere(),Rd.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;null===t.boundingSphere&&t.computeBoundingSphere(),Rd.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(Rd)}intersectsSprite(e){return Rd.center.set(0,0,0),Rd.radius=.7071067811865476,Rd.applyMatrix4(e.matrixWorld),this.intersectsSphere(Rd)}intersectsSphere(e){const t=this.planes,i=e.center,r=-e.radius;for(let o=0;o<6;o++)if(t[o].distanceToPoint(i)<r)return!1;return!0}intersectsBox(e){const t=this.planes;for(let i=0;i<6;i++){const r=t[i];if(zx.x=r.normal.x>0?e.max.x:e.min.x,zx.y=r.normal.y>0?e.max.y:e.min.y,zx.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(zx)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function A2(){let n=null,e=!1,t=null,i=null;function r(o,a){t(o,a),i=n.requestAnimationFrame(r)}return{start:function(){!0!==e&&null!==t&&(i=n.requestAnimationFrame(r),e=!0)},stop:function(){n.cancelAnimationFrame(i),e=!1},setAnimationLoop:function(o){t=o},setContext:function(o){n=o}}}function VX(n){const e=new WeakMap;return{get:function r(u){return u.isInterleavedBufferAttribute&&(u=u.data),e.get(u)},remove:function o(u){u.isInterleavedBufferAttribute&&(u=u.data);const h=e.get(u);h&&(n.deleteBuffer(h.buffer),e.delete(u))},update:function a(u,h){if(u.isGLBufferAttribute){const g=e.get(u);return void((!g||g.version<u.version)&&e.set(u,{buffer:u.buffer,type:u.type,bytesPerElement:u.elementSize,version:u.version}))}u.isInterleavedBufferAttribute&&(u=u.data);const f=e.get(u);if(void 0===f)e.set(u,function t(u,h){const f=u.array,g=u.usage,_=f.byteLength,x=n.createBuffer();let M;if(n.bindBuffer(h,x),n.bufferData(h,f,g),u.onUploadCallback(),f instanceof Float32Array)M=n.FLOAT;else if(f instanceof Uint16Array)M=u.isFloat16BufferAttribute?n.HALF_FLOAT:n.UNSIGNED_SHORT;else if(f instanceof Int16Array)M=n.SHORT;else if(f instanceof Uint32Array)M=n.UNSIGNED_INT;else if(f instanceof Int32Array)M=n.INT;else if(f instanceof Int8Array)M=n.BYTE;else if(f instanceof Uint8Array)M=n.UNSIGNED_BYTE;else{if(!(f instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+f);M=n.UNSIGNED_BYTE}return{buffer:x,type:M,bytesPerElement:f.BYTES_PER_ELEMENT,version:u.version,size:_}}(u,h));else if(f.version<u.version){if(f.size!==u.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");(function i(u,h,f){const g=h.array,_=h._updateRange,x=h.updateRanges;if(n.bindBuffer(f,u),-1===_.count&&0===x.length&&n.bufferSubData(f,0,g),0!==x.length){for(let M=0,E=x.length;M<E;M++){const D=x[M];n.bufferSubData(f,D.start*g.BYTES_PER_ELEMENT,g,D.start,D.count)}h.clearUpdateRanges()}-1!==_.count&&(n.bufferSubData(f,_.offset*g.BYTES_PER_ELEMENT,g,_.offset,_.count),_.count=-1),h.onUploadCallback()})(f.buffer,u,h),f.version=u.version}}}}class Jv extends Hn{constructor(e=1,t=1,i=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:r};const o=e/2,a=t/2,u=Math.floor(i),h=Math.floor(r),f=u+1,g=h+1,_=e/u,x=t/h,M=[],E=[],D=[],C=[];for(let S=0;S<g;S++){const I=S*x-a;for(let N=0;N<f;N++)E.push(N*_-o,-I,0),D.push(0,0,1),C.push(N/u),C.push(1-S/h)}for(let S=0;S<h;S++)for(let I=0;I<u;I++){const O=I+f*(S+1),ne=I+1+f*(S+1),$=I+1+f*S;M.push(I+f*S,O,$),M.push(O,ne,$)}this.setIndex(M),this.setAttribute("position",new Vt(E,3)),this.setAttribute("normal",new Vt(D,3)),this.setAttribute("uv",new Vt(C,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Jv(e.width,e.height,e.widthSegments,e.heightSegments)}}const Fn={alphahash_fragment:"#ifdef USE_ALPHAHASH\n\tif ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;\n#endif",alphahash_pars_fragment:"#ifdef USE_ALPHAHASH\n\tconst float ALPHA_HASH_SCALE = 0.05;\n\tfloat hash2D( vec2 value ) {\n\t\treturn fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );\n\t}\n\tfloat hash3D( vec3 value ) {\n\t\treturn hash2D( vec2( hash2D( value.xy ), value.z ) );\n\t}\n\tfloat getAlphaHashThreshold( vec3 position ) {\n\t\tfloat maxDeriv = max(\n\t\t\tlength( dFdx( position.xyz ) ),\n\t\t\tlength( dFdy( position.xyz ) )\n\t\t);\n\t\tfloat pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );\n\t\tvec2 pixScales = vec2(\n\t\t\texp2( floor( log2( pixScale ) ) ),\n\t\t\texp2( ceil( log2( pixScale ) ) )\n\t\t);\n\t\tvec2 alpha = vec2(\n\t\t\thash3D( floor( pixScales.x * position.xyz ) ),\n\t\t\thash3D( floor( pixScales.y * position.xyz ) )\n\t\t);\n\t\tfloat lerpFactor = fract( log2( pixScale ) );\n\t\tfloat x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;\n\t\tfloat a = min( lerpFactor, 1.0 - lerpFactor );\n\t\tvec3 cases = vec3(\n\t\t\tx * x / ( 2.0 * a * ( 1.0 - a ) ),\n\t\t\t( x - 0.5 * a ) / ( 1.0 - a ),\n\t\t\t1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )\n\t\t);\n\t\tfloat threshold = ( x < ( 1.0 - a ) )\n\t\t\t? ( ( x < a ) ? cases.x : cases.y )\n\t\t\t: cases.z;\n\t\treturn clamp( threshold , 1.0e-6, 1.0 );\n\t}\n#endif",alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\t#ifdef ALPHA_TO_COVERAGE\n\tdiffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );\n\tif ( diffuseColor.a == 0.0 ) discard;\n\t#else\n\tif ( diffuseColor.a < alphaTest ) discard;\n\t#endif\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_CLEARCOAT ) \n\t\tclearcoatSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_SHEEN ) \n\t\tsheenSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometryNormal, geometryViewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",batching_pars_vertex:"#ifdef USE_BATCHING\n\t#if ! defined( GL_ANGLE_multi_draw )\n\t#define gl_DrawID _gl_DrawID\n\tuniform int _gl_DrawID;\n\t#endif\n\tuniform highp sampler2D batchingTexture;\n\tuniform highp usampler2D batchingIdTexture;\n\tmat4 getBatchingMatrix( const in float i ) {\n\t\tint size = textureSize( batchingTexture, 0 ).x;\n\t\tint j = int( i ) * 4;\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\tvec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );\n\t\tvec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );\n\t\tvec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );\n\t\tvec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );\n\t\treturn mat4( v1, v2, v3, v4 );\n\t}\n\tfloat getIndirectIndex( const in int i ) {\n\t\tint size = textureSize( batchingIdTexture, 0 ).x;\n\t\tint x = i % size;\n\t\tint y = i / size;\n\t\treturn float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );\n\t}\n#endif\n#ifdef USE_BATCHING_COLOR\n\tuniform sampler2D batchingColorTexture;\n\tvec3 getBatchingColor( const in float i ) {\n\t\tint size = textureSize( batchingColorTexture, 0 ).x;\n\t\tint j = int( i );\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\treturn texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;\n\t}\n#endif",batching_vertex:"#ifdef USE_BATCHING\n\tmat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );\n#endif",begin_vertex:"vec3 transformed = vec3( position );\n#ifdef USE_ALPHAHASH\n\tvPosition = vec3( position );\n#endif",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"float G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n} // validated",iridescence_fragment:"#ifdef USE_IRIDESCENCE\n\tconst mat3 XYZ_TO_REC709 = mat3(\n\t\t 3.2404542, -0.9692660,  0.0556434,\n\t\t-1.5371385,  1.8760108, -0.2040259,\n\t\t-0.4985314,  0.0415560,  1.0572252\n\t);\n\tvec3 Fresnel0ToIor( vec3 fresnel0 ) {\n\t\tvec3 sqrtF0 = sqrt( fresnel0 );\n\t\treturn ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n\t}\n\tvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n\t}\n\tfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n\t}\n\tvec3 evalSensitivity( float OPD, vec3 shift ) {\n\t\tfloat phase = 2.0 * PI * OPD * 1.0e-9;\n\t\tvec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n\t\tvec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n\t\tvec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n\t\tvec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n\t\txyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n\t\txyz /= 1.0685e-7;\n\t\tvec3 rgb = XYZ_TO_REC709 * xyz;\n\t\treturn rgb;\n\t}\n\tvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n\t\tvec3 I;\n\t\tfloat iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n\t\tfloat sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n\t\tfloat cosTheta2Sq = 1.0 - sinTheta2Sq;\n\t\tif ( cosTheta2Sq < 0.0 ) {\n\t\t\treturn vec3( 1.0 );\n\t\t}\n\t\tfloat cosTheta2 = sqrt( cosTheta2Sq );\n\t\tfloat R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n\t\tfloat R12 = F_Schlick( R0, 1.0, cosTheta1 );\n\t\tfloat T121 = 1.0 - R12;\n\t\tfloat phi12 = 0.0;\n\t\tif ( iridescenceIOR < outsideIOR ) phi12 = PI;\n\t\tfloat phi21 = PI - phi12;\n\t\tvec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );\t\tvec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n\t\tvec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n\t\tvec3 phi23 = vec3( 0.0 );\n\t\tif ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n\t\tif ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n\t\tif ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n\t\tfloat OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n\t\tvec3 phi = vec3( phi21 ) + phi23;\n\t\tvec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n\t\tvec3 r123 = sqrt( R123 );\n\t\tvec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n\t\tvec3 C0 = R12 + Rs;\n\t\tI = C0;\n\t\tvec3 Cm = Rs - T121;\n\t\tfor ( int m = 1; m <= 2; ++ m ) {\n\t\t\tCm *= r123;\n\t\t\tvec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n\t\t\tI += Cm * Sm;\n\t\t}\n\t\treturn max( I, vec3( 0.0 ) );\n\t}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vBumpMapUv );\n\t\tvec2 dSTdy = dFdy( vBumpMapUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );\n\t\tvec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#ifdef ALPHA_TO_COVERAGE\n\t\tfloat distanceToPlane, distanceGradient;\n\t\tfloat clipOpacity = 1.0;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tdistanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;\n\t\t\tdistanceGradient = fwidth( distanceToPlane ) / 2.0;\n\t\t\tclipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );\n\t\t\tif ( clipOpacity == 0.0 ) discard;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\t\tfloat unionClipOpacity = 1.0;\n\t\t\t#pragma unroll_loop_start\n\t\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\t\tplane = clippingPlanes[ i ];\n\t\t\t\tdistanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;\n\t\t\t\tdistanceGradient = fwidth( distanceToPlane ) / 2.0;\n\t\t\t\tunionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );\n\t\t\t}\n\t\t\t#pragma unroll_loop_end\n\t\t\tclipOpacity *= 1.0 - unionClipOpacity;\n\t\t#endif\n\t\tdiffuseColor.a *= clipOpacity;\n\t\tif ( diffuseColor.a == 0.0 ) discard;\n\t#else\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\t\tbool clipped = true;\n\t\t\t#pragma unroll_loop_start\n\t\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\t\tplane = clippingPlanes[ i ];\n\t\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t\t}\n\t\t\t#pragma unroll_loop_end\n\t\t\tif ( clipped ) discard;\n\t\t#endif\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif\n#ifdef USE_BATCHING_COLOR\n\tvec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );\n\tvColor.xyz *= batchingColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\n#ifdef USE_ALPHAHASH\n\tvarying vec3 vPosition;\n#endif\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat luminance( const in vec3 rgb ) {\n\tconst vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );\n\treturn dot( weights, rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}\nvec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n} // validated",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\thighp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define cubeUV_r0 1.0\n\t#define cubeUV_m0 - 2.0\n\t#define cubeUV_r1 0.8\n\t#define cubeUV_m1 - 1.0\n\t#define cubeUV_r4 0.4\n\t#define cubeUV_m4 2.0\n\t#define cubeUV_r5 0.305\n\t#define cubeUV_m5 3.0\n\t#define cubeUV_r6 0.21\n\t#define cubeUV_m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= cubeUV_r1 ) {\n\t\t\tmip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n\t\t} else if ( roughness >= cubeUV_r4 ) {\n\t\t\tmip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n\t\t} else if ( roughness >= cubeUV_r5 ) {\n\t\t\tmip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n\t\t} else if ( roughness >= cubeUV_r6 ) {\n\t\t\tmip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = objectTangent;\n#endif\n#ifdef USE_BATCHING\n\tmat3 bm = mat3( batchingMatrix );\n\ttransformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );\n\ttransformedNormal = bm * transformedNormal;\n\t#ifdef USE_TANGENT\n\t\ttransformedTangent = bm * transformedTangent;\n\t#endif\n#endif\n#ifdef USE_INSTANCING\n\tmat3 im = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );\n\ttransformedNormal = im * transformedNormal;\n\t#ifdef USE_TANGENT\n\t\ttransformedTangent = im * transformedTangent;\n\t#endif\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\ttransformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",colorspace_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",colorspace_pars_fragment:"\nconst mat3 LINEAR_SRGB_TO_LINEAR_DISPLAY_P3 = mat3(\n\tvec3( 0.8224621, 0.177538, 0.0 ),\n\tvec3( 0.0331941, 0.9668058, 0.0 ),\n\tvec3( 0.0170827, 0.0723974, 0.9105199 )\n);\nconst mat3 LINEAR_DISPLAY_P3_TO_LINEAR_SRGB = mat3(\n\tvec3( 1.2249401, - 0.2249404, 0.0 ),\n\tvec3( - 0.0420569, 1.0420571, 0.0 ),\n\tvec3( - 0.0196376, - 0.0786361, 1.0982735 )\n);\nvec4 LinearSRGBToLinearDisplayP3( in vec4 value ) {\n\treturn vec4( value.rgb * LINEAR_SRGB_TO_LINEAR_DISPLAY_P3, value.a );\n}\nvec4 LinearDisplayP3ToLinearSRGB( in vec4 value ) {\n\treturn vec4( value.rgb * LINEAR_DISPLAY_P3_TO_LINEAR_SRGB, value.a );\n}\nvec4 LinearTransferOETF( in vec4 value ) {\n\treturn value;\n}\nvec4 sRGBTransferOETF( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn sRGBTransferOETF( value );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform mat3 envMapRotation;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#ifdef USE_ENVMAP\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\t#ifdef USE_ANISOTROPY\n\t\tvec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {\n\t\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\t\tvec3 bentNormal = cross( bitangent, viewDir );\n\t\t\t\tbentNormal = normalize( cross( bentNormal, bitangent ) );\n\t\t\t\tbentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );\n\t\t\t\treturn getIBLRadiance( viewDir, bentNormal, roughness );\n\t\t\t#else\n\t\t\t\treturn vec3( 0.0 );\n\t\t\t#endif\n\t\t}\n\t#endif\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\tvec2 fw = fwidth( coord ) * 0.5;\n\t\treturn mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n\t#endif\n}",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_fragment:"LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;",lights_lambert_pars_fragment:"varying vec3 vViewPosition;\nstruct LambertMaterial {\n\tvec3 diffuseColor;\n\tfloat specularStrength;\n};\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Lambert\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Lambert",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\n#if defined( USE_LIGHT_PROBES )\n\tuniform vec3 lightProbe[ 9 ];\n#endif\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif ( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\tmaterial.ior = ior;\n\t#ifdef USE_SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULAR_COLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;\n\t\t#endif\n\t\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_DISPERSION\n\tmaterial.dispersion = dispersion;\n#endif\n#ifdef USE_IRIDESCENCE\n\tmaterial.iridescence = iridescence;\n\tmaterial.iridescenceIOR = iridescenceIOR;\n\t#ifdef USE_IRIDESCENCEMAP\n\t\tmaterial.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;\n\t#endif\n\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\t\tmaterial.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;\n\t#else\n\t\tmaterial.iridescenceThickness = iridescenceThicknessMaximum;\n\t#endif\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\t#ifdef USE_ANISOTROPYMAP\n\t\tmat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );\n\t\tvec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;\n\t\tvec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;\n\t#else\n\t\tvec2 anisotropyV = anisotropyVector;\n\t#endif\n\tmaterial.anisotropy = length( anisotropyV );\n\tif( material.anisotropy == 0.0 ) {\n\t\tanisotropyV = vec2( 1.0, 0.0 );\n\t} else {\n\t\tanisotropyV /= material.anisotropy;\n\t\tmaterial.anisotropy = saturate( material.anisotropy );\n\t}\n\tmaterial.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );\n\tmaterial.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;\n\tmaterial.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\tfloat dispersion;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n\t#ifdef IOR\n\t\tfloat ior;\n\t#endif\n\t#ifdef USE_TRANSMISSION\n\t\tfloat transmission;\n\t\tfloat transmissionAlpha;\n\t\tfloat thickness;\n\t\tfloat attenuationDistance;\n\t\tvec3 attenuationColor;\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat anisotropy;\n\t\tfloat alphaT;\n\t\tvec3 anisotropyT;\n\t\tvec3 anisotropyB;\n\t#endif\n};\nvec3 clearcoatSpecularDirect = vec3( 0.0 );\nvec3 clearcoatSpecularIndirect = vec3( 0.0 );\nvec3 sheenSpecularDirect = vec3( 0.0 );\nvec3 sheenSpecularIndirect = vec3(0.0 );\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\n#ifdef USE_ANISOTROPY\n\tfloat V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {\n\t\tfloat gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );\n\t\tfloat gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );\n\t\tfloat v = 0.5 / ( gv + gl );\n\t\treturn saturate(v);\n\t}\n\tfloat D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {\n\t\tfloat a2 = alphaT * alphaB;\n\t\thighp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );\n\t\thighp float v2 = dot( v, v );\n\t\tfloat w2 = a2 / v2;\n\t\treturn RECIPROCAL_PI * a2 * pow2 ( w2 );\n\t}\n#endif\n#ifdef USE_CLEARCOAT\n\tvec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {\n\t\tvec3 f0 = material.clearcoatF0;\n\t\tfloat f90 = material.clearcoatF90;\n\t\tfloat roughness = material.clearcoatRoughness;\n\t\tfloat alpha = pow2( roughness );\n\t\tvec3 halfDir = normalize( lightDir + viewDir );\n\t\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\t\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\t\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\t\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\t\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t\treturn F * ( V * D );\n\t}\n#endif\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {\n\tvec3 f0 = material.specularColor;\n\tfloat f90 = material.specularF90;\n\tfloat roughness = material.roughness;\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t#ifdef USE_IRIDESCENCE\n\t\tF = mix( F, material.iridescenceFresnel, material.iridescence );\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat dotTL = dot( material.anisotropyT, lightDir );\n\t\tfloat dotTV = dot( material.anisotropyT, viewDir );\n\t\tfloat dotTH = dot( material.anisotropyT, halfDir );\n\t\tfloat dotBL = dot( material.anisotropyB, lightDir );\n\t\tfloat dotBV = dot( material.anisotropyB, viewDir );\n\t\tfloat dotBH = dot( material.anisotropyB, halfDir );\n\t\tfloat V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );\n\t\tfloat D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );\n\t#else\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t#endif\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\t#ifdef USE_IRIDESCENCE\n\t\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n\t#else\n\t\tvec3 Fr = specularColor;\n\t#endif\n\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometryNormal;\n\t\tvec3 viewDir = geometryViewDir;\n\t\tvec3 position = geometryPosition;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t#ifdef USE_IRIDESCENCE\n\t\tcomputeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n\t#else\n\t\tcomputeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\t#endif\n\tvec3 totalScattering = singleScattering + multiScattering;\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nvec3 geometryPosition = - vViewPosition;\nvec3 geometryNormal = normal;\nvec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\nvec3 geometryClearcoatNormal = vec3( 0.0 );\n#ifdef USE_CLEARCOAT\n\tgeometryClearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n\tfloat dotNVi = saturate( dot( normal, geometryViewDir ) );\n\tif ( material.iridescenceThickness == 0.0 ) {\n\t\tmaterial.iridescence = 0.0;\n\t} else {\n\t\tmaterial.iridescence = saturate( material.iridescence );\n\t}\n\tif ( material.iridescence > 0.0 ) {\n\t\tmaterial.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\t\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n\t}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometryPosition, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tvec4 spotColor;\n\tvec3 spotLightCoord;\n\tbool inSpotLightMap;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometryPosition, directLight );\n\t\t#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n\t\t#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n\t\t#else\n\t\t#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#endif\n\t\t#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n\t\t\tspotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n\t\t\tinSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n\t\t\tspotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n\t\t\tdirectLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n\t\t#endif\n\t\t#undef SPOT_LIGHT_MAP_INDEX\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#if defined( USE_LIGHT_PROBES )\n\t\tirradiance += getLightProbeIrradiance( lightProbe, geometryNormal );\n\t#endif\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometryNormal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\t#ifdef USE_ANISOTROPY\n\t\tradiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );\n\t#else\n\t\tradiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF )\n\tgl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\tvFragDepth = 1.0 + gl_Position.w;\n\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vMapUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );\n\t\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t#if defined( USE_POINTS_UV )\n\t\tvec2 uv = vUv;\n\t#else\n\t\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_POINTS_UV )\n\tvarying vec2 vUv;\n#else\n\t#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t\tuniform mat3 uvTransform;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphinstance_vertex:"#ifdef USE_INSTANCING_MORPH\n\tfloat morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\tfloat morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tmorphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;\n\t}\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t}\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\t#ifndef USE_INSTANCING_MORPH\n\t\tuniform float morphTargetBaseInfluence;\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t#endif\n\tuniform sampler2DArray morphTargetsTexture;\n\tuniform ivec2 morphTargetsTextureSize;\n\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t}\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t}\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal *= faceDirection;\n\t#endif\n#endif\n#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn = getTangentFrame( - vViewPosition, normal,\n\t\t#if defined( USE_NORMALMAP )\n\t\t\tvNormalMapUv\n\t\t#elif defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tvClearcoatNormalMapUv\n\t\t#else\n\t\t\tvUv\n\t\t#endif\n\t\t);\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn[0] *= faceDirection;\n\t\ttbn[1] *= faceDirection;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn2[0] *= faceDirection;\n\t\ttbn2[1] *= faceDirection;\n\t#endif\n#endif\nvec3 nonPerturbedNormal = normal;",normal_fragment_maps:"#ifdef USE_NORMALMAP_OBJECTSPACE\n\tnormal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( USE_NORMALMAP_TANGENTSPACE )\n\tvec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\tnormal = normalize( tbn * mapN );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef USE_NORMALMAP_OBJECTSPACE\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )\n\tmat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( uv.st );\n\t\tvec2 st1 = dFdy( uv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );\n\t\treturn mat3( T * scale, B * scale, N );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = nonPerturbedNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\tclearcoatNormal = normalize( tbn2 * clearcoatMapN );\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif",iridescence_pars_fragment:"#ifdef USE_IRIDESCENCEMAP\n\tuniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform sampler2D iridescenceThicknessMap;\n#endif",opaque_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec2 packDepthToRG( in highp float v ) {\n\treturn packDepthToRGBA( v ).yx;\n}\nfloat unpackRGToDepth( const in highp vec2 v ) {\n\treturn unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn depth * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * depth - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_BATCHING\n\tmvPosition = batchingMatrix * mvPosition;\n#endif\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#if NUM_SPOT_LIGHT_MAPS > 0\n\tuniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;\n\t\tbool frustumTest = inFrustum && shadowCoord.z <= 1.0;\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn mix( 1.0, shadow, shadowIntensity );\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tfloat shadow = 1.0;\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\t\n\t\tfloat lightToPositionLength = length( lightToPosition );\n\t\tif ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {\n\t\t\tfloat dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\t\tdp += shadowBias;\n\t\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\t\tshadow = (\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t\t) * ( 1.0 / 9.0 );\n\t\t\t#else\n\t\t\t\tshadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t\t#endif\n\t\t}\n\t\treturn mix( 1.0, shadow, shadowIntensity );\n\t}\n#endif",shadowmap_pars_vertex:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tuniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\tvec4 shadowWorldPosition;\n#endif\n#if defined( USE_SHADOWMAP )\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if NUM_SPOT_LIGHT_COORDS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition;\n\t\t#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t\tshadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n\t\t#endif\n\t\tvSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tint size = textureSize( boneTexture, 0 ).x;\n\t\tint j = int( i ) * 4;\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\tvec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );\n\t\tvec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );\n\t\tvec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );\n\t\tvec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );\n\t\treturn mat4( v1, v2, v3, v4 );\n\t}\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn saturate( toneMappingExposure * color );\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nconst mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(\n\tvec3( 1.6605, - 0.1246, - 0.0182 ),\n\tvec3( - 0.5876, 1.1329, - 0.1006 ),\n\tvec3( - 0.0728, - 0.0083, 1.1187 )\n);\nconst mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(\n\tvec3( 0.6274, 0.0691, 0.0164 ),\n\tvec3( 0.3293, 0.9195, 0.0880 ),\n\tvec3( 0.0433, 0.0113, 0.8956 )\n);\nvec3 agxDefaultContrastApprox( vec3 x ) {\n\tvec3 x2 = x * x;\n\tvec3 x4 = x2 * x2;\n\treturn + 15.5 * x4 * x2\n\t\t- 40.14 * x4 * x\n\t\t+ 31.96 * x4\n\t\t- 6.868 * x2 * x\n\t\t+ 0.4298 * x2\n\t\t+ 0.1191 * x\n\t\t- 0.00232;\n}\nvec3 AgXToneMapping( vec3 color ) {\n\tconst mat3 AgXInsetMatrix = mat3(\n\t\tvec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),\n\t\tvec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),\n\t\tvec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )\n\t);\n\tconst mat3 AgXOutsetMatrix = mat3(\n\t\tvec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),\n\t\tvec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),\n\t\tvec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )\n\t);\n\tconst float AgxMinEv = - 12.47393;\tconst float AgxMaxEv = 4.026069;\n\tcolor *= toneMappingExposure;\n\tcolor = LINEAR_SRGB_TO_LINEAR_REC2020 * color;\n\tcolor = AgXInsetMatrix * color;\n\tcolor = max( color, 1e-10 );\tcolor = log2( color );\n\tcolor = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );\n\tcolor = clamp( color, 0.0, 1.0 );\n\tcolor = agxDefaultContrastApprox( color );\n\tcolor = AgXOutsetMatrix * color;\n\tcolor = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );\n\tcolor = LINEAR_REC2020_TO_LINEAR_SRGB * color;\n\tcolor = clamp( color, 0.0, 1.0 );\n\treturn color;\n}\nvec3 NeutralToneMapping( vec3 color ) {\n\tconst float StartCompression = 0.8 - 0.04;\n\tconst float Desaturation = 0.15;\n\tcolor *= toneMappingExposure;\n\tfloat x = min( color.r, min( color.g, color.b ) );\n\tfloat offset = x < 0.08 ? x - 6.25 * x * x : 0.04;\n\tcolor -= offset;\n\tfloat peak = max( color.r, max( color.g, color.b ) );\n\tif ( peak < StartCompression ) return color;\n\tfloat d = 1. - StartCompression;\n\tfloat newPeak = 1. - d * d / ( peak + d - StartCompression );\n\tcolor *= newPeak / peak;\n\tfloat g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );\n\treturn mix( color, vec3( newPeak ), g );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tmaterial.transmission = transmission;\n\tmaterial.transmissionAlpha = 1.0;\n\tmaterial.thickness = thickness;\n\tmaterial.attenuationDistance = attenuationDistance;\n\tmaterial.attenuationColor = attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tmaterial.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tmaterial.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmitted = getIBLVolumeRefraction(\n\t\tn, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,\n\t\tmaterial.attenuationColor, material.attenuationDistance );\n\tmaterial.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );\n\ttotalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tfloat w0( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );\n\t}\n\tfloat w1( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );\n\t}\n\tfloat w2( float a ){\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );\n\t}\n\tfloat w3( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * a * a );\n\t}\n\tfloat g0( float a ) {\n\t\treturn w0( a ) + w1( a );\n\t}\n\tfloat g1( float a ) {\n\t\treturn w2( a ) + w3( a );\n\t}\n\tfloat h0( float a ) {\n\t\treturn - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );\n\t}\n\tfloat h1( float a ) {\n\t\treturn 1.0 + w3( a ) / ( w2( a ) + w3( a ) );\n\t}\n\tvec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {\n\t\tuv = uv * texelSize.zw + 0.5;\n\t\tvec2 iuv = floor( uv );\n\t\tvec2 fuv = fract( uv );\n\t\tfloat g0x = g0( fuv.x );\n\t\tfloat g1x = g1( fuv.x );\n\t\tfloat h0x = h0( fuv.x );\n\t\tfloat h1x = h1( fuv.x );\n\t\tfloat h0y = h0( fuv.y );\n\t\tfloat h1y = h1( fuv.y );\n\t\tvec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\treturn g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +\n\t\t\tg1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );\n\t}\n\tvec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {\n\t\tvec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );\n\t\tvec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );\n\t\tvec2 fLodSizeInv = 1.0 / fLodSize;\n\t\tvec2 cLodSizeInv = 1.0 / cLodSize;\n\t\tvec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );\n\t\tvec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );\n\t\treturn mix( fSample, cSample, fract( lod ) );\n\t}\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\treturn textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );\n\t}\n\tvec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( isinf( attenuationDistance ) ) {\n\t\t\treturn vec3( 1.0 );\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec4 transmittedLight;\n\t\tvec3 transmittance;\n\t\t#ifdef USE_DISPERSION\n\t\t\tfloat halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;\n\t\t\tvec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );\n\t\t\tfor ( int i = 0; i < 3; i ++ ) {\n\t\t\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );\n\t\t\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\t\n\t\t\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\t\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\t\t\trefractionCoords += 1.0;\n\t\t\t\trefractionCoords /= 2.0;\n\t\t\n\t\t\t\tvec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );\n\t\t\t\ttransmittedLight[ i ] = transmissionSample[ i ];\n\t\t\t\ttransmittedLight.a += transmissionSample.a;\n\t\t\t\ttransmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];\n\t\t\t}\n\t\t\ttransmittedLight.a /= 3.0;\n\t\t\n\t\t#else\n\t\t\n\t\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\t\trefractionCoords += 1.0;\n\t\t\trefractionCoords /= 2.0;\n\t\t\ttransmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\t\ttransmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\t\n\t\t#endif\n\t\tvec3 attenuatedColor = transmittance * transmittedLight.rgb;\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\tfloat transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );\n\t}\n#endif",uv_pars_fragment:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_pars_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tuniform mat3 mapTransform;\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform mat3 alphaMapTransform;\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tuniform mat3 lightMapTransform;\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tuniform mat3 aoMapTransform;\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tuniform mat3 bumpMapTransform;\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tuniform mat3 normalMapTransform;\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tuniform mat3 displacementMapTransform;\n\tvarying vec2 vDisplacementMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tuniform mat3 emissiveMapTransform;\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tuniform mat3 metalnessMapTransform;\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tuniform mat3 roughnessMapTransform;\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tuniform mat3 anisotropyMapTransform;\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tuniform mat3 clearcoatMapTransform;\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform mat3 clearcoatNormalMapTransform;\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform mat3 clearcoatRoughnessMapTransform;\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tuniform mat3 sheenColorMapTransform;\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tuniform mat3 sheenRoughnessMapTransform;\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tuniform mat3 iridescenceMapTransform;\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform mat3 iridescenceThicknessMapTransform;\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tuniform mat3 specularMapTransform;\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tuniform mat3 specularColorMapTransform;\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tuniform mat3 specularIntensityMapTransform;\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvUv = vec3( uv, 1 ).xy;\n#endif\n#ifdef USE_MAP\n\tvMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ALPHAMAP\n\tvAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_LIGHTMAP\n\tvLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_AOMAP\n\tvAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_BUMPMAP\n\tvBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_NORMALMAP\n\tvNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tvDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_METALNESSMAP\n\tvMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULARMAP\n\tvSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tvTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_THICKNESSMAP\n\tvThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_BATCHING\n\t\tworldPosition = batchingMatrix * worldPosition;\n\t#endif\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nuniform float backgroundIntensity;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\ttexColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",backgroundCube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",backgroundCube_frag:"#ifdef ENVMAP_TYPE_CUBE\n\tuniform samplerCube envMap;\n#elif defined( ENVMAP_TYPE_CUBE_UV )\n\tuniform sampler2D envMap;\n#endif\nuniform float flipEnvMap;\nuniform float backgroundBlurriness;\nuniform float backgroundIntensity;\nuniform mat3 backgroundRotation;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );\n\t#else\n\t\tvec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = texColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",depth_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\t#include <morphinstance_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <clipping_planes_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\t#include <morphinstance_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <clipping_planes_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_lambert_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define USE_SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef USE_SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULAR_COLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_DISPERSION\n\tuniform float dispersion;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\tuniform vec2 anisotropyVector;\n\t#ifdef USE_ANISOTROPYMAP\n\t\tuniform sampler2D anisotropyMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;\n\t#endif\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n#ifdef USE_POINTS_UV\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif\nvoid main() {\n\t#ifdef USE_POINTS_UV\n\t\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\t#endif\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <logdepthbuf_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}"},dt={common:{diffuse:{value:new wt(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Nn},alphaMap:{value:null},alphaMapTransform:{value:new Nn},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Nn}},envmap:{envMap:{value:null},envMapRotation:{value:new Nn},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Nn}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Nn}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Nn},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Nn},normalScale:{value:new Ve(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Nn},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Nn}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Nn}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Nn}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new wt(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new wt(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new Nn},alphaTest:{value:0},uvTransform:{value:new Nn}},sprite:{diffuse:{value:new wt(16777215)},opacity:{value:1},center:{value:new Ve(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Nn},alphaMap:{value:null},alphaMapTransform:{value:new Nn},alphaTest:{value:0}}},yl={basic:{uniforms:no([dt.common,dt.specularmap,dt.envmap,dt.aomap,dt.lightmap,dt.fog]),vertexShader:Fn.meshbasic_vert,fragmentShader:Fn.meshbasic_frag},lambert:{uniforms:no([dt.common,dt.specularmap,dt.envmap,dt.aomap,dt.lightmap,dt.emissivemap,dt.bumpmap,dt.normalmap,dt.displacementmap,dt.fog,dt.lights,{emissive:{value:new wt(0)}}]),vertexShader:Fn.meshlambert_vert,fragmentShader:Fn.meshlambert_frag},phong:{uniforms:no([dt.common,dt.specularmap,dt.envmap,dt.aomap,dt.lightmap,dt.emissivemap,dt.bumpmap,dt.normalmap,dt.displacementmap,dt.fog,dt.lights,{emissive:{value:new wt(0)},specular:{value:new wt(1118481)},shininess:{value:30}}]),vertexShader:Fn.meshphong_vert,fragmentShader:Fn.meshphong_frag},standard:{uniforms:no([dt.common,dt.envmap,dt.aomap,dt.lightmap,dt.emissivemap,dt.bumpmap,dt.normalmap,dt.displacementmap,dt.roughnessmap,dt.metalnessmap,dt.fog,dt.lights,{emissive:{value:new wt(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Fn.meshphysical_vert,fragmentShader:Fn.meshphysical_frag},toon:{uniforms:no([dt.common,dt.aomap,dt.lightmap,dt.emissivemap,dt.bumpmap,dt.normalmap,dt.displacementmap,dt.gradientmap,dt.fog,dt.lights,{emissive:{value:new wt(0)}}]),vertexShader:Fn.meshtoon_vert,fragmentShader:Fn.meshtoon_frag},matcap:{uniforms:no([dt.common,dt.bumpmap,dt.normalmap,dt.displacementmap,dt.fog,{matcap:{value:null}}]),vertexShader:Fn.meshmatcap_vert,fragmentShader:Fn.meshmatcap_frag},points:{uniforms:no([dt.points,dt.fog]),vertexShader:Fn.points_vert,fragmentShader:Fn.points_frag},dashed:{uniforms:no([dt.common,dt.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Fn.linedashed_vert,fragmentShader:Fn.linedashed_frag},depth:{uniforms:no([dt.common,dt.displacementmap]),vertexShader:Fn.depth_vert,fragmentShader:Fn.depth_frag},normal:{uniforms:no([dt.common,dt.bumpmap,dt.normalmap,dt.displacementmap,{opacity:{value:1}}]),vertexShader:Fn.meshnormal_vert,fragmentShader:Fn.meshnormal_frag},sprite:{uniforms:no([dt.sprite,dt.fog]),vertexShader:Fn.sprite_vert,fragmentShader:Fn.sprite_frag},background:{uniforms:{uvTransform:{value:new Nn},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:Fn.background_vert,fragmentShader:Fn.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new Nn}},vertexShader:Fn.backgroundCube_vert,fragmentShader:Fn.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Fn.cube_vert,fragmentShader:Fn.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Fn.equirect_vert,fragmentShader:Fn.equirect_frag},distanceRGBA:{uniforms:no([dt.common,dt.displacementmap,{referencePosition:{value:new Q},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Fn.distanceRGBA_vert,fragmentShader:Fn.distanceRGBA_frag},shadow:{uniforms:no([dt.lights,dt.fog,{color:{value:new wt(0)},opacity:{value:1}}]),vertexShader:Fn.shadow_vert,fragmentShader:Fn.shadow_frag}};yl.physical={uniforms:no([yl.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Nn},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Nn},clearcoatNormalScale:{value:new Ve(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Nn},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Nn},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Nn},sheen:{value:0},sheenColor:{value:new wt(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Nn},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Nn},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Nn},transmissionSamplerSize:{value:new Ve},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Nn},attenuationDistance:{value:0},attenuationColor:{value:new wt(0)},specularColor:{value:new wt(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Nn},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Nn},anisotropyVector:{value:new Ve},anisotropyMap:{value:null},anisotropyMapTransform:{value:new Nn}}]),vertexShader:Fn.meshphysical_vert,fragmentShader:Fn.meshphysical_frag};const Gx={r:0,b:0,g:0},Id=new _c,Vq=new cn;function zq(n,e,t,i,r,o,a){const u=new wt(0);let f,g,h=!0===o?0:1,_=null,x=0,M=null;function E(I){let N=!0===I.isScene?I.background:null;return N&&N.isTexture&&(N=(I.backgroundBlurriness>0?t:e).get(N)),N}function S(I,N){I.getRGB(Gx,S2(n)),i.buffers.color.setClear(Gx.r,Gx.g,Gx.b,N,a)}return{getClearColor:function(){return u},setClearColor:function(I,N=1){u.set(I),h=N,S(u,h)},getClearAlpha:function(){return h},setClearAlpha:function(I){h=I,S(u,h)},render:function D(I){let N=!1;const O=E(I);null===O?S(u,h):O&&O.isColor&&(S(O,1),N=!0);const ne=n.xr.getEnvironmentBlendMode();"additive"===ne?i.buffers.color.setClear(0,0,0,1,a):"alpha-blend"===ne&&i.buffers.color.setClear(0,0,0,0,a),(n.autoClear||N)&&(i.buffers.depth.setTest(!0),i.buffers.depth.setMask(!0),i.buffers.color.setMask(!0),n.clear(n.autoClearColor,n.autoClearDepth,n.autoClearStencil))},addToRenderList:function C(I,N){const O=E(N);O&&(O.isCubeTexture||O.mapping===kv)?(void 0===g&&(g=new rs(new ym(1,1,1),new Ec({name:"BackgroundCubeMaterial",uniforms:_m(yl.backgroundCube.uniforms),vertexShader:yl.backgroundCube.vertexShader,fragmentShader:yl.backgroundCube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1})),g.geometry.deleteAttribute("normal"),g.geometry.deleteAttribute("uv"),g.onBeforeRender=function(ne,$,K){this.matrixWorld.copyPosition(K.matrixWorld)},Object.defineProperty(g.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(g)),Id.copy(N.backgroundRotation),Id.x*=-1,Id.y*=-1,Id.z*=-1,O.isCubeTexture&&!1===O.isRenderTargetTexture&&(Id.y*=-1,Id.z*=-1),g.material.uniforms.envMap.value=O,g.material.uniforms.flipEnvMap.value=O.isCubeTexture&&!1===O.isRenderTargetTexture?-1:1,g.material.uniforms.backgroundBlurriness.value=N.backgroundBlurriness,g.material.uniforms.backgroundIntensity.value=N.backgroundIntensity,g.material.uniforms.backgroundRotation.value.setFromMatrix4(Vq.makeRotationFromEuler(Id)),g.material.toneMapped=mi.getTransfer(O.colorSpace)!==ji,(_!==O||x!==O.version||M!==n.toneMapping)&&(g.material.needsUpdate=!0,_=O,x=O.version,M=n.toneMapping),g.layers.enableAll(),I.unshift(g,g.geometry,g.material,0,0,null)):O&&O.isTexture&&(void 0===f&&(f=new rs(new Jv(2,2),new Ec({name:"BackgroundMaterial",uniforms:_m(yl.background.uniforms),vertexShader:yl.background.vertexShader,fragmentShader:yl.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1})),f.geometry.deleteAttribute("normal"),Object.defineProperty(f.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(f)),f.material.uniforms.t2D.value=O,f.material.uniforms.backgroundIntensity.value=N.backgroundIntensity,f.material.toneMapped=mi.getTransfer(O.colorSpace)!==ji,!0===O.matrixAutoUpdate&&O.updateMatrix(),f.material.uniforms.uvTransform.value.copy(O.matrix),(_!==O||x!==O.version||M!==n.toneMapping)&&(f.material.needsUpdate=!0,_=O,x=O.version,M=n.toneMapping),f.layers.enableAll(),I.unshift(f,f.geometry,f.material,0,0,null))}}}function Hq(n,e){const t=n.getParameter(n.MAX_VERTEX_ATTRIBS),i={},r=x(null);let o=r,a=!1;function f(G){return n.bindVertexArray(G)}function g(G){return n.deleteVertexArray(G)}function x(G){const ce=[],Se=[],xe=[];for(let Ce=0;Ce<t;Ce++)ce[Ce]=0,Se[Ce]=0,xe[Ce]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:ce,enabledAttributes:Se,attributeDivisors:xe,object:G,attributes:{},index:null}}function D(){const G=o.newAttributes;for(let ce=0,Se=G.length;ce<Se;ce++)G[ce]=0}function C(G){S(G,0)}function S(G,ce){const xe=o.enabledAttributes,Ce=o.attributeDivisors;o.newAttributes[G]=1,0===xe[G]&&(n.enableVertexAttribArray(G),xe[G]=1),Ce[G]!==ce&&(n.vertexAttribDivisor(G,ce),Ce[G]=ce)}function I(){const G=o.newAttributes,ce=o.enabledAttributes;for(let Se=0,xe=ce.length;Se<xe;Se++)ce[Se]!==G[Se]&&(n.disableVertexAttribArray(Se),ce[Se]=0)}function N(G,ce,Se,xe,Ce,Be,Ae){!0===Ae?n.vertexAttribIPointer(G,ce,Se,Ce,Be):n.vertexAttribPointer(G,ce,Se,xe,Ce,Be)}function oe(){j(),a=!0,o!==r&&(o=r,f(o.object))}function j(){r.geometry=null,r.program=null,r.wireframe=!1}return{setup:function u(G,ce,Se,xe,Ce){let Be=!1;const Ae=function _(G,ce,Se){const xe=!0===Se.wireframe;let Ce=i[G.id];void 0===Ce&&(Ce={},i[G.id]=Ce);let Be=Ce[ce.id];void 0===Be&&(Be={},Ce[ce.id]=Be);let Ae=Be[xe];return void 0===Ae&&(Ae=x(function h(){return n.createVertexArray()}()),Be[xe]=Ae),Ae}(xe,Se,ce);o!==Ae&&(o=Ae,f(o.object)),Be=function M(G,ce,Se,xe){const Ce=o.attributes,Be=ce.attributes;let Ae=0;const Ke=Se.getAttributes();for(const De in Ke)if(Ke[De].location>=0){const Ut=Ce[De];let Rt=Be[De];if(void 0===Rt&&("instanceMatrix"===De&&G.instanceMatrix&&(Rt=G.instanceMatrix),"instanceColor"===De&&G.instanceColor&&(Rt=G.instanceColor)),void 0===Ut||Ut.attribute!==Rt||Rt&&Ut.data!==Rt.data)return!0;Ae++}return o.attributesNum!==Ae||o.index!==xe}(G,xe,Se,Ce),Be&&function E(G,ce,Se,xe){const Ce={},Be=ce.attributes;let Ae=0;const Ke=Se.getAttributes();for(const De in Ke)if(Ke[De].location>=0){let Ut=Be[De];void 0===Ut&&("instanceMatrix"===De&&G.instanceMatrix&&(Ut=G.instanceMatrix),"instanceColor"===De&&G.instanceColor&&(Ut=G.instanceColor));const Rt={};Rt.attribute=Ut,Ut&&Ut.data&&(Rt.data=Ut.data),Ce[De]=Rt,Ae++}o.attributes=Ce,o.attributesNum=Ae,o.index=xe}(G,xe,Se,Ce),null!==Ce&&e.update(Ce,n.ELEMENT_ARRAY_BUFFER),(Be||a)&&(a=!1,function O(G,ce,Se,xe){D();const Ce=xe.attributes,Be=Se.getAttributes(),Ae=ce.defaultAttributeValues;for(const Ke in Be){const De=Be[Ke];if(De.location>=0){let bt=Ce[Ke];if(void 0===bt&&("instanceMatrix"===Ke&&G.instanceMatrix&&(bt=G.instanceMatrix),"instanceColor"===Ke&&G.instanceColor&&(bt=G.instanceColor)),void 0!==bt){const Ut=bt.normalized,Rt=bt.itemSize,Vn=e.get(bt);if(void 0===Vn)continue;const ci=Vn.buffer,Pe=Vn.type,nt=Vn.bytesPerElement,It=Pe===n.INT||Pe===n.UNSIGNED_INT||bt.gpuType===rT;if(bt.isInterleavedBufferAttribute){const pt=bt.data,mn=pt.stride,Dn=bt.offset;if(pt.isInstancedInterleavedBuffer){for(let yn=0;yn<De.locationSize;yn++)S(De.location+yn,pt.meshPerAttribute);!0!==G.isInstancedMesh&&void 0===xe._maxInstanceCount&&(xe._maxInstanceCount=pt.meshPerAttribute*pt.count)}else for(let yn=0;yn<De.locationSize;yn++)C(De.location+yn);n.bindBuffer(n.ARRAY_BUFFER,ci);for(let yn=0;yn<De.locationSize;yn++)N(De.location+yn,Rt/De.locationSize,Pe,Ut,mn*nt,(Dn+Rt/De.locationSize*yn)*nt,It)}else{if(bt.isInstancedBufferAttribute){for(let pt=0;pt<De.locationSize;pt++)S(De.location+pt,bt.meshPerAttribute);!0!==G.isInstancedMesh&&void 0===xe._maxInstanceCount&&(xe._maxInstanceCount=bt.meshPerAttribute*bt.count)}else for(let pt=0;pt<De.locationSize;pt++)C(De.location+pt);n.bindBuffer(n.ARRAY_BUFFER,ci);for(let pt=0;pt<De.locationSize;pt++)N(De.location+pt,Rt/De.locationSize,Pe,Ut,Rt*nt,Rt/De.locationSize*pt*nt,It)}}else if(void 0!==Ae){const Ut=Ae[Ke];if(void 0!==Ut)switch(Ut.length){case 2:n.vertexAttrib2fv(De.location,Ut);break;case 3:n.vertexAttrib3fv(De.location,Ut);break;case 4:n.vertexAttrib4fv(De.location,Ut);break;default:n.vertexAttrib1fv(De.location,Ut)}}}}I()}(G,ce,Se,xe),null!==Ce&&n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e.get(Ce).buffer))},reset:oe,resetDefaultState:j,dispose:function ne(){oe();for(const G in i){const ce=i[G];for(const Se in ce){const xe=ce[Se];for(const Ce in xe)g(xe[Ce].object),delete xe[Ce];delete ce[Se]}delete i[G]}},releaseStatesOfGeometry:function $(G){if(void 0===i[G.id])return;const ce=i[G.id];for(const Se in ce){const xe=ce[Se];for(const Ce in xe)g(xe[Ce].object),delete xe[Ce];delete ce[Se]}delete i[G.id]},releaseStatesOfProgram:function K(G){for(const ce in i){const Se=i[ce];if(void 0===Se[G.id])continue;const xe=Se[G.id];for(const Ce in xe)g(xe[Ce].object),delete xe[Ce];delete Se[G.id]}},initAttributes:D,enableAttribute:C,disableUnusedAttributes:I}}function Gq(n,e,t){let i;function a(f,g,_){0!==_&&(n.drawArraysInstanced(i,f,g,_),t.update(g,i,_))}this.setMode=function r(f){i=f},this.render=function o(f,g){n.drawArrays(i,f,g),t.update(g,i,1)},this.renderInstances=a,this.renderMultiDraw=function u(f,g,_){if(0===_)return;e.get("WEBGL_multi_draw").multiDrawArraysWEBGL(i,f,0,g,0,_);let M=0;for(let E=0;E<_;E++)M+=g[E];t.update(M,i,1)},this.renderMultiDrawInstances=function h(f,g,_,x){if(0===_)return;const M=e.get("WEBGL_multi_draw");if(null===M)for(let E=0;E<f.length;E++)a(f[E],g[E],x[E]);else{M.multiDrawArraysInstancedWEBGL(i,f,0,g,0,x,0,_);let E=0;for(let D=0;D<_;D++)E+=g[D];for(let D=0;D<x.length;D++)t.update(E,i,x[D])}}}function Wq(n,e,t,i){let r;function h($){if("highp"===$){if(n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.HIGH_FLOAT).precision>0&&n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.HIGH_FLOAT).precision>0)return"highp";$="mediump"}return"mediump"===$&&n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.MEDIUM_FLOAT).precision>0&&n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let f=void 0!==t.precision?t.precision:"highp";const g=h(f);g!==f&&(console.warn("THREE.WebGLRenderer:",f,"not supported, using",g,"instead."),f=g);const _=!0===t.logarithmicDepthBuffer,x=n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS),M=n.getParameter(n.MAX_VERTEX_TEXTURE_IMAGE_UNITS);return{isWebGL2:!0,getMaxAnisotropy:function o(){if(void 0!==r)return r;if(!0===e.has("EXT_texture_filter_anisotropic")){const $=e.get("EXT_texture_filter_anisotropic");r=n.getParameter($.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r},getMaxPrecision:h,textureFormatReadable:function a($){return!($!==mo&&i.convert($)!==n.getParameter(n.IMPLEMENTATION_COLOR_READ_FORMAT))},textureTypeReadable:function u($){const K=$===Hv&&(e.has("EXT_color_buffer_half_float")||e.has("EXT_color_buffer_float"));return!($!==pc&&i.convert($)!==n.getParameter(n.IMPLEMENTATION_COLOR_READ_TYPE)&&$!==Po&&!K)},precision:f,logarithmicDepthBuffer:_,maxTextures:x,maxVertexTextures:M,maxTextureSize:n.getParameter(n.MAX_TEXTURE_SIZE),maxCubemapSize:n.getParameter(n.MAX_CUBE_MAP_TEXTURE_SIZE),maxAttributes:n.getParameter(n.MAX_VERTEX_ATTRIBS),maxVertexUniforms:n.getParameter(n.MAX_VERTEX_UNIFORM_VECTORS),maxVaryings:n.getParameter(n.MAX_VARYING_VECTORS),maxFragmentUniforms:n.getParameter(n.MAX_FRAGMENT_UNIFORM_VECTORS),vertexTextures:M>0,maxSamples:n.getParameter(n.MAX_SAMPLES)}}function jq(n){const e=this;let t=null,i=0,r=!1,o=!1;const a=new Dd,u=new Nn,h={value:null,needsUpdate:!1};function g(_,x,M,E){const D=null!==_?_.length:0;let C=null;if(0!==D){if(C=h.value,!0!==E||null===C){const S=M+4*D,I=x.matrixWorldInverse;u.getNormalMatrix(I),(null===C||C.length<S)&&(C=new Float32Array(S));for(let N=0,O=M;N!==D;++N,O+=4)a.copy(_[N]).applyMatrix4(I,u),a.normal.toArray(C,O),C[O+3]=a.constant}h.value=C,h.needsUpdate=!0}return e.numPlanes=D,e.numIntersection=0,C}this.uniform=h,this.numPlanes=0,this.numIntersection=0,this.init=function(_,x){const M=0!==_.length||x||0!==i||r;return r=x,i=_.length,M},this.beginShadows=function(){o=!0,g(null)},this.endShadows=function(){o=!1},this.setGlobalState=function(_,x){t=g(_,x,0)},this.setState=function(_,x,M){const E=_.clippingPlanes,D=_.clipIntersection,C=_.clipShadows,S=n.get(_);if(!r||null===E||0===E.length||o&&!C)o?g(null):function f(){h.value!==t&&(h.value=t,h.needsUpdate=i>0),e.numPlanes=i,e.numIntersection=0}();else{const I=o?0:i,N=4*I;let O=S.clippingState||null;h.value=O,O=g(E,x,N,M);for(let ne=0;ne!==N;++ne)O[ne]=t[ne];S.clippingState=O,this.numIntersection=D?this.numPlanes:0,this.numPlanes+=I}}}function $q(n){let e=new WeakMap;function t(a,u){return 303===u?a.mapping=Ou:304===u&&(a.mapping=wd),a}function r(a){const u=a.target;u.removeEventListener("dispose",r);const h=e.get(u);void 0!==h&&(e.delete(u),h.dispose())}return{get:function i(a){if(a&&a.isTexture){const u=a.mapping;if(303===u||304===u){if(e.has(a))return t(e.get(a).texture,a.mapping);{const h=a.image;if(h&&h.height>0){const f=new UX(h.height);return f.fromEquirectangularTexture(n,a),e.set(a,f),a.addEventListener("dispose",r),t(f.texture,a.mapping)}return null}}}return a},dispose:function o(){e=new WeakMap}}}class cC extends aC{constructor(e=-1,t=1,i=1,r=-1,o=.1,a=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=i,this.bottom=r,this.near=o,this.far=a,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,t,i,r,o,a){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=r,this.view.width=o,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,r=(this.top+this.bottom)/2;let o=i-e,a=i+e,u=r+t,h=r-t;if(null!==this.view&&this.view.enabled){const f=(this.right-this.left)/this.view.fullWidth/this.zoom,g=(this.top-this.bottom)/this.view.fullHeight/this.zoom;o+=f*this.view.offsetX,a=o+f*this.view.width,u-=g*this.view.offsetY,h=u-g*this.view.height}this.projectionMatrix.makeOrthographic(o,a,u,h,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}const D2=[.125,.215,.35,.446,.526,.582],uC=new cC,R2=new wt;let hC=null,dC=0,fC=0,pC=!1;const Ld=(1+Math.sqrt(5))/2,bm=1/Ld,I2=[new Q(-Ld,bm,0),new Q(Ld,bm,0),new Q(-bm,0,Ld),new Q(bm,0,Ld),new Q(0,Ld,-bm),new Q(0,Ld,bm),new Q(-1,1,-1),new Q(1,1,-1),new Q(-1,1,1),new Q(1,1,1)];class P2{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,i=.1,r=100){hC=this._renderer.getRenderTarget(),dC=this._renderer.getActiveCubeFace(),fC=this._renderer.getActiveMipmapLevel(),pC=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(256);const o=this._allocateTargets();return o.depthBuffer=!0,this._sceneToCubeUV(e,i,r,o),t>0&&this._blur(o,0,0,t),this._applyPMREM(o),this._cleanup(o),o}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=O2(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=N2(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(hC,dC,fC),this._renderer.xr.enabled=pC,e.scissorTest=!1,Wx(e,0,0,e.width,e.height)}_fromTexture(e,t){this._setSize(e.mapping===Ou||e.mapping===wd?0===e.image.length?16:e.image[0].width||e.image[0].image.width:e.image.width/4),hC=this._renderer.getRenderTarget(),dC=this._renderer.getActiveCubeFace(),fC=this._renderer.getActiveMipmapLevel(),pC=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const i=t||this._allocateTargets();return this._textureToCubeUV(e,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,i={magFilter:qr,minFilter:qr,generateMipmaps:!1,type:Hv,format:mo,colorSpace:Bu,depthBuffer:!1},r=L2(e,t,i);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=L2(e,t,i);const{_lodMax:o}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function Xq(n){const e=[],t=[],i=[];let r=n;const o=n-4+1+D2.length;for(let a=0;a<o;a++){const u=Math.pow(2,r);t.push(u);let h=1/u;a>n-4?h=D2[a-n+4-1]:0===a&&(h=0),i.push(h);const f=1/(u-2),g=-f,_=1+f,x=[g,g,_,g,_,_,g,g,_,_,g,_],M=6,E=6,D=3,C=2,S=1,I=new Float32Array(D*E*M),N=new Float32Array(C*E*M),O=new Float32Array(S*E*M);for(let $=0;$<M;$++){const K=$%3*2/3-1,oe=$>2?0:-1;I.set([K,oe,0,K+2/3,oe,0,K+2/3,oe+1,0,K,oe,0,K+2/3,oe+1,0,K,oe+1,0],D*E*$),N.set(x,C*E*$),O.set([$,$,$,$,$,$],S*E*$)}const ne=new Hn;ne.setAttribute("position",new Nr(I,D)),ne.setAttribute("uv",new Nr(N,C)),ne.setAttribute("faceIndex",new Nr(O,S)),e.push(ne),r>4&&r--}return{lodPlanes:e,sizeLods:t,sigmas:i}}(o)),this._blurMaterial=function qq(n,e,t){const i=new Float32Array(20),r=new Q(0,1,0);return new Ec({name:"SphericalGaussianBlur",defines:{n:20,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${n}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}(o,e,t)}return r}_compileMaterial(e){const t=new rs(this._lodPlanes[0],e);this._renderer.compile(t,uC)}_sceneToCubeUV(e,t,i,r){const u=new gs(90,1,t,i),h=[1,-1,1,1,1,1],f=[1,1,1,-1,-1,-1],g=this._renderer,_=g.autoClear,x=g.toneMapping;g.getClearColor(R2),g.toneMapping=Nu,g.autoClear=!1;const M=new vl({name:"PMREM.Background",side:1,depthWrite:!1,depthTest:!1}),E=new rs(new ym,M);let D=!1;const C=e.background;C?C.isColor&&(M.color.copy(C),e.background=null,D=!0):(M.color.copy(R2),D=!0);for(let S=0;S<6;S++){const I=S%3;0===I?(u.up.set(0,h[S],0),u.lookAt(f[S],0,0)):1===I?(u.up.set(0,0,h[S]),u.lookAt(0,f[S],0)):(u.up.set(0,h[S],0),u.lookAt(0,0,f[S]));const N=this._cubeSize;Wx(r,I*N,S>2?N:0,N,N),g.setRenderTarget(r),D&&g.render(E,u),g.render(e,u)}E.geometry.dispose(),E.material.dispose(),g.toneMapping=x,g.autoClear=_,e.background=C}_textureToCubeUV(e,t){const i=this._renderer,r=e.mapping===Ou||e.mapping===wd;r?(null===this._cubemapMaterial&&(this._cubemapMaterial=O2()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===e.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=N2());const o=r?this._cubemapMaterial:this._equirectMaterial,a=new rs(this._lodPlanes[0],o);o.uniforms.envMap.value=e;const h=this._cubeSize;Wx(t,0,0,3*h,2*h),i.setRenderTarget(t),i.render(a,uC)}_applyPMREM(e){const t=this._renderer,i=t.autoClear;t.autoClear=!1;const r=this._lodPlanes.length;for(let o=1;o<r;o++){const a=Math.sqrt(this._sigmas[o]*this._sigmas[o]-this._sigmas[o-1]*this._sigmas[o-1]);this._blur(e,o-1,o,a,I2[(r-o-1)%I2.length])}t.autoClear=i}_blur(e,t,i,r,o){const a=this._pingPongRenderTarget;this._halfBlur(e,a,t,i,r,"latitudinal",o),this._halfBlur(a,e,i,i,r,"longitudinal",o)}_halfBlur(e,t,i,r,o,a,u){const h=this._renderer,f=this._blurMaterial;"latitudinal"!==a&&"longitudinal"!==a&&console.error("blur direction must be either latitudinal or longitudinal!");const _=new rs(this._lodPlanes[r],f),x=f.uniforms,M=this._sizeLods[i]-1,E=isFinite(o)?Math.PI/(2*M):2*Math.PI/39,D=o/E,C=isFinite(o)?1+Math.floor(3*D):20;C>20&&console.warn(`sigmaRadians, ${o}, is too large and will clip, as it requested ${C} samples when the maximum is set to 20`);const S=[];let I=0;for(let K=0;K<20;++K){const oe=K/D,j=Math.exp(-oe*oe/2);S.push(j),0===K?I+=j:K<C&&(I+=2*j)}for(let K=0;K<S.length;K++)S[K]=S[K]/I;x.envMap.value=e.texture,x.samples.value=C,x.weights.value=S,x.latitudinal.value="latitudinal"===a,u&&(x.poleAxis.value=u);const{_lodMax:N}=this;x.dTheta.value=E,x.mipInt.value=N-i;const O=this._sizeLods[r];Wx(t,3*O*(r>N-4?r-N+4:0),4*(this._cubeSize-O),3*O,2*O),h.setRenderTarget(t),h.render(_,uC)}}function L2(n,e,t){const i=new Sd(n,e,t);return i.texture.mapping=kv,i.texture.name="PMREM.cubeUv",i.scissorTest=!0,i}function Wx(n,e,t,i,r){n.viewport.set(e,t,i,r),n.scissor.set(e,t,i,r)}function N2(){return new Ec({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function O2(){return new Ec({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function Yq(n){let e=new WeakMap,t=null;function o(u){const h=u.target;h.removeEventListener("dispose",o);const f=e.get(h);void 0!==f&&(e.delete(h),f.dispose())}return{get:function i(u){if(u&&u.isTexture){const h=u.mapping,f=303===h||304===h,g=h===Ou||h===wd;if(f||g){let _=e.get(u);if(u.isRenderTargetTexture&&u.pmremVersion!==(void 0!==_?_.texture.pmremVersion:0))return null===t&&(t=new P2(n)),_=f?t.fromEquirectangular(u,_):t.fromCubemap(u,_),_.texture.pmremVersion=u.pmremVersion,e.set(u,_),_.texture;if(void 0!==_)return _.texture;{const M=u.image;return f&&M&&M.height>0||g&&M&&function r(u){let h=0;for(let g=0;g<6;g++)void 0!==u[g]&&h++;return 6===h}(M)?(null===t&&(t=new P2(n)),_=f?t.fromEquirectangular(u):t.fromCubemap(u),_.texture.pmremVersion=u.pmremVersion,e.set(u,_),u.addEventListener("dispose",o),_.texture):null}}}return u},dispose:function a(){e=new WeakMap,null!==t&&(t.dispose(),t=null)}}}function Zq(n){const e={};function t(i){if(void 0!==e[i])return e[i];let r;switch(i){case"WEBGL_depth_texture":r=n.getExtension("WEBGL_depth_texture")||n.getExtension("MOZ_WEBGL_depth_texture")||n.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=n.getExtension("WEBGL_compressed_texture_s3tc")||n.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=n.getExtension("WEBGL_compressed_texture_pvrtc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=n.getExtension(i)}return e[i]=r,r}return{has:function(i){return null!==t(i)},init:function(){t("EXT_color_buffer_float"),t("WEBGL_clip_cull_distance"),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture"),t("WEBGL_render_shared_exponent")},get:function(i){const r=t(i);return null===r&&HT("THREE.WebGLRenderer: "+i+" extension not supported."),r}}}function Jq(n,e,t,i){const r={},o=new WeakMap;function a(_){const x=_.target;null!==x.index&&e.remove(x.index);for(const E in x.attributes)e.remove(x.attributes[E]);for(const E in x.morphAttributes){const D=x.morphAttributes[E];for(let C=0,S=D.length;C<S;C++)e.remove(D[C])}x.removeEventListener("dispose",a),delete r[x.id];const M=o.get(x);M&&(e.remove(M),o.delete(x)),i.releaseStatesOfGeometry(x),!0===x.isInstancedBufferGeometry&&delete x._maxInstanceCount,t.memory.geometries--}function f(_){const x=[],M=_.index,E=_.attributes.position;let D=0;if(null!==M){const I=M.array;D=M.version;for(let N=0,O=I.length;N<O;N+=3){const ne=I[N+0],$=I[N+1],K=I[N+2];x.push(ne,$,$,K,K,ne)}}else{if(void 0===E)return;D=E.version;for(let N=0,O=E.array.length/3-1;N<O;N+=3){const ne=N+0,$=N+1,K=N+2;x.push(ne,$,$,K,K,ne)}}const C=new(i2(x)?_2:y2)(x,1);C.version=D;const S=o.get(_);S&&e.remove(S),o.set(_,C)}return{get:function u(_,x){return!0===r[x.id]||(x.addEventListener("dispose",a),r[x.id]=!0,t.memory.geometries++),x},update:function h(_){const x=_.attributes;for(const E in x)e.update(x[E],n.ARRAY_BUFFER);const M=_.morphAttributes;for(const E in M){const D=M[E];for(let C=0,S=D.length;C<S;C++)e.update(D[C],n.ARRAY_BUFFER)}},getWireframeAttribute:function g(_){const x=o.get(_);if(x){const M=_.index;null!==M&&x.version<M.version&&f(_)}else f(_);return o.get(_)}}}function Kq(n,e,t){let i,o,a;function f(x,M,E){0!==E&&(n.drawElementsInstanced(i,M,o,x*a,E),t.update(M,i,E))}this.setMode=function r(x){i=x},this.setIndex=function u(x){o=x.type,a=x.bytesPerElement},this.render=function h(x,M){n.drawElements(i,M,o,x*a),t.update(M,i,1)},this.renderInstances=f,this.renderMultiDraw=function g(x,M,E){if(0===E)return;e.get("WEBGL_multi_draw").multiDrawElementsWEBGL(i,M,0,o,x,0,E);let C=0;for(let S=0;S<E;S++)C+=M[S];t.update(C,i,1)},this.renderMultiDrawInstances=function _(x,M,E,D){if(0===E)return;const C=e.get("WEBGL_multi_draw");if(null===C)for(let S=0;S<x.length;S++)f(x[S]/a,M[S],D[S]);else{C.multiDrawElementsInstancedWEBGL(i,M,0,o,x,0,D,0,E);let S=0;for(let I=0;I<E;I++)S+=M[I];for(let I=0;I<D.length;I++)t.update(S,i,D[I])}}}function Qq(n){const t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function r(){t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function i(o,a,u){switch(t.calls++,a){case n.TRIANGLES:t.triangles+=u*(o/3);break;case n.LINES:t.lines+=u*(o/2);break;case n.LINE_STRIP:t.lines+=u*(o-1);break;case n.LINE_LOOP:t.lines+=u*o;break;case n.POINTS:t.points+=u*o;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",a)}}}}function e7(n,e,t){const i=new WeakMap,r=new wi;return{update:function o(a,u,h){const f=a.morphTargetInfluences,g=u.morphAttributes.position||u.morphAttributes.normal||u.morphAttributes.color,_=void 0!==g?g.length:0;let x=i.get(u);if(void 0===x||x.count!==_){let j=function(){K.dispose(),i.delete(u),u.removeEventListener("dispose",j)};void 0!==x&&x.texture.dispose();const M=void 0!==u.morphAttributes.position,E=void 0!==u.morphAttributes.normal,D=void 0!==u.morphAttributes.color,C=u.morphAttributes.position||[],S=u.morphAttributes.normal||[],I=u.morphAttributes.color||[];let N=0;!0===M&&(N=1),!0===E&&(N=2),!0===D&&(N=3);let O=u.attributes.position.count*N,ne=1;O>e.maxTextureSize&&(ne=Math.ceil(O/e.maxTextureSize),O=e.maxTextureSize);const $=new Float32Array(O*ne*4*_),K=new jT($,O,ne,_);K.type=Po,K.needsUpdate=!0;const oe=4*N;for(let G=0;G<_;G++){const ce=C[G],Se=S[G],xe=I[G],Ce=O*ne*4*G;for(let Be=0;Be<ce.count;Be++){const Ae=Be*oe;!0===M&&(r.fromBufferAttribute(ce,Be),$[Ce+Ae+0]=r.x,$[Ce+Ae+1]=r.y,$[Ce+Ae+2]=r.z,$[Ce+Ae+3]=0),!0===E&&(r.fromBufferAttribute(Se,Be),$[Ce+Ae+4]=r.x,$[Ce+Ae+5]=r.y,$[Ce+Ae+6]=r.z,$[Ce+Ae+7]=0),!0===D&&(r.fromBufferAttribute(xe,Be),$[Ce+Ae+8]=r.x,$[Ce+Ae+9]=r.y,$[Ce+Ae+10]=r.z,$[Ce+Ae+11]=4===xe.itemSize?r.w:1)}}x={count:_,texture:K,size:new Ve(O,ne)},i.set(u,x),u.addEventListener("dispose",j)}if(!0===a.isInstancedMesh&&null!==a.morphTexture)h.getUniforms().setValue(n,"morphTexture",a.morphTexture,t);else{let M=0;for(let D=0;D<f.length;D++)M+=f[D];const E=u.morphTargetsRelative?1:1-M;h.getUniforms().setValue(n,"morphTargetBaseInfluence",E),h.getUniforms().setValue(n,"morphTargetInfluences",f)}h.getUniforms().setValue(n,"morphTargetsTexture",x.texture,t),h.getUniforms().setValue(n,"morphTargetsTextureSize",x.size)}}}function t7(n,e,t,i){let r=new WeakMap;function u(h){const f=h.target;f.removeEventListener("dispose",u),t.remove(f.instanceMatrix),null!==f.instanceColor&&t.remove(f.instanceColor)}return{update:function o(h){const f=i.render.frame,_=e.get(h,h.geometry);if(r.get(_)!==f&&(e.update(_),r.set(_,f)),h.isInstancedMesh&&(!1===h.hasEventListener("dispose",u)&&h.addEventListener("dispose",u),r.get(h)!==f&&(t.update(h.instanceMatrix,n.ARRAY_BUFFER),null!==h.instanceColor&&t.update(h.instanceColor,n.ARRAY_BUFFER),r.set(h,f))),h.isSkinnedMesh){const x=h.skeleton;r.get(x)!==f&&(x.update(),r.set(x,f))}return _},dispose:function a(){r=new WeakMap}}}class F2 extends gc{constructor(e,t,i,r,o,a,u,h,f,g=qp){if(g!==qp&&g!==Yp)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===i&&g===qp&&(i=Fu),void 0===i&&g===Yp&&(i=Xp),super(null,r,o,a,u,h,g,i,f),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=void 0!==u?u:ms,this.minFilter=void 0!==h?h:ms,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return null!==this.compareFunction&&(t.compareFunction=this.compareFunction),t}}const U2=new gc,B2=new F2(1,1),k2=new jT,V2=new a2,z2=new Vx,H2=[],G2=[],W2=new Float32Array(16),j2=new Float32Array(9),$2=new Float32Array(4);function Em(n,e,t){const i=n[0];if(i<=0||i>0)return n;const r=e*t;let o=H2[r];if(void 0===o&&(o=new Float32Array(r),H2[r]=o),0!==e){i.toArray(o,0);for(let a=1,u=0;a!==e;++a)u+=t,n[a].toArray(o,u)}return o}function Yr(n,e){if(n.length!==e.length)return!1;for(let t=0,i=n.length;t<i;t++)if(n[t]!==e[t])return!1;return!0}function Zr(n,e){for(let t=0,i=e.length;t<i;t++)n[t]=e[t]}function jx(n,e){let t=G2[e];void 0===t&&(t=new Int32Array(e),G2[e]=t);for(let i=0;i!==e;++i)t[i]=n.allocateTextureUnit();return t}function n7(n,e){const t=this.cache;t[0]!==e&&(n.uniform1f(this.addr,e),t[0]=e)}function i7(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Yr(t,e))return;n.uniform2fv(this.addr,e),Zr(t,e)}}function r7(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(void 0!==e.r)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(n.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(Yr(t,e))return;n.uniform3fv(this.addr,e),Zr(t,e)}}function s7(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Yr(t,e))return;n.uniform4fv(this.addr,e),Zr(t,e)}}function o7(n,e){const t=this.cache,i=e.elements;if(void 0===i){if(Yr(t,e))return;n.uniformMatrix2fv(this.addr,!1,e),Zr(t,e)}else{if(Yr(t,i))return;$2.set(i),n.uniformMatrix2fv(this.addr,!1,$2),Zr(t,i)}}function a7(n,e){const t=this.cache,i=e.elements;if(void 0===i){if(Yr(t,e))return;n.uniformMatrix3fv(this.addr,!1,e),Zr(t,e)}else{if(Yr(t,i))return;j2.set(i),n.uniformMatrix3fv(this.addr,!1,j2),Zr(t,i)}}function l7(n,e){const t=this.cache,i=e.elements;if(void 0===i){if(Yr(t,e))return;n.uniformMatrix4fv(this.addr,!1,e),Zr(t,e)}else{if(Yr(t,i))return;W2.set(i),n.uniformMatrix4fv(this.addr,!1,W2),Zr(t,i)}}function c7(n,e){const t=this.cache;t[0]!==e&&(n.uniform1i(this.addr,e),t[0]=e)}function u7(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2i(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Yr(t,e))return;n.uniform2iv(this.addr,e),Zr(t,e)}}function h7(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3i(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(Yr(t,e))return;n.uniform3iv(this.addr,e),Zr(t,e)}}function d7(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4i(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Yr(t,e))return;n.uniform4iv(this.addr,e),Zr(t,e)}}function f7(n,e){const t=this.cache;t[0]!==e&&(n.uniform1ui(this.addr,e),t[0]=e)}function p7(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2ui(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Yr(t,e))return;n.uniform2uiv(this.addr,e),Zr(t,e)}}function m7(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3ui(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(Yr(t,e))return;n.uniform3uiv(this.addr,e),Zr(t,e)}}function g7(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4ui(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Yr(t,e))return;n.uniform4uiv(this.addr,e),Zr(t,e)}}function v7(n,e,t){const i=this.cache,r=t.allocateTextureUnit();let o;i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r),this.type===n.SAMPLER_2D_SHADOW?(B2.compareFunction=515,o=B2):o=U2,t.setTexture2D(e||o,r)}function y7(n,e,t){const i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r),t.setTexture3D(e||V2,r)}function _7(n,e,t){const i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r),t.setTextureCube(e||z2,r)}function x7(n,e,t){const i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r),t.setTexture2DArray(e||k2,r)}function w7(n,e){n.uniform1fv(this.addr,e)}function b7(n,e){const t=Em(e,this.size,2);n.uniform2fv(this.addr,t)}function E7(n,e){const t=Em(e,this.size,3);n.uniform3fv(this.addr,t)}function S7(n,e){const t=Em(e,this.size,4);n.uniform4fv(this.addr,t)}function T7(n,e){const t=Em(e,this.size,4);n.uniformMatrix2fv(this.addr,!1,t)}function C7(n,e){const t=Em(e,this.size,9);n.uniformMatrix3fv(this.addr,!1,t)}function A7(n,e){const t=Em(e,this.size,16);n.uniformMatrix4fv(this.addr,!1,t)}function D7(n,e){n.uniform1iv(this.addr,e)}function R7(n,e){n.uniform2iv(this.addr,e)}function I7(n,e){n.uniform3iv(this.addr,e)}function P7(n,e){n.uniform4iv(this.addr,e)}function L7(n,e){n.uniform1uiv(this.addr,e)}function N7(n,e){n.uniform2uiv(this.addr,e)}function O7(n,e){n.uniform3uiv(this.addr,e)}function F7(n,e){n.uniform4uiv(this.addr,e)}function U7(n,e,t){const i=this.cache,r=e.length,o=jx(t,r);Yr(i,o)||(n.uniform1iv(this.addr,o),Zr(i,o));for(let a=0;a!==r;++a)t.setTexture2D(e[a]||U2,o[a])}function B7(n,e,t){const i=this.cache,r=e.length,o=jx(t,r);Yr(i,o)||(n.uniform1iv(this.addr,o),Zr(i,o));for(let a=0;a!==r;++a)t.setTexture3D(e[a]||V2,o[a])}function k7(n,e,t){const i=this.cache,r=e.length,o=jx(t,r);Yr(i,o)||(n.uniform1iv(this.addr,o),Zr(i,o));for(let a=0;a!==r;++a)t.setTextureCube(e[a]||z2,o[a])}function V7(n,e,t){const i=this.cache,r=e.length,o=jx(t,r);Yr(i,o)||(n.uniform1iv(this.addr,o),Zr(i,o));for(let a=0;a!==r;++a)t.setTexture2DArray(e[a]||k2,o[a])}class H7{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.type=t.type,this.setValue=function M7(n){switch(n){case 5126:return n7;case 35664:return i7;case 35665:return r7;case 35666:return s7;case 35674:return o7;case 35675:return a7;case 35676:return l7;case 5124:case 35670:return c7;case 35667:case 35671:return u7;case 35668:case 35672:return h7;case 35669:case 35673:return d7;case 5125:return f7;case 36294:return p7;case 36295:return m7;case 36296:return g7;case 35678:case 36198:case 36298:case 36306:case 35682:return v7;case 35679:case 36299:case 36307:return y7;case 35680:case 36300:case 36308:case 36293:return _7;case 36289:case 36303:case 36311:case 36292:return x7}}(t.type)}}class G7{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.type=t.type,this.size=t.size,this.setValue=function z7(n){switch(n){case 5126:return w7;case 35664:return b7;case 35665:return E7;case 35666:return S7;case 35674:return T7;case 35675:return C7;case 35676:return A7;case 5124:case 35670:return D7;case 35667:case 35671:return R7;case 35668:case 35672:return I7;case 35669:case 35673:return P7;case 5125:return L7;case 36294:return N7;case 36295:return O7;case 36296:return F7;case 35678:case 36198:case 36298:case 36306:case 35682:return U7;case 35679:case 36299:case 36307:return B7;case 35680:case 36300:case 36308:case 36293:return k7;case 36289:case 36303:case 36311:case 36292:return V7}}(t.type)}}class W7{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,i){const r=this.seq;for(let o=0,a=r.length;o!==a;++o){const u=r[o];u.setValue(e,t[u.id],i)}}}const gC=/(\w+)(\])?(\[|\.)?/g;function X2(n,e){n.seq.push(e),n.map[e.id]=e}function j7(n,e,t){const i=n.name,r=i.length;for(gC.lastIndex=0;;){const o=gC.exec(i);let u=o[1];const f=o[3];if("]"===o[2]&&(u|=0),void 0===f||"["===f&&gC.lastIndex+2===r){X2(t,void 0===f?new H7(u,n,e):new G7(u,n,e));break}{let _=t.map[u];void 0===_&&(_=new W7(u),X2(t,_)),t=_}}}class $x{constructor(e,t){this.seq=[],this.map={};const i=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let r=0;r<i;++r){const o=e.getActiveUniform(t,r);j7(o,e.getUniformLocation(t,o.name),this)}}setValue(e,t,i,r){const o=this.map[t];void 0!==o&&o.setValue(e,i,r)}setOptional(e,t,i){const r=t[i];void 0!==r&&this.setValue(e,i,r)}static upload(e,t,i,r){for(let o=0,a=t.length;o!==a;++o){const u=t[o],h=i[u.id];!1!==h.needsUpdate&&u.setValue(e,h.value,r)}}static seqWithValue(e,t){const i=[];for(let r=0,o=e.length;r!==o;++r){const a=e[r];a.id in t&&i.push(a)}return i}}function q2(n,e,t){const i=n.createShader(e);return n.shaderSource(i,t),n.compileShader(i),i}const $7=37297;let X7=0;function Y2(n,e,t){const i=n.getShaderParameter(e,n.COMPILE_STATUS),r=n.getShaderInfoLog(e).trim();if(i&&""===r)return"";const o=/ERROR: 0:(\d+)/.exec(r);if(o){const a=parseInt(o[1]);return t.toUpperCase()+"\n\n"+r+"\n\n"+function q7(n,e){const t=n.split("\n"),i=[],r=Math.max(e-6,0),o=Math.min(e+6,t.length);for(let a=r;a<o;a++){const u=a+1;i.push(`${u===e?">":" "} ${u}: ${t[a]}`)}return i.join("\n")}(n.getShaderSource(e),a)}return r}function Z7(n,e){const t=function Y7(n){const e=mi.getPrimaries(mi.workingColorSpace),t=mi.getPrimaries(n);let i;switch(e===t?i="":e===_x&&t===yx?i="LinearDisplayP3ToLinearSRGB":e===yx&&t===_x&&(i="LinearSRGBToLinearDisplayP3"),n){case Bu:case gx:return[i,"LinearTransferOETF"];case Ba:case kT:return[i,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",n),[i,"LinearTransferOETF"]}}(e);return`vec4 ${n}( vec4 value ) { return ${t[0]}( ${t[1]}( value ) ); }`}function J7(n,e){let t;switch(e){case R$:t="Linear";break;case I$:t="Reinhard";break;case P$:t="OptimizedCineon";break;case L$:t="ACESFilmic";break;case O$:t="AgX";break;case F$:t="Neutral";break;case N$:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+n+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}function Kv(n){return""!==n}function Z2(n,e){const t=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return n.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,t).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function J2(n,e){return n.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const tY=/^[ \t]*#include +<([\w\d./]+)>/gm;function vC(n){return n.replace(tY,iY)}const nY=new Map;function iY(n,e){let t=Fn[e];if(void 0===t){const i=nY.get(e);if(void 0===i)throw new Error("Can not resolve #include <"+e+">");t=Fn[i],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,i)}return vC(t)}const rY=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function K2(n){return n.replace(rY,sY)}function sY(n,e,t,i){let r="";for(let o=parseInt(e);o<parseInt(t);o++)r+=i.replace(/\[\s*i\s*\]/g,"[ "+o+" ]").replace(/UNROLLED_LOOP_INDEX/g,o);return r}function Q2(n){let e=`precision ${n.precision} float;\n\tprecision ${n.precision} int;\n\tprecision ${n.precision} sampler2D;\n\tprecision ${n.precision} samplerCube;\n\tprecision ${n.precision} sampler3D;\n\tprecision ${n.precision} sampler2DArray;\n\tprecision ${n.precision} sampler2DShadow;\n\tprecision ${n.precision} samplerCubeShadow;\n\tprecision ${n.precision} sampler2DArrayShadow;\n\tprecision ${n.precision} isampler2D;\n\tprecision ${n.precision} isampler3D;\n\tprecision ${n.precision} isamplerCube;\n\tprecision ${n.precision} isampler2DArray;\n\tprecision ${n.precision} usampler2D;\n\tprecision ${n.precision} usampler3D;\n\tprecision ${n.precision} usamplerCube;\n\tprecision ${n.precision} usampler2DArray;\n\t`;return"highp"===n.precision?e+="\n#define HIGH_PRECISION":"mediump"===n.precision?e+="\n#define MEDIUM_PRECISION":"lowp"===n.precision&&(e+="\n#define LOW_PRECISION"),e}function hY(n,e,t,i){const r=n.getContext(),o=t.defines;let a=t.vertexShader,u=t.fragmentShader;const h=function oY(n){let e="SHADOWMAP_TYPE_BASIC";return n.shadowMapType===BO?e="SHADOWMAP_TYPE_PCF":n.shadowMapType===n$?e="SHADOWMAP_TYPE_PCF_SOFT":n.shadowMapType===hc&&(e="SHADOWMAP_TYPE_VSM"),e}(t),f=function aY(n){let e="ENVMAP_TYPE_CUBE";if(n.envMap)switch(n.envMapMode){case Ou:case wd:e="ENVMAP_TYPE_CUBE";break;case kv:e="ENVMAP_TYPE_CUBE_UV"}return e}(t),g=function lY(n){let e="ENVMAP_MODE_REFLECTION";return n.envMap&&n.envMapMode===wd&&(e="ENVMAP_MODE_REFRACTION"),e}(t),_=function cY(n){let e="ENVMAP_BLENDING_NONE";if(n.envMap)switch(n.combine){case ix:e="ENVMAP_BLENDING_MULTIPLY";break;case A$:e="ENVMAP_BLENDING_MIX";break;case D$:e="ENVMAP_BLENDING_ADD"}return e}(t),x=function uY(n){const e=n.envMapCubeUVHeight;if(null===e)return null;const t=Math.log2(e)-2,i=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),112)),texelHeight:i,maxMip:t}}(t),M=function K7(n){return[n.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",n.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(Kv).join("\n")}(t),E=function Q7(n){const e=[];for(const t in n){const i=n[t];!1!==i&&e.push("#define "+t+" "+i)}return e.join("\n")}(o),D=r.createProgram();let C,S,I=t.glslVersion?"#version "+t.glslVersion+"\n":"";t.isRawShaderMaterial?(C=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,E].filter(Kv).join("\n"),C.length>0&&(C+="\n"),S=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,E].filter(Kv).join("\n"),S.length>0&&(S+="\n")):(C=[Q2(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,E,t.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",t.batching?"#define USE_BATCHING":"",t.batchingColor?"#define USE_BATCHING_COLOR":"",t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.instancingMorph?"#define USE_INSTANCING_MORPH":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+g:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.displacementMap?"#define USE_DISPLACEMENTMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.mapUv?"#define MAP_UV "+t.mapUv:"",t.alphaMapUv?"#define ALPHAMAP_UV "+t.alphaMapUv:"",t.lightMapUv?"#define LIGHTMAP_UV "+t.lightMapUv:"",t.aoMapUv?"#define AOMAP_UV "+t.aoMapUv:"",t.emissiveMapUv?"#define EMISSIVEMAP_UV "+t.emissiveMapUv:"",t.bumpMapUv?"#define BUMPMAP_UV "+t.bumpMapUv:"",t.normalMapUv?"#define NORMALMAP_UV "+t.normalMapUv:"",t.displacementMapUv?"#define DISPLACEMENTMAP_UV "+t.displacementMapUv:"",t.metalnessMapUv?"#define METALNESSMAP_UV "+t.metalnessMapUv:"",t.roughnessMapUv?"#define ROUGHNESSMAP_UV "+t.roughnessMapUv:"",t.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+t.anisotropyMapUv:"",t.clearcoatMapUv?"#define CLEARCOATMAP_UV "+t.clearcoatMapUv:"",t.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+t.clearcoatNormalMapUv:"",t.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+t.clearcoatRoughnessMapUv:"",t.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+t.iridescenceMapUv:"",t.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+t.iridescenceThicknessMapUv:"",t.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+t.sheenColorMapUv:"",t.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+t.sheenRoughnessMapUv:"",t.specularMapUv?"#define SPECULARMAP_UV "+t.specularMapUv:"",t.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+t.specularColorMapUv:"",t.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+t.specularIntensityMapUv:"",t.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+t.transmissionMapUv:"",t.thicknessMapUv?"#define THICKNESSMAP_UV "+t.thicknessMapUv:"",t.vertexTangents&&!1===t.flatShading?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&!1===t.flatShading?"#define USE_MORPHNORMALS":"",t.morphColors?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+h:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","\tuniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","\tattribute vec2 uv1;","#endif","#ifdef USE_UV2","\tattribute vec2 uv2;","#endif","#ifdef USE_UV3","\tattribute vec2 uv3;","#endif","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(Kv).join("\n"),S=[Q2(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,E,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+f:"",t.envMap?"#define "+g:"",t.envMap?"#define "+_:"",x?"#define CUBEUV_TEXEL_WIDTH "+x.texelWidth:"",x?"#define CUBEUV_TEXEL_HEIGHT "+x.texelHeight:"",x?"#define CUBEUV_MAX_MIP "+x.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.dispersion?"#define USE_DISPERSION":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents&&!1===t.flatShading?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor||t.batchingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+h:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==Nu?"#define TONE_MAPPING":"",t.toneMapping!==Nu?Fn.tonemapping_pars_fragment:"",t.toneMapping!==Nu?J7("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",Fn.colorspace_pars_fragment,Z7("linearToOutputTexel",t.outputColorSpace),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"","\n"].filter(Kv).join("\n")),a=vC(a),a=Z2(a,t),a=J2(a,t),u=vC(u),u=Z2(u,t),u=J2(u,t),a=K2(a),u=K2(u),!0!==t.isRawShaderMaterial&&(I="#version 300 es\n",C=[M,"#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+C,S=["#define varying in",t.glslVersion===t2?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===t2?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+S);const O=I+S+u,ne=q2(r,r.VERTEX_SHADER,I+C+a),$=q2(r,r.FRAGMENT_SHADER,O);function K(ce){if(n.debug.checkShaderErrors){const Se=r.getProgramInfoLog(D).trim(),xe=r.getShaderInfoLog(ne).trim(),Ce=r.getShaderInfoLog($).trim();let Be=!0,Ae=!0;if(!1===r.getProgramParameter(D,r.LINK_STATUS))if(Be=!1,"function"==typeof n.debug.onShaderError)n.debug.onShaderError(r,D,ne,$);else{const Ke=Y2(r,ne,"vertex"),De=Y2(r,$,"fragment");console.error("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(D,r.VALIDATE_STATUS)+"\n\nMaterial Name: "+ce.name+"\nMaterial Type: "+ce.type+"\n\nProgram Info Log: "+Se+"\n"+Ke+"\n"+De)}else""!==Se?console.warn("THREE.WebGLProgram: Program Info Log:",Se):(""===xe||""===Ce)&&(Ae=!1);Ae&&(ce.diagnostics={runnable:Be,programLog:Se,vertexShader:{log:xe,prefix:C},fragmentShader:{log:Ce,prefix:S}})}r.deleteShader(ne),r.deleteShader($),oe=new $x(r,D),j=function eY(n,e){const t={},i=n.getProgramParameter(e,n.ACTIVE_ATTRIBUTES);for(let r=0;r<i;r++){const o=n.getActiveAttrib(e,r),a=o.name;let u=1;o.type===n.FLOAT_MAT2&&(u=2),o.type===n.FLOAT_MAT3&&(u=3),o.type===n.FLOAT_MAT4&&(u=4),t[a]={type:o.type,location:n.getAttribLocation(e,a),locationSize:u}}return t}(r,D)}let oe,j;r.attachShader(D,ne),r.attachShader(D,$),void 0!==t.index0AttributeName?r.bindAttribLocation(D,0,t.index0AttributeName):!0===t.morphTargets&&r.bindAttribLocation(D,0,"position"),r.linkProgram(D),this.getUniforms=function(){return void 0===oe&&K(this),oe},this.getAttributes=function(){return void 0===j&&K(this),j};let G=!1===t.rendererExtensionParallelShaderCompile;return this.isReady=function(){return!1===G&&(G=r.getProgramParameter(D,$7)),G},this.destroy=function(){i.releaseStatesOfProgram(this),r.deleteProgram(D),this.program=void 0},this.type=t.shaderType,this.name=t.shaderName,this.id=X7++,this.cacheKey=e,this.usedTimes=1,this.program=D,this.vertexShader=ne,this.fragmentShader=$,this}let dY=0;class fY{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const i=e.fragmentShader,r=this._getShaderStage(e.vertexShader),o=this._getShaderStage(i),a=this._getShaderCacheForMaterial(e);return!1===a.has(r)&&(a.add(r),r.usedTimes++),!1===a.has(o)&&(a.add(o),o.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const i of t)i.usedTimes--,0===i.usedTimes&&this.shaderCache.delete(i.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let i=t.get(e);return void 0===i&&(i=new Set,t.set(e,i)),i}_getShaderStage(e){const t=this.shaderCache;let i=t.get(e);return void 0===i&&(i=new pY(e),t.set(e,i)),i}}class pY{constructor(e){this.id=dY++,this.code=e,this.usedTimes=0}}function mY(n,e,t,i,r,o,a){const u=new KT,h=new fY,f=new Set,g=[],_=r.logarithmicDepthBuffer,x=r.vertexTextures;let M=r.precision;const E={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function D(j){return f.add(j),0===j?"uv":`uv${j}`}return{getParameters:function C(j,G,ce,Se,xe){const Ce=Se.fog,Be=xe.geometry,Ke=(j.isMeshStandardMaterial?t:e).get(j.envMap||(j.isMeshStandardMaterial?Se.environment:null)),De=Ke&&Ke.mapping===kv?Ke.image.height:null,bt=E[j.type];null!==j.precision&&(M=r.getMaxPrecision(j.precision),M!==j.precision&&console.warn("THREE.WebGLProgram.getParameters:",j.precision,"not supported, using",M,"instead."));const Ut=Be.morphAttributes.position||Be.morphAttributes.normal||Be.morphAttributes.color,Rt=void 0!==Ut?Ut.length:0;let ci,Pe,nt,It,Vn=0;if(void 0!==Be.morphAttributes.position&&(Vn=1),void 0!==Be.morphAttributes.normal&&(Vn=2),void 0!==Be.morphAttributes.color&&(Vn=3),bt){const gi=yl[bt];ci=gi.vertexShader,Pe=gi.fragmentShader}else ci=j.vertexShader,Pe=j.fragmentShader,h.update(j),nt=h.getVertexShaderID(j),It=h.getFragmentShaderID(j);const pt=n.getRenderTarget(),mn=!0===xe.isInstancedMesh,Dn=!0===xe.isBatchedMesh,yn=!!j.map,Y=!!Ke,it=!!j.aoMap,Ze=!!j.lightMap,gt=!!j.bumpMap,Ue=!!j.normalMap,rn=!!j.displacementMap,vt=!!j.emissiveMap,Ft=!!j.metalnessMap,re=!!j.roughnessMap,W=j.anisotropy>0,we=j.clearcoat>0,Xe=j.iridescence>0,We=j.sheen>0,Jt=j.transmission>0,ft=W&&!!j.anisotropyMap,Pt=we&&!!j.clearcoatMap,Rn=we&&!!j.clearcoatNormalMap,et=we&&!!j.clearcoatRoughnessMap,Et=Xe&&!!j.iridescenceMap,Jn=Xe&&!!j.iridescenceThicknessMap,Mn=We&&!!j.sheenColorMap,Bt=We&&!!j.sheenRoughnessMap,Sn=!!j.specularMap,Gn=!!j.specularColorMap,ur=!!j.specularIntensityMap,pe=Jt&&!!j.transmissionMap,rt=Jt&&!!j.thicknessMap,ze=!!j.alphaMap,ei=!!j.extensions;let Or=Nu;j.toneMapped&&(null===pt||!0===pt.isXRRenderTarget)&&(Or=n.toneMapping);const vs={shaderID:bt,shaderType:j.type,shaderName:j.name,vertexShader:ci,fragmentShader:Pe,defines:j.defines,customVertexShaderID:nt,customFragmentShaderID:It,isRawShaderMaterial:!0===j.isRawShaderMaterial,glslVersion:j.glslVersion,precision:M,batching:Dn,batchingColor:Dn&&null!==xe._colorsTexture,instancing:mn,instancingColor:mn&&null!==xe.instanceColor,instancingMorph:mn&&null!==xe.morphTexture,supportsVertexTextures:x,outputColorSpace:null===pt?n.outputColorSpace:!0===pt.isXRRenderTarget?pt.texture.colorSpace:Bu,alphaToCoverage:!!j.alphaToCoverage,map:yn,matcap:!!j.matcap,envMap:Y,envMapMode:Y&&Ke.mapping,envMapCubeUVHeight:De,aoMap:it,lightMap:Ze,bumpMap:gt,normalMap:Ue,displacementMap:x&&rn,emissiveMap:vt,normalMapObjectSpace:Ue&&1===j.normalMapType,normalMapTangentSpace:Ue&&0===j.normalMapType,metalnessMap:Ft,roughnessMap:re,anisotropy:W,anisotropyMap:ft,clearcoat:we,clearcoatMap:Pt,clearcoatNormalMap:Rn,clearcoatRoughnessMap:et,dispersion:j.dispersion>0,iridescence:Xe,iridescenceMap:Et,iridescenceThicknessMap:Jn,sheen:We,sheenColorMap:Mn,sheenRoughnessMap:Bt,specularMap:Sn,specularColorMap:Gn,specularIntensityMap:ur,transmission:Jt,transmissionMap:pe,thicknessMap:rt,gradientMap:!!j.gradientMap,opaque:!1===j.transparent&&1===j.blending&&!1===j.alphaToCoverage,alphaMap:ze,alphaTest:j.alphaTest>0,alphaHash:!!j.alphaHash,combine:j.combine,mapUv:yn&&D(j.map.channel),aoMapUv:it&&D(j.aoMap.channel),lightMapUv:Ze&&D(j.lightMap.channel),bumpMapUv:gt&&D(j.bumpMap.channel),normalMapUv:Ue&&D(j.normalMap.channel),displacementMapUv:rn&&D(j.displacementMap.channel),emissiveMapUv:vt&&D(j.emissiveMap.channel),metalnessMapUv:Ft&&D(j.metalnessMap.channel),roughnessMapUv:re&&D(j.roughnessMap.channel),anisotropyMapUv:ft&&D(j.anisotropyMap.channel),clearcoatMapUv:Pt&&D(j.clearcoatMap.channel),clearcoatNormalMapUv:Rn&&D(j.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:et&&D(j.clearcoatRoughnessMap.channel),iridescenceMapUv:Et&&D(j.iridescenceMap.channel),iridescenceThicknessMapUv:Jn&&D(j.iridescenceThicknessMap.channel),sheenColorMapUv:Mn&&D(j.sheenColorMap.channel),sheenRoughnessMapUv:Bt&&D(j.sheenRoughnessMap.channel),specularMapUv:Sn&&D(j.specularMap.channel),specularColorMapUv:Gn&&D(j.specularColorMap.channel),specularIntensityMapUv:ur&&D(j.specularIntensityMap.channel),transmissionMapUv:pe&&D(j.transmissionMap.channel),thicknessMapUv:rt&&D(j.thicknessMap.channel),alphaMapUv:ze&&D(j.alphaMap.channel),vertexTangents:!!Be.attributes.tangent&&(Ue||W),vertexColors:j.vertexColors,vertexAlphas:!0===j.vertexColors&&!!Be.attributes.color&&4===Be.attributes.color.itemSize,pointsUvs:!0===xe.isPoints&&!!Be.attributes.uv&&(yn||ze),fog:!!Ce,useFog:!0===j.fog,fogExp2:!!Ce&&Ce.isFogExp2,flatShading:!0===j.flatShading,sizeAttenuation:!0===j.sizeAttenuation,logarithmicDepthBuffer:_,skinning:!0===xe.isSkinnedMesh,morphTargets:void 0!==Be.morphAttributes.position,morphNormals:void 0!==Be.morphAttributes.normal,morphColors:void 0!==Be.morphAttributes.color,morphTargetsCount:Rt,morphTextureStride:Vn,numDirLights:G.directional.length,numPointLights:G.point.length,numSpotLights:G.spot.length,numSpotLightMaps:G.spotLightMap.length,numRectAreaLights:G.rectArea.length,numHemiLights:G.hemi.length,numDirLightShadows:G.directionalShadowMap.length,numPointLightShadows:G.pointShadowMap.length,numSpotLightShadows:G.spotShadowMap.length,numSpotLightShadowsWithMaps:G.numSpotLightShadowsWithMaps,numLightProbes:G.numLightProbes,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,dithering:j.dithering,shadowMapEnabled:n.shadowMap.enabled&&ce.length>0,shadowMapType:n.shadowMap.type,toneMapping:Or,decodeVideoTexture:yn&&!0===j.map.isVideoTexture&&mi.getTransfer(j.map.colorSpace)===ji,premultipliedAlpha:j.premultipliedAlpha,doubleSided:2===j.side,flipSided:1===j.side,useDepthPacking:j.depthPacking>=0,depthPacking:j.depthPacking||0,index0AttributeName:j.index0AttributeName,extensionClipCullDistance:ei&&!0===j.extensions.clipCullDistance&&i.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(ei&&!0===j.extensions.multiDraw||Dn)&&i.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:i.has("KHR_parallel_shader_compile"),customProgramCacheKey:j.customProgramCacheKey()};return vs.vertexUv1s=f.has(1),vs.vertexUv2s=f.has(2),vs.vertexUv3s=f.has(3),f.clear(),vs},getProgramCacheKey:function S(j){const G=[];if(j.shaderID?G.push(j.shaderID):(G.push(j.customVertexShaderID),G.push(j.customFragmentShaderID)),void 0!==j.defines)for(const ce in j.defines)G.push(ce),G.push(j.defines[ce]);return!1===j.isRawShaderMaterial&&(function I(j,G){j.push(G.precision),j.push(G.outputColorSpace),j.push(G.envMapMode),j.push(G.envMapCubeUVHeight),j.push(G.mapUv),j.push(G.alphaMapUv),j.push(G.lightMapUv),j.push(G.aoMapUv),j.push(G.bumpMapUv),j.push(G.normalMapUv),j.push(G.displacementMapUv),j.push(G.emissiveMapUv),j.push(G.metalnessMapUv),j.push(G.roughnessMapUv),j.push(G.anisotropyMapUv),j.push(G.clearcoatMapUv),j.push(G.clearcoatNormalMapUv),j.push(G.clearcoatRoughnessMapUv),j.push(G.iridescenceMapUv),j.push(G.iridescenceThicknessMapUv),j.push(G.sheenColorMapUv),j.push(G.sheenRoughnessMapUv),j.push(G.specularMapUv),j.push(G.specularColorMapUv),j.push(G.specularIntensityMapUv),j.push(G.transmissionMapUv),j.push(G.thicknessMapUv),j.push(G.combine),j.push(G.fogExp2),j.push(G.sizeAttenuation),j.push(G.morphTargetsCount),j.push(G.morphAttributeCount),j.push(G.numDirLights),j.push(G.numPointLights),j.push(G.numSpotLights),j.push(G.numSpotLightMaps),j.push(G.numHemiLights),j.push(G.numRectAreaLights),j.push(G.numDirLightShadows),j.push(G.numPointLightShadows),j.push(G.numSpotLightShadows),j.push(G.numSpotLightShadowsWithMaps),j.push(G.numLightProbes),j.push(G.shadowMapType),j.push(G.toneMapping),j.push(G.numClippingPlanes),j.push(G.numClipIntersection),j.push(G.depthPacking)}(G,j),function N(j,G){u.disableAll(),G.supportsVertexTextures&&u.enable(0),G.instancing&&u.enable(1),G.instancingColor&&u.enable(2),G.instancingMorph&&u.enable(3),G.matcap&&u.enable(4),G.envMap&&u.enable(5),G.normalMapObjectSpace&&u.enable(6),G.normalMapTangentSpace&&u.enable(7),G.clearcoat&&u.enable(8),G.iridescence&&u.enable(9),G.alphaTest&&u.enable(10),G.vertexColors&&u.enable(11),G.vertexAlphas&&u.enable(12),G.vertexUv1s&&u.enable(13),G.vertexUv2s&&u.enable(14),G.vertexUv3s&&u.enable(15),G.vertexTangents&&u.enable(16),G.anisotropy&&u.enable(17),G.alphaHash&&u.enable(18),G.batching&&u.enable(19),G.dispersion&&u.enable(20),G.batchingColor&&u.enable(21),j.push(u.mask),u.disableAll(),G.fog&&u.enable(0),G.useFog&&u.enable(1),G.flatShading&&u.enable(2),G.logarithmicDepthBuffer&&u.enable(3),G.skinning&&u.enable(4),G.morphTargets&&u.enable(5),G.morphNormals&&u.enable(6),G.morphColors&&u.enable(7),G.premultipliedAlpha&&u.enable(8),G.shadowMapEnabled&&u.enable(9),G.doubleSided&&u.enable(10),G.flipSided&&u.enable(11),G.useDepthPacking&&u.enable(12),G.dithering&&u.enable(13),G.transmission&&u.enable(14),G.sheen&&u.enable(15),G.opaque&&u.enable(16),G.pointsUvs&&u.enable(17),G.decodeVideoTexture&&u.enable(18),G.alphaToCoverage&&u.enable(19),j.push(u.mask)}(G,j),G.push(n.outputColorSpace)),G.push(j.customProgramCacheKey),G.join()},getUniforms:function O(j){const G=E[j.type];let ce;return ce=G?LX.clone(yl[G].uniforms):j.uniforms,ce},acquireProgram:function ne(j,G){let ce;for(let Se=0,xe=g.length;Se<xe;Se++){const Ce=g[Se];if(Ce.cacheKey===G){ce=Ce,++ce.usedTimes;break}}return void 0===ce&&(ce=new hY(n,G,j,o),g.push(ce)),ce},releaseProgram:function $(j){if(0==--j.usedTimes){const G=g.indexOf(j);g[G]=g[g.length-1],g.pop(),j.destroy()}},releaseShaderCache:function K(j){h.remove(j)},programs:g,dispose:function oe(){h.dispose()}}}function gY(){let n=new WeakMap;return{get:function e(o){let a=n.get(o);return void 0===a&&(a={},n.set(o,a)),a},remove:function t(o){n.delete(o)},update:function i(o,a,u){n.get(o)[a]=u},dispose:function r(){n=new WeakMap}}}function vY(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.material.id!==e.material.id?n.material.id-e.material.id:n.z!==e.z?n.z-e.z:n.id-e.id}function eF(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.z!==e.z?e.z-n.z:n.id-e.id}function tF(){const n=[];let e=0;const t=[],i=[],r=[];function a(_,x,M,E,D,C){let S=n[e];return void 0===S?(S={id:_.id,object:_,geometry:x,material:M,groupOrder:E,renderOrder:_.renderOrder,z:D,group:C},n[e]=S):(S.id=_.id,S.object=_,S.geometry=x,S.material=M,S.groupOrder=E,S.renderOrder=_.renderOrder,S.z=D,S.group=C),e++,S}return{opaque:t,transmissive:i,transparent:r,init:function o(){e=0,t.length=0,i.length=0,r.length=0},push:function u(_,x,M,E,D,C){const S=a(_,x,M,E,D,C);M.transmission>0?i.push(S):!0===M.transparent?r.push(S):t.push(S)},unshift:function h(_,x,M,E,D,C){const S=a(_,x,M,E,D,C);M.transmission>0?i.unshift(S):!0===M.transparent?r.unshift(S):t.unshift(S)},finish:function g(){for(let _=e,x=n.length;_<x;_++){const M=n[_];if(null===M.id)break;M.id=null,M.object=null,M.geometry=null,M.material=null,M.group=null}},sort:function f(_,x){t.length>1&&t.sort(_||vY),i.length>1&&i.sort(x||eF),r.length>1&&r.sort(x||eF)}}}function yY(){let n=new WeakMap;return{get:function e(i,r){const o=n.get(i);let a;return void 0===o?(a=new tF,n.set(i,[a])):r>=o.length?(a=new tF,o.push(a)):a=o[r],a},dispose:function t(){n=new WeakMap}}}function _Y(){const n={};return{get:function(e){if(void 0!==n[e.id])return n[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new Q,color:new wt};break;case"SpotLight":t={position:new Q,direction:new Q,color:new wt,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new Q,color:new wt,distance:0,decay:0};break;case"HemisphereLight":t={direction:new Q,skyColor:new wt,groundColor:new wt};break;case"RectAreaLight":t={color:new wt,position:new Q,halfWidth:new Q,halfHeight:new Q}}return n[e.id]=t,t}}}let MY=0;function wY(n,e){return(e.castShadow?2:0)-(n.castShadow?2:0)+(e.map?1:0)-(n.map?1:0)}function bY(n){const e=new _Y,t=function xY(){const n={};return{get:function(e){if(void 0!==n[e.id])return n[e.id];let t;switch(e.type){case"DirectionalLight":case"SpotLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Ve};break;case"PointLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Ve,shadowCameraNear:1,shadowCameraFar:1e3}}return n[e.id]=t,t}}}(),i={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let f=0;f<9;f++)i.probe.push(new Q);const r=new Q,o=new cn,a=new cn;return{setup:function u(f){let g=0,_=0,x=0;for(let j=0;j<9;j++)i.probe[j].set(0,0,0);let M=0,E=0,D=0,C=0,S=0,I=0,N=0,O=0,ne=0,$=0,K=0;f.sort(wY);for(let j=0,G=f.length;j<G;j++){const ce=f[j],Se=ce.color,xe=ce.intensity,Ce=ce.distance,Be=ce.shadow&&ce.shadow.map?ce.shadow.map.texture:null;if(ce.isAmbientLight)g+=Se.r*xe,_+=Se.g*xe,x+=Se.b*xe;else if(ce.isLightProbe){for(let Ae=0;Ae<9;Ae++)i.probe[Ae].addScaledVector(ce.sh.coefficients[Ae],xe);K++}else if(ce.isDirectionalLight){const Ae=e.get(ce);if(Ae.color.copy(ce.color).multiplyScalar(ce.intensity),ce.castShadow){const Ke=ce.shadow,De=t.get(ce);De.shadowIntensity=Ke.intensity,De.shadowBias=Ke.bias,De.shadowNormalBias=Ke.normalBias,De.shadowRadius=Ke.radius,De.shadowMapSize=Ke.mapSize,i.directionalShadow[M]=De,i.directionalShadowMap[M]=Be,i.directionalShadowMatrix[M]=ce.shadow.matrix,I++}i.directional[M]=Ae,M++}else if(ce.isSpotLight){const Ae=e.get(ce);Ae.position.setFromMatrixPosition(ce.matrixWorld),Ae.color.copy(Se).multiplyScalar(xe),Ae.distance=Ce,Ae.coneCos=Math.cos(ce.angle),Ae.penumbraCos=Math.cos(ce.angle*(1-ce.penumbra)),Ae.decay=ce.decay,i.spot[D]=Ae;const Ke=ce.shadow;if(ce.map&&(i.spotLightMap[ne]=ce.map,ne++,Ke.updateMatrices(ce),ce.castShadow&&$++),i.spotLightMatrix[D]=Ke.matrix,ce.castShadow){const De=t.get(ce);De.shadowIntensity=Ke.intensity,De.shadowBias=Ke.bias,De.shadowNormalBias=Ke.normalBias,De.shadowRadius=Ke.radius,De.shadowMapSize=Ke.mapSize,i.spotShadow[D]=De,i.spotShadowMap[D]=Be,O++}D++}else if(ce.isRectAreaLight){const Ae=e.get(ce);Ae.color.copy(Se).multiplyScalar(xe),Ae.halfWidth.set(.5*ce.width,0,0),Ae.halfHeight.set(0,.5*ce.height,0),i.rectArea[C]=Ae,C++}else if(ce.isPointLight){const Ae=e.get(ce);if(Ae.color.copy(ce.color).multiplyScalar(ce.intensity),Ae.distance=ce.distance,Ae.decay=ce.decay,ce.castShadow){const Ke=ce.shadow,De=t.get(ce);De.shadowIntensity=Ke.intensity,De.shadowBias=Ke.bias,De.shadowNormalBias=Ke.normalBias,De.shadowRadius=Ke.radius,De.shadowMapSize=Ke.mapSize,De.shadowCameraNear=Ke.camera.near,De.shadowCameraFar=Ke.camera.far,i.pointShadow[E]=De,i.pointShadowMap[E]=Be,i.pointShadowMatrix[E]=ce.shadow.matrix,N++}i.point[E]=Ae,E++}else if(ce.isHemisphereLight){const Ae=e.get(ce);Ae.skyColor.copy(ce.color).multiplyScalar(xe),Ae.groundColor.copy(ce.groundColor).multiplyScalar(xe),i.hemi[S]=Ae,S++}}C>0&&(!0===n.has("OES_texture_float_linear")?(i.rectAreaLTC1=dt.LTC_FLOAT_1,i.rectAreaLTC2=dt.LTC_FLOAT_2):(i.rectAreaLTC1=dt.LTC_HALF_1,i.rectAreaLTC2=dt.LTC_HALF_2)),i.ambient[0]=g,i.ambient[1]=_,i.ambient[2]=x;const oe=i.hash;(oe.directionalLength!==M||oe.pointLength!==E||oe.spotLength!==D||oe.rectAreaLength!==C||oe.hemiLength!==S||oe.numDirectionalShadows!==I||oe.numPointShadows!==N||oe.numSpotShadows!==O||oe.numSpotMaps!==ne||oe.numLightProbes!==K)&&(i.directional.length=M,i.spot.length=D,i.rectArea.length=C,i.point.length=E,i.hemi.length=S,i.directionalShadow.length=I,i.directionalShadowMap.length=I,i.pointShadow.length=N,i.pointShadowMap.length=N,i.spotShadow.length=O,i.spotShadowMap.length=O,i.directionalShadowMatrix.length=I,i.pointShadowMatrix.length=N,i.spotLightMatrix.length=O+ne-$,i.spotLightMap.length=ne,i.numSpotLightShadowsWithMaps=$,i.numLightProbes=K,oe.directionalLength=M,oe.pointLength=E,oe.spotLength=D,oe.rectAreaLength=C,oe.hemiLength=S,oe.numDirectionalShadows=I,oe.numPointShadows=N,oe.numSpotShadows=O,oe.numSpotMaps=ne,oe.numLightProbes=K,i.version=MY++)},setupView:function h(f,g){let _=0,x=0,M=0,E=0,D=0;const C=g.matrixWorldInverse;for(let S=0,I=f.length;S<I;S++){const N=f[S];if(N.isDirectionalLight){const O=i.directional[_];O.direction.setFromMatrixPosition(N.matrixWorld),r.setFromMatrixPosition(N.target.matrixWorld),O.direction.sub(r),O.direction.transformDirection(C),_++}else if(N.isSpotLight){const O=i.spot[M];O.position.setFromMatrixPosition(N.matrixWorld),O.position.applyMatrix4(C),O.direction.setFromMatrixPosition(N.matrixWorld),r.setFromMatrixPosition(N.target.matrixWorld),O.direction.sub(r),O.direction.transformDirection(C),M++}else if(N.isRectAreaLight){const O=i.rectArea[E];O.position.setFromMatrixPosition(N.matrixWorld),O.position.applyMatrix4(C),a.identity(),o.copy(N.matrixWorld),o.premultiply(C),a.extractRotation(o),O.halfWidth.set(.5*N.width,0,0),O.halfHeight.set(0,.5*N.height,0),O.halfWidth.applyMatrix4(a),O.halfHeight.applyMatrix4(a),E++}else if(N.isPointLight){const O=i.point[x];O.position.setFromMatrixPosition(N.matrixWorld),O.position.applyMatrix4(C),x++}else if(N.isHemisphereLight){const O=i.hemi[D];O.direction.setFromMatrixPosition(N.matrixWorld),O.direction.transformDirection(C),D++}}},state:i}}function nF(n){const e=new bY(n),t=[],i=[],f={lightsArray:t,shadowsArray:i,camera:null,lights:e,transmissionRenderTarget:{}};return{init:function r(g){f.camera=g,t.length=0,i.length=0},state:f,setupLights:function u(){e.setup(t)},setupLightsView:function h(g){e.setupView(t,g)},pushLight:function o(g){t.push(g)},pushShadow:function a(g){i.push(g)}}}function EY(n){let e=new WeakMap;return{get:function t(r,o=0){const a=e.get(r);let u;return void 0===a?(u=new nF(n),e.set(r,[u])):o>=a.length?(u=new nF(n),a.push(u)):u=a[o],u},dispose:function i(){e=new WeakMap}}}class iF extends fm{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=3200,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class rF extends fm{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}function CY(n,e,t){let i=new Hx;const r=new Ve,o=new Ve,a=new wi,u=new iF({depthPacking:3201}),h=new rF,f={},g=t.maxTextureSize,_={0:1,1:0,2:2},x=new Ec({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Ve},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),M=x.clone();M.defines.HORIZONTAL_PASS=1;const E=new Hn;E.setAttribute("position",new Nr(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const D=new rs(E,x),C=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=BO;let S=this.type;function I($,K){const oe=e.update(D);x.defines.VSM_SAMPLES!==$.blurSamples&&(x.defines.VSM_SAMPLES=$.blurSamples,M.defines.VSM_SAMPLES=$.blurSamples,x.needsUpdate=!0,M.needsUpdate=!0),null===$.mapPass&&($.mapPass=new Sd(r.x,r.y)),x.uniforms.shadow_pass.value=$.map.texture,x.uniforms.resolution.value=$.mapSize,x.uniforms.radius.value=$.radius,n.setRenderTarget($.mapPass),n.clear(),n.renderBufferDirect(K,null,oe,x,D,null),M.uniforms.shadow_pass.value=$.mapPass.texture,M.uniforms.resolution.value=$.mapSize,M.uniforms.radius.value=$.radius,n.setRenderTarget($.map),n.clear(),n.renderBufferDirect(K,null,oe,M,D,null)}function N($,K,oe,j){let G=null;const ce=!0===oe.isPointLight?$.customDistanceMaterial:$.customDepthMaterial;if(void 0!==ce)G=ce;else if(G=!0===oe.isPointLight?h:u,n.localClippingEnabled&&!0===K.clipShadows&&Array.isArray(K.clippingPlanes)&&0!==K.clippingPlanes.length||K.displacementMap&&0!==K.displacementScale||K.alphaMap&&K.alphaTest>0||K.map&&K.alphaTest>0){const Se=G.uuid,xe=K.uuid;let Ce=f[Se];void 0===Ce&&(Ce={},f[Se]=Ce);let Be=Ce[xe];void 0===Be&&(Be=G.clone(),Ce[xe]=Be,K.addEventListener("dispose",ne)),G=Be}return G.visible=K.visible,G.wireframe=K.wireframe,G.side=j===hc?null!==K.shadowSide?K.shadowSide:K.side:null!==K.shadowSide?K.shadowSide:_[K.side],G.alphaMap=K.alphaMap,G.alphaTest=K.alphaTest,G.map=K.map,G.clipShadows=K.clipShadows,G.clippingPlanes=K.clippingPlanes,G.clipIntersection=K.clipIntersection,G.displacementMap=K.displacementMap,G.displacementScale=K.displacementScale,G.displacementBias=K.displacementBias,G.wireframeLinewidth=K.wireframeLinewidth,G.linewidth=K.linewidth,!0===oe.isPointLight&&!0===G.isMeshDistanceMaterial&&(n.properties.get(G).light=oe),G}function O($,K,oe,j,G){if(!1===$.visible)return;if($.layers.test(K.layers)&&($.isMesh||$.isLine||$.isPoints)&&($.castShadow||$.receiveShadow&&G===hc)&&(!$.frustumCulled||i.intersectsObject($))){$.modelViewMatrix.multiplyMatrices(oe.matrixWorldInverse,$.matrixWorld);const xe=e.update($),Ce=$.material;if(Array.isArray(Ce)){const Be=xe.groups;for(let Ae=0,Ke=Be.length;Ae<Ke;Ae++){const De=Be[Ae],bt=Ce[De.materialIndex];if(bt&&bt.visible){const Ut=N($,bt,j,G);$.onBeforeShadow(n,$,K,oe,xe,Ut,De),n.renderBufferDirect(oe,null,xe,Ut,$,De),$.onAfterShadow(n,$,K,oe,xe,Ut,De)}}}else if(Ce.visible){const Be=N($,Ce,j,G);$.onBeforeShadow(n,$,K,oe,xe,Be,null),n.renderBufferDirect(oe,null,xe,Be,$,null),$.onAfterShadow(n,$,K,oe,xe,Be,null)}}const Se=$.children;for(let xe=0,Ce=Se.length;xe<Ce;xe++)O(Se[xe],K,oe,j,G)}function ne($){$.target.removeEventListener("dispose",ne);for(const oe in f){const j=f[oe],G=$.target.uuid;G in j&&(j[G].dispose(),delete j[G])}}this.render=function($,K,oe){if(!1===C.enabled||!1===C.autoUpdate&&!1===C.needsUpdate||0===$.length)return;const j=n.getRenderTarget(),G=n.getActiveCubeFace(),ce=n.getActiveMipmapLevel(),Se=n.state;Se.setBlending(0),Se.buffers.color.setClear(1,1,1,1),Se.buffers.depth.setTest(!0),Se.setScissorTest(!1);const xe=S!==hc&&this.type===hc,Ce=S===hc&&this.type!==hc;for(let Be=0,Ae=$.length;Be<Ae;Be++){const Ke=$[Be],De=Ke.shadow;if(void 0===De){console.warn("THREE.WebGLShadowMap:",Ke,"has no shadow.");continue}if(!1===De.autoUpdate&&!1===De.needsUpdate)continue;r.copy(De.mapSize);const bt=De.getFrameExtents();if(r.multiply(bt),o.copy(De.mapSize),(r.x>g||r.y>g)&&(r.x>g&&(o.x=Math.floor(g/bt.x),r.x=o.x*bt.x,De.mapSize.x=o.x),r.y>g&&(o.y=Math.floor(g/bt.y),r.y=o.y*bt.y,De.mapSize.y=o.y)),null===De.map||!0===xe||!0===Ce){const Rt=this.type!==hc?{minFilter:ms,magFilter:ms}:{};null!==De.map&&De.map.dispose(),De.map=new Sd(r.x,r.y,Rt),De.map.texture.name=Ke.name+".shadowMap",De.camera.updateProjectionMatrix()}n.setRenderTarget(De.map),n.clear();const Ut=De.getViewportCount();for(let Rt=0;Rt<Ut;Rt++){const Vn=De.getViewport(Rt);a.set(o.x*Vn.x,o.y*Vn.y,o.x*Vn.z,o.y*Vn.w),Se.viewport(a),De.updateMatrices(Ke,Rt),i=De.getFrustum(),O(K,oe,De.camera,Ke,this.type)}!0!==De.isPointLightShadow&&this.type===hc&&I(De,oe),De.needsUpdate=!1}S=this.type,C.needsUpdate=!1,n.setRenderTarget(j,G,ce)}}function AY(n){const r=new function e(){let pe=!1;const rt=new wi;let ke=null;const ze=new wi(0,0,0,0);return{setMask:function(ct){ke!==ct&&!pe&&(n.colorMask(ct,ct,ct,ct),ke=ct)},setLocked:function(ct){pe=ct},setClear:function(ct,gn,ei,Or,vs){!0===vs&&(ct*=Or,gn*=Or,ei*=Or),rt.set(ct,gn,ei,Or),!1===ze.equals(rt)&&(n.clearColor(ct,gn,ei,Or),ze.copy(rt))},reset:function(){pe=!1,ke=null,ze.set(-1,0,0,0)}}},o=new function t(){let pe=!1,rt=null,ke=null,ze=null;return{setTest:function(ct){ct?It(n.DEPTH_TEST):pt(n.DEPTH_TEST)},setMask:function(ct){rt!==ct&&!pe&&(n.depthMask(ct),rt=ct)},setFunc:function(ct){if(ke!==ct){switch(ct){case 0:n.depthFunc(n.NEVER);break;case 1:n.depthFunc(n.ALWAYS);break;case 2:n.depthFunc(n.LESS);break;case 3:default:n.depthFunc(n.LEQUAL);break;case 4:n.depthFunc(n.EQUAL);break;case 5:n.depthFunc(n.GEQUAL);break;case 6:n.depthFunc(n.GREATER);break;case 7:n.depthFunc(n.NOTEQUAL)}ke=ct}},setLocked:function(ct){pe=ct},setClear:function(ct){ze!==ct&&(n.clearDepth(ct),ze=ct)},reset:function(){pe=!1,rt=null,ke=null,ze=null}}},a=new function i(){let pe=!1,rt=null,ke=null,ze=null,ct=null,gn=null,ei=null,Or=null,vs=null;return{setTest:function(gi){pe||(gi?It(n.STENCIL_TEST):pt(n.STENCIL_TEST))},setMask:function(gi){rt!==gi&&!pe&&(n.stencilMask(gi),rt=gi)},setFunc:function(gi,Ac,Ml){(ke!==gi||ze!==Ac||ct!==Ml)&&(n.stencilFunc(gi,Ac,Ml),ke=gi,ze=Ac,ct=Ml)},setOp:function(gi,Ac,Ml){(gn!==gi||ei!==Ac||Or!==Ml)&&(n.stencilOp(gi,Ac,Ml),gn=gi,ei=Ac,Or=Ml)},setLocked:function(gi){pe=gi},setClear:function(gi){vs!==gi&&(n.clearStencil(gi),vs=gi)},reset:function(){pe=!1,rt=null,ke=null,ze=null,ct=null,gn=null,ei=null,Or=null,vs=null}}},u=new WeakMap,h=new WeakMap;let f={},g={},_=new WeakMap,x=[],M=null,E=!1,D=null,C=null,S=null,I=null,N=null,O=null,ne=null,$=new wt(0,0,0),K=0,oe=!1,j=null,G=null,ce=null,Se=null,xe=null;const Ce=n.getParameter(n.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let Be=!1,Ae=0;const Ke=n.getParameter(n.VERSION);-1!==Ke.indexOf("WebGL")?(Ae=parseFloat(/^WebGL (\d)/.exec(Ke)[1]),Be=Ae>=1):-1!==Ke.indexOf("OpenGL ES")&&(Ae=parseFloat(/^OpenGL ES (\d)/.exec(Ke)[1]),Be=Ae>=2);let De=null,bt={};const Ut=n.getParameter(n.SCISSOR_BOX),Rt=n.getParameter(n.VIEWPORT),Vn=(new wi).fromArray(Ut),ci=(new wi).fromArray(Rt);function Pe(pe,rt,ke,ze){const ct=new Uint8Array(4),gn=n.createTexture();n.bindTexture(pe,gn),n.texParameteri(pe,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(pe,n.TEXTURE_MAG_FILTER,n.NEAREST);for(let ei=0;ei<ke;ei++)pe===n.TEXTURE_3D||pe===n.TEXTURE_2D_ARRAY?n.texImage3D(rt,0,n.RGBA,1,1,ze,0,n.RGBA,n.UNSIGNED_BYTE,ct):n.texImage2D(rt+ei,0,n.RGBA,1,1,0,n.RGBA,n.UNSIGNED_BYTE,ct);return gn}const nt={};function It(pe){!0!==f[pe]&&(n.enable(pe),f[pe]=!0)}function pt(pe){!1!==f[pe]&&(n.disable(pe),f[pe]=!1)}nt[n.TEXTURE_2D]=Pe(n.TEXTURE_2D,n.TEXTURE_2D,1),nt[n.TEXTURE_CUBE_MAP]=Pe(n.TEXTURE_CUBE_MAP,n.TEXTURE_CUBE_MAP_POSITIVE_X,6),nt[n.TEXTURE_2D_ARRAY]=Pe(n.TEXTURE_2D_ARRAY,n.TEXTURE_2D_ARRAY,1,1),nt[n.TEXTURE_3D]=Pe(n.TEXTURE_3D,n.TEXTURE_3D,1,1),r.setClear(0,0,0,1),o.setClear(1),a.setClear(0),It(n.DEPTH_TEST),o.setFunc(3),gt(!1),Ue(1),It(n.CULL_FACE),it(0);const ii={100:n.FUNC_ADD,101:n.FUNC_SUBTRACT,102:n.FUNC_REVERSE_SUBTRACT};ii[103]=n.MIN,ii[104]=n.MAX;const Y={200:n.ZERO,201:n.ONE,202:n.SRC_COLOR,204:n.SRC_ALPHA,210:n.SRC_ALPHA_SATURATE,208:n.DST_COLOR,206:n.DST_ALPHA,203:n.ONE_MINUS_SRC_COLOR,205:n.ONE_MINUS_SRC_ALPHA,209:n.ONE_MINUS_DST_COLOR,207:n.ONE_MINUS_DST_ALPHA,211:n.CONSTANT_COLOR,212:n.ONE_MINUS_CONSTANT_COLOR,213:n.CONSTANT_ALPHA,214:n.ONE_MINUS_CONSTANT_ALPHA};function it(pe,rt,ke,ze,ct,gn,ei,Or,vs,gi){if(0!==pe){if(!1===E&&(It(n.BLEND),E=!0),5===pe)ct=ct||rt,gn=gn||ke,ei=ei||ze,(rt!==C||ct!==N)&&(n.blendEquationSeparate(ii[rt],ii[ct]),C=rt,N=ct),(ke!==S||ze!==I||gn!==O||ei!==ne)&&(n.blendFuncSeparate(Y[ke],Y[ze],Y[gn],Y[ei]),S=ke,I=ze,O=gn,ne=ei),(!1===Or.equals($)||vs!==K)&&(n.blendColor(Or.r,Or.g,Or.b,vs),$.copy(Or),K=vs),D=pe,oe=!1;else if(pe!==D||gi!==oe){if((100!==C||100!==N)&&(n.blendEquation(n.FUNC_ADD),C=100,N=100),gi)switch(pe){case 1:n.blendFuncSeparate(n.ONE,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case 2:n.blendFunc(n.ONE,n.ONE);break;case 3:n.blendFuncSeparate(n.ZERO,n.ONE_MINUS_SRC_COLOR,n.ZERO,n.ONE);break;case 4:n.blendFuncSeparate(n.ZERO,n.SRC_COLOR,n.ZERO,n.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",pe)}else switch(pe){case 1:n.blendFuncSeparate(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case 2:n.blendFunc(n.SRC_ALPHA,n.ONE);break;case 3:n.blendFuncSeparate(n.ZERO,n.ONE_MINUS_SRC_COLOR,n.ZERO,n.ONE);break;case 4:n.blendFunc(n.ZERO,n.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",pe)}S=null,I=null,O=null,ne=null,$.set(0,0,0),K=0,D=pe,oe=gi}}else!0===E&&(pt(n.BLEND),E=!1)}function gt(pe){j!==pe&&(n.frontFace(pe?n.CW:n.CCW),j=pe)}function Ue(pe){0!==pe?(It(n.CULL_FACE),pe!==G&&n.cullFace(1===pe?n.BACK:2===pe?n.FRONT:n.FRONT_AND_BACK)):pt(n.CULL_FACE),G=pe}function vt(pe,rt,ke){pe?(It(n.POLYGON_OFFSET_FILL),(Se!==rt||xe!==ke)&&(n.polygonOffset(rt,ke),Se=rt,xe=ke)):pt(n.POLYGON_OFFSET_FILL)}return{buffers:{color:r,depth:o,stencil:a},enable:It,disable:pt,bindFramebuffer:function mn(pe,rt){return g[pe]!==rt&&(n.bindFramebuffer(pe,rt),g[pe]=rt,pe===n.DRAW_FRAMEBUFFER&&(g[n.FRAMEBUFFER]=rt),pe===n.FRAMEBUFFER&&(g[n.DRAW_FRAMEBUFFER]=rt),!0)},drawBuffers:function Dn(pe,rt){let ke=x,ze=!1;if(pe){ke=_.get(rt),void 0===ke&&(ke=[],_.set(rt,ke));const ct=pe.textures;if(ke.length!==ct.length||ke[0]!==n.COLOR_ATTACHMENT0){for(let gn=0,ei=ct.length;gn<ei;gn++)ke[gn]=n.COLOR_ATTACHMENT0+gn;ke.length=ct.length,ze=!0}}else ke[0]!==n.BACK&&(ke[0]=n.BACK,ze=!0);ze&&n.drawBuffers(ke)},useProgram:function yn(pe){return M!==pe&&(n.useProgram(pe),M=pe,!0)},setBlending:it,setMaterial:function Ze(pe,rt){2===pe.side?pt(n.CULL_FACE):It(n.CULL_FACE);let ke=1===pe.side;rt&&(ke=!ke),gt(ke),1===pe.blending&&!1===pe.transparent?it(0):it(pe.blending,pe.blendEquation,pe.blendSrc,pe.blendDst,pe.blendEquationAlpha,pe.blendSrcAlpha,pe.blendDstAlpha,pe.blendColor,pe.blendAlpha,pe.premultipliedAlpha),o.setFunc(pe.depthFunc),o.setTest(pe.depthTest),o.setMask(pe.depthWrite),r.setMask(pe.colorWrite);const ze=pe.stencilWrite;a.setTest(ze),ze&&(a.setMask(pe.stencilWriteMask),a.setFunc(pe.stencilFunc,pe.stencilRef,pe.stencilFuncMask),a.setOp(pe.stencilFail,pe.stencilZFail,pe.stencilZPass)),vt(pe.polygonOffset,pe.polygonOffsetFactor,pe.polygonOffsetUnits),!0===pe.alphaToCoverage?It(n.SAMPLE_ALPHA_TO_COVERAGE):pt(n.SAMPLE_ALPHA_TO_COVERAGE)},setFlipSided:gt,setCullFace:Ue,setLineWidth:function rn(pe){pe!==ce&&(Be&&n.lineWidth(pe),ce=pe)},setPolygonOffset:vt,setScissorTest:function Ft(pe){pe?It(n.SCISSOR_TEST):pt(n.SCISSOR_TEST)},activeTexture:function re(pe){void 0===pe&&(pe=n.TEXTURE0+Ce-1),De!==pe&&(n.activeTexture(pe),De=pe)},bindTexture:function W(pe,rt,ke){void 0===ke&&(ke=null===De?n.TEXTURE0+Ce-1:De);let ze=bt[ke];void 0===ze&&(ze={type:void 0,texture:void 0},bt[ke]=ze),(ze.type!==pe||ze.texture!==rt)&&(De!==ke&&(n.activeTexture(ke),De=ke),n.bindTexture(pe,rt||nt[pe]),ze.type=pe,ze.texture=rt)},unbindTexture:function we(){const pe=bt[De];void 0!==pe&&void 0!==pe.type&&(n.bindTexture(pe.type,null),pe.type=void 0,pe.texture=void 0)},compressedTexImage2D:function qe(){try{n.compressedTexImage2D.apply(n,arguments)}catch(pe){console.error("THREE.WebGLState:",pe)}},compressedTexImage3D:function Xe(){try{n.compressedTexImage3D.apply(n,arguments)}catch(pe){console.error("THREE.WebGLState:",pe)}},texImage2D:function Et(){try{n.texImage2D.apply(n,arguments)}catch(pe){console.error("THREE.WebGLState:",pe)}},texImage3D:function Jn(){try{n.texImage3D.apply(n,arguments)}catch(pe){console.error("THREE.WebGLState:",pe)}},updateUBOMapping:function Sn(pe,rt){let ke=h.get(rt);void 0===ke&&(ke=new WeakMap,h.set(rt,ke));let ze=ke.get(pe);void 0===ze&&(ze=n.getUniformBlockIndex(rt,pe.name),ke.set(pe,ze))},uniformBlockBinding:function Gn(pe,rt){const ze=h.get(rt).get(pe);u.get(rt)!==ze&&(n.uniformBlockBinding(rt,ze,pe.__bindingPointIndex),u.set(rt,ze))},texStorage2D:function Rn(){try{n.texStorage2D.apply(n,arguments)}catch(pe){console.error("THREE.WebGLState:",pe)}},texStorage3D:function et(){try{n.texStorage3D.apply(n,arguments)}catch(pe){console.error("THREE.WebGLState:",pe)}},texSubImage2D:function We(){try{n.texSubImage2D.apply(n,arguments)}catch(pe){console.error("THREE.WebGLState:",pe)}},texSubImage3D:function Jt(){try{n.texSubImage3D.apply(n,arguments)}catch(pe){console.error("THREE.WebGLState:",pe)}},compressedTexSubImage2D:function ft(){try{n.compressedTexSubImage2D.apply(n,arguments)}catch(pe){console.error("THREE.WebGLState:",pe)}},compressedTexSubImage3D:function Pt(){try{n.compressedTexSubImage3D.apply(n,arguments)}catch(pe){console.error("THREE.WebGLState:",pe)}},scissor:function Mn(pe){!1===Vn.equals(pe)&&(n.scissor(pe.x,pe.y,pe.z,pe.w),Vn.copy(pe))},viewport:function Bt(pe){!1===ci.equals(pe)&&(n.viewport(pe.x,pe.y,pe.z,pe.w),ci.copy(pe))},reset:function ur(){n.disable(n.BLEND),n.disable(n.CULL_FACE),n.disable(n.DEPTH_TEST),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SCISSOR_TEST),n.disable(n.STENCIL_TEST),n.disable(n.SAMPLE_ALPHA_TO_COVERAGE),n.blendEquation(n.FUNC_ADD),n.blendFunc(n.ONE,n.ZERO),n.blendFuncSeparate(n.ONE,n.ZERO,n.ONE,n.ZERO),n.blendColor(0,0,0,0),n.colorMask(!0,!0,!0,!0),n.clearColor(0,0,0,0),n.depthMask(!0),n.depthFunc(n.LESS),n.clearDepth(1),n.stencilMask(4294967295),n.stencilFunc(n.ALWAYS,0,4294967295),n.stencilOp(n.KEEP,n.KEEP,n.KEEP),n.clearStencil(0),n.cullFace(n.BACK),n.frontFace(n.CCW),n.polygonOffset(0,0),n.activeTexture(n.TEXTURE0),n.bindFramebuffer(n.FRAMEBUFFER,null),n.bindFramebuffer(n.DRAW_FRAMEBUFFER,null),n.bindFramebuffer(n.READ_FRAMEBUFFER,null),n.useProgram(null),n.lineWidth(1),n.scissor(0,0,n.canvas.width,n.canvas.height),n.viewport(0,0,n.canvas.width,n.canvas.height),f={},De=null,bt={},g={},_=new WeakMap,x=[],M=null,E=!1,D=null,C=null,S=null,I=null,N=null,O=null,ne=null,$=new wt(0,0,0),K=0,oe=!1,j=null,G=null,ce=null,Se=null,xe=null,Vn.set(0,0,n.canvas.width,n.canvas.height),ci.set(0,0,n.canvas.width,n.canvas.height),r.reset(),o.reset(),a.reset()}}}function yC(n,e,t,i){const r=function PY(n){switch(n){case pc:case GO:return{byteLength:1,components:1};case zv:case WO:case Hv:return{byteLength:2,components:1};case sT:case oT:return{byteLength:2,components:4};case Fu:case rT:case Po:return{byteLength:4,components:1};case jO:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${n}.`)}(i);switch(t){case $O:case qO:return n*e;case YO:return n*e*2;case aT:case lx:return n*e/r.components*r.byteLength;case ZO:case lT:return n*e*2/r.components*r.byteLength;case XO:return n*e*3/r.components*r.byteLength;case mo:case cT:return n*e*4/r.components*r.byteLength;case cx:case ux:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*8;case hx:case dx:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*16;case hT:case fT:return Math.max(n,16)*Math.max(e,8)/4;case uT:case dT:return Math.max(n,8)*Math.max(e,8)/2;case pT:case mT:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*8;case gT:case vT:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*16;case yT:return Math.floor((n+4)/5)*Math.floor((e+3)/4)*16;case _T:return Math.floor((n+4)/5)*Math.floor((e+4)/5)*16;case xT:return Math.floor((n+5)/6)*Math.floor((e+4)/5)*16;case MT:return Math.floor((n+5)/6)*Math.floor((e+5)/6)*16;case wT:return Math.floor((n+7)/8)*Math.floor((e+4)/5)*16;case bT:return Math.floor((n+7)/8)*Math.floor((e+5)/6)*16;case ET:return Math.floor((n+7)/8)*Math.floor((e+7)/8)*16;case ST:return Math.floor((n+9)/10)*Math.floor((e+4)/5)*16;case TT:return Math.floor((n+9)/10)*Math.floor((e+5)/6)*16;case CT:return Math.floor((n+9)/10)*Math.floor((e+7)/8)*16;case AT:return Math.floor((n+9)/10)*Math.floor((e+9)/10)*16;case DT:return Math.floor((n+11)/12)*Math.floor((e+9)/10)*16;case RT:return Math.floor((n+11)/12)*Math.floor((e+11)/12)*16;case fx:case IT:case PT:return Math.ceil(n/4)*Math.ceil(e/4)*16;case JO:case LT:return Math.ceil(n/4)*Math.ceil(e/4)*8;case NT:case OT:return Math.ceil(n/4)*Math.ceil(e/4)*16}throw new Error(`Unable to determine texture byte length for ${t} format.`)}function LY(n,e,t,i,r,o,a){const u=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,h=!(typeof navigator>"u")&&/OculusBrowser/g.test(navigator.userAgent),f=new Ve,g=new WeakMap;let _;const x=new WeakMap;let M=!1;try{M=typeof OffscreenCanvas<"u"&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch{}function E(re,W){return M?new OffscreenCanvas(re,W):Wv("canvas")}function D(re,W,we){let qe=1;const Xe=Ft(re);if((Xe.width>we||Xe.height>we)&&(qe=we/Math.max(Xe.width,Xe.height)),qe<1){if(typeof HTMLImageElement<"u"&&re instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&re instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&re instanceof ImageBitmap||typeof VideoFrame<"u"&&re instanceof VideoFrame){const We=Math.floor(qe*Xe.width),Jt=Math.floor(qe*Xe.height);void 0===_&&(_=E(We,Jt));const ft=W?E(We,Jt):_;return ft.width=We,ft.height=Jt,ft.getContext("2d").drawImage(re,0,0,We,Jt),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+Xe.width+"x"+Xe.height+") to ("+We+"x"+Jt+")."),ft}return"data"in re&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+Xe.width+"x"+Xe.height+")."),re}return re}function C(re){return re.generateMipmaps&&re.minFilter!==ms&&re.minFilter!==qr}function S(re){n.generateMipmap(re)}function I(re,W,we,qe,Xe=!1){if(null!==re){if(void 0!==n[re])return n[re];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+re+"'")}let We=W;if(W===n.RED&&(we===n.FLOAT&&(We=n.R32F),we===n.HALF_FLOAT&&(We=n.R16F),we===n.UNSIGNED_BYTE&&(We=n.R8)),W===n.RED_INTEGER&&(we===n.UNSIGNED_BYTE&&(We=n.R8UI),we===n.UNSIGNED_SHORT&&(We=n.R16UI),we===n.UNSIGNED_INT&&(We=n.R32UI),we===n.BYTE&&(We=n.R8I),we===n.SHORT&&(We=n.R16I),we===n.INT&&(We=n.R32I)),W===n.RG&&(we===n.FLOAT&&(We=n.RG32F),we===n.HALF_FLOAT&&(We=n.RG16F),we===n.UNSIGNED_BYTE&&(We=n.RG8)),W===n.RG_INTEGER&&(we===n.UNSIGNED_BYTE&&(We=n.RG8UI),we===n.UNSIGNED_SHORT&&(We=n.RG16UI),we===n.UNSIGNED_INT&&(We=n.RG32UI),we===n.BYTE&&(We=n.RG8I),we===n.SHORT&&(We=n.RG16I),we===n.INT&&(We=n.RG32I)),W===n.RGB&&we===n.UNSIGNED_INT_5_9_9_9_REV&&(We=n.RGB9_E5),W===n.RGBA){const Jt=Xe?vx:mi.getTransfer(qe);we===n.FLOAT&&(We=n.RGBA32F),we===n.HALF_FLOAT&&(We=n.RGBA16F),we===n.UNSIGNED_BYTE&&(We=Jt===ji?n.SRGB8_ALPHA8:n.RGBA8),we===n.UNSIGNED_SHORT_4_4_4_4&&(We=n.RGBA4),we===n.UNSIGNED_SHORT_5_5_5_1&&(We=n.RGB5_A1)}return(We===n.R16F||We===n.R32F||We===n.RG16F||We===n.RG32F||We===n.RGBA16F||We===n.RGBA32F)&&e.get("EXT_color_buffer_float"),We}function N(re,W){let we;return re?null===W||W===Fu||W===Xp?we=n.DEPTH24_STENCIL8:W===Po?we=n.DEPTH32F_STENCIL8:W===zv&&(we=n.DEPTH24_STENCIL8,console.warn("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):null===W||W===Fu||W===Xp?we=n.DEPTH_COMPONENT24:W===Po?we=n.DEPTH_COMPONENT32F:W===zv&&(we=n.DEPTH_COMPONENT16),we}function O(re,W){return!0===C(re)||re.isFramebufferTexture&&re.minFilter!==ms&&re.minFilter!==qr?Math.log2(Math.max(W.width,W.height))+1:void 0!==re.mipmaps&&re.mipmaps.length>0?re.mipmaps.length:re.isCompressedTexture&&Array.isArray(re.image)?W.mipmaps.length:1}function ne(re){const W=re.target;W.removeEventListener("dispose",ne),function K(re){const W=i.get(re);if(void 0===W.__webglInit)return;const we=re.source,qe=x.get(we);if(qe){const Xe=qe[W.__cacheKey];Xe.usedTimes--,0===Xe.usedTimes&&oe(re),0===Object.keys(qe).length&&x.delete(we)}i.remove(re)}(W),W.isVideoTexture&&g.delete(W)}function $(re){const W=re.target;W.removeEventListener("dispose",$),function j(re){const W=i.get(re);if(re.depthTexture&&re.depthTexture.dispose(),re.isWebGLCubeRenderTarget)for(let qe=0;qe<6;qe++){if(Array.isArray(W.__webglFramebuffer[qe]))for(let Xe=0;Xe<W.__webglFramebuffer[qe].length;Xe++)n.deleteFramebuffer(W.__webglFramebuffer[qe][Xe]);else n.deleteFramebuffer(W.__webglFramebuffer[qe]);W.__webglDepthbuffer&&n.deleteRenderbuffer(W.__webglDepthbuffer[qe])}else{if(Array.isArray(W.__webglFramebuffer))for(let qe=0;qe<W.__webglFramebuffer.length;qe++)n.deleteFramebuffer(W.__webglFramebuffer[qe]);else n.deleteFramebuffer(W.__webglFramebuffer);if(W.__webglDepthbuffer&&n.deleteRenderbuffer(W.__webglDepthbuffer),W.__webglMultisampledFramebuffer&&n.deleteFramebuffer(W.__webglMultisampledFramebuffer),W.__webglColorRenderbuffer)for(let qe=0;qe<W.__webglColorRenderbuffer.length;qe++)W.__webglColorRenderbuffer[qe]&&n.deleteRenderbuffer(W.__webglColorRenderbuffer[qe]);W.__webglDepthRenderbuffer&&n.deleteRenderbuffer(W.__webglDepthRenderbuffer)}const we=re.textures;for(let qe=0,Xe=we.length;qe<Xe;qe++){const We=i.get(we[qe]);We.__webglTexture&&(n.deleteTexture(We.__webglTexture),a.memory.textures--),i.remove(we[qe])}i.remove(re)}(W)}function oe(re){const W=i.get(re);n.deleteTexture(W.__webglTexture),delete x.get(re.source)[W.__cacheKey],a.memory.textures--}let G=0;function Ce(re,W){const we=i.get(re);if(re.isVideoTexture&&function rn(re){const W=a.render.frame;g.get(re)!==W&&(g.set(re,W),re.update())}(re),!1===re.isRenderTargetTexture&&re.version>0&&we.__version!==re.version){const qe=re.image;if(null===qe)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==qe.complete)return void ci(we,re,W);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}t.bindTexture(n.TEXTURE_2D,we.__webglTexture,n.TEXTURE0+W)}const De={[$p]:n.REPEAT,[Ua]:n.CLAMP_TO_EDGE,1002:n.MIRRORED_REPEAT},bt={[ms]:n.NEAREST,1004:n.NEAREST_MIPMAP_NEAREST,1005:n.NEAREST_MIPMAP_LINEAR,[qr]:n.LINEAR,1007:n.LINEAR_MIPMAP_NEAREST,[fc]:n.LINEAR_MIPMAP_LINEAR},Ut={512:n.NEVER,519:n.ALWAYS,513:n.LESS,515:n.LEQUAL,514:n.EQUAL,518:n.GEQUAL,516:n.GREATER,517:n.NOTEQUAL};function Rt(re,W){if(W.type===Po&&!1===e.has("OES_texture_float_linear")&&(W.magFilter===qr||1007===W.magFilter||1005===W.magFilter||W.magFilter===fc||W.minFilter===qr||1007===W.minFilter||1005===W.minFilter||W.minFilter===fc)&&console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),n.texParameteri(re,n.TEXTURE_WRAP_S,De[W.wrapS]),n.texParameteri(re,n.TEXTURE_WRAP_T,De[W.wrapT]),(re===n.TEXTURE_3D||re===n.TEXTURE_2D_ARRAY)&&n.texParameteri(re,n.TEXTURE_WRAP_R,De[W.wrapR]),n.texParameteri(re,n.TEXTURE_MAG_FILTER,bt[W.magFilter]),n.texParameteri(re,n.TEXTURE_MIN_FILTER,bt[W.minFilter]),W.compareFunction&&(n.texParameteri(re,n.TEXTURE_COMPARE_MODE,n.COMPARE_REF_TO_TEXTURE),n.texParameteri(re,n.TEXTURE_COMPARE_FUNC,Ut[W.compareFunction])),!0===e.has("EXT_texture_filter_anisotropic")){if(W.magFilter===ms||1005!==W.minFilter&&W.minFilter!==fc||W.type===Po&&!1===e.has("OES_texture_float_linear"))return;if(W.anisotropy>1||i.get(W).__currentAnisotropy){const we=e.get("EXT_texture_filter_anisotropic");n.texParameterf(re,we.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(W.anisotropy,r.getMaxAnisotropy())),i.get(W).__currentAnisotropy=W.anisotropy}}}function Vn(re,W){let we=!1;void 0===re.__webglInit&&(re.__webglInit=!0,W.addEventListener("dispose",ne));const qe=W.source;let Xe=x.get(qe);void 0===Xe&&(Xe={},x.set(qe,Xe));const We=function xe(re){const W=[];return W.push(re.wrapS),W.push(re.wrapT),W.push(re.wrapR||0),W.push(re.magFilter),W.push(re.minFilter),W.push(re.anisotropy),W.push(re.internalFormat),W.push(re.format),W.push(re.type),W.push(re.generateMipmaps),W.push(re.premultiplyAlpha),W.push(re.flipY),W.push(re.unpackAlignment),W.push(re.colorSpace),W.join()}(W);if(We!==re.__cacheKey){void 0===Xe[We]&&(Xe[We]={texture:n.createTexture(),usedTimes:0},a.memory.textures++,we=!0),Xe[We].usedTimes++;const Jt=Xe[re.__cacheKey];void 0!==Jt&&(Xe[re.__cacheKey].usedTimes--,0===Jt.usedTimes&&oe(W)),re.__cacheKey=We,re.__webglTexture=Xe[We].texture}return we}function ci(re,W,we){let qe=n.TEXTURE_2D;(W.isDataArrayTexture||W.isCompressedArrayTexture)&&(qe=n.TEXTURE_2D_ARRAY),W.isData3DTexture&&(qe=n.TEXTURE_3D);const Xe=Vn(re,W),We=W.source;t.bindTexture(qe,re.__webglTexture,n.TEXTURE0+we);const Jt=i.get(We);if(We.version!==Jt.__version||!0===Xe){t.activeTexture(n.TEXTURE0+we);const ft=mi.getPrimaries(mi.workingColorSpace),Pt=""===W.colorSpace?null:mi.getPrimaries(W.colorSpace),Rn=""===W.colorSpace||ft===Pt?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,W.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,W.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,W.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,Rn);let et=D(W.image,!1,r.maxTextureSize);et=vt(W,et);const Et=o.convert(W.format,W.colorSpace),Jn=o.convert(W.type);let Bt,Mn=I(W.internalFormat,Et,Jn,W.colorSpace,W.isVideoTexture);Rt(qe,W);const Sn=W.mipmaps,Gn=!0!==W.isVideoTexture,ur=void 0===Jt.__version||!0===Xe,pe=We.dataReady,rt=O(W,et);if(W.isDepthTexture)Mn=N(W.format===Yp,W.type),ur&&(Gn?t.texStorage2D(n.TEXTURE_2D,1,Mn,et.width,et.height):t.texImage2D(n.TEXTURE_2D,0,Mn,et.width,et.height,0,Et,Jn,null));else if(W.isDataTexture)if(Sn.length>0){Gn&&ur&&t.texStorage2D(n.TEXTURE_2D,rt,Mn,Sn[0].width,Sn[0].height);for(let ke=0,ze=Sn.length;ke<ze;ke++)Bt=Sn[ke],Gn?pe&&t.texSubImage2D(n.TEXTURE_2D,ke,0,0,Bt.width,Bt.height,Et,Jn,Bt.data):t.texImage2D(n.TEXTURE_2D,ke,Mn,Bt.width,Bt.height,0,Et,Jn,Bt.data);W.generateMipmaps=!1}else Gn?(ur&&t.texStorage2D(n.TEXTURE_2D,rt,Mn,et.width,et.height),pe&&t.texSubImage2D(n.TEXTURE_2D,0,0,0,et.width,et.height,Et,Jn,et.data)):t.texImage2D(n.TEXTURE_2D,0,Mn,et.width,et.height,0,Et,Jn,et.data);else if(W.isCompressedTexture)if(W.isCompressedArrayTexture){Gn&&ur&&t.texStorage3D(n.TEXTURE_2D_ARRAY,rt,Mn,Sn[0].width,Sn[0].height,et.depth);for(let ke=0,ze=Sn.length;ke<ze;ke++)if(Bt=Sn[ke],W.format!==mo)if(null!==Et)if(Gn){if(pe)if(W.layerUpdates.size>0){const ct=yC(Bt.width,Bt.height,W.format,W.type);for(const gn of W.layerUpdates){const ei=Bt.data.subarray(gn*ct/Bt.data.BYTES_PER_ELEMENT,(gn+1)*ct/Bt.data.BYTES_PER_ELEMENT);t.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,ke,0,0,gn,Bt.width,Bt.height,1,Et,ei,0,0)}W.clearLayerUpdates()}else t.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,ke,0,0,0,Bt.width,Bt.height,et.depth,Et,Bt.data,0,0)}else t.compressedTexImage3D(n.TEXTURE_2D_ARRAY,ke,Mn,Bt.width,Bt.height,et.depth,0,Bt.data,0,0);else console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else Gn?pe&&t.texSubImage3D(n.TEXTURE_2D_ARRAY,ke,0,0,0,Bt.width,Bt.height,et.depth,Et,Jn,Bt.data):t.texImage3D(n.TEXTURE_2D_ARRAY,ke,Mn,Bt.width,Bt.height,et.depth,0,Et,Jn,Bt.data)}else{Gn&&ur&&t.texStorage2D(n.TEXTURE_2D,rt,Mn,Sn[0].width,Sn[0].height);for(let ke=0,ze=Sn.length;ke<ze;ke++)Bt=Sn[ke],W.format!==mo?null!==Et?Gn?pe&&t.compressedTexSubImage2D(n.TEXTURE_2D,ke,0,0,Bt.width,Bt.height,Et,Bt.data):t.compressedTexImage2D(n.TEXTURE_2D,ke,Mn,Bt.width,Bt.height,0,Bt.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Gn?pe&&t.texSubImage2D(n.TEXTURE_2D,ke,0,0,Bt.width,Bt.height,Et,Jn,Bt.data):t.texImage2D(n.TEXTURE_2D,ke,Mn,Bt.width,Bt.height,0,Et,Jn,Bt.data)}else if(W.isDataArrayTexture)if(Gn){if(ur&&t.texStorage3D(n.TEXTURE_2D_ARRAY,rt,Mn,et.width,et.height,et.depth),pe)if(W.layerUpdates.size>0){const ke=yC(et.width,et.height,W.format,W.type);for(const ze of W.layerUpdates){const ct=et.data.subarray(ze*ke/et.data.BYTES_PER_ELEMENT,(ze+1)*ke/et.data.BYTES_PER_ELEMENT);t.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,ze,et.width,et.height,1,Et,Jn,ct)}W.clearLayerUpdates()}else t.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,0,et.width,et.height,et.depth,Et,Jn,et.data)}else t.texImage3D(n.TEXTURE_2D_ARRAY,0,Mn,et.width,et.height,et.depth,0,Et,Jn,et.data);else if(W.isData3DTexture)Gn?(ur&&t.texStorage3D(n.TEXTURE_3D,rt,Mn,et.width,et.height,et.depth),pe&&t.texSubImage3D(n.TEXTURE_3D,0,0,0,0,et.width,et.height,et.depth,Et,Jn,et.data)):t.texImage3D(n.TEXTURE_3D,0,Mn,et.width,et.height,et.depth,0,Et,Jn,et.data);else if(W.isFramebufferTexture){if(ur)if(Gn)t.texStorage2D(n.TEXTURE_2D,rt,Mn,et.width,et.height);else{let ke=et.width,ze=et.height;for(let ct=0;ct<rt;ct++)t.texImage2D(n.TEXTURE_2D,ct,Mn,ke,ze,0,Et,Jn,null),ke>>=1,ze>>=1}}else if(Sn.length>0){if(Gn&&ur){const ke=Ft(Sn[0]);t.texStorage2D(n.TEXTURE_2D,rt,Mn,ke.width,ke.height)}for(let ke=0,ze=Sn.length;ke<ze;ke++)Bt=Sn[ke],Gn?pe&&t.texSubImage2D(n.TEXTURE_2D,ke,0,0,Et,Jn,Bt):t.texImage2D(n.TEXTURE_2D,ke,Mn,Et,Jn,Bt);W.generateMipmaps=!1}else if(Gn){if(ur){const ke=Ft(et);t.texStorage2D(n.TEXTURE_2D,rt,Mn,ke.width,ke.height)}pe&&t.texSubImage2D(n.TEXTURE_2D,0,0,0,Et,Jn,et)}else t.texImage2D(n.TEXTURE_2D,0,Mn,Et,Jn,et);C(W)&&S(qe),Jt.__version=We.version,W.onUpdate&&W.onUpdate(W)}re.__version=W.version}function nt(re,W,we,qe,Xe,We){const Jt=o.convert(we.format,we.colorSpace),ft=o.convert(we.type),Pt=I(we.internalFormat,Jt,ft,we.colorSpace);if(!i.get(W).__hasExternalTextures){const et=Math.max(1,W.width>>We),Et=Math.max(1,W.height>>We);Xe===n.TEXTURE_3D||Xe===n.TEXTURE_2D_ARRAY?t.texImage3D(Xe,We,Pt,et,Et,W.depth,0,Jt,ft,null):t.texImage2D(Xe,We,Pt,et,Et,0,Jt,ft,null)}t.bindFramebuffer(n.FRAMEBUFFER,re),Ue(W)?u.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,qe,Xe,i.get(we).__webglTexture,0,gt(W)):(Xe===n.TEXTURE_2D||Xe>=n.TEXTURE_CUBE_MAP_POSITIVE_X&&Xe<=n.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&n.framebufferTexture2D(n.FRAMEBUFFER,qe,Xe,i.get(we).__webglTexture,We),t.bindFramebuffer(n.FRAMEBUFFER,null)}function It(re,W,we){if(n.bindRenderbuffer(n.RENDERBUFFER,re),W.depthBuffer){const qe=W.depthTexture,We=N(W.stencilBuffer,qe&&qe.isDepthTexture?qe.type:null),Jt=W.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,ft=gt(W);Ue(W)?u.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,ft,We,W.width,W.height):we?n.renderbufferStorageMultisample(n.RENDERBUFFER,ft,We,W.width,W.height):n.renderbufferStorage(n.RENDERBUFFER,We,W.width,W.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,Jt,n.RENDERBUFFER,re)}else{const qe=W.textures;for(let Xe=0;Xe<qe.length;Xe++){const We=qe[Xe],Jt=o.convert(We.format,We.colorSpace),ft=o.convert(We.type),Pt=I(We.internalFormat,Jt,ft,We.colorSpace),Rn=gt(W);we&&!1===Ue(W)?n.renderbufferStorageMultisample(n.RENDERBUFFER,Rn,Pt,W.width,W.height):Ue(W)?u.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,Rn,Pt,W.width,W.height):n.renderbufferStorage(n.RENDERBUFFER,Pt,W.width,W.height)}}n.bindRenderbuffer(n.RENDERBUFFER,null)}function mn(re){const W=i.get(re),we=!0===re.isWebGLCubeRenderTarget;if(re.depthTexture&&!W.__autoAllocateDepthBuffer){if(we)throw new Error("target.depthTexture not supported in Cube render targets");!function pt(re,W){if(W&&W.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(n.FRAMEBUFFER,re),!W.depthTexture||!W.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!i.get(W.depthTexture).__webglTexture||W.depthTexture.image.width!==W.width||W.depthTexture.image.height!==W.height)&&(W.depthTexture.image.width=W.width,W.depthTexture.image.height=W.height,W.depthTexture.needsUpdate=!0),Ce(W.depthTexture,0);const qe=i.get(W.depthTexture).__webglTexture,Xe=gt(W);if(W.depthTexture.format===qp)Ue(W)?u.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,qe,0,Xe):n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,qe,0);else{if(W.depthTexture.format!==Yp)throw new Error("Unknown depthTexture format");Ue(W)?u.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.TEXTURE_2D,qe,0,Xe):n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.TEXTURE_2D,qe,0)}}(W.__webglFramebuffer,re)}else if(we){W.__webglDepthbuffer=[];for(let qe=0;qe<6;qe++)t.bindFramebuffer(n.FRAMEBUFFER,W.__webglFramebuffer[qe]),W.__webglDepthbuffer[qe]=n.createRenderbuffer(),It(W.__webglDepthbuffer[qe],re,!1)}else t.bindFramebuffer(n.FRAMEBUFFER,W.__webglFramebuffer),W.__webglDepthbuffer=n.createRenderbuffer(),It(W.__webglDepthbuffer,re,!1);t.bindFramebuffer(n.FRAMEBUFFER,null)}const Y=[],it=[];function gt(re){return Math.min(r.maxSamples,re.samples)}function Ue(re){const W=i.get(re);return re.samples>0&&!0===e.has("WEBGL_multisampled_render_to_texture")&&!1!==W.__useRenderToTexture}function vt(re,W){const we=re.colorSpace,qe=re.format,Xe=re.type;return!0===re.isCompressedTexture||!0===re.isVideoTexture||we!==Bu&&""!==we&&(mi.getTransfer(we)===ji?(qe!==mo||Xe!==pc)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",we)),W}function Ft(re){return typeof HTMLImageElement<"u"&&re instanceof HTMLImageElement?(f.width=re.naturalWidth||re.width,f.height=re.naturalHeight||re.height):typeof VideoFrame<"u"&&re instanceof VideoFrame?(f.width=re.displayWidth,f.height=re.displayHeight):(f.width=re.width,f.height=re.height),f}this.allocateTextureUnit=function Se(){const re=G;return re>=r.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+re+" texture units while this GPU supports only "+r.maxTextures),G+=1,re},this.resetTextureUnits=function ce(){G=0},this.setTexture2D=Ce,this.setTexture2DArray=function Be(re,W){const we=i.get(re);re.version>0&&we.__version!==re.version?ci(we,re,W):t.bindTexture(n.TEXTURE_2D_ARRAY,we.__webglTexture,n.TEXTURE0+W)},this.setTexture3D=function Ae(re,W){const we=i.get(re);re.version>0&&we.__version!==re.version?ci(we,re,W):t.bindTexture(n.TEXTURE_3D,we.__webglTexture,n.TEXTURE0+W)},this.setTextureCube=function Ke(re,W){const we=i.get(re);re.version>0&&we.__version!==re.version?function Pe(re,W,we){if(6!==W.image.length)return;const qe=Vn(re,W),Xe=W.source;t.bindTexture(n.TEXTURE_CUBE_MAP,re.__webglTexture,n.TEXTURE0+we);const We=i.get(Xe);if(Xe.version!==We.__version||!0===qe){t.activeTexture(n.TEXTURE0+we);const Jt=mi.getPrimaries(mi.workingColorSpace),ft=""===W.colorSpace?null:mi.getPrimaries(W.colorSpace),Pt=""===W.colorSpace||Jt===ft?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,W.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,W.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,W.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,Pt);const Rn=W.isCompressedTexture||W.image[0].isCompressedTexture,et=W.image[0]&&W.image[0].isDataTexture,Et=[];for(let ze=0;ze<6;ze++)Et[ze]=Rn||et?et?W.image[ze].image:W.image[ze]:D(W.image[ze],!0,r.maxCubemapSize),Et[ze]=vt(W,Et[ze]);const Jn=Et[0],Mn=o.convert(W.format,W.colorSpace),Bt=o.convert(W.type),Sn=I(W.internalFormat,Mn,Bt,W.colorSpace),Gn=!0!==W.isVideoTexture,ur=void 0===We.__version||!0===qe,pe=Xe.dataReady;let ke,rt=O(W,Jn);if(Rt(n.TEXTURE_CUBE_MAP,W),Rn){Gn&&ur&&t.texStorage2D(n.TEXTURE_CUBE_MAP,rt,Sn,Jn.width,Jn.height);for(let ze=0;ze<6;ze++){ke=Et[ze].mipmaps;for(let ct=0;ct<ke.length;ct++){const gn=ke[ct];W.format!==mo?null!==Mn?Gn?pe&&t.compressedTexSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ze,ct,0,0,gn.width,gn.height,Mn,gn.data):t.compressedTexImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ze,ct,Sn,gn.width,gn.height,0,gn.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):Gn?pe&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ze,ct,0,0,gn.width,gn.height,Mn,Bt,gn.data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ze,ct,Sn,gn.width,gn.height,0,Mn,Bt,gn.data)}}}else{if(ke=W.mipmaps,Gn&&ur){ke.length>0&&rt++;const ze=Ft(Et[0]);t.texStorage2D(n.TEXTURE_CUBE_MAP,rt,Sn,ze.width,ze.height)}for(let ze=0;ze<6;ze++)if(et){Gn?pe&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ze,0,0,0,Et[ze].width,Et[ze].height,Mn,Bt,Et[ze].data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ze,0,Sn,Et[ze].width,Et[ze].height,0,Mn,Bt,Et[ze].data);for(let ct=0;ct<ke.length;ct++){const ei=ke[ct].image[ze].image;Gn?pe&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ze,ct+1,0,0,ei.width,ei.height,Mn,Bt,ei.data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ze,ct+1,Sn,ei.width,ei.height,0,Mn,Bt,ei.data)}}else{Gn?pe&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ze,0,0,0,Mn,Bt,Et[ze]):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ze,0,Sn,Mn,Bt,Et[ze]);for(let ct=0;ct<ke.length;ct++){const gn=ke[ct];Gn?pe&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ze,ct+1,0,0,Mn,Bt,gn.image[ze]):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ze,ct+1,Sn,Mn,Bt,gn.image[ze])}}}C(W)&&S(n.TEXTURE_CUBE_MAP),We.__version=Xe.version,W.onUpdate&&W.onUpdate(W)}re.__version=W.version}(we,re,W):t.bindTexture(n.TEXTURE_CUBE_MAP,we.__webglTexture,n.TEXTURE0+W)},this.rebindTextures=function Dn(re,W,we){const qe=i.get(re);void 0!==W&&nt(qe.__webglFramebuffer,re,re.texture,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,0),void 0!==we&&mn(re)},this.setupRenderTarget=function yn(re){const W=re.texture,we=i.get(re),qe=i.get(W);re.addEventListener("dispose",$);const Xe=re.textures,We=!0===re.isWebGLCubeRenderTarget,Jt=Xe.length>1;if(Jt||(void 0===qe.__webglTexture&&(qe.__webglTexture=n.createTexture()),qe.__version=W.version,a.memory.textures++),We){we.__webglFramebuffer=[];for(let ft=0;ft<6;ft++)if(W.mipmaps&&W.mipmaps.length>0){we.__webglFramebuffer[ft]=[];for(let Pt=0;Pt<W.mipmaps.length;Pt++)we.__webglFramebuffer[ft][Pt]=n.createFramebuffer()}else we.__webglFramebuffer[ft]=n.createFramebuffer()}else{if(W.mipmaps&&W.mipmaps.length>0){we.__webglFramebuffer=[];for(let ft=0;ft<W.mipmaps.length;ft++)we.__webglFramebuffer[ft]=n.createFramebuffer()}else we.__webglFramebuffer=n.createFramebuffer();if(Jt)for(let ft=0,Pt=Xe.length;ft<Pt;ft++){const Rn=i.get(Xe[ft]);void 0===Rn.__webglTexture&&(Rn.__webglTexture=n.createTexture(),a.memory.textures++)}if(re.samples>0&&!1===Ue(re)){we.__webglMultisampledFramebuffer=n.createFramebuffer(),we.__webglColorRenderbuffer=[],t.bindFramebuffer(n.FRAMEBUFFER,we.__webglMultisampledFramebuffer);for(let ft=0;ft<Xe.length;ft++){const Pt=Xe[ft];we.__webglColorRenderbuffer[ft]=n.createRenderbuffer(),n.bindRenderbuffer(n.RENDERBUFFER,we.__webglColorRenderbuffer[ft]);const Rn=o.convert(Pt.format,Pt.colorSpace),et=o.convert(Pt.type),Et=I(Pt.internalFormat,Rn,et,Pt.colorSpace,!0===re.isXRRenderTarget),Jn=gt(re);n.renderbufferStorageMultisample(n.RENDERBUFFER,Jn,Et,re.width,re.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+ft,n.RENDERBUFFER,we.__webglColorRenderbuffer[ft])}n.bindRenderbuffer(n.RENDERBUFFER,null),re.depthBuffer&&(we.__webglDepthRenderbuffer=n.createRenderbuffer(),It(we.__webglDepthRenderbuffer,re,!0)),t.bindFramebuffer(n.FRAMEBUFFER,null)}}if(We){t.bindTexture(n.TEXTURE_CUBE_MAP,qe.__webglTexture),Rt(n.TEXTURE_CUBE_MAP,W);for(let ft=0;ft<6;ft++)if(W.mipmaps&&W.mipmaps.length>0)for(let Pt=0;Pt<W.mipmaps.length;Pt++)nt(we.__webglFramebuffer[ft][Pt],re,W,n.COLOR_ATTACHMENT0,n.TEXTURE_CUBE_MAP_POSITIVE_X+ft,Pt);else nt(we.__webglFramebuffer[ft],re,W,n.COLOR_ATTACHMENT0,n.TEXTURE_CUBE_MAP_POSITIVE_X+ft,0);C(W)&&S(n.TEXTURE_CUBE_MAP),t.unbindTexture()}else if(Jt){for(let ft=0,Pt=Xe.length;ft<Pt;ft++){const Rn=Xe[ft],et=i.get(Rn);t.bindTexture(n.TEXTURE_2D,et.__webglTexture),Rt(n.TEXTURE_2D,Rn),nt(we.__webglFramebuffer,re,Rn,n.COLOR_ATTACHMENT0+ft,n.TEXTURE_2D,0),C(Rn)&&S(n.TEXTURE_2D)}t.unbindTexture()}else{let ft=n.TEXTURE_2D;if((re.isWebGL3DRenderTarget||re.isWebGLArrayRenderTarget)&&(ft=re.isWebGL3DRenderTarget?n.TEXTURE_3D:n.TEXTURE_2D_ARRAY),t.bindTexture(ft,qe.__webglTexture),Rt(ft,W),W.mipmaps&&W.mipmaps.length>0)for(let Pt=0;Pt<W.mipmaps.length;Pt++)nt(we.__webglFramebuffer[Pt],re,W,n.COLOR_ATTACHMENT0,ft,Pt);else nt(we.__webglFramebuffer,re,W,n.COLOR_ATTACHMENT0,ft,0);C(W)&&S(ft),t.unbindTexture()}re.depthBuffer&&mn(re)},this.updateRenderTargetMipmap=function ii(re){const W=re.textures;for(let we=0,qe=W.length;we<qe;we++){const Xe=W[we];if(C(Xe)){const We=re.isWebGLCubeRenderTarget?n.TEXTURE_CUBE_MAP:n.TEXTURE_2D,Jt=i.get(Xe).__webglTexture;t.bindTexture(We,Jt),S(We),t.unbindTexture()}}},this.updateMultisampleRenderTarget=function Ze(re){if(re.samples>0)if(!1===Ue(re)){const W=re.textures,we=re.width,qe=re.height;let Xe=n.COLOR_BUFFER_BIT;const We=re.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,Jt=i.get(re),ft=W.length>1;if(ft)for(let Pt=0;Pt<W.length;Pt++)t.bindFramebuffer(n.FRAMEBUFFER,Jt.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+Pt,n.RENDERBUFFER,null),t.bindFramebuffer(n.FRAMEBUFFER,Jt.__webglFramebuffer),n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0+Pt,n.TEXTURE_2D,null,0);t.bindFramebuffer(n.READ_FRAMEBUFFER,Jt.__webglMultisampledFramebuffer),t.bindFramebuffer(n.DRAW_FRAMEBUFFER,Jt.__webglFramebuffer);for(let Pt=0;Pt<W.length;Pt++){if(re.resolveDepthBuffer&&(re.depthBuffer&&(Xe|=n.DEPTH_BUFFER_BIT),re.stencilBuffer&&re.resolveStencilBuffer&&(Xe|=n.STENCIL_BUFFER_BIT)),ft){n.framebufferRenderbuffer(n.READ_FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.RENDERBUFFER,Jt.__webglColorRenderbuffer[Pt]);const Rn=i.get(W[Pt]).__webglTexture;n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,Rn,0)}n.blitFramebuffer(0,0,we,qe,0,0,we,qe,Xe,n.NEAREST),!0===h&&(Y.length=0,it.length=0,Y.push(n.COLOR_ATTACHMENT0+Pt),re.depthBuffer&&!1===re.resolveDepthBuffer&&(Y.push(We),it.push(We),n.invalidateFramebuffer(n.DRAW_FRAMEBUFFER,it)),n.invalidateFramebuffer(n.READ_FRAMEBUFFER,Y))}if(t.bindFramebuffer(n.READ_FRAMEBUFFER,null),t.bindFramebuffer(n.DRAW_FRAMEBUFFER,null),ft)for(let Pt=0;Pt<W.length;Pt++){t.bindFramebuffer(n.FRAMEBUFFER,Jt.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+Pt,n.RENDERBUFFER,Jt.__webglColorRenderbuffer[Pt]);const Rn=i.get(W[Pt]).__webglTexture;t.bindFramebuffer(n.FRAMEBUFFER,Jt.__webglFramebuffer),n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0+Pt,n.TEXTURE_2D,Rn,0)}t.bindFramebuffer(n.DRAW_FRAMEBUFFER,Jt.__webglMultisampledFramebuffer)}else re.depthBuffer&&!1===re.resolveDepthBuffer&&h&&n.invalidateFramebuffer(n.DRAW_FRAMEBUFFER,[re.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT])},this.setupDepthRenderbuffer=mn,this.setupFrameBufferTexture=nt,this.useMultisampledRTT=Ue}function NY(n,e){return{convert:function t(i,r=""){let o;const a=mi.getTransfer(r);if(i===pc)return n.UNSIGNED_BYTE;if(i===sT)return n.UNSIGNED_SHORT_4_4_4_4;if(i===oT)return n.UNSIGNED_SHORT_5_5_5_1;if(i===jO)return n.UNSIGNED_INT_5_9_9_9_REV;if(i===GO)return n.BYTE;if(i===WO)return n.SHORT;if(i===zv)return n.UNSIGNED_SHORT;if(i===rT)return n.INT;if(i===Fu)return n.UNSIGNED_INT;if(i===Po)return n.FLOAT;if(i===Hv)return n.HALF_FLOAT;if(i===$O)return n.ALPHA;if(i===XO)return n.RGB;if(i===mo)return n.RGBA;if(i===qO)return n.LUMINANCE;if(i===YO)return n.LUMINANCE_ALPHA;if(i===qp)return n.DEPTH_COMPONENT;if(i===Yp)return n.DEPTH_STENCIL;if(i===aT)return n.RED;if(i===lx)return n.RED_INTEGER;if(i===ZO)return n.RG;if(i===lT)return n.RG_INTEGER;if(i===cT)return n.RGBA_INTEGER;if(i===cx||i===ux||i===hx||i===dx)if(a===ji){if(o=e.get("WEBGL_compressed_texture_s3tc_srgb"),null===o)return null;if(i===cx)return o.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(i===ux)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(i===hx)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(i===dx)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(o=e.get("WEBGL_compressed_texture_s3tc"),null===o)return null;if(i===cx)return o.COMPRESSED_RGB_S3TC_DXT1_EXT;if(i===ux)return o.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(i===hx)return o.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(i===dx)return o.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(i===uT||i===hT||i===dT||i===fT){if(o=e.get("WEBGL_compressed_texture_pvrtc"),null===o)return null;if(i===uT)return o.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(i===hT)return o.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(i===dT)return o.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(i===fT)return o.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(i===pT||i===mT||i===gT){if(o=e.get("WEBGL_compressed_texture_etc"),null===o)return null;if(i===pT||i===mT)return a===ji?o.COMPRESSED_SRGB8_ETC2:o.COMPRESSED_RGB8_ETC2;if(i===gT)return a===ji?o.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:o.COMPRESSED_RGBA8_ETC2_EAC}if(i===vT||i===yT||i===_T||i===xT||i===MT||i===wT||i===bT||i===ET||i===ST||i===TT||i===CT||i===AT||i===DT||i===RT){if(o=e.get("WEBGL_compressed_texture_astc"),null===o)return null;if(i===vT)return a===ji?o.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:o.COMPRESSED_RGBA_ASTC_4x4_KHR;if(i===yT)return a===ji?o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:o.COMPRESSED_RGBA_ASTC_5x4_KHR;if(i===_T)return a===ji?o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:o.COMPRESSED_RGBA_ASTC_5x5_KHR;if(i===xT)return a===ji?o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:o.COMPRESSED_RGBA_ASTC_6x5_KHR;if(i===MT)return a===ji?o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:o.COMPRESSED_RGBA_ASTC_6x6_KHR;if(i===wT)return a===ji?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:o.COMPRESSED_RGBA_ASTC_8x5_KHR;if(i===bT)return a===ji?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:o.COMPRESSED_RGBA_ASTC_8x6_KHR;if(i===ET)return a===ji?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:o.COMPRESSED_RGBA_ASTC_8x8_KHR;if(i===ST)return a===ji?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:o.COMPRESSED_RGBA_ASTC_10x5_KHR;if(i===TT)return a===ji?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:o.COMPRESSED_RGBA_ASTC_10x6_KHR;if(i===CT)return a===ji?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:o.COMPRESSED_RGBA_ASTC_10x8_KHR;if(i===AT)return a===ji?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:o.COMPRESSED_RGBA_ASTC_10x10_KHR;if(i===DT)return a===ji?o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:o.COMPRESSED_RGBA_ASTC_12x10_KHR;if(i===RT)return a===ji?o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:o.COMPRESSED_RGBA_ASTC_12x12_KHR}if(i===fx||i===IT||i===PT){if(o=e.get("EXT_texture_compression_bptc"),null===o)return null;if(i===fx)return a===ji?o.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:o.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(i===IT)return o.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(i===PT)return o.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}if(i===JO||i===LT||i===NT||i===OT){if(o=e.get("EXT_texture_compression_rgtc"),null===o)return null;if(i===fx)return o.COMPRESSED_RED_RGTC1_EXT;if(i===LT)return o.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(i===NT)return o.COMPRESSED_RED_GREEN_RGTC2_EXT;if(i===OT)return o.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return i===Xp?n.UNSIGNED_INT_24_8:void 0!==n[i]?n[i]:null}}}class OY extends gs{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}class Qv extends vo{constructor(){super(),this.isGroup=!0,this.type="Group"}}const FY={type:"move"};class _C{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new Qv,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new Qv,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Q,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Q),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new Qv,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Q,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Q),this._grip}dispatchEvent(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const i of e.hand.values())this._getHandJoint(t,i)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(e,t,i){let r=null,o=null,a=null;const u=this._targetRay,h=this._grip,f=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState){if(f&&e.hand){a=!0;for(const D of e.hand.values()){const C=t.getJointPose(D,i),S=this._getHandJoint(f,D);null!==C&&(S.matrix.fromArray(C.transform.matrix),S.matrix.decompose(S.position,S.rotation,S.scale),S.matrixWorldNeedsUpdate=!0,S.jointRadius=C.radius),S.visible=null!==C}const x=f.joints["index-finger-tip"].position.distanceTo(f.joints["thumb-tip"].position),M=.02,E=.005;f.inputState.pinching&&x>M+E?(f.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!f.inputState.pinching&&x<=M-E&&(f.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==h&&e.gripSpace&&(o=t.getPose(e.gripSpace,i),null!==o&&(h.matrix.fromArray(o.transform.matrix),h.matrix.decompose(h.position,h.rotation,h.scale),h.matrixWorldNeedsUpdate=!0,o.linearVelocity?(h.hasLinearVelocity=!0,h.linearVelocity.copy(o.linearVelocity)):h.hasLinearVelocity=!1,o.angularVelocity?(h.hasAngularVelocity=!0,h.angularVelocity.copy(o.angularVelocity)):h.hasAngularVelocity=!1));null!==u&&(r=t.getPose(e.targetRaySpace,i),null===r&&null!==o&&(r=o),null!==r&&(u.matrix.fromArray(r.transform.matrix),u.matrix.decompose(u.position,u.rotation,u.scale),u.matrixWorldNeedsUpdate=!0,r.linearVelocity?(u.hasLinearVelocity=!0,u.linearVelocity.copy(r.linearVelocity)):u.hasLinearVelocity=!1,r.angularVelocity?(u.hasAngularVelocity=!0,u.angularVelocity.copy(r.angularVelocity)):u.hasAngularVelocity=!1,this.dispatchEvent(FY)))}return null!==u&&(u.visible=null!==r),null!==h&&(h.visible=null!==o),null!==f&&(f.visible=null!==a),this}_getHandJoint(e,t){if(void 0===e.joints[t.jointName]){const i=new Qv;i.matrixAutoUpdate=!1,i.visible=!1,e.joints[t.jointName]=i,e.add(i)}return e.joints[t.jointName]}}class kY{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,t,i){if(null===this.texture){const r=new gc;e.properties.get(r).__webglTexture=t.texture,(t.depthNear!=i.depthNear||t.depthFar!=i.depthFar)&&(this.depthNear=t.depthNear,this.depthFar=t.depthFar),this.texture=r}}getMesh(e){if(null!==this.texture&&null===this.mesh){const t=e.cameras[0].viewport,i=new Ec({vertexShader:"\nvoid main() {\n\n\tgl_Position = vec4( position, 1.0 );\n\n}",fragmentShader:"\nuniform sampler2DArray depthColor;\nuniform float depthWidth;\nuniform float depthHeight;\n\nvoid main() {\n\n\tvec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );\n\n\tif ( coord.x >= 1.0 ) {\n\n\t\tgl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;\n\n\t} else {\n\n\t\tgl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;\n\n\t}\n\n}",uniforms:{depthColor:{value:this.texture},depthWidth:{value:t.z},depthHeight:{value:t.w}}});this.mesh=new rs(new Jv(20,20),i)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class VY extends Qp{constructor(e,t){super();const i=this;let r=null,o=1,a=null,u="local-floor",h=1,f=null,g=null,_=null,x=null,M=null,E=null;const D=new kY,C=t.getContextAttributes();let S=null,I=null;const N=[],O=[],ne=new Ve;let $=null;const K=new gs;K.layers.enable(1),K.viewport=new wi;const oe=new gs;oe.layers.enable(2),oe.viewport=new wi;const j=[K,oe],G=new OY;G.layers.enable(1),G.layers.enable(2);let ce=null,Se=null;function xe(Pe){const nt=O.indexOf(Pe.inputSource);if(-1===nt)return;const It=N[nt];void 0!==It&&(It.update(Pe.inputSource,Pe.frame,f||a),It.dispatchEvent({type:Pe.type,data:Pe.inputSource}))}function Ce(){r.removeEventListener("select",xe),r.removeEventListener("selectstart",xe),r.removeEventListener("selectend",xe),r.removeEventListener("squeeze",xe),r.removeEventListener("squeezestart",xe),r.removeEventListener("squeezeend",xe),r.removeEventListener("end",Ce),r.removeEventListener("inputsourceschange",Be);for(let Pe=0;Pe<N.length;Pe++){const nt=O[Pe];null!==nt&&(O[Pe]=null,N[Pe].disconnect(nt))}ce=null,Se=null,D.reset(),e.setRenderTarget(S),M=null,x=null,_=null,r=null,I=null,ci.stop(),i.isPresenting=!1,e.setPixelRatio($),e.setSize(ne.width,ne.height,!1),i.dispatchEvent({type:"sessionend"})}function Be(Pe){for(let nt=0;nt<Pe.removed.length;nt++){const It=Pe.removed[nt],pt=O.indexOf(It);pt>=0&&(O[pt]=null,N[pt].disconnect(It))}for(let nt=0;nt<Pe.added.length;nt++){const It=Pe.added[nt];let pt=O.indexOf(It);if(-1===pt){for(let Dn=0;Dn<N.length;Dn++){if(Dn>=O.length){O.push(It),pt=Dn;break}if(null===O[Dn]){O[Dn]=It,pt=Dn;break}}if(-1===pt)break}const mn=N[pt];mn&&mn.connect(It)}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(Pe){let nt=N[Pe];return void 0===nt&&(nt=new _C,N[Pe]=nt),nt.getTargetRaySpace()},this.getControllerGrip=function(Pe){let nt=N[Pe];return void 0===nt&&(nt=new _C,N[Pe]=nt),nt.getGripSpace()},this.getHand=function(Pe){let nt=N[Pe];return void 0===nt&&(nt=new _C,N[Pe]=nt),nt.getHandSpace()},this.setFramebufferScaleFactor=function(Pe){o=Pe,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(Pe){u=Pe,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return f||a},this.setReferenceSpace=function(Pe){f=Pe},this.getBaseLayer=function(){return null!==x?x:M},this.getBinding=function(){return _},this.getFrame=function(){return E},this.getSession=function(){return r},this.setSession=function(){var Pe=FO(function*(nt){if(r=nt,null!==r){if(S=e.getRenderTarget(),r.addEventListener("select",xe),r.addEventListener("selectstart",xe),r.addEventListener("selectend",xe),r.addEventListener("squeeze",xe),r.addEventListener("squeezestart",xe),r.addEventListener("squeezeend",xe),r.addEventListener("end",Ce),r.addEventListener("inputsourceschange",Be),!0!==C.xrCompatible&&(yield t.makeXRCompatible()),$=e.getPixelRatio(),e.getSize(ne),void 0===r.renderState.layers)M=new XRWebGLLayer(r,t,{antialias:C.antialias,alpha:!0,depth:C.depth,stencil:C.stencil,framebufferScaleFactor:o}),r.updateRenderState({baseLayer:M}),e.setPixelRatio(1),e.setSize(M.framebufferWidth,M.framebufferHeight,!1),I=new Sd(M.framebufferWidth,M.framebufferHeight,{format:mo,type:pc,colorSpace:e.outputColorSpace,stencilBuffer:C.stencil});else{let It=null,pt=null,mn=null;C.depth&&(mn=C.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,It=C.stencil?Yp:qp,pt=C.stencil?Xp:Fu);const Dn={colorFormat:t.RGBA8,depthFormat:mn,scaleFactor:o};_=new XRWebGLBinding(r,t),x=_.createProjectionLayer(Dn),r.updateRenderState({layers:[x]}),e.setPixelRatio(1),e.setSize(x.textureWidth,x.textureHeight,!1),I=new Sd(x.textureWidth,x.textureHeight,{format:mo,type:pc,depthTexture:new F2(x.textureWidth,x.textureHeight,pt,void 0,void 0,void 0,void 0,void 0,void 0,It),stencilBuffer:C.stencil,colorSpace:e.outputColorSpace,samples:C.antialias?4:0,resolveDepthBuffer:!1===x.ignoreDepthValues})}I.isXRRenderTarget=!0,this.setFoveation(h),f=null,a=yield r.requestReferenceSpace(u),ci.setContext(r),ci.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}});return function(nt){return Pe.apply(this,arguments)}}(),this.getEnvironmentBlendMode=function(){if(null!==r)return r.environmentBlendMode},this.getDepthTexture=function(){return D.getDepthTexture()};const Ae=new Q,Ke=new Q;function bt(Pe,nt){null===nt?Pe.matrixWorld.copy(Pe.matrix):Pe.matrixWorld.multiplyMatrices(nt.matrixWorld,Pe.matrix),Pe.matrixWorldInverse.copy(Pe.matrixWorld).invert()}this.updateCamera=function(Pe){if(null===r)return;null!==D.texture&&(Pe.near=D.depthNear,Pe.far=D.depthFar),G.near=oe.near=K.near=Pe.near,G.far=oe.far=K.far=Pe.far,(ce!==G.near||Se!==G.far)&&(r.updateRenderState({depthNear:G.near,depthFar:G.far}),ce=G.near,Se=G.far,K.near=ce,K.far=Se,oe.near=ce,oe.far=Se,K.updateProjectionMatrix(),oe.updateProjectionMatrix(),Pe.updateProjectionMatrix());const nt=Pe.parent,It=G.cameras;bt(G,nt);for(let pt=0;pt<It.length;pt++)bt(It[pt],nt);2===It.length?function De(Pe,nt,It){Ae.setFromMatrixPosition(nt.matrixWorld),Ke.setFromMatrixPosition(It.matrixWorld);const pt=Ae.distanceTo(Ke),mn=nt.projectionMatrix.elements,Dn=It.projectionMatrix.elements,yn=mn[14]/(mn[10]-1),ii=mn[14]/(mn[10]+1),Y=(mn[9]+1)/mn[5],it=(mn[9]-1)/mn[5],Ze=(mn[8]-1)/mn[0],gt=(Dn[8]+1)/Dn[0],Ue=yn*Ze,rn=yn*gt,vt=pt/(-Ze+gt),Ft=vt*-Ze;nt.matrixWorld.decompose(Pe.position,Pe.quaternion,Pe.scale),Pe.translateX(Ft),Pe.translateZ(vt),Pe.matrixWorld.compose(Pe.position,Pe.quaternion,Pe.scale),Pe.matrixWorldInverse.copy(Pe.matrixWorld).invert();const re=yn+vt,W=ii+vt;Pe.projectionMatrix.makePerspective(Ue-Ft,rn+(pt-Ft),Y*ii/W*re,it*ii/W*re,re,W),Pe.projectionMatrixInverse.copy(Pe.projectionMatrix).invert()}(G,K,oe):G.projectionMatrix.copy(K.projectionMatrix),function Ut(Pe,nt,It){null===It?Pe.matrix.copy(nt.matrixWorld):(Pe.matrix.copy(It.matrixWorld),Pe.matrix.invert(),Pe.matrix.multiply(nt.matrixWorld)),Pe.matrix.decompose(Pe.position,Pe.quaternion,Pe.scale),Pe.updateMatrixWorld(!0),Pe.projectionMatrix.copy(nt.projectionMatrix),Pe.projectionMatrixInverse.copy(nt.projectionMatrixInverse),Pe.isPerspectiveCamera&&(Pe.fov=2*em*Math.atan(1/Pe.projectionMatrix.elements[5]),Pe.zoom=1)}(Pe,G,nt)},this.getCamera=function(){return G},this.getFoveation=function(){if(null!==x||null!==M)return h},this.setFoveation=function(Pe){h=Pe,null!==x&&(x.fixedFoveation=Pe),null!==M&&void 0!==M.fixedFoveation&&(M.fixedFoveation=Pe)},this.hasDepthSensing=function(){return null!==D.texture},this.getDepthSensingMesh=function(){return D.getMesh(G)};let Rt=null;const ci=new A2;ci.setAnimationLoop(function Vn(Pe,nt){if(g=nt.getViewerPose(f||a),E=nt,null!==g){const It=g.views;null!==M&&(e.setRenderTargetFramebuffer(I,M.framebuffer),e.setRenderTarget(I));let pt=!1;It.length!==G.cameras.length&&(G.cameras.length=0,pt=!0);for(let Dn=0;Dn<It.length;Dn++){const yn=It[Dn];let ii=null;if(null!==M)ii=M.getViewport(yn);else{const it=_.getViewSubImage(x,yn);ii=it.viewport,0===Dn&&(e.setRenderTargetTextures(I,it.colorTexture,x.ignoreDepthValues?void 0:it.depthStencilTexture),e.setRenderTarget(I))}let Y=j[Dn];void 0===Y&&(Y=new gs,Y.layers.enable(Dn),Y.viewport=new wi,j[Dn]=Y),Y.matrix.fromArray(yn.transform.matrix),Y.matrix.decompose(Y.position,Y.quaternion,Y.scale),Y.projectionMatrix.fromArray(yn.projectionMatrix),Y.projectionMatrixInverse.copy(Y.projectionMatrix).invert(),Y.viewport.set(ii.x,ii.y,ii.width,ii.height),0===Dn&&(G.matrix.copy(Y.matrix),G.matrix.decompose(G.position,G.quaternion,G.scale)),!0===pt&&G.cameras.push(Y)}const mn=r.enabledFeatures;if(mn&&mn.includes("depth-sensing")){const Dn=_.getDepthInformation(It[0]);Dn&&Dn.isValid&&Dn.texture&&D.init(e,Dn,r.renderState)}}for(let It=0;It<N.length;It++){const pt=O[It],mn=N[It];null!==pt&&void 0!==mn&&mn.update(pt,nt,f||a)}Rt&&Rt(Pe,nt),nt.detectedPlanes&&i.dispatchEvent({type:"planesdetected",data:nt}),E=null}),this.setAnimationLoop=function(Pe){Rt=Pe},this.dispose=function(){}}}const Nd=new _c,zY=new cn;function HY(n,e){function t(C,S){!0===C.matrixAutoUpdate&&C.updateMatrix(),S.value.copy(C.matrix)}function o(C,S){C.opacity.value=S.opacity,S.color&&C.diffuse.value.copy(S.color),S.emissive&&C.emissive.value.copy(S.emissive).multiplyScalar(S.emissiveIntensity),S.map&&(C.map.value=S.map,t(S.map,C.mapTransform)),S.alphaMap&&(C.alphaMap.value=S.alphaMap,t(S.alphaMap,C.alphaMapTransform)),S.bumpMap&&(C.bumpMap.value=S.bumpMap,t(S.bumpMap,C.bumpMapTransform),C.bumpScale.value=S.bumpScale,1===S.side&&(C.bumpScale.value*=-1)),S.normalMap&&(C.normalMap.value=S.normalMap,t(S.normalMap,C.normalMapTransform),C.normalScale.value.copy(S.normalScale),1===S.side&&C.normalScale.value.negate()),S.displacementMap&&(C.displacementMap.value=S.displacementMap,t(S.displacementMap,C.displacementMapTransform),C.displacementScale.value=S.displacementScale,C.displacementBias.value=S.displacementBias),S.emissiveMap&&(C.emissiveMap.value=S.emissiveMap,t(S.emissiveMap,C.emissiveMapTransform)),S.specularMap&&(C.specularMap.value=S.specularMap,t(S.specularMap,C.specularMapTransform)),S.alphaTest>0&&(C.alphaTest.value=S.alphaTest);const I=e.get(S),N=I.envMap,O=I.envMapRotation;N&&(C.envMap.value=N,Nd.copy(O),Nd.x*=-1,Nd.y*=-1,Nd.z*=-1,N.isCubeTexture&&!1===N.isRenderTargetTexture&&(Nd.y*=-1,Nd.z*=-1),C.envMapRotation.value.setFromMatrix4(zY.makeRotationFromEuler(Nd)),C.flipEnvMap.value=N.isCubeTexture&&!1===N.isRenderTargetTexture?-1:1,C.reflectivity.value=S.reflectivity,C.ior.value=S.ior,C.refractionRatio.value=S.refractionRatio),S.lightMap&&(C.lightMap.value=S.lightMap,C.lightMapIntensity.value=S.lightMapIntensity,t(S.lightMap,C.lightMapTransform)),S.aoMap&&(C.aoMap.value=S.aoMap,C.aoMapIntensity.value=S.aoMapIntensity,t(S.aoMap,C.aoMapTransform))}return{refreshFogUniforms:function i(C,S){S.color.getRGB(C.fogColor.value,S2(n)),S.isFog?(C.fogNear.value=S.near,C.fogFar.value=S.far):S.isFogExp2&&(C.fogDensity.value=S.density)},refreshMaterialUniforms:function r(C,S,I,N,O){S.isMeshBasicMaterial||S.isMeshLambertMaterial?o(C,S):S.isMeshToonMaterial?(o(C,S),function _(C,S){S.gradientMap&&(C.gradientMap.value=S.gradientMap)}(C,S)):S.isMeshPhongMaterial?(o(C,S),function g(C,S){C.specular.value.copy(S.specular),C.shininess.value=Math.max(S.shininess,1e-4)}(C,S)):S.isMeshStandardMaterial?(o(C,S),function x(C,S){C.metalness.value=S.metalness,S.metalnessMap&&(C.metalnessMap.value=S.metalnessMap,t(S.metalnessMap,C.metalnessMapTransform)),C.roughness.value=S.roughness,S.roughnessMap&&(C.roughnessMap.value=S.roughnessMap,t(S.roughnessMap,C.roughnessMapTransform)),S.envMap&&(C.envMapIntensity.value=S.envMapIntensity)}(C,S),S.isMeshPhysicalMaterial&&function M(C,S,I){C.ior.value=S.ior,S.sheen>0&&(C.sheenColor.value.copy(S.sheenColor).multiplyScalar(S.sheen),C.sheenRoughness.value=S.sheenRoughness,S.sheenColorMap&&(C.sheenColorMap.value=S.sheenColorMap,t(S.sheenColorMap,C.sheenColorMapTransform)),S.sheenRoughnessMap&&(C.sheenRoughnessMap.value=S.sheenRoughnessMap,t(S.sheenRoughnessMap,C.sheenRoughnessMapTransform))),S.clearcoat>0&&(C.clearcoat.value=S.clearcoat,C.clearcoatRoughness.value=S.clearcoatRoughness,S.clearcoatMap&&(C.clearcoatMap.value=S.clearcoatMap,t(S.clearcoatMap,C.clearcoatMapTransform)),S.clearcoatRoughnessMap&&(C.clearcoatRoughnessMap.value=S.clearcoatRoughnessMap,t(S.clearcoatRoughnessMap,C.clearcoatRoughnessMapTransform)),S.clearcoatNormalMap&&(C.clearcoatNormalMap.value=S.clearcoatNormalMap,t(S.clearcoatNormalMap,C.clearcoatNormalMapTransform),C.clearcoatNormalScale.value.copy(S.clearcoatNormalScale),1===S.side&&C.clearcoatNormalScale.value.negate())),S.dispersion>0&&(C.dispersion.value=S.dispersion),S.iridescence>0&&(C.iridescence.value=S.iridescence,C.iridescenceIOR.value=S.iridescenceIOR,C.iridescenceThicknessMinimum.value=S.iridescenceThicknessRange[0],C.iridescenceThicknessMaximum.value=S.iridescenceThicknessRange[1],S.iridescenceMap&&(C.iridescenceMap.value=S.iridescenceMap,t(S.iridescenceMap,C.iridescenceMapTransform)),S.iridescenceThicknessMap&&(C.iridescenceThicknessMap.value=S.iridescenceThicknessMap,t(S.iridescenceThicknessMap,C.iridescenceThicknessMapTransform))),S.transmission>0&&(C.transmission.value=S.transmission,C.transmissionSamplerMap.value=I.texture,C.transmissionSamplerSize.value.set(I.width,I.height),S.transmissionMap&&(C.transmissionMap.value=S.transmissionMap,t(S.transmissionMap,C.transmissionMapTransform)),C.thickness.value=S.thickness,S.thicknessMap&&(C.thicknessMap.value=S.thicknessMap,t(S.thicknessMap,C.thicknessMapTransform)),C.attenuationDistance.value=S.attenuationDistance,C.attenuationColor.value.copy(S.attenuationColor)),S.anisotropy>0&&(C.anisotropyVector.value.set(S.anisotropy*Math.cos(S.anisotropyRotation),S.anisotropy*Math.sin(S.anisotropyRotation)),S.anisotropyMap&&(C.anisotropyMap.value=S.anisotropyMap,t(S.anisotropyMap,C.anisotropyMapTransform))),C.specularIntensity.value=S.specularIntensity,C.specularColor.value.copy(S.specularColor),S.specularColorMap&&(C.specularColorMap.value=S.specularColorMap,t(S.specularColorMap,C.specularColorMapTransform)),S.specularIntensityMap&&(C.specularIntensityMap.value=S.specularIntensityMap,t(S.specularIntensityMap,C.specularIntensityMapTransform))}(C,S,O)):S.isMeshMatcapMaterial?(o(C,S),function E(C,S){S.matcap&&(C.matcap.value=S.matcap)}(C,S)):S.isMeshDepthMaterial?o(C,S):S.isMeshDistanceMaterial?(o(C,S),function D(C,S){const I=e.get(S).light;C.referencePosition.value.setFromMatrixPosition(I.matrixWorld),C.nearDistance.value=I.shadow.camera.near,C.farDistance.value=I.shadow.camera.far}(C,S)):S.isMeshNormalMaterial?o(C,S):S.isLineBasicMaterial?(function a(C,S){C.diffuse.value.copy(S.color),C.opacity.value=S.opacity,S.map&&(C.map.value=S.map,t(S.map,C.mapTransform))}(C,S),S.isLineDashedMaterial&&function u(C,S){C.dashSize.value=S.dashSize,C.totalSize.value=S.dashSize+S.gapSize,C.scale.value=S.scale}(C,S)):S.isPointsMaterial?function h(C,S,I,N){C.diffuse.value.copy(S.color),C.opacity.value=S.opacity,C.size.value=S.size*I,C.scale.value=.5*N,S.map&&(C.map.value=S.map,t(S.map,C.uvTransform)),S.alphaMap&&(C.alphaMap.value=S.alphaMap,t(S.alphaMap,C.alphaMapTransform)),S.alphaTest>0&&(C.alphaTest.value=S.alphaTest)}(C,S,I,N):S.isSpriteMaterial?function f(C,S){C.diffuse.value.copy(S.color),C.opacity.value=S.opacity,C.rotation.value=S.rotation,S.map&&(C.map.value=S.map,t(S.map,C.mapTransform)),S.alphaMap&&(C.alphaMap.value=S.alphaMap,t(S.alphaMap,C.alphaMapTransform)),S.alphaTest>0&&(C.alphaTest.value=S.alphaTest)}(C,S):S.isShadowMaterial?(C.color.value.copy(S.color),C.opacity.value=S.opacity):S.isShaderMaterial&&(S.uniformsNeedUpdate=!1)}}}function GY(n,e,t,i){let r={},o={},a=[];const u=n.getParameter(n.MAX_UNIFORM_BUFFER_BINDINGS);function M(I,N,O,ne){const $=I.value,K=N+"_"+O;if(void 0===ne[K])return ne[K]="number"==typeof $||"boolean"==typeof $?$:$.clone(),!0;{const oe=ne[K];if("number"==typeof $||"boolean"==typeof $){if(oe!==$)return ne[K]=$,!0}else if(!1===oe.equals($))return oe.copy($),!0}return!1}function D(I){const N={boundary:0,storage:0};return"number"==typeof I||"boolean"==typeof I?(N.boundary=4,N.storage=4):I.isVector2?(N.boundary=8,N.storage=8):I.isVector3||I.isColor?(N.boundary=16,N.storage=12):I.isVector4?(N.boundary=16,N.storage=16):I.isMatrix3?(N.boundary=48,N.storage=48):I.isMatrix4?(N.boundary=64,N.storage=64):I.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",I),N}function C(I){const N=I.target;N.removeEventListener("dispose",C);const O=a.indexOf(N.__bindingPointIndex);a.splice(O,1),n.deleteBuffer(r[N.id]),delete r[N.id],delete o[N.id]}return{bind:function h(I,N){i.uniformBlockBinding(I,N.program)},update:function f(I,N){let O=r[I.id];void 0===O&&(function E(I){const N=I.uniforms;let O=0;for(let K=0,oe=N.length;K<oe;K++){const j=Array.isArray(N[K])?N[K]:[N[K]];for(let G=0,ce=j.length;G<ce;G++){const Se=j[G],xe=Array.isArray(Se.value)?Se.value:[Se.value];for(let Ce=0,Be=xe.length;Ce<Be;Ce++){const Ke=D(xe[Ce]),De=O%16;0!==De&&16-De<Ke.boundary&&(O+=16-De),Se.__data=new Float32Array(Ke.storage/Float32Array.BYTES_PER_ELEMENT),Se.__offset=O,O+=Ke.storage}}}const $=O%16;$>0&&(O+=16-$),I.__size=O,I.__cache={}}(I),O=function g(I){const N=function _(){for(let I=0;I<u;I++)if(-1===a.indexOf(I))return a.push(I),I;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}();I.__bindingPointIndex=N;const O=n.createBuffer(),ne=I.__size,$=I.usage;return n.bindBuffer(n.UNIFORM_BUFFER,O),n.bufferData(n.UNIFORM_BUFFER,ne,$),n.bindBuffer(n.UNIFORM_BUFFER,null),n.bindBufferBase(n.UNIFORM_BUFFER,N,O),O}(I),r[I.id]=O,I.addEventListener("dispose",C)),i.updateUBOMapping(I,N.program);const $=e.render.frame;o[I.id]!==$&&(function x(I){const O=I.uniforms,ne=I.__cache;n.bindBuffer(n.UNIFORM_BUFFER,r[I.id]);for(let $=0,K=O.length;$<K;$++){const oe=Array.isArray(O[$])?O[$]:[O[$]];for(let j=0,G=oe.length;j<G;j++){const ce=oe[j];if(!0===M(ce,$,j,ne)){const Se=ce.__offset,xe=Array.isArray(ce.value)?ce.value:[ce.value];let Ce=0;for(let Be=0;Be<xe.length;Be++){const Ae=xe[Be],Ke=D(Ae);"number"==typeof Ae||"boolean"==typeof Ae?(ce.__data[0]=Ae,n.bufferSubData(n.UNIFORM_BUFFER,Se+Ce,ce.__data)):Ae.isMatrix3?(ce.__data[0]=Ae.elements[0],ce.__data[1]=Ae.elements[1],ce.__data[2]=Ae.elements[2],ce.__data[3]=0,ce.__data[4]=Ae.elements[3],ce.__data[5]=Ae.elements[4],ce.__data[6]=Ae.elements[5],ce.__data[7]=0,ce.__data[8]=Ae.elements[6],ce.__data[9]=Ae.elements[7],ce.__data[10]=Ae.elements[8],ce.__data[11]=0):(Ae.toArray(ce.__data,Ce),Ce+=Ke.storage/Float32Array.BYTES_PER_ELEMENT)}n.bufferSubData(n.UNIFORM_BUFFER,Se,ce.__data)}}}n.bindBuffer(n.UNIFORM_BUFFER,null)}(I),o[I.id]=$)},dispose:function S(){for(const I in r)n.deleteBuffer(r[I]);a=[],r={},o={}}}}class WY{constructor(e={}){const{canvas:t=pX(),context:i=null,depth:r=!0,stencil:o=!1,alpha:a=!1,antialias:u=!1,premultipliedAlpha:h=!0,preserveDrawingBuffer:f=!1,powerPreference:g="default",failIfMajorPerformanceCaveat:_=!1}=e;let x;if(this.isWebGLRenderer=!0,null!==i){if(typeof WebGLRenderingContext<"u"&&i instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");x=i.getContextAttributes().alpha}else x=a;const M=new Uint32Array(4),E=new Int32Array(4);let D=null,C=null;const S=[],I=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=Ba,this.toneMapping=Nu,this.toneMappingExposure=1;const N=this;let O=!1,ne=0,$=0,K=null,oe=-1,j=null;const G=new wi,ce=new wi;let Se=null;const xe=new wt(0);let Ce=0,Be=t.width,Ae=t.height,Ke=1,De=null,bt=null;const Ut=new wi(0,0,Be,Ae),Rt=new wi(0,0,Be,Ae);let Vn=!1;const ci=new Hx;let Pe=!1,nt=!1;const It=new cn,pt=new Q,mn=new wi,Dn={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let yn=!1;function ii(){return null===K?Ke:1}let Ze,gt,Ue,rn,vt,Ft,re,W,we,qe,Xe,We,Jt,ft,Pt,Rn,et,Et,Jn,Mn,Bt,Sn,Gn,ur,Y=i;function it(X,fe){return t.getContext(X,fe)}try{const X={alpha:!0,depth:r,stencil:o,antialias:u,premultipliedAlpha:h,preserveDrawingBuffer:f,powerPreference:g,failIfMajorPerformanceCaveat:_};if("setAttribute"in t&&t.setAttribute("data-engine","three.js r166"),t.addEventListener("webglcontextlost",ke,!1),t.addEventListener("webglcontextrestored",ze,!1),t.addEventListener("webglcontextcreationerror",ct,!1),null===Y){const fe="webgl2";if(Y=it(fe,X),null===Y)throw it(fe)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(X){throw console.error("THREE.WebGLRenderer: "+X.message),X}function pe(){Ze=new Zq(Y),Ze.init(),Sn=new NY(Y,Ze),gt=new Wq(Y,Ze,e,Sn),Ue=new AY(Y),rn=new Qq(Y),vt=new gY,Ft=new LY(Y,Ze,Ue,vt,gt,Sn,rn),re=new $q(N),W=new Yq(N),we=new VX(Y),Gn=new Hq(Y,we),qe=new Jq(Y,we,rn,Gn),Xe=new t7(Y,qe,we,rn),Jn=new e7(Y,gt,Ft),Rn=new jq(vt),We=new mY(N,re,W,Ze,gt,Gn,Rn),Jt=new HY(N,vt),ft=new yY,Pt=new EY(Ze),Et=new zq(N,re,W,Ue,Xe,x,h),et=new CY(N,Xe,gt),ur=new GY(Y,rn,gt,Ue),Mn=new Gq(Y,Ze,rn),Bt=new Kq(Y,Ze,rn),rn.programs=We.programs,N.capabilities=gt,N.extensions=Ze,N.properties=vt,N.renderLists=ft,N.shadowMap=et,N.state=Ue,N.info=rn}pe();const rt=new VY(N,Y);function ke(X){X.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),O=!0}function ze(){console.log("THREE.WebGLRenderer: Context Restored."),O=!1;const X=rn.autoReset,fe=et.enabled,_e=et.autoUpdate,be=et.needsUpdate,ge=et.type;pe(),rn.autoReset=X,et.enabled=fe,et.autoUpdate=_e,et.needsUpdate=be,et.type=ge}function ct(X){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",X.statusMessage)}function gn(X){const fe=X.target;fe.removeEventListener("dispose",gn),function ei(X){(function Or(X){const fe=vt.get(X).programs;void 0!==fe&&(fe.forEach(function(_e){We.releaseProgram(_e)}),X.isShaderMaterial&&We.releaseShaderCache(X))})(X),vt.remove(X)}(fe)}function vs(X,fe,_e){!0===X.transparent&&2===X.side&&!1===X.forceSinglePass?(X.side=1,X.needsUpdate=!0,NM(X,fe,_e),X.side=0,X.needsUpdate=!0,NM(X,fe,_e),X.side=2):NM(X,fe,_e)}this.xr=rt,this.getContext=function(){return Y},this.getContextAttributes=function(){return Y.getContextAttributes()},this.forceContextLoss=function(){const X=Ze.get("WEBGL_lose_context");X&&X.loseContext()},this.forceContextRestore=function(){const X=Ze.get("WEBGL_lose_context");X&&X.restoreContext()},this.getPixelRatio=function(){return Ke},this.setPixelRatio=function(X){void 0!==X&&(Ke=X,this.setSize(Be,Ae,!1))},this.getSize=function(X){return X.set(Be,Ae)},this.setSize=function(X,fe,_e=!0){rt.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(Be=X,Ae=fe,t.width=Math.floor(X*Ke),t.height=Math.floor(fe*Ke),!0===_e&&(t.style.width=X+"px",t.style.height=fe+"px"),this.setViewport(0,0,X,fe))},this.getDrawingBufferSize=function(X){return X.set(Be*Ke,Ae*Ke).floor()},this.setDrawingBufferSize=function(X,fe,_e){Be=X,Ae=fe,Ke=_e,t.width=Math.floor(X*_e),t.height=Math.floor(fe*_e),this.setViewport(0,0,X,fe)},this.getCurrentViewport=function(X){return X.copy(G)},this.getViewport=function(X){return X.copy(Ut)},this.setViewport=function(X,fe,_e,be){X.isVector4?Ut.set(X.x,X.y,X.z,X.w):Ut.set(X,fe,_e,be),Ue.viewport(G.copy(Ut).multiplyScalar(Ke).round())},this.getScissor=function(X){return X.copy(Rt)},this.setScissor=function(X,fe,_e,be){X.isVector4?Rt.set(X.x,X.y,X.z,X.w):Rt.set(X,fe,_e,be),Ue.scissor(ce.copy(Rt).multiplyScalar(Ke).round())},this.getScissorTest=function(){return Vn},this.setScissorTest=function(X){Ue.setScissorTest(Vn=X)},this.setOpaqueSort=function(X){De=X},this.setTransparentSort=function(X){bt=X},this.getClearColor=function(X){return X.copy(Et.getClearColor())},this.setClearColor=function(){Et.setClearColor.apply(Et,arguments)},this.getClearAlpha=function(){return Et.getClearAlpha()},this.setClearAlpha=function(){Et.setClearAlpha.apply(Et,arguments)},this.clear=function(X=!0,fe=!0,_e=!0){let be=0;if(X){let ge=!1;if(null!==K){const ot=K.texture.format;ge=ot===cT||ot===lT||ot===lx}if(ge){const ot=K.texture.type,xt=ot===pc||ot===Fu||ot===zv||ot===Xp||ot===sT||ot===oT,zt=Et.getClearColor(),Ht=Et.getClearAlpha(),un=zt.r,_n=zt.g,hn=zt.b;xt?(M[0]=un,M[1]=_n,M[2]=hn,M[3]=Ht,Y.clearBufferuiv(Y.COLOR,0,M)):(E[0]=un,E[1]=_n,E[2]=hn,E[3]=Ht,Y.clearBufferiv(Y.COLOR,0,E))}else be|=Y.COLOR_BUFFER_BIT}fe&&(be|=Y.DEPTH_BUFFER_BIT),_e&&(be|=Y.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),Y.clear(be)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",ke,!1),t.removeEventListener("webglcontextrestored",ze,!1),t.removeEventListener("webglcontextcreationerror",ct,!1),ft.dispose(),Pt.dispose(),vt.dispose(),re.dispose(),W.dispose(),Xe.dispose(),Gn.dispose(),ur.dispose(),We.dispose(),rt.dispose(),rt.removeEventListener("sessionstart",Ml),rt.removeEventListener("sessionend",EU),Wd.stop()},this.renderBufferDirect=function(X,fe,_e,be,ge,ot){null===fe&&(fe=Dn);const xt=ge.isMesh&&ge.matrixWorld.determinant()<0,zt=function zJ(X,fe,_e,be,ge){!0!==fe.isScene&&(fe=Dn),Ft.resetTextureUnits();const ot=fe.fog,zt=null===K?N.outputColorSpace:!0===K.isXRRenderTarget?K.texture.colorSpace:Bu,Ht=(be.isMeshStandardMaterial?W:re).get(be.envMap||(be.isMeshStandardMaterial?fe.environment:null)),un=!0===be.vertexColors&&!!_e.attributes.color&&4===_e.attributes.color.itemSize,_n=!!_e.attributes.tangent&&(!!be.normalMap||be.anisotropy>0),hn=!!_e.morphAttributes.position,ui=!!_e.morphAttributes.normal,Xi=!!_e.morphAttributes.color;let xr=Nu;be.toneMapped&&(null===K||!0===K.isXRRenderTarget)&&(xr=N.toneMapping);const Bo=_e.morphAttributes.position||_e.morphAttributes.normal||_e.morphAttributes.color,vi=void 0!==Bo?Bo.length:0,Xt=vt.get(be),ys=C.state.lights;!0!==Pe||!0!==nt&&X===j||Rn.setState(be,X,X===j&&be.id===oe);let yi=!1;be.version===Xt.__version?(Xt.needsLights&&Xt.lightsStateVersion!==ys.state.version||Xt.outputColorSpace!==zt||ge.isBatchedMesh&&!1===Xt.batching||!ge.isBatchedMesh&&!0===Xt.batching||ge.isBatchedMesh&&!0===Xt.batchingColor&&null===ge.colorTexture||ge.isBatchedMesh&&!1===Xt.batchingColor&&null!==ge.colorTexture||ge.isInstancedMesh&&!1===Xt.instancing||!ge.isInstancedMesh&&!0===Xt.instancing||ge.isSkinnedMesh&&!1===Xt.skinning||!ge.isSkinnedMesh&&!0===Xt.skinning||ge.isInstancedMesh&&!0===Xt.instancingColor&&null===ge.instanceColor||ge.isInstancedMesh&&!1===Xt.instancingColor&&null!==ge.instanceColor||ge.isInstancedMesh&&!0===Xt.instancingMorph&&null===ge.morphTexture||ge.isInstancedMesh&&!1===Xt.instancingMorph&&null!==ge.morphTexture||Xt.envMap!==Ht||!0===be.fog&&Xt.fog!==ot||void 0!==Xt.numClippingPlanes&&(Xt.numClippingPlanes!==Rn.numPlanes||Xt.numIntersection!==Rn.numIntersection)||Xt.vertexAlphas!==un||Xt.vertexTangents!==_n||Xt.morphTargets!==hn||Xt.morphNormals!==ui||Xt.morphColors!==Xi||Xt.toneMapping!==xr||Xt.morphTargetsCount!==vi)&&(yi=!0):(yi=!0,Xt.__version=be.version);let Ha=Xt.currentProgram;!0===yi&&(Ha=NM(be,fe,ge));let Fm=!1,ko=!1,cA=!1;const Fr=Ha.getUniforms(),Yu=Xt.uniforms;if(Ue.useProgram(Ha.program)&&(Fm=!0,ko=!0,cA=!0),be.id!==oe&&(oe=be.id,ko=!0),Fm||j!==X){Fr.setValue(Y,"projectionMatrix",X.projectionMatrix),Fr.setValue(Y,"viewMatrix",X.matrixWorldInverse);const la=Fr.map.cameraPosition;void 0!==la&&la.setValue(Y,pt.setFromMatrixPosition(X.matrixWorld)),gt.logarithmicDepthBuffer&&Fr.setValue(Y,"logDepthBufFC",2/(Math.log(X.far+1)/Math.LN2)),(be.isMeshPhongMaterial||be.isMeshToonMaterial||be.isMeshLambertMaterial||be.isMeshBasicMaterial||be.isMeshStandardMaterial||be.isShaderMaterial)&&Fr.setValue(Y,"isOrthographic",!0===X.isOrthographicCamera),j!==X&&(j=X,ko=!0,cA=!0)}if(ge.isSkinnedMesh){Fr.setOptional(Y,ge,"bindMatrix"),Fr.setOptional(Y,ge,"bindMatrixInverse");const la=ge.skeleton;la&&(null===la.boneTexture&&la.computeBoneTexture(),Fr.setValue(Y,"boneTexture",la.boneTexture,Ft))}ge.isBatchedMesh&&(Fr.setOptional(Y,ge,"batchingTexture"),Fr.setValue(Y,"batchingTexture",ge._matricesTexture,Ft),Fr.setOptional(Y,ge,"batchingIdTexture"),Fr.setValue(Y,"batchingIdTexture",ge._indirectTexture,Ft),Fr.setOptional(Y,ge,"batchingColorTexture"),null!==ge._colorsTexture&&Fr.setValue(Y,"batchingColorTexture",ge._colorsTexture,Ft));const uA=_e.morphAttributes;if((void 0!==uA.position||void 0!==uA.normal||void 0!==uA.color)&&Jn.update(ge,_e,Ha),(ko||Xt.receiveShadow!==ge.receiveShadow)&&(Xt.receiveShadow=ge.receiveShadow,Fr.setValue(Y,"receiveShadow",ge.receiveShadow)),be.isMeshGouraudMaterial&&null!==be.envMap&&(Yu.envMap.value=Ht,Yu.flipEnvMap.value=Ht.isCubeTexture&&!1===Ht.isRenderTargetTexture?-1:1),be.isMeshStandardMaterial&&null===be.envMap&&null!==fe.environment&&(Yu.envMapIntensity.value=fe.environmentIntensity),ko&&(Fr.setValue(Y,"toneMappingExposure",N.toneMappingExposure),Xt.needsLights&&function HJ(X,fe){X.ambientLightColor.needsUpdate=fe,X.lightProbe.needsUpdate=fe,X.directionalLights.needsUpdate=fe,X.directionalLightShadows.needsUpdate=fe,X.pointLights.needsUpdate=fe,X.pointLightShadows.needsUpdate=fe,X.spotLights.needsUpdate=fe,X.spotLightShadows.needsUpdate=fe,X.rectAreaLights.needsUpdate=fe,X.hemisphereLights.needsUpdate=fe}(Yu,cA),ot&&!0===be.fog&&Jt.refreshFogUniforms(Yu,ot),Jt.refreshMaterialUniforms(Yu,be,Ke,Ae,C.state.transmissionRenderTarget[X.id]),$x.upload(Y,AU(Xt),Yu,Ft)),be.isShaderMaterial&&!0===be.uniformsNeedUpdate&&($x.upload(Y,AU(Xt),Yu,Ft),be.uniformsNeedUpdate=!1),be.isSpriteMaterial&&Fr.setValue(Y,"center",ge.center),Fr.setValue(Y,"modelViewMatrix",ge.modelViewMatrix),Fr.setValue(Y,"normalMatrix",ge.normalMatrix),Fr.setValue(Y,"modelMatrix",ge.matrixWorld),be.isShaderMaterial||be.isRawShaderMaterial){const la=be.uniformsGroups;for(let hA=0,WJ=la.length;hA<WJ;hA++){const RU=la[hA];ur.update(RU,Ha),ur.bind(RU,Ha)}}return Ha}(X,fe,_e,be,ge);Ue.setMaterial(be,xt);let Ht=_e.index,un=1;if(!0===be.wireframe){if(Ht=qe.getWireframeAttribute(_e),void 0===Ht)return;un=2}const _n=_e.drawRange,hn=_e.attributes.position;let ui=_n.start*un,Xi=(_n.start+_n.count)*un;null!==ot&&(ui=Math.max(ui,ot.start*un),Xi=Math.min(Xi,(ot.start+ot.count)*un)),null!==Ht?(ui=Math.max(ui,0),Xi=Math.min(Xi,Ht.count)):null!=hn&&(ui=Math.max(ui,0),Xi=Math.min(Xi,hn.count));const xr=Xi-ui;if(xr<0||xr===1/0)return;Gn.setup(ge,be,zt,_e,Ht);let Bo,vi=Mn;if(null!==Ht&&(Bo=we.get(Ht),vi=Bt,vi.setIndex(Bo)),ge.isMesh)!0===be.wireframe?(Ue.setLineWidth(be.wireframeLinewidth*ii()),vi.setMode(Y.LINES)):vi.setMode(Y.TRIANGLES);else if(ge.isLine){let Xt=be.linewidth;void 0===Xt&&(Xt=1),Ue.setLineWidth(Xt*ii()),vi.setMode(ge.isLineSegments?Y.LINES:ge.isLineLoop?Y.LINE_LOOP:Y.LINE_STRIP)}else ge.isPoints?vi.setMode(Y.POINTS):ge.isSprite&&vi.setMode(Y.TRIANGLES);if(ge.isBatchedMesh)if(null!==ge._multiDrawInstances)vi.renderMultiDrawInstances(ge._multiDrawStarts,ge._multiDrawCounts,ge._multiDrawCount,ge._multiDrawInstances);else if(Ze.get("WEBGL_multi_draw"))vi.renderMultiDraw(ge._multiDrawStarts,ge._multiDrawCounts,ge._multiDrawCount);else{const Xt=ge._multiDrawStarts,ys=ge._multiDrawCounts,yi=ge._multiDrawCount,Ha=Ht?we.get(Ht).bytesPerElement:1,Fm=vt.get(be).currentProgram.getUniforms();for(let ko=0;ko<yi;ko++)Fm.setValue(Y,"_gl_DrawID",ko),vi.render(Xt[ko]/Ha,ys[ko])}else if(ge.isInstancedMesh)vi.renderInstances(ui,xr,ge.count);else if(_e.isInstancedBufferGeometry){const ys=Math.min(_e.instanceCount,void 0!==_e._maxInstanceCount?_e._maxInstanceCount:1/0);vi.renderInstances(ui,xr,ys)}else vi.render(ui,xr)},this.compile=function(X,fe,_e=null){null===_e&&(_e=X),C=Pt.get(_e),C.init(fe),I.push(C),_e.traverseVisible(function(ge){ge.isLight&&ge.layers.test(fe.layers)&&(C.pushLight(ge),ge.castShadow&&C.pushShadow(ge))}),X!==_e&&X.traverseVisible(function(ge){ge.isLight&&ge.layers.test(fe.layers)&&(C.pushLight(ge),ge.castShadow&&C.pushShadow(ge))}),C.setupLights();const be=new Set;return X.traverse(function(ge){const ot=ge.material;if(ot)if(Array.isArray(ot))for(let xt=0;xt<ot.length;xt++){const zt=ot[xt];vs(zt,_e,ge),be.add(zt)}else vs(ot,_e,ge),be.add(ot)}),I.pop(),C=null,be},this.compileAsync=function(X,fe,_e=null){const be=this.compile(X,fe,_e);return new Promise(ge=>{function ot(){be.forEach(function(xt){vt.get(xt).currentProgram.isReady()&&be.delete(xt)}),0!==be.size?setTimeout(ot,10):ge(X)}null!==Ze.get("KHR_parallel_shader_compile")?ot():setTimeout(ot,10)})};let gi=null;function Ml(){Wd.stop()}function EU(){Wd.start()}const Wd=new A2;function lA(X,fe,_e,be){if(!1===X.visible)return;if(X.layers.test(fe.layers))if(X.isGroup)_e=X.renderOrder;else if(X.isLOD)!0===X.autoUpdate&&X.update(fe);else if(X.isLight)C.pushLight(X),X.castShadow&&C.pushShadow(X);else if(X.isSprite){if(!X.frustumCulled||ci.intersectsSprite(X)){be&&mn.setFromMatrixPosition(X.matrixWorld).applyMatrix4(It);const xt=Xe.update(X),zt=X.material;zt.visible&&D.push(X,xt,zt,_e,mn.z,null)}}else if((X.isMesh||X.isLine||X.isPoints)&&(!X.frustumCulled||ci.intersectsObject(X))){const xt=Xe.update(X),zt=X.material;if(be&&(void 0!==X.boundingSphere?(null===X.boundingSphere&&X.computeBoundingSphere(),mn.copy(X.boundingSphere.center)):(null===xt.boundingSphere&&xt.computeBoundingSphere(),mn.copy(xt.boundingSphere.center)),mn.applyMatrix4(X.matrixWorld).applyMatrix4(It)),Array.isArray(zt)){const Ht=xt.groups;for(let un=0,_n=Ht.length;un<_n;un++){const hn=Ht[un],ui=zt[hn.materialIndex];ui&&ui.visible&&D.push(X,xt,ui,_e,mn.z,hn)}}else zt.visible&&D.push(X,xt,zt,_e,mn.z,null)}const ot=X.children;for(let xt=0,zt=ot.length;xt<zt;xt++)lA(ot[xt],fe,_e,be)}function SU(X,fe,_e,be){const ge=X.opaque,ot=X.transmissive,xt=X.transparent;C.setupLightsView(_e),!0===Pe&&Rn.setGlobalState(N.clippingPlanes,_e),be&&Ue.viewport(G.copy(be)),ge.length>0&&LM(ge,fe,_e),ot.length>0&&LM(ot,fe,_e),xt.length>0&&LM(xt,fe,_e),Ue.buffers.depth.setTest(!0),Ue.buffers.depth.setMask(!0),Ue.buffers.color.setMask(!0),Ue.setPolygonOffset(!1)}function TU(X,fe,_e,be){if(null!==(!0===_e.isScene?_e.overrideMaterial:null))return;void 0===C.state.transmissionRenderTarget[be.id]&&(C.state.transmissionRenderTarget[be.id]=new Sd(1,1,{generateMipmaps:!0,type:Ze.has("EXT_color_buffer_half_float")||Ze.has("EXT_color_buffer_float")?Hv:pc,minFilter:fc,samples:4,stencilBuffer:o,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:mi.workingColorSpace}));const ot=C.state.transmissionRenderTarget[be.id],xt=be.viewport||G;ot.setSize(xt.z,xt.w);const zt=N.getRenderTarget();N.setRenderTarget(ot),N.getClearColor(xe),Ce=N.getClearAlpha(),Ce<1&&N.setClearColor(16777215,.5),yn?Et.render(_e):N.clear();const Ht=N.toneMapping;N.toneMapping=Nu;const un=be.viewport;if(void 0!==be.viewport&&(be.viewport=void 0),C.setupLightsView(be),!0===Pe&&Rn.setGlobalState(N.clippingPlanes,be),LM(X,_e,be),Ft.updateMultisampleRenderTarget(ot),Ft.updateRenderTargetMipmap(ot),!1===Ze.has("WEBGL_multisampled_render_to_texture")){let _n=!1;for(let hn=0,ui=fe.length;hn<ui;hn++){const Xi=fe[hn],xr=Xi.object,Bo=Xi.geometry,vi=Xi.material,Xt=Xi.group;if(2===vi.side&&xr.layers.test(be.layers)){const ys=vi.side;vi.side=1,vi.needsUpdate=!0,CU(xr,_e,be,Bo,vi,Xt),vi.side=ys,vi.needsUpdate=!0,_n=!0}}!0===_n&&(Ft.updateMultisampleRenderTarget(ot),Ft.updateRenderTargetMipmap(ot))}N.setRenderTarget(zt),N.setClearColor(xe,Ce),void 0!==un&&(be.viewport=un),N.toneMapping=Ht}function LM(X,fe,_e){const be=!0===fe.isScene?fe.overrideMaterial:null;for(let ge=0,ot=X.length;ge<ot;ge++){const xt=X[ge],zt=xt.object,Ht=xt.geometry,un=null===be?xt.material:be,_n=xt.group;zt.layers.test(_e.layers)&&CU(zt,fe,_e,Ht,un,_n)}}function CU(X,fe,_e,be,ge,ot){X.onBeforeRender(N,fe,_e,be,ge,ot),X.modelViewMatrix.multiplyMatrices(_e.matrixWorldInverse,X.matrixWorld),X.normalMatrix.getNormalMatrix(X.modelViewMatrix),!0===ge.transparent&&2===ge.side&&!1===ge.forceSinglePass?(ge.side=1,ge.needsUpdate=!0,N.renderBufferDirect(_e,fe,be,ge,X,ot),ge.side=0,ge.needsUpdate=!0,N.renderBufferDirect(_e,fe,be,ge,X,ot),ge.side=2):N.renderBufferDirect(_e,fe,be,ge,X,ot),X.onAfterRender(N,fe,_e,be,ge,ot)}function NM(X,fe,_e){!0!==fe.isScene&&(fe=Dn);const be=vt.get(X),ge=C.state.lights,xt=ge.state.version,zt=We.getParameters(X,ge.state,C.state.shadowsArray,fe,_e),Ht=We.getProgramCacheKey(zt);let un=be.programs;be.environment=X.isMeshStandardMaterial?fe.environment:null,be.fog=fe.fog,be.envMap=(X.isMeshStandardMaterial?W:re).get(X.envMap||be.environment),be.envMapRotation=null!==be.environment&&null===X.envMap?fe.environmentRotation:X.envMapRotation,void 0===un&&(X.addEventListener("dispose",gn),un=new Map,be.programs=un);let _n=un.get(Ht);if(void 0!==_n){if(be.currentProgram===_n&&be.lightsStateVersion===xt)return DU(X,zt),_n}else zt.uniforms=We.getUniforms(X),X.onBeforeCompile(zt,N),_n=We.acquireProgram(zt,Ht),un.set(Ht,_n),be.uniforms=zt.uniforms;const hn=be.uniforms;return(!X.isShaderMaterial&&!X.isRawShaderMaterial||!0===X.clipping)&&(hn.clippingPlanes=Rn.uniform),DU(X,zt),be.needsLights=function GJ(X){return X.isMeshLambertMaterial||X.isMeshToonMaterial||X.isMeshPhongMaterial||X.isMeshStandardMaterial||X.isShadowMaterial||X.isShaderMaterial&&!0===X.lights}(X),be.lightsStateVersion=xt,be.needsLights&&(hn.ambientLightColor.value=ge.state.ambient,hn.lightProbe.value=ge.state.probe,hn.directionalLights.value=ge.state.directional,hn.directionalLightShadows.value=ge.state.directionalShadow,hn.spotLights.value=ge.state.spot,hn.spotLightShadows.value=ge.state.spotShadow,hn.rectAreaLights.value=ge.state.rectArea,hn.ltc_1.value=ge.state.rectAreaLTC1,hn.ltc_2.value=ge.state.rectAreaLTC2,hn.pointLights.value=ge.state.point,hn.pointLightShadows.value=ge.state.pointShadow,hn.hemisphereLights.value=ge.state.hemi,hn.directionalShadowMap.value=ge.state.directionalShadowMap,hn.directionalShadowMatrix.value=ge.state.directionalShadowMatrix,hn.spotShadowMap.value=ge.state.spotShadowMap,hn.spotLightMatrix.value=ge.state.spotLightMatrix,hn.spotLightMap.value=ge.state.spotLightMap,hn.pointShadowMap.value=ge.state.pointShadowMap,hn.pointShadowMatrix.value=ge.state.pointShadowMatrix),be.currentProgram=_n,be.uniformsList=null,_n}function AU(X){if(null===X.uniformsList){const fe=X.currentProgram.getUniforms();X.uniformsList=$x.seqWithValue(fe.seq,X.uniforms)}return X.uniformsList}function DU(X,fe){const _e=vt.get(X);_e.outputColorSpace=fe.outputColorSpace,_e.batching=fe.batching,_e.batchingColor=fe.batchingColor,_e.instancing=fe.instancing,_e.instancingColor=fe.instancingColor,_e.instancingMorph=fe.instancingMorph,_e.skinning=fe.skinning,_e.morphTargets=fe.morphTargets,_e.morphNormals=fe.morphNormals,_e.morphColors=fe.morphColors,_e.morphTargetsCount=fe.morphTargetsCount,_e.numClippingPlanes=fe.numClippingPlanes,_e.numIntersection=fe.numClipIntersection,_e.vertexAlphas=fe.vertexAlphas,_e.vertexTangents=fe.vertexTangents,_e.toneMapping=fe.toneMapping}Wd.setAnimationLoop(function Ac(X){gi&&gi(X)}),typeof self<"u"&&Wd.setContext(self),this.setAnimationLoop=function(X){gi=X,rt.setAnimationLoop(X),null===X?Wd.stop():Wd.start()},rt.addEventListener("sessionstart",Ml),rt.addEventListener("sessionend",EU),this.render=function(X,fe){if(void 0!==fe&&!0!==fe.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===O)return;if(!0===X.matrixWorldAutoUpdate&&X.updateMatrixWorld(),null===fe.parent&&!0===fe.matrixWorldAutoUpdate&&fe.updateMatrixWorld(),!0===rt.enabled&&!0===rt.isPresenting&&(!0===rt.cameraAutoUpdate&&rt.updateCamera(fe),fe=rt.getCamera()),!0===X.isScene&&X.onBeforeRender(N,X,fe,K),C=Pt.get(X,I.length),C.init(fe),I.push(C),It.multiplyMatrices(fe.projectionMatrix,fe.matrixWorldInverse),ci.setFromProjectionMatrix(It),nt=this.localClippingEnabled,Pe=Rn.init(this.clippingPlanes,nt),D=ft.get(X,S.length),D.init(),S.push(D),!0===rt.enabled&&!0===rt.isPresenting){const ot=N.xr.getDepthSensingMesh();null!==ot&&lA(ot,fe,-1/0,N.sortObjects)}lA(X,fe,0,N.sortObjects),D.finish(),!0===N.sortObjects&&D.sort(De,bt),yn=!1===rt.enabled||!1===rt.isPresenting||!1===rt.hasDepthSensing(),yn&&Et.addToRenderList(D,X),this.info.render.frame++,!0===Pe&&Rn.beginShadows(),et.render(C.state.shadowsArray,X,fe),!0===Pe&&Rn.endShadows(),!0===this.info.autoReset&&this.info.reset();const be=D.opaque,ge=D.transmissive;if(C.setupLights(),fe.isArrayCamera){const ot=fe.cameras;if(ge.length>0)for(let xt=0,zt=ot.length;xt<zt;xt++)TU(be,ge,X,ot[xt]);yn&&Et.render(X);for(let xt=0,zt=ot.length;xt<zt;xt++){const Ht=ot[xt];SU(D,X,Ht,Ht.viewport)}}else ge.length>0&&TU(be,ge,X,fe),yn&&Et.render(X),SU(D,X,fe);null!==K&&(Ft.updateMultisampleRenderTarget(K),Ft.updateRenderTargetMipmap(K)),!0===X.isScene&&X.onAfterRender(N,X,fe),Gn.resetDefaultState(),oe=-1,j=null,I.pop(),I.length>0?(C=I[I.length-1],!0===Pe&&Rn.setGlobalState(N.clippingPlanes,C.state.camera)):C=null,S.pop(),D=S.length>0?S[S.length-1]:null},this.getActiveCubeFace=function(){return ne},this.getActiveMipmapLevel=function(){return $},this.getRenderTarget=function(){return K},this.setRenderTargetTextures=function(X,fe,_e){vt.get(X.texture).__webglTexture=fe,vt.get(X.depthTexture).__webglTexture=_e;const be=vt.get(X);be.__hasExternalTextures=!0,be.__autoAllocateDepthBuffer=void 0===_e,be.__autoAllocateDepthBuffer||!0===Ze.has("WEBGL_multisampled_render_to_texture")&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),be.__useRenderToTexture=!1)},this.setRenderTargetFramebuffer=function(X,fe){const _e=vt.get(X);_e.__webglFramebuffer=fe,_e.__useDefaultFramebuffer=void 0===fe},this.setRenderTarget=function(X,fe=0,_e=0){K=X,ne=fe,$=_e;let be=!0,ge=null,ot=!1,xt=!1;if(X){const Ht=vt.get(X);void 0!==Ht.__useDefaultFramebuffer?(Ue.bindFramebuffer(Y.FRAMEBUFFER,null),be=!1):void 0===Ht.__webglFramebuffer?Ft.setupRenderTarget(X):Ht.__hasExternalTextures&&Ft.rebindTextures(X,vt.get(X.texture).__webglTexture,vt.get(X.depthTexture).__webglTexture);const un=X.texture;(un.isData3DTexture||un.isDataArrayTexture||un.isCompressedArrayTexture)&&(xt=!0);const _n=vt.get(X).__webglFramebuffer;X.isWebGLCubeRenderTarget?(ge=Array.isArray(_n[fe])?_n[fe][_e]:_n[fe],ot=!0):ge=X.samples>0&&!1===Ft.useMultisampledRTT(X)?vt.get(X).__webglMultisampledFramebuffer:Array.isArray(_n)?_n[_e]:_n,G.copy(X.viewport),ce.copy(X.scissor),Se=X.scissorTest}else G.copy(Ut).multiplyScalar(Ke).floor(),ce.copy(Rt).multiplyScalar(Ke).floor(),Se=Vn;if(Ue.bindFramebuffer(Y.FRAMEBUFFER,ge)&&be&&Ue.drawBuffers(X,ge),Ue.viewport(G),Ue.scissor(ce),Ue.setScissorTest(Se),ot){const Ht=vt.get(X.texture);Y.framebufferTexture2D(Y.FRAMEBUFFER,Y.COLOR_ATTACHMENT0,Y.TEXTURE_CUBE_MAP_POSITIVE_X+fe,Ht.__webglTexture,_e)}else if(xt){const Ht=vt.get(X.texture);Y.framebufferTextureLayer(Y.FRAMEBUFFER,Y.COLOR_ATTACHMENT0,Ht.__webglTexture,_e||0,fe||0)}oe=-1},this.readRenderTargetPixels=function(X,fe,_e,be,ge,ot,xt){if(!X||!X.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let zt=vt.get(X).__webglFramebuffer;if(X.isWebGLCubeRenderTarget&&void 0!==xt&&(zt=zt[xt]),zt){Ue.bindFramebuffer(Y.FRAMEBUFFER,zt);try{const Ht=X.texture,un=Ht.format,_n=Ht.type;if(!gt.textureFormatReadable(un))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!gt.textureTypeReadable(_n))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");fe>=0&&fe<=X.width-be&&_e>=0&&_e<=X.height-ge&&Y.readPixels(fe,_e,be,ge,Sn.convert(un),Sn.convert(_n),ot)}finally{const Ht=null!==K?vt.get(K).__webglFramebuffer:null;Ue.bindFramebuffer(Y.FRAMEBUFFER,Ht)}}},this.readRenderTargetPixelsAsync=function(){var X=FO(function*(fe,_e,be,ge,ot,xt,zt){if(!fe||!fe.isWebGLRenderTarget)throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let Ht=vt.get(fe).__webglFramebuffer;if(fe.isWebGLCubeRenderTarget&&void 0!==zt&&(Ht=Ht[zt]),Ht){Ue.bindFramebuffer(Y.FRAMEBUFFER,Ht);try{const un=fe.texture,_n=un.format,hn=un.type;if(!gt.textureFormatReadable(_n))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!gt.textureTypeReadable(hn))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");if(_e>=0&&_e<=fe.width-ge&&be>=0&&be<=fe.height-ot){const ui=Y.createBuffer();Y.bindBuffer(Y.PIXEL_PACK_BUFFER,ui),Y.bufferData(Y.PIXEL_PACK_BUFFER,xt.byteLength,Y.STREAM_READ),Y.readPixels(_e,be,ge,ot,Sn.convert(_n),Sn.convert(hn),0),Y.flush();const Xi=Y.fenceSync(Y.SYNC_GPU_COMMANDS_COMPLETE,0);yield function mX(n,e,t){return new Promise(function(i,r){setTimeout(function o(){switch(n.clientWaitSync(e,n.SYNC_FLUSH_COMMANDS_BIT,0)){case n.WAIT_FAILED:r();break;case n.TIMEOUT_EXPIRED:setTimeout(o,t);break;default:i()}},t)})}(Y,Xi,4);try{Y.bindBuffer(Y.PIXEL_PACK_BUFFER,ui),Y.getBufferSubData(Y.PIXEL_PACK_BUFFER,0,xt)}finally{Y.deleteBuffer(ui),Y.deleteSync(Xi)}return xt}}finally{const un=null!==K?vt.get(K).__webglFramebuffer:null;Ue.bindFramebuffer(Y.FRAMEBUFFER,un)}}});return function(fe,_e,be,ge,ot,xt,zt){return X.apply(this,arguments)}}(),this.copyFramebufferToTexture=function(X,fe=null,_e=0){!0!==X.isTexture&&(console.warn("WebGLRenderer: copyFramebufferToTexture function signature has changed."),fe=arguments[0]||null,X=arguments[1]);const be=Math.pow(2,-_e),ge=Math.floor(X.image.width*be),ot=Math.floor(X.image.height*be),xt=null!==fe?fe.x:0,zt=null!==fe?fe.y:0;Ft.setTexture2D(X,0),Y.copyTexSubImage2D(Y.TEXTURE_2D,_e,0,0,xt,zt,ge,ot),Ue.unbindTexture()},this.copyTextureToTexture=function(X,fe,_e=null,be=null,ge=0){let ot,xt,zt,Ht,un,_n;!0!==X.isTexture&&(console.warn("WebGLRenderer: copyTextureToTexture function signature has changed."),be=arguments[0]||null,X=arguments[1],fe=arguments[2],ge=arguments[3]||0,_e=null),null!==_e?(ot=_e.max.x-_e.min.x,xt=_e.max.y-_e.min.y,zt=_e.min.x,Ht=_e.min.y):(ot=X.image.width,xt=X.image.height,zt=0,Ht=0),null!==be?(un=be.x,_n=be.y):(un=0,_n=0);const hn=Sn.convert(fe.format),ui=Sn.convert(fe.type);Ft.setTexture2D(fe,0),Y.pixelStorei(Y.UNPACK_FLIP_Y_WEBGL,fe.flipY),Y.pixelStorei(Y.UNPACK_PREMULTIPLY_ALPHA_WEBGL,fe.premultiplyAlpha),Y.pixelStorei(Y.UNPACK_ALIGNMENT,fe.unpackAlignment);const Xi=Y.getParameter(Y.UNPACK_ROW_LENGTH),xr=Y.getParameter(Y.UNPACK_IMAGE_HEIGHT),Bo=Y.getParameter(Y.UNPACK_SKIP_PIXELS),vi=Y.getParameter(Y.UNPACK_SKIP_ROWS),Xt=Y.getParameter(Y.UNPACK_SKIP_IMAGES),ys=X.isCompressedTexture?X.mipmaps[ge]:X.image;Y.pixelStorei(Y.UNPACK_ROW_LENGTH,ys.width),Y.pixelStorei(Y.UNPACK_IMAGE_HEIGHT,ys.height),Y.pixelStorei(Y.UNPACK_SKIP_PIXELS,zt),Y.pixelStorei(Y.UNPACK_SKIP_ROWS,Ht),X.isDataTexture?Y.texSubImage2D(Y.TEXTURE_2D,ge,un,_n,ot,xt,hn,ui,ys.data):X.isCompressedTexture?Y.compressedTexSubImage2D(Y.TEXTURE_2D,ge,un,_n,ys.width,ys.height,hn,ys.data):Y.texSubImage2D(Y.TEXTURE_2D,ge,un,_n,ot,xt,hn,ui,ys),Y.pixelStorei(Y.UNPACK_ROW_LENGTH,Xi),Y.pixelStorei(Y.UNPACK_IMAGE_HEIGHT,xr),Y.pixelStorei(Y.UNPACK_SKIP_PIXELS,Bo),Y.pixelStorei(Y.UNPACK_SKIP_ROWS,vi),Y.pixelStorei(Y.UNPACK_SKIP_IMAGES,Xt),0===ge&&fe.generateMipmaps&&Y.generateMipmap(Y.TEXTURE_2D),Ue.unbindTexture()},this.copyTextureToTexture3D=function(X,fe,_e=null,be=null,ge=0){let ot,xt,zt,Ht,un,_n,hn,ui,Xi;!0!==X.isTexture&&(console.warn("WebGLRenderer: copyTextureToTexture3D function signature has changed."),_e=arguments[0]||null,be=arguments[1]||null,X=arguments[2],fe=arguments[3],ge=arguments[4]||0);const xr=X.isCompressedTexture?X.mipmaps[ge]:X.image;null!==_e?(ot=_e.max.x-_e.min.x,xt=_e.max.y-_e.min.y,zt=_e.max.z-_e.min.z,Ht=_e.min.x,un=_e.min.y,_n=_e.min.z):(ot=xr.width,xt=xr.height,zt=xr.depth,Ht=0,un=0,_n=0),null!==be?(hn=be.x,ui=be.y,Xi=be.z):(hn=0,ui=0,Xi=0);const Bo=Sn.convert(fe.format),vi=Sn.convert(fe.type);let Xt;if(fe.isData3DTexture)Ft.setTexture3D(fe,0),Xt=Y.TEXTURE_3D;else{if(!fe.isDataArrayTexture&&!fe.isCompressedArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");Ft.setTexture2DArray(fe,0),Xt=Y.TEXTURE_2D_ARRAY}Y.pixelStorei(Y.UNPACK_FLIP_Y_WEBGL,fe.flipY),Y.pixelStorei(Y.UNPACK_PREMULTIPLY_ALPHA_WEBGL,fe.premultiplyAlpha),Y.pixelStorei(Y.UNPACK_ALIGNMENT,fe.unpackAlignment);const ys=Y.getParameter(Y.UNPACK_ROW_LENGTH),yi=Y.getParameter(Y.UNPACK_IMAGE_HEIGHT),Ha=Y.getParameter(Y.UNPACK_SKIP_PIXELS),Fm=Y.getParameter(Y.UNPACK_SKIP_ROWS),ko=Y.getParameter(Y.UNPACK_SKIP_IMAGES);Y.pixelStorei(Y.UNPACK_ROW_LENGTH,xr.width),Y.pixelStorei(Y.UNPACK_IMAGE_HEIGHT,xr.height),Y.pixelStorei(Y.UNPACK_SKIP_PIXELS,Ht),Y.pixelStorei(Y.UNPACK_SKIP_ROWS,un),Y.pixelStorei(Y.UNPACK_SKIP_IMAGES,_n),X.isDataTexture||X.isData3DTexture?Y.texSubImage3D(Xt,ge,hn,ui,Xi,ot,xt,zt,Bo,vi,xr.data):fe.isCompressedArrayTexture?Y.compressedTexSubImage3D(Xt,ge,hn,ui,Xi,ot,xt,zt,Bo,xr.data):Y.texSubImage3D(Xt,ge,hn,ui,Xi,ot,xt,zt,Bo,vi,xr),Y.pixelStorei(Y.UNPACK_ROW_LENGTH,ys),Y.pixelStorei(Y.UNPACK_IMAGE_HEIGHT,yi),Y.pixelStorei(Y.UNPACK_SKIP_PIXELS,Ha),Y.pixelStorei(Y.UNPACK_SKIP_ROWS,Fm),Y.pixelStorei(Y.UNPACK_SKIP_IMAGES,ko),0===ge&&fe.generateMipmaps&&Y.generateMipmap(Xt),Ue.unbindTexture()},this.initRenderTarget=function(X){void 0===vt.get(X).__webglFramebuffer&&Ft.setupRenderTarget(X)},this.initTexture=function(X){X.isCubeTexture?Ft.setTextureCube(X,0):X.isData3DTexture?Ft.setTexture3D(X,0):X.isDataArrayTexture||X.isCompressedArrayTexture?Ft.setTexture2DArray(X,0):Ft.setTexture2D(X,0),Ue.unbindTexture()},this.resetState=function(){ne=0,$=0,K=null,Ue.reset(),Gn.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return mc}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorSpace=e===kT?"display-p3":"srgb",t.unpackColorSpace=mi.workingColorSpace===gx?"display-p3":"srgb"}}class sF extends vo{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new _c,this.environmentIntensity=1,this.environmentRotation=new _c,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return null!==this.fog&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),1!==this.backgroundIntensity&&(t.object.backgroundIntensity=this.backgroundIntensity),t.object.backgroundRotation=this.backgroundRotation.toArray(),1!==this.environmentIntensity&&(t.object.environmentIntensity=this.environmentIntensity),t.object.environmentRotation=this.environmentRotation.toArray(),t}}class RC extends fm{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new wt(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}class _M extends Hn{constructor(e=.5,t=1,i=32,r=1,o=0,a=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:i,phiSegments:r,thetaStart:o,thetaLength:a},i=Math.max(3,i);const u=[],h=[],f=[],g=[];let _=e;const x=(t-e)/(r=Math.max(1,r)),M=new Q,E=new Ve;for(let D=0;D<=r;D++){for(let C=0;C<=i;C++){const S=o+C/i*a;M.x=_*Math.cos(S),M.y=_*Math.sin(S),h.push(M.x,M.y,M.z),f.push(0,0,1),E.x=(M.x/t+1)/2,E.y=(M.y/t+1)/2,g.push(E.x,E.y)}_+=x}for(let D=0;D<r;D++){const C=D*(i+1);for(let S=0;S<i;S++){const I=S+C,O=I+i+1,ne=I+i+2,$=I+1;u.push(I,O,$),u.push(O,ne,$)}}this.setIndex(u),this.setAttribute("position",new Vt(h,3)),this.setAttribute("normal",new Vt(f,3)),this.setAttribute("uv",new Vt(g,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new _M(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class Lm extends Hn{constructor(e=1,t=32,i=16,r=0,o=2*Math.PI,a=0,u=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:r,phiLength:o,thetaStart:a,thetaLength:u},t=Math.max(3,Math.floor(t)),i=Math.max(2,Math.floor(i));const h=Math.min(a+u,Math.PI);let f=0;const g=[],_=new Q,x=new Q,M=[],E=[],D=[],C=[];for(let S=0;S<=i;S++){const I=[],N=S/i;let O=0;0===S&&0===a?O=.5/t:S===i&&h===Math.PI&&(O=-.5/t);for(let ne=0;ne<=t;ne++){const $=ne/t;_.x=-e*Math.cos(r+$*o)*Math.sin(a+N*u),_.y=e*Math.cos(a+N*u),_.z=e*Math.sin(r+$*o)*Math.sin(a+N*u),E.push(_.x,_.y,_.z),x.copy(_).normalize(),D.push(x.x,x.y,x.z),C.push($+O,1-N),I.push(f++)}g.push(I)}for(let S=0;S<i;S++)for(let I=0;I<t;I++){const O=g[S][I],ne=g[S+1][I],$=g[S+1][I+1];(0!==S||a>0)&&M.push(g[S][I+1],O,$),(S!==i-1||h<Math.PI)&&M.push(O,ne,$)}this.setIndex(M),this.setAttribute("position",new Vt(E,3)),this.setAttribute("normal",new Vt(D,3)),this.setAttribute("uv",new Vt(C,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Lm(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}function Bd(n,e,t){return!n||!t&&n.constructor===e?n:"number"==typeof e.BYTES_PER_ELEMENT?new e(n):Array.prototype.slice.call(n)}class xM{constructor(e,t,i,r){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==r?r:new t.constructor(i),this.sampleValues=t,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let i=this._cachedIndex,r=t[i],o=t[i-1];e:{t:{let a;n:{i:if(!(e<r)){for(let u=i+2;;){if(void 0===r){if(e<o)break i;return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}if(i===u)break;if(o=r,r=t[++i],e<r)break t}a=t.length;break n}if(e>=o)break e;{const u=t[1];e<u&&(i=2,o=u);for(let h=i-2;;){if(void 0===o)return this._cachedIndex=0,this.copySampleValue_(0);if(i===h)break;if(r=o,o=t[--i-1],e>=o)break t}a=i,i=0}}for(;i<a;){const u=i+a>>>1;e<t[u]?a=u:i=u+1}if(r=t[i],o=t[i-1],void 0===o)return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===r)return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}this._cachedIndex=i,this.intervalChanged_(i,o,r)}return this.interpolate_(i,o,e,r)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,i=this.sampleValues,r=this.valueSize,o=e*r;for(let a=0;a!==r;++a)t[a]=i[o+a];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class tJ extends xM{constructor(e,t,i,r){super(e,t,i,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:2400,endingEnd:2400}}intervalChanged_(e,t,i){const r=this.parameterPositions;let o=e-2,a=e+1,u=r[o],h=r[a];if(void 0===u)switch(this.getSettings_().endingStart){case 2401:o=e,u=2*t-i;break;case 2402:o=r.length-2,u=t+r[o]-r[o+1];break;default:o=e,u=i}if(void 0===h)switch(this.getSettings_().endingEnd){case 2401:a=e,h=2*i-t;break;case 2402:a=1,h=i+r[1]-r[0];break;default:a=e-1,h=t}const f=.5*(i-t),g=this.valueSize;this._weightPrev=f/(t-u),this._weightNext=f/(h-i),this._offsetPrev=o*g,this._offsetNext=a*g}interpolate_(e,t,i,r){const o=this.resultBuffer,a=this.sampleValues,u=this.valueSize,h=e*u,f=h-u,g=this._offsetPrev,_=this._offsetNext,x=this._weightPrev,M=this._weightNext,E=(i-t)/(r-t),D=E*E,C=D*E,S=-x*C+2*x*D-x*E,I=(1+x)*C+(-1.5-2*x)*D+(-.5+x)*E+1,N=(-1-M)*C+(1.5+M)*D+.5*E,O=M*C-M*D;for(let ne=0;ne!==u;++ne)o[ne]=S*a[g+ne]+I*a[f+ne]+N*a[h+ne]+O*a[_+ne];return o}}class $F extends xM{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e,t,i,r){const o=this.resultBuffer,a=this.sampleValues,u=this.valueSize,h=e*u,f=h-u,g=(i-t)/(r-t),_=1-g;for(let x=0;x!==u;++x)o[x]=a[f+x]*_+a[h+x]*g;return o}}class nJ extends xM{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e){return this.copySampleValue_(e-1)}}class xl{constructor(e,t,i,r){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Bd(t,this.TimeBufferType),this.values=Bd(i,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let i;if(t.toJSON!==this.toJSON)i=t.toJSON(e);else{i={name:e.name,times:Bd(e.times,Array),values:Bd(e.values,Array)};const r=e.getInterpolation();r!==e.DefaultInterpolation&&(i.interpolation=r)}return i.type=e.ValueTypeName,i}InterpolantFactoryMethodDiscrete(e){return new nJ(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new $F(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new tJ(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case 2300:t=this.InterpolantFactoryMethodDiscrete;break;case 2301:t=this.InterpolantFactoryMethodLinear;break;case 2302:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){const i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(i);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",i),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return 2300;case this.InterpolantFactoryMethodLinear:return 2301;case this.InterpolantFactoryMethodSmooth:return 2302}}getValueSize(){return this.values.length/this.times.length}shift(e){if(0!==e){const t=this.times;for(let i=0,r=t.length;i!==r;++i)t[i]+=e}return this}scale(e){if(1!==e){const t=this.times;for(let i=0,r=t.length;i!==r;++i)t[i]*=e}return this}trim(e,t){const i=this.times,r=i.length;let o=0,a=r-1;for(;o!==r&&i[o]<e;)++o;for(;-1!==a&&i[a]>t;)--a;if(++a,0!==o||a!==r){o>=a&&(a=Math.max(a,1),o=a-1);const u=this.getValueSize();this.times=i.slice(o,a),this.values=this.values.slice(o*u,a*u)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const i=this.times,r=this.values,o=i.length;0===o&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let a=null;for(let u=0;u!==o;u++){const h=i[u];if("number"==typeof h&&isNaN(h)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,u,h),e=!1;break}if(null!==a&&a>h){console.error("THREE.KeyframeTrack: Out of order keys.",this,u,h,a),e=!1;break}a=h}if(void 0!==r&&function WF(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}(r))for(let u=0,h=r.length;u!==h;++u){const f=r[u];if(isNaN(f)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,u,f),e=!1;break}}return e}optimize(){const e=this.times.slice(),t=this.values.slice(),i=this.getValueSize(),r=2302===this.getInterpolation(),o=e.length-1;let a=1;for(let u=1;u<o;++u){let h=!1;const f=e[u];if(f!==e[u+1]&&(1!==u||f!==e[0]))if(r)h=!0;else{const _=u*i,x=_-i,M=_+i;for(let E=0;E!==i;++E){const D=t[_+E];if(D!==t[x+E]||D!==t[M+E]){h=!0;break}}}if(h){if(u!==a){e[a]=e[u];const _=u*i,x=a*i;for(let M=0;M!==i;++M)t[x+M]=t[_+M]}++a}}if(o>0){e[a]=e[o];for(let u=o*i,h=a*i,f=0;f!==i;++f)t[h+f]=t[u+f];++a}return a!==e.length?(this.times=e.slice(0,a),this.values=t.slice(0,a*i)):(this.times=e,this.values=t),this}clone(){const e=this.times.slice(),t=this.values.slice(),r=new(0,this.constructor)(this.name,e,t);return r.createInterpolant=this.createInterpolant,r}}xl.prototype.TimeBufferType=Float32Array,xl.prototype.ValueBufferType=Float32Array,xl.prototype.DefaultInterpolation=2301;class Nm extends xl{constructor(e,t,i){super(e,t,i)}}Nm.prototype.ValueTypeName="bool",Nm.prototype.ValueBufferType=Array,Nm.prototype.DefaultInterpolation=2300,Nm.prototype.InterpolantFactoryMethodLinear=void 0,Nm.prototype.InterpolantFactoryMethodSmooth=void 0;(class XF extends xl{}).prototype.ValueTypeName="color";(class MM extends xl{}).prototype.ValueTypeName="number";class iJ extends xM{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e,t,i,r){const o=this.resultBuffer,a=this.sampleValues,u=this.valueSize,h=(i-t)/(r-t);let f=e*u;for(let g=f+u;f!==g;f+=4)No.slerpFlat(o,0,a,f-u,a,f,h);return o}}class wM extends xl{InterpolantFactoryMethodLinear(e){return new iJ(this.times,this.values,this.getValueSize(),e)}}wM.prototype.ValueTypeName="quaternion",wM.prototype.InterpolantFactoryMethodSmooth=void 0;class Om extends xl{constructor(e,t,i){super(e,t,i)}}Om.prototype.ValueTypeName="string",Om.prototype.ValueBufferType=Array,Om.prototype.DefaultInterpolation=2300,Om.prototype.InterpolantFactoryMethodLinear=void 0,Om.prototype.InterpolantFactoryMethodSmooth=void 0;(class bM extends xl{}).prototype.ValueTypeName="vector";const $u={enabled:!1,files:{},add:function(n,e){!1!==this.enabled&&(this.files[n]=e)},get:function(n){if(!1!==this.enabled)return this.files[n]},remove:function(n){delete this.files[n]},clear:function(){this.files={}}};class qF{constructor(e,t,i){const r=this;let h,o=!1,a=0,u=0;const f=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i,this.itemStart=function(g){u++,!1===o&&void 0!==r.onStart&&r.onStart(g,a,u),o=!0},this.itemEnd=function(g){a++,void 0!==r.onProgress&&r.onProgress(g,a,u),a===u&&(o=!1,void 0!==r.onLoad&&r.onLoad())},this.itemError=function(g){void 0!==r.onError&&r.onError(g)},this.resolveURL=function(g){return h?h(g):g},this.setURLModifier=function(g){return h=g,this},this.addHandler=function(g,_){return f.push(g,_),this},this.removeHandler=function(g){const _=f.indexOf(g);return-1!==_&&f.splice(_,2),this},this.getHandler=function(g){for(let _=0,x=f.length;_<x;_+=2){const M=f[_],E=f[_+1];if(M.global&&(M.lastIndex=0),M.test(g))return E}return null}}}const oJ=new qF;let YF=(()=>{class n{constructor(t){this.manager=void 0!==t?t:oJ,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(t,i){const r=this;return new Promise(function(o,a){r.load(t,o,i,a)})}parse(){}setCrossOrigin(t){return this.crossOrigin=t,this}setWithCredentials(t){return this.withCredentials=t,this}setPath(t){return this.path=t,this}setResourcePath(t){return this.resourcePath=t,this}setRequestHeader(t){return this.requestHeader=t,this}}return n.DEFAULT_MATERIAL_NAME="__DEFAULT",n})();class SM extends YF{constructor(e){super(e)}load(e,t,i,r){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const o=this,a=$u.get(e);if(void 0!==a)return o.manager.itemStart(e),setTimeout(function(){t&&t(a),o.manager.itemEnd(e)},0),a;const u=Wv("img");function h(){g(),$u.add(e,this),t&&t(this),o.manager.itemEnd(e)}function f(_){g(),r&&r(_),o.manager.itemError(e),o.manager.itemEnd(e)}function g(){u.removeEventListener("load",h,!1),u.removeEventListener("error",f,!1)}return u.addEventListener("load",h,!1),u.addEventListener("error",f,!1),"data:"!==e.slice(0,5)&&void 0!==this.crossOrigin&&(u.crossOrigin=this.crossOrigin),o.manager.itemStart(e),u.src=e,u}}class ZF extends YF{constructor(e){super(e)}load(e,t,i,r){const o=new gc,a=new SM(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(e,function(u){o.image=u,o.needsUpdate=!0,void 0!==t&&t(o)},i,r),o}}class JF extends vo{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new wt(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),void 0!==this.target&&(t.object.target=this.target.uuid),t}}const QC=new cn,KF=new Q,QF=new Q;class cJ{constructor(e){this.camera=e,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Ve(512,512),this.map=null,this.mapPass=null,this.matrix=new cn,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Hx,this._frameExtents=new Ve(1,1),this._viewportCount=1,this._viewports=[new wi(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,i=this.matrix;KF.setFromMatrixPosition(e.matrixWorld),t.position.copy(KF),QF.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(QF),t.updateMatrixWorld(),QC.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(QC),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(QC)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.intensity=e.intensity,this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const e={};return 1!==this.intensity&&(e.intensity=this.intensity),0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),(512!==this.mapSize.x||512!==this.mapSize.y)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}const eU=new cn,py=new Q,eA=new Q;class dJ extends cJ{constructor(){super(new gs(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new Ve(4,2),this._viewportCount=6,this._viewports=[new wi(2,1,1,1),new wi(0,1,1,1),new wi(3,1,1,1),new wi(1,1,1,1),new wi(3,0,1,1),new wi(1,0,1,1)],this._cubeDirections=[new Q(1,0,0),new Q(-1,0,0),new Q(0,0,1),new Q(0,0,-1),new Q(0,1,0),new Q(0,-1,0)],this._cubeUps=[new Q(0,1,0),new Q(0,1,0),new Q(0,1,0),new Q(0,1,0),new Q(0,0,1),new Q(0,0,-1)]}updateMatrices(e,t=0){const i=this.camera,r=this.matrix,o=e.distance||i.far;o!==i.far&&(i.far=o,i.updateProjectionMatrix()),py.setFromMatrixPosition(e.matrixWorld),i.position.copy(py),eA.copy(i.position),eA.add(this._cubeDirections[t]),i.up.copy(this._cubeUps[t]),i.lookAt(eA),i.updateMatrixWorld(),r.makeTranslation(-py.x,-py.y,-py.z),eU.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(eU)}}class tU extends JF{constructor(e,t,i=0,r=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=i,this.decay=r,this.shadow=new dJ}get power(){return 4*this.intensity*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class tA extends JF{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class lU{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=cU(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=cU();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function cU(){return(typeof performance>"u"?Date:performance).now()}const iA="\\[\\]\\.:\\/",EJ=new RegExp("["+iA+"]","g"),rA="[^"+iA+"]",SJ="[^"+iA.replace("\\.","")+"]",RJ=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",rA)+/(WCOD+)?/.source.replace("WCOD",SJ)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",rA)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",rA)+"$"),IJ=["material","materials","bones","map"];class PJ{constructor(e,t,i){const r=i||$i.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,r)}getValue(e,t){this.bind();const r=this._bindings[this._targetGroup.nCachedObjects_];void 0!==r&&r.getValue(e,t)}setValue(e,t){const i=this._bindings;for(let r=this._targetGroup.nCachedObjects_,o=i.length;r!==o;++r)i[r].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].unbind()}}let $i=(()=>{class n{constructor(t,i,r){this.path=i,this.parsedPath=r||n.parseTrackName(i),this.node=n.findNode(t,this.parsedPath.nodeName),this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(t,i,r){return t&&t.isAnimationObjectGroup?new n.Composite(t,i,r):new n(t,i,r)}static sanitizeNodeName(t){return t.replace(/\s/g,"_").replace(EJ,"")}static parseTrackName(t){const i=RJ.exec(t);if(null===i)throw new Error("PropertyBinding: Cannot parse trackName: "+t);const r={nodeName:i[2],objectName:i[3],objectIndex:i[4],propertyName:i[5],propertyIndex:i[6]},o=r.nodeName&&r.nodeName.lastIndexOf(".");if(void 0!==o&&-1!==o){const a=r.nodeName.substring(o+1);-1!==IJ.indexOf(a)&&(r.nodeName=r.nodeName.substring(0,o),r.objectName=a)}if(null===r.propertyName||0===r.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return r}static findNode(t,i){if(void 0===i||""===i||"."===i||-1===i||i===t.name||i===t.uuid)return t;if(t.skeleton){const r=t.skeleton.getBoneByName(i);if(void 0!==r)return r}if(t.children){const r=function(a){for(let u=0;u<a.length;u++){const h=a[u];if(h.name===i||h.uuid===i)return h;const f=r(h.children);if(f)return f}return null},o=r(t.children);if(o)return o}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(t,i){t[i]=this.targetObject[this.propertyName]}_getValue_array(t,i){const r=this.resolvedProperty;for(let o=0,a=r.length;o!==a;++o)t[i++]=r[o]}_getValue_arrayElement(t,i){t[i]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(t,i){this.resolvedProperty.toArray(t,i)}_setValue_direct(t,i){this.targetObject[this.propertyName]=t[i]}_setValue_direct_setNeedsUpdate(t,i){this.targetObject[this.propertyName]=t[i],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(t,i){this.targetObject[this.propertyName]=t[i],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(t,i){const r=this.resolvedProperty;for(let o=0,a=r.length;o!==a;++o)r[o]=t[i++]}_setValue_array_setNeedsUpdate(t,i){const r=this.resolvedProperty;for(let o=0,a=r.length;o!==a;++o)r[o]=t[i++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(t,i){const r=this.resolvedProperty;for(let o=0,a=r.length;o!==a;++o)r[o]=t[i++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(t,i){this.resolvedProperty[this.propertyIndex]=t[i]}_setValue_arrayElement_setNeedsUpdate(t,i){this.resolvedProperty[this.propertyIndex]=t[i],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(t,i){this.resolvedProperty[this.propertyIndex]=t[i],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(t,i){this.resolvedProperty.fromArray(t,i)}_setValue_fromArray_setNeedsUpdate(t,i){this.resolvedProperty.fromArray(t,i),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(t,i){this.resolvedProperty.fromArray(t,i),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(t,i){this.bind(),this.getValue(t,i)}_setValue_unbound(t,i){this.bind(),this.setValue(t,i)}bind(){let t=this.node;const i=this.parsedPath,r=i.objectName,o=i.propertyName;let a=i.propertyIndex;if(t||(t=n.findNode(this.rootNode,i.nodeName),this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t)return void console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");if(r){let g=i.objectIndex;switch(r){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(let _=0;_<t.length;_++)if(t[_].name===g){g=_;break}break;case"map":if("map"in t){t=t.map;break}if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.map)return void console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);t=t.material.map;break;default:if(void 0===t[r])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[r]}if(void 0!==g){if(void 0===t[g])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[g]}}const u=t[o];if(void 0===u)return void console.error("THREE.PropertyBinding: Trying to update property for track: "+i.nodeName+"."+o+" but it wasn't found.",t);let h=this.Versioning.None;this.targetObject=t,void 0!==t.needsUpdate?h=this.Versioning.NeedsUpdate:void 0!==t.matrixWorldNeedsUpdate&&(h=this.Versioning.MatrixWorldNeedsUpdate);let f=this.BindingType.Direct;if(void 0!==a){if("morphTargetInfluences"===o){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==t.morphTargetDictionary[a]&&(a=t.morphTargetDictionary[a])}f=this.BindingType.ArrayElement,this.resolvedProperty=u,this.propertyIndex=a}else void 0!==u.fromArray&&void 0!==u.toArray?(f=this.BindingType.HasFromToArray,this.resolvedProperty=u):Array.isArray(u)?(f=this.BindingType.EntireArray,this.resolvedProperty=u):this.propertyName=o;this.getValue=this.GetterByBindingType[f],this.setValue=this.SetterByBindingTypeAndVersioning[f][h]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}return n.Composite=PJ,n})();$i.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},$i.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},$i.prototype.GetterByBindingType=[$i.prototype._getValue_direct,$i.prototype._getValue_array,$i.prototype._getValue_arrayElement,$i.prototype._getValue_toArray],$i.prototype.SetterByBindingTypeAndVersioning=[[$i.prototype._setValue_direct,$i.prototype._setValue_direct_setNeedsUpdate,$i.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[$i.prototype._setValue_array,$i.prototype._setValue_array_setNeedsUpdate,$i.prototype._setValue_array_setMatrixWorldNeedsUpdate],[$i.prototype._setValue_arrayElement,$i.prototype._setValue_arrayElement_setNeedsUpdate,$i.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[$i.prototype._setValue_fromArray,$i.prototype._setValue_fromArray_setNeedsUpdate,$i.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]],new Float32Array(1),typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"166"}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__="166");var UJ=Ju(801);const BJ=[{path:"planets",component:Qj},{path:"system-solar",component:(()=>{class n{constructor(t,i){this._planetsServiceService=t,this.route=i,this.canvasSizes={width:window.innerWidth-20,height:window.innerHeight-20}}ngOnInit(){this.createThreeJsBox()}createThreeJsBox(){this.loadPlanetIfo(),this.initializeScene(),this.addLights(),this.createObjects(),this.createRenderer(),this.addControls(),this.animateGeometry()}initializeScene(){this.scene=new sF;const t=(new ZF).load(this.planetSelected.imageUrl);t.wrapS=$p,t.wrapT=$p,t.repeat.set(1,1);const i=(new ZF).load("assets/sun.png"),r=new vl({map:t}),o=new vl({map:i}),a=new Lm(2,64,64),u=new Lm(3,32,100);this.planet=new rs(a,r),this.planet.position.set(10,0,0),this.sun=new rs(u,o),this.scene.add(this.sun,this.planet),this.camera=new gs(75,this.canvasSizes.width/this.canvasSizes.height,.001,1e3),this.camera.position.z=30,this.scene.add(this.camera),this.clock=new lU}addLights(){this.ambientLight=new tA(268435455,.5),this.scene.add(this.ambientLight),this.pointLight=new tA(16777215,.5),this.pointLight.position.set(2,2,2),this.scene.add(this.pointLight)}createObjects(){const t=new vl({color:"white"}),i=new _M(15,15.1233,100),r=new rs(i,t);r.position.set(0,0,-13),this.scene.add(r)}createRenderer(){this.canvas=document.getElementById("canvas-box"),this.canvas&&(this.renderer=new WY({antialias:!0,alpha:!0,canvas:this.canvas}),this.renderer.setSize(this.canvasSizes.width,this.canvasSizes.height))}addControls(){this.controls=new UJ.OrbitControls(this.camera,this.renderer.domElement),this.controls.update(),window.addEventListener("resize",this.onWindowResize.bind(this))}onWindowResize(){this.canvasSizes.width=window.innerWidth-20,this.canvasSizes.height=window.innerHeight,this.camera.aspect=this.canvasSizes.width/this.canvasSizes.height,this.camera.updateProjectionMatrix(),this.renderer.setSize(this.canvasSizes.width,this.canvasSizes.height),this.renderer.render(this.scene,this.camera)}loadPlanetIfo(){this.route.queryParamMap.subscribe(t=>{let i=t.get("name")??"";this.planetSelected=this._planetsServiceService.getPlanetByName(i)})}createStarParticles(t){new tU,new RC({color:16777215,size:1,transparent:!0,blending:2,depthTest:!1});for(let a=0;a<1e3;a++){const u=2e3*Math.random()-1e3,h=2e3*Math.random()-1e3,f=2e3*Math.random()-1e3;new Q(u,h,f)}}animateGeometry(){const t=()=>{const i=this.clock.getElapsedTime();this.planet.rotation.y=.3*i,this.sun.rotation.y=.3*i,this.controls.update(),this.renderer.render(this.scene,this.camera),window.requestAnimationFrame(t)};t()}static#e=this.\u0275fac=function(i){return new(i||n)($e(KS),$e(xd))};static#t=this.\u0275cmp=Al({type:n,selectors:[["app-system-solar"]],decls:1,vars:0,consts:[["id","canvas-box"]],template:function(i,r){1&i&&ad(0,"canvas",0)}})}return n})()}];let kJ=(()=>{class n{static#e=this.\u0275fac=function(i){return new(i||n)};static#t=this.\u0275mod=Wo({type:n});static#n=this.\u0275inj=_o({imports:[JP,PO.forRoot(BJ,{enableTracing:!0}),PO]})}return n})(),VJ=(()=>{class n{static#e=this.\u0275fac=function(i){return new(i||n)};static#t=this.\u0275mod=Wo({type:n,bootstrap:[Zj]});static#n=this.\u0275inj=_o({providers:[KS],imports:[hW,E8,kJ]})}return n})();cW().bootstrapModule(VJ).catch(n=>console.error(n))},801:function(Um,Zu,Ju){var Tn=this&&this.__extends||function(_s,ti){for(var qn in ti)ti.hasOwnProperty(qn)&&(_s[qn]=ti[qn]);function Ur(){this.constructor=_s}_s.prototype=null===ti?Object.create(ti):(Ur.prototype=ti.prototype,new Ur)},zn=Ju(863),wl={type:"change"},er={type:"start"},Ga={type:"end"},Qu=function(_s){function ti(qn,Ur,xs){var ie=_s.call(this)||this;return ie.object=qn,ie.domElement=void 0!==Ur?Ur:document,ie.window=void 0!==xs?xs:window,ie.enabled=!0,ie.target=new zn.Vector3,ie.minDistance=0,ie.maxDistance=1/0,ie.minZoom=0,ie.maxZoom=1/0,ie.minPolarAngle=0,ie.maxPolarAngle=Math.PI,ie.minAzimuthAngle=-1/0,ie.maxAzimuthAngle=1/0,ie.enableDamping=!1,ie.dampingFactor=.25,ie.enableZoom=!0,ie.zoomSpeed=1,ie.enableRotate=!0,ie.rotateSpeed=1,ie.enablePan=!0,ie.keyPanSpeed=7,ie.autoRotate=!1,ie.autoRotateSpeed=2,ie.enableKeys=!0,ie.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},ie.mouseButtons={ORBIT:zn.MOUSE.LEFT,ZOOM:zn.MOUSE.MIDDLE,PAN:zn.MOUSE.RIGHT},ie.target0=ie.target.clone(),ie.position0=ie.object.position.clone(),ie.zoom0=ie.object.zoom,ie.updateOffset=new zn.Vector3,ie.updateQuat=(new zn.Quaternion).setFromUnitVectors(qn.up,new zn.Vector3(0,1,0)),ie.updateQuatInverse=ie.updateQuat.clone().inverse(),ie.updateLastPosition=new zn.Vector3,ie.updateLastQuaternion=new zn.Quaternion,ie.state=-1,ie.scale=1,ie.spherical=new zn.Spherical,ie.sphericalDelta=new zn.Spherical,ie.panOffset=new zn.Vector3,ie.zoomChanged=!1,ie.rotateStart=new zn.Vector2,ie.rotateEnd=new zn.Vector2,ie.rotateDelta=new zn.Vector2,ie.panStart=new zn.Vector2,ie.panEnd=new zn.Vector2,ie.panDelta=new zn.Vector2,ie.dollyStart=new zn.Vector2,ie.dollyEnd=new zn.Vector2,ie.dollyDelta=new zn.Vector2,ie.panLeftV=new zn.Vector3,ie.panUpV=new zn.Vector3,ie.panInternalOffset=new zn.Vector3,ie.onMouseDown=function(Nt){if(!1!==ie.enabled){if(Nt.preventDefault(),Nt.button===ie.mouseButtons.ORBIT){if(!1===ie.enableRotate)return;ie.rotateStart.set(Nt.clientX,Nt.clientY),ie.state=0}else if(Nt.button===ie.mouseButtons.ZOOM){if(!1===ie.enableZoom)return;ie.dollyStart.set(Nt.clientX,Nt.clientY),ie.state=1}else if(Nt.button===ie.mouseButtons.PAN){if(!1===ie.enablePan)return;ie.panStart.set(Nt.clientX,Nt.clientY),ie.state=2}-1!==ie.state&&(document.addEventListener("mousemove",ie.onMouseMove,!1),document.addEventListener("mouseup",ie.onMouseUp,!1),ie.dispatchEvent(er))}},ie.onMouseMove=function(Nt){if(!1!==ie.enabled)if(Nt.preventDefault(),0===ie.state){if(!1===ie.enableRotate)return;ie.rotateEnd.set(Nt.clientX,Nt.clientY),ie.rotateDelta.subVectors(ie.rotateEnd,ie.rotateStart);var Ms=ie.domElement===document?ie.domElement.body:ie.domElement;ie.rotateLeft(2*Math.PI*ie.rotateDelta.x/Ms.clientWidth*ie.rotateSpeed),ie.rotateUp(2*Math.PI*ie.rotateDelta.y/Ms.clientHeight*ie.rotateSpeed),ie.rotateStart.copy(ie.rotateEnd),ie.update()}else if(1===ie.state){if(!1===ie.enableZoom)return;ie.dollyEnd.set(Nt.clientX,Nt.clientY),ie.dollyDelta.subVectors(ie.dollyEnd,ie.dollyStart),ie.dollyDelta.y>0?ie.dollyIn(ie.getZoomScale()):ie.dollyDelta.y<0&&ie.dollyOut(ie.getZoomScale()),ie.dollyStart.copy(ie.dollyEnd),ie.update()}else if(2===ie.state){if(!1===ie.enablePan)return;ie.panEnd.set(Nt.clientX,Nt.clientY),ie.panDelta.subVectors(ie.panEnd,ie.panStart),ie.pan(ie.panDelta.x,ie.panDelta.y),ie.panStart.copy(ie.panEnd),ie.update()}},ie.onMouseUp=function(Nt){!1!==ie.enabled&&(document.removeEventListener("mousemove",ie.onMouseMove,!1),document.removeEventListener("mouseup",ie.onMouseUp,!1),ie.dispatchEvent(Ga),ie.state=-1)},ie.onMouseWheel=function(Nt){!1===ie.enabled||!1===ie.enableZoom||-1!==ie.state&&0!==ie.state||(Nt.preventDefault(),Nt.stopPropagation(),Nt.deltaY<0?ie.dollyOut(ie.getZoomScale()):Nt.deltaY>0&&ie.dollyIn(ie.getZoomScale()),ie.update(),ie.dispatchEvent(er),ie.dispatchEvent(Ga))},ie.onKeyDown=function(Nt){if(!1!==ie.enabled&&!1!==ie.enableKeys&&!1!==ie.enablePan)switch(Nt.keyCode){case ie.keys.UP:ie.pan(0,ie.keyPanSpeed),ie.update();break;case ie.keys.BOTTOM:ie.pan(0,-ie.keyPanSpeed),ie.update();break;case ie.keys.LEFT:ie.pan(ie.keyPanSpeed,0),ie.update();break;case ie.keys.RIGHT:ie.pan(-ie.keyPanSpeed,0),ie.update()}},ie.onTouchStart=function(Nt){if(!1!==ie.enabled){switch(Nt.touches.length){case 1:if(!1===ie.enableRotate)return;ie.rotateStart.set(Nt.touches[0].pageX,Nt.touches[0].pageY),ie.state=3;break;case 2:if(!1===ie.enableZoom)return;var Ms=Nt.touches[0].pageX-Nt.touches[1].pageX,ss=Nt.touches[0].pageY-Nt.touches[1].pageY,ro=Math.sqrt(Ms*Ms+ss*ss);ie.dollyStart.set(0,ro),ie.state=4;break;case 3:if(!1===ie.enablePan)return;ie.panStart.set(Nt.touches[0].pageX,Nt.touches[0].pageY),ie.state=5;break;default:ie.state=-1}-1!==ie.state&&ie.dispatchEvent(er)}},ie.onTouchMove=function(Nt){if(!1!==ie.enabled)switch(Nt.preventDefault(),Nt.stopPropagation(),Nt.touches.length){case 1:if(!1===ie.enableRotate||3!==ie.state)return;ie.rotateEnd.set(Nt.touches[0].pageX,Nt.touches[0].pageY),ie.rotateDelta.subVectors(ie.rotateEnd,ie.rotateStart);var Ms=ie.domElement===document?ie.domElement.body:ie.domElement;ie.rotateLeft(2*Math.PI*ie.rotateDelta.x/Ms.clientWidth*ie.rotateSpeed),ie.rotateUp(2*Math.PI*ie.rotateDelta.y/Ms.clientHeight*ie.rotateSpeed),ie.rotateStart.copy(ie.rotateEnd),ie.update();break;case 2:if(!1===ie.enableZoom||4!==ie.state)return;var ss=Nt.touches[0].pageX-Nt.touches[1].pageX,ro=Nt.touches[0].pageY-Nt.touches[1].pageY,eh=Math.sqrt(ss*ss+ro*ro);ie.dollyEnd.set(0,eh),ie.dollyDelta.subVectors(ie.dollyEnd,ie.dollyStart),ie.dollyDelta.y>0?ie.dollyOut(ie.getZoomScale()):ie.dollyDelta.y<0&&ie.dollyIn(ie.getZoomScale()),ie.dollyStart.copy(ie.dollyEnd),ie.update();break;case 3:if(!1===ie.enablePan||5!==ie.state)return;ie.panEnd.set(Nt.touches[0].pageX,Nt.touches[0].pageY),ie.panDelta.subVectors(ie.panEnd,ie.panStart),ie.pan(ie.panDelta.x,ie.panDelta.y),ie.panStart.copy(ie.panEnd),ie.update();break;default:ie.state=-1}},ie.onTouchEnd=function(Nt){!1!==ie.enabled&&(ie.dispatchEvent(Ga),ie.state=-1)},ie.onContextMenu=function(Nt){Nt.preventDefault()},ie.domElement.addEventListener("contextmenu",ie.onContextMenu,!1),ie.domElement.addEventListener("mousedown",ie.onMouseDown,!1),ie.domElement.addEventListener("wheel",ie.onMouseWheel,!1),ie.domElement.addEventListener("touchstart",ie.onTouchStart,!1),ie.domElement.addEventListener("touchend",ie.onTouchEnd,!1),ie.domElement.addEventListener("touchmove",ie.onTouchMove,!1),ie.window.addEventListener("keydown",ie.onKeyDown,!1),ie.update(),ie}return Tn(ti,_s),ti.prototype.update=function(){var qn=this.object.position;return this.updateOffset.copy(qn).sub(this.target),this.updateOffset.applyQuaternion(this.updateQuat),this.spherical.setFromVector3(this.updateOffset),this.autoRotate&&-1===this.state&&this.rotateLeft(this.getAutoRotationAngle()),this.spherical.theta+=this.sphericalDelta.theta,this.spherical.phi+=this.sphericalDelta.phi,this.spherical.theta=Math.max(this.minAzimuthAngle,Math.min(this.maxAzimuthAngle,this.spherical.theta)),this.spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this.spherical.phi)),this.spherical.makeSafe(),this.spherical.radius*=this.scale,this.spherical.radius=Math.max(this.minDistance,Math.min(this.maxDistance,this.spherical.radius)),this.target.add(this.panOffset),this.updateOffset.setFromSpherical(this.spherical),this.updateOffset.applyQuaternion(this.updateQuatInverse),qn.copy(this.target).add(this.updateOffset),this.object.lookAt(this.target),!0===this.enableDamping?(this.sphericalDelta.theta*=1-this.dampingFactor,this.sphericalDelta.phi*=1-this.dampingFactor):this.sphericalDelta.set(0,0,0),this.scale=1,this.panOffset.set(0,0,0),!!(this.zoomChanged||this.updateLastPosition.distanceToSquared(this.object.position)>1e-6||8*(1-this.updateLastQuaternion.dot(this.object.quaternion))>1e-6)&&(this.dispatchEvent(wl),this.updateLastPosition.copy(this.object.position),this.updateLastQuaternion.copy(this.object.quaternion),this.zoomChanged=!1,!0)},ti.prototype.panLeft=function(qn,Ur){this.panLeftV.setFromMatrixColumn(Ur,0),this.panLeftV.multiplyScalar(-qn),this.panOffset.add(this.panLeftV)},ti.prototype.panUp=function(qn,Ur){this.panUpV.setFromMatrixColumn(Ur,1),this.panUpV.multiplyScalar(qn),this.panOffset.add(this.panUpV)},ti.prototype.pan=function(qn,Ur){var xs=this.domElement===document?this.domElement.body:this.domElement;if(this.object instanceof zn.PerspectiveCamera){this.panInternalOffset.copy(this.object.position).sub(this.target);var Nt=this.panInternalOffset.length();Nt*=Math.tan(this.object.fov/2*Math.PI/180),this.panLeft(2*qn*Nt/xs.clientHeight,this.object.matrix),this.panUp(2*Ur*Nt/xs.clientHeight,this.object.matrix)}else this.object instanceof zn.OrthographicCamera?(this.panLeft(qn*(this.object.right-this.object.left)/this.object.zoom/xs.clientWidth,this.object.matrix),this.panUp(Ur*(this.object.top-this.object.bottom)/this.object.zoom/xs.clientHeight,this.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),this.enablePan=!1)},ti.prototype.dollyIn=function(qn){this.object instanceof zn.PerspectiveCamera?this.scale/=qn:this.object instanceof zn.OrthographicCamera?(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom*qn)),this.object.updateProjectionMatrix(),this.zoomChanged=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)},ti.prototype.dollyOut=function(qn){this.object instanceof zn.PerspectiveCamera?this.scale*=qn:this.object instanceof zn.OrthographicCamera?(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/qn)),this.object.updateProjectionMatrix(),this.zoomChanged=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)},ti.prototype.getAutoRotationAngle=function(){return 2*Math.PI/60/60*this.autoRotateSpeed},ti.prototype.getZoomScale=function(){return Math.pow(.95,this.zoomSpeed)},ti.prototype.rotateLeft=function(qn){this.sphericalDelta.theta-=qn},ti.prototype.rotateUp=function(qn){this.sphericalDelta.phi-=qn},ti.prototype.getPolarAngle=function(){return this.spherical.phi},ti.prototype.getAzimuthalAngle=function(){return this.spherical.theta},ti.prototype.dispose=function(){this.domElement.removeEventListener("contextmenu",this.onContextMenu,!1),this.domElement.removeEventListener("mousedown",this.onMouseDown,!1),this.domElement.removeEventListener("wheel",this.onMouseWheel,!1),this.domElement.removeEventListener("touchstart",this.onTouchStart,!1),this.domElement.removeEventListener("touchend",this.onTouchEnd,!1),this.domElement.removeEventListener("touchmove",this.onTouchMove,!1),document.removeEventListener("mousemove",this.onMouseMove,!1),document.removeEventListener("mouseup",this.onMouseUp,!1),this.window.removeEventListener("keydown",this.onKeyDown,!1)},ti.prototype.reset=function(){this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(wl),this.update(),this.state=-1},Object.defineProperty(ti.prototype,"center",{get:function(){return console.warn("THREE.OrbitControls: .center has been renamed to .target"),this.target},enumerable:!0,configurable:!0}),Object.defineProperty(ti.prototype,"noZoom",{get:function(){return console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),!this.enableZoom},set:function(qn){console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),this.enableZoom=!qn},enumerable:!0,configurable:!0}),ti}(zn.EventDispatcher);Zu.OrbitControls=Qu},863:(Um,Zu,Ju)=>{function Tn(){}Ju.r(Zu),Ju.d(Zu,{AddEquation:()=>Vm,AddOperation:()=>UM,AdditiveBlending:()=>Bm,AlphaFormat:()=>Sy,AlwaysDepth:()=>qd,AmbientLight:()=>Hh,AnimationClip:()=>pr,AnimationMixer:()=>pu,AnimationObjectGroup:()=>Jh,AnimationUtils:()=>Hr,ArcCurve:()=>Yf,ArrowHelper:()=>vu,Audio:()=>Hl,AudioAnalyser:()=>lo,AudioContext:()=>Sg,AudioListener:()=>Wf,AudioLoader:()=>zl,AxisHelper:()=>Rg,BackSide:()=>ie,BasicDepthPacking:()=>dh,BasicShadowMap:()=>ti,BinaryTextureLoader:()=>bg,BlendingMode:()=>jd,Bone:()=>If,BooleanKeyframeTrack:()=>jh,BoundingBoxHelper:()=>Iw,Box2:()=>pa,Box3:()=>Vs,BoxBufferGeometry:()=>zc,BoxGeometry:()=>iu,BoxHelper:()=>So,BufferAttribute:()=>lt,BufferGeometry:()=>kt,BufferGeometryLoader:()=>hu,ByteType:()=>Zm,Cache:()=>Of,Camera:()=>us,CameraHelper:()=>Zl,CanvasRenderer:()=>Qf,CanvasTexture:()=>Lf,CatmullRomCurve3:()=>f_,CineonToneMapping:()=>by,CircleBufferGeometry:()=>nu,CircleGeometry:()=>Bh,ClampToEdgeWrapping:()=>Fs,Clock:()=>Dg,ClosedSplineCurve3:()=>g_,Color:()=>Tt,ColorKeyframeTrack:()=>$h,CompressedTexture:()=>Rl,CompressedTextureLoader:()=>Bl,ConeBufferGeometry:()=>Uh,ConeGeometry:()=>Fh,CubeCamera:()=>Tg,CubeGeometry:()=>iu,CubeReflectionMapping:()=>nh,CubeRefractionMapping:()=>Qd,CubeTexture:()=>qt,CubeTextureLoader:()=>Eg,CubeUVReflectionMapping:()=>ih,CubeUVRefractionMapping:()=>tf,CubicBezierCurve:()=>fu,CubicBezierCurve3:()=>VA,CubicInterpolant:()=>cu,CullFaceBack:()=>er,CullFaceFront:()=>Ga,CullFaceFrontBack:()=>Ku,CullFaceNone:()=>wl,Curve:()=>Gr,CurvePath:()=>Xh,CurveUtils:()=>Ma,CustomBlending:()=>km,CylinderBufferGeometry:()=>qo,CylinderGeometry:()=>ao,Cylindrical:()=>Xl,DataTexture:()=>Za,DataTextureLoader:()=>xa,DefaultLoadingManager:()=>ar,DepthFormat:()=>os,DepthStencilFormat:()=>Nc,DepthTexture:()=>Dh,DirectionalLight:()=>zh,DirectionalLightHelper:()=>Yl,DirectionalLightShadow:()=>lu,DiscreteInterpolant:()=>Bf,DodecahedronBufferGeometry:()=>va,DodecahedronGeometry:()=>Rr,DoubleSide:()=>Nt,DstAlphaFactor:()=>Wm,DstColorFactor:()=>hr,DynamicBufferAttribute:()=>Cw,EdgesGeometry:()=>tu,EdgesHelper:()=>Pw,EllipseCurve:()=>Cs,EqualDepth:()=>_y,EquirectangularReflectionMapping:()=>$m,EquirectangularRefractionMapping:()=>ef,Euler:()=>jo,EventDispatcher:()=>Tn,ExtrudeGeometry:()=>js,Face3:()=>zs,Face4:()=>Sr,FaceColors:()=>eh,FaceNormalsHelper:()=>Ko,FileLoader:()=>$s,FlatShading:()=>Ms,Float32Attribute:()=>Dw,Float32BufferAttribute:()=>On,Float64Attribute:()=>Rw,Float64BufferAttribute:()=>Tf,FloatType:()=>Sl,Fog:()=>Qa,FogExp2:()=>jc,Font:()=>u_,FontLoader:()=>Gf,FrontFaceDirectionCCW:()=>_s,FrontFaceDirectionCW:()=>Qu,FrontSide:()=>xs,Frustum:()=>xf,GammaEncoding:()=>lf,Geometry:()=>vn,GeometryIdCount:()=>t_,GeometryUtils:()=>Lw,GreaterDepth:()=>My,GreaterEqualDepth:()=>xy,GridHelper:()=>Jo,Group:()=>Ah,HalfFloatType:()=>oh,HemisphereLight:()=>ou,HemisphereLightHelper:()=>Ea,IcosahedronBufferGeometry:()=>Qn,IcosahedronGeometry:()=>Ll,ImageLoader:()=>su,ImageUtils:()=>Kf,ImmediateRenderObject:()=>Er,InstancedBufferAttribute:()=>$l,InstancedBufferGeometry:()=>Gl,InstancedInterleavedBuffer:()=>jl,Int16Attribute:()=>xu,Int16BufferAttribute:()=>Ef,Int32Attribute:()=>m_,Int32BufferAttribute:()=>Sf,Int8Attribute:()=>GA,Int8BufferAttribute:()=>bh,IntType:()=>Km,InterleavedBuffer:()=>Wl,InterleavedBufferAttribute:()=>Xf,Interpolant:()=>fs,InterpolateDiscrete:()=>ch,InterpolateLinear:()=>uh,InterpolateSmooth:()=>af,JSONLoader:()=>du,KeyframeTrack:()=>Yo,LOD:()=>qc,LatheBufferGeometry:()=>Fl,LatheGeometry:()=>Nf,Layers:()=>$o,LensFlare:()=>a_,LessDepth:()=>yy,LessEqualDepth:()=>Rc,Light:()=>zi,LightShadow:()=>il,Line:()=>ga,Line3:()=>ma,LineBasicMaterial:()=>Ji,LineCurve:()=>Eo,LineCurve3:()=>yu,LineDashedMaterial:()=>Ul,LinePieces:()=>ed,LineSegments:()=>Di,LineStrip:()=>Ew,LinearEncoding:()=>Jr,LinearFilter:()=>ws,LinearInterpolant:()=>Gh,LinearMipMapLinearFilter:()=>rh,LinearMipMapNearestFilter:()=>Ym,LinearToneMapping:()=>Jd,Loader:()=>Zo,LoadingManager:()=>zr,LogLuvEncoding:()=>Ho,LoopOnce:()=>Ay,LoopPingPong:()=>og,LoopRepeat:()=>sg,LuminanceAlphaFormat:()=>Ty,LuminanceFormat:()=>ng,MOUSE:()=>_i,Material:()=>wn,MaterialLoader:()=>zf,Math:()=>dn,Matrix3:()=>es,Matrix4:()=>Wt,MaxEquation:()=>Xd,Mesh:()=>br,MeshBasicMaterial:()=>Hs,MeshDepthMaterial:()=>kr,MeshFaceMaterial:()=>Sw,MeshLambertMaterial:()=>_a,MeshNormalMaterial:()=>ya,MeshPhongMaterial:()=>ds,MeshPhysicalMaterial:()=>nl,MeshStandardMaterial:()=>Si,MeshToonMaterial:()=>ns,MinEquation:()=>zm,MirroredRepeatWrapping:()=>El,MixOperation:()=>FM,MorphBlendMesh:()=>Wr,MultiMaterial:()=>kh,MultiplyBlending:()=>Dc,MultiplyOperation:()=>Yd,NearestFilter:()=>Us,NearestMipMapLinearFilter:()=>rf,NearestMipMapNearestFilter:()=>nf,NeverDepth:()=>hi,NoBlending:()=>th,NoColors:()=>ro,NoToneMapping:()=>Zd,NormalBlending:()=>Wa,NotEqualDepth:()=>OM,NumberKeyframeTrack:()=>uu,Object3D:()=>at,ObjectLoader:()=>Hf,OctahedronBufferGeometry:()=>el,OctahedronGeometry:()=>Zc,OneFactor:()=>Hm,OneMinusDstAlphaFactor:()=>jm,OneMinusDstColorFactor:()=>nr,OneMinusSrcAlphaFactor:()=>Os,OneMinusSrcColorFactor:()=>gy,OrthographicCamera:()=>Gs,PCFShadowMap:()=>qn,PCFSoftShadowMap:()=>Ur,ParametricBufferGeometry:()=>Pl,ParametricGeometry:()=>Rh,Particle:()=>_u,ParticleBasicMaterial:()=>td,ParticleSystem:()=>p_,ParticleSystemMaterial:()=>Tw,Path:()=>qh,PerspectiveCamera:()=>Zi,Plane:()=>si,PlaneBufferGeometry:()=>Hc,PlaneGeometry:()=>Yt,PointCloud:()=>co,PointCloudMaterial:()=>Zf,PointLight:()=>Vh,PointLightHelper:()=>gu,Points:()=>Ch,PointsMaterial:()=>bo,PolarGridHelper:()=>Sa,PolyhedronBufferGeometry:()=>ts,PolyhedronGeometry:()=>Ih,PositionalAudio:()=>Cg,Projector:()=>Nw,PropertyBinding:()=>Ri,PropertyMixer:()=>jf,QuadraticBezierCurve:()=>wa,QuadraticBezierCurve3:()=>zA,Quaternion:()=>fr,QuaternionKeyframeTrack:()=>Wh,QuaternionLinearInterpolant:()=>kf,REVISION:()=>zn,RGBADepthPacking:()=>dr,RGBAFormat:()=>zo,RGBA_PVRTC_2BPPV1_Format:()=>sf,RGBA_PVRTC_4BPPV1_Format:()=>lh,RGBA_S3TC_DXT1_Format:()=>ja,RGBA_S3TC_DXT3_Format:()=>so,RGBA_S3TC_DXT5_Format:()=>Cy,RGBDEncoding:()=>ni,RGBEEncoding:()=>cf,RGBEFormat:()=>BM,RGBFormat:()=>Lc,RGBM16Encoding:()=>Iy,RGBM7Encoding:()=>Ry,RGB_ETC1_Format:()=>Oc,RGB_PVRTC_2BPPV1_Format:()=>rg,RGB_PVRTC_4BPPV1_Format:()=>ig,RGB_S3TC_DXT1_Format:()=>Mr,RawShaderMaterial:()=>ru,Ray:()=>Yi,Raycaster:()=>Ag,RectAreaLight:()=>Yh,RectAreaLightHelper:()=>ql,ReinhardToneMapping:()=>wy,RepeatWrapping:()=>ha,ReverseSubtractEquation:()=>ua,RingBufferGeometry:()=>Ol,RingGeometry:()=>Oh,Scene:()=>$c,SceneUtils:()=>bw,ShaderChunk:()=>Wn,ShaderLib:()=>Ss,ShaderMaterial:()=>Qr,ShadowMaterial:()=>Pn,Shape:()=>Vl,ShapeBufferGeometry:()=>Qc,ShapeGeometry:()=>eu,ShapePath:()=>c_,ShapeUtils:()=>Ui,ShortType:()=>Jm,Skeleton:()=>Rf,SkeletonHelper:()=>sl,SkinnedMesh:()=>Pf,SmoothShading:()=>ss,Sphere:()=>or,SphereBufferGeometry:()=>tl,SphereGeometry:()=>Kc,Spherical:()=>qf,SphericalReflectionMapping:()=>Vo,Spline:()=>h_,SplineCurve:()=>kl,SplineCurve3:()=>kA,SpotLight:()=>Uf,SpotLightHelper:()=>Ki,SpotLightShadow:()=>au,Sprite:()=>Xc,SpriteMaterial:()=>Dl,SrcAlphaFactor:()=>Gm,SrcAlphaSaturateFactor:()=>vy,SrcColorFactor:()=>my,StereoCamera:()=>Zh,StringKeyframeTrack:()=>Vf,SubtractEquation:()=>$d,SubtractiveBlending:()=>bl,TetrahedronBufferGeometry:()=>Yc,TetrahedronGeometry:()=>Ts,TextGeometry:()=>Nh,Texture:()=>mt,TextureFilter:()=>Ey,TextureLoader:()=>Ff,TextureMapping:()=>Xm,TextureWrapping:()=>qm,TorusBufferGeometry:()=>Jc,TorusGeometry:()=>Lh,TorusKnotBufferGeometry:()=>Ir,TorusKnotGeometry:()=>Ph,Triangle:()=>oo,TriangleFanDrawMode:()=>Dy,TriangleStripDrawMode:()=>wr,TrianglesDrawMode:()=>ag,TubeBufferGeometry:()=>Nl,TubeGeometry:()=>Xo,UVMapping:()=>Ic,Uint16Attribute:()=>WA,Uint16BufferAttribute:()=>Ja,Uint32Attribute:()=>Aw,Uint32BufferAttribute:()=>Ka,Uint8Attribute:()=>qs,Uint8BufferAttribute:()=>wf,Uint8ClampedAttribute:()=>Ig,Uint8ClampedBufferAttribute:()=>bf,Uncharted2ToneMapping:()=>Kd,Uniform:()=>mu,UniformsLib:()=>Qt,UniformsUtils:()=>as,UnsignedByteType:()=>sh,UnsignedInt248Type:()=>ah,UnsignedIntType:()=>Qm,UnsignedShort4444Type:()=>eg,UnsignedShort5551Type:()=>tg,UnsignedShort565Type:()=>bs,UnsignedShortType:()=>Pc,Vector2:()=>ut,Vector3:()=>z,Vector4:()=>ri,VectorKeyframeTrack:()=>di,Vertex:()=>HA,VertexColors:()=>ca,VertexNormalsHelper:()=>Qh,VideoTexture:()=>hs,WebGLRenderTarget:()=>Xa,WebGLRenderTargetCube:()=>fh,WebGLRenderer:()=>Th,WireframeGeometry:()=>Il,WireframeHelper:()=>Pg,WrapAroundEnding:()=>hh,XHRLoader:()=>Jf,ZeroCurvatureEnding:()=>Tl,ZeroFactor:()=>tr,ZeroSlopeEnding:()=>$a,sRGBEncoding:()=>on}),void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52)),void 0===Math.sign&&(Math.sign=function(s){return s<0?-1:s>0?1:+s}),void 0===Function.prototype.name&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}}),void 0===Object.assign&&(Object.assign=function(s){if(null==s)throw new TypeError("Cannot convert undefined or null to object");for(var l=Object(s),c=1;c<arguments.length;c++){var d=arguments[c];if(null!=d)for(var p in d)Object.prototype.hasOwnProperty.call(d,p)&&(l[p]=d[p])}return l}),Object.assign(Tn.prototype,{addEventListener:function(s,l){void 0===this._listeners&&(this._listeners={});var c=this._listeners;void 0===c[s]&&(c[s]=[]),-1===c[s].indexOf(l)&&c[s].push(l)},hasEventListener:function(s,l){if(void 0===this._listeners)return!1;var c=this._listeners;return void 0!==c[s]&&-1!==c[s].indexOf(l)},removeEventListener:function(s,l){if(void 0!==this._listeners){var d=this._listeners[s];if(void 0!==d){var p=d.indexOf(l);-1!==p&&d.splice(p,1)}}},dispatchEvent:function(s){if(void 0!==this._listeners){var c=this._listeners[s.type];if(void 0!==c){s.target=this;var d=[],p=0,m=c.length;for(p=0;p<m;p++)d[p]=c[p];for(p=0;p<m;p++)d[p].call(this,s)}}}});var d,s,l,c,zn="83",_i={LEFT:0,MIDDLE:1,RIGHT:2},wl=0,er=1,Ga=2,Ku=3,Qu=0,_s=1,ti=0,qn=1,Ur=2,xs=0,ie=1,Nt=2,Ms=1,ss=2,ro=0,eh=1,ca=2,th=0,Wa=1,Bm=2,bl=3,Dc=4,km=5,jd={NoBlending:th,NormalBlending:Wa,AdditiveBlending:Bm,SubtractiveBlending:bl,MultiplyBlending:Dc,CustomBlending:km},Vm=100,$d=101,ua=102,zm=103,Xd=104,tr=200,Hm=201,my=202,gy=203,Gm=204,Os=205,Wm=206,jm=207,hr=208,nr=209,vy=210,hi=0,qd=1,yy=2,Rc=3,_y=4,xy=5,My=6,OM=7,Yd=0,FM=1,UM=2,Zd=0,Jd=1,wy=2,Kd=3,by=4,Ic=300,nh=301,Qd=302,$m=303,ef=304,Vo=305,ih=306,tf=307,Xm={UVMapping:Ic,CubeReflectionMapping:nh,CubeRefractionMapping:Qd,EquirectangularReflectionMapping:$m,EquirectangularRefractionMapping:ef,SphericalReflectionMapping:Vo,CubeUVReflectionMapping:ih,CubeUVRefractionMapping:tf},ha=1e3,Fs=1001,El=1002,qm={RepeatWrapping:ha,ClampToEdgeWrapping:Fs,MirroredRepeatWrapping:El},Us=1003,nf=1004,rf=1005,ws=1006,Ym=1007,rh=1008,Ey={NearestFilter:Us,NearestMipMapNearestFilter:nf,NearestMipMapLinearFilter:rf,LinearFilter:ws,LinearMipMapNearestFilter:Ym,LinearMipMapLinearFilter:rh},sh=1009,Zm=1010,Jm=1011,Pc=1012,Km=1013,Qm=1014,Sl=1015,oh=1016,eg=1017,tg=1018,bs=1019,ah=1020,Sy=1021,Lc=1022,zo=1023,ng=1024,Ty=1025,BM=zo,os=1026,Nc=1027,Mr=2001,ja=2002,so=2003,Cy=2004,ig=2100,rg=2101,lh=2102,sf=2103,Oc=2151,Ay=2200,sg=2201,og=2202,ch=2300,uh=2301,af=2302,Tl=2400,$a=2401,hh=2402,ag=0,wr=1,Dy=2,Jr=3e3,on=3001,lf=3007,cf=3002,Ho=3003,Ry=3004,Iy=3005,ni=3006,dh=3200,dr=3201,dn={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:(s="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),l=new Array(36),c=0,function(){for(var m=0;m<36;m++)8===m||13===m||18===m||23===m?l[m]="-":14===m?l[m]="4":(c<=2&&(c=33554432+16777216*Math.random()|0),d=15&c,c>>=4,l[m]=s[19===m?3&d|8:d]);return l.join("")}),clamp:function(s,l,c){return Math.max(l,Math.min(c,s))},euclideanModulo:function(s,l){return(s%l+l)%l},mapLinear:function(s,l,c,d,p){return d+(s-l)*(p-d)/(c-l)},lerp:function(s,l,c){return(1-c)*s+c*l},smoothstep:function(s,l,c){return s<=l?0:s>=c?1:(s=(s-l)/(c-l))*s*(3-2*s)},smootherstep:function(s,l,c){return s<=l?0:s>=c?1:(s=(s-l)/(c-l))*s*s*(s*(6*s-15)+10)},randInt:function(s,l){return s+Math.floor(Math.random()*(l-s+1))},randFloat:function(s,l){return s+Math.random()*(l-s)},randFloatSpread:function(s){return s*(.5-Math.random())},degToRad:function(s){return s*dn.DEG2RAD},radToDeg:function(s){return s*dn.RAD2DEG},isPowerOfTwo:function(s){return 0==(s&s-1)&&0!==s},nearestPowerOfTwo:function(s){return Math.pow(2,Math.round(Math.log(s)/Math.LN2))},nextPowerOfTwo:function(s){return s--,s|=s>>1,s|=s>>2,s|=s>>4,s|=s>>8,s|=s>>16,++s}};function ut(s,l){this.x=s||0,this.y=l||0}ut.prototype={constructor:ut,isVector2:!0,get width(){return this.x},set width(s){this.x=s},get height(){return this.y},set height(s){this.y=s},set:function(s,l){return this.x=s,this.y=l,this},setScalar:function(s){return this.x=s,this.y=s,this},setX:function(s){return this.x=s,this},setY:function(s){return this.y=s,this},setComponent:function(s,l){switch(s){case 0:this.x=l;break;case 1:this.y=l;break;default:throw new Error("index is out of range: "+s)}return this},getComponent:function(s){switch(s){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+s)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(s){return this.x=s.x,this.y=s.y,this},add:function(s,l){return void 0!==l?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(s,l)):(this.x+=s.x,this.y+=s.y,this)},addScalar:function(s){return this.x+=s,this.y+=s,this},addVectors:function(s,l){return this.x=s.x+l.x,this.y=s.y+l.y,this},addScaledVector:function(s,l){return this.x+=s.x*l,this.y+=s.y*l,this},sub:function(s,l){return void 0!==l?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(s,l)):(this.x-=s.x,this.y-=s.y,this)},subScalar:function(s){return this.x-=s,this.y-=s,this},subVectors:function(s,l){return this.x=s.x-l.x,this.y=s.y-l.y,this},multiply:function(s){return this.x*=s.x,this.y*=s.y,this},multiplyScalar:function(s){return isFinite(s)?(this.x*=s,this.y*=s):(this.x=0,this.y=0),this},divide:function(s){return this.x/=s.x,this.y/=s.y,this},divideScalar:function(s){return this.multiplyScalar(1/s)},min:function(s){return this.x=Math.min(this.x,s.x),this.y=Math.min(this.y,s.y),this},max:function(s){return this.x=Math.max(this.x,s.x),this.y=Math.max(this.y,s.y),this},clamp:function(s,l){return this.x=Math.max(s.x,Math.min(l.x,this.x)),this.y=Math.max(s.y,Math.min(l.y,this.y)),this},clampScalar:function(){var s,l;return function(d,p){return void 0===s&&(s=new ut,l=new ut),s.set(d,d),l.set(p,p),this.clamp(s,l)}}(),clampLength:function(s,l){var c=this.length();return this.multiplyScalar(Math.max(s,Math.min(l,c))/c)},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(s){return this.x*s.x+this.y*s.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length())},angle:function(){var s=Math.atan2(this.y,this.x);return s<0&&(s+=2*Math.PI),s},distanceTo:function(s){return Math.sqrt(this.distanceToSquared(s))},distanceToSquared:function(s){var l=this.x-s.x,c=this.y-s.y;return l*l+c*c},distanceToManhattan:function(s){return Math.abs(this.x-s.x)+Math.abs(this.y-s.y)},setLength:function(s){return this.multiplyScalar(s/this.length())},lerp:function(s,l){return this.x+=(s.x-this.x)*l,this.y+=(s.y-this.y)*l,this},lerpVectors:function(s,l,c){return this.subVectors(l,s).multiplyScalar(c).add(s)},equals:function(s){return s.x===this.x&&s.y===this.y},fromArray:function(s,l){return void 0===l&&(l=0),this.x=s[l],this.y=s[l+1],this},toArray:function(s,l){return void 0===s&&(s=[]),void 0===l&&(l=0),s[l]=this.x,s[l+1]=this.y,s},fromAttribute:function(s,l,c){return void 0!==c&&console.warn("THREE.Vector2: offset has been removed from .fromAttribute()."),this.x=s.getX(l),this.y=s.getY(l),this},rotateAround:function(s,l){var c=Math.cos(l),d=Math.sin(l),p=this.x-s.x,m=this.y-s.y;return this.x=p*c-m*d+s.x,this.y=p*d+m*c+s.y,this}};var bi=0;function mt(s,l,c,d,p,m,v,y,b,w){Object.defineProperty(this,"id",{value:bi++}),this.uuid=dn.generateUUID(),this.name="",this.image=void 0!==s?s:mt.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==l?l:mt.DEFAULT_MAPPING,this.wrapS=void 0!==c?c:Fs,this.wrapT=void 0!==d?d:Fs,this.magFilter=void 0!==p?p:ws,this.minFilter=void 0!==m?m:rh,this.anisotropy=void 0!==b?b:1,this.format=void 0!==v?v:zo,this.type=void 0!==y?y:sh,this.offset=new ut(0,0),this.repeat=new ut(1,1),this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=void 0!==w?w:Jr,this.version=0,this.onUpdate=null}function ri(s,l,c,d){this.x=s||0,this.y=l||0,this.z=c||0,this.w=void 0!==d?d:1}function Xa(s,l,c){this.uuid=dn.generateUUID(),this.width=s,this.height=l,this.scissor=new ri(0,0,s,l),this.scissorTest=!1,this.viewport=new ri(0,0,s,l),void 0===(c=c||{}).minFilter&&(c.minFilter=ws),this.texture=new mt(void 0,void 0,c.wrapS,c.wrapT,c.magFilter,c.minFilter,c.format,c.type,c.anisotropy,c.encoding),this.depthBuffer=void 0===c.depthBuffer||c.depthBuffer,this.stencilBuffer=void 0===c.stencilBuffer||c.stencilBuffer,this.depthTexture=void 0!==c.depthTexture?c.depthTexture:null}function fh(s,l,c){Xa.call(this,s,l,c),this.activeCubeFace=0,this.activeMipMapLevel=0}function fr(s,l,c,d){this._x=s||0,this._y=l||0,this._z=c||0,this._w=void 0!==d?d:1}function z(s,l,c){this.x=s||0,this.y=l||0,this.z=c||0}function Wt(){this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}function qt(s,l,c,d,p,m,v,y,b,w){mt.call(this,s=void 0!==s?s:[],l=void 0!==l?l:nh,c,d,p,m,v,y,b,w),this.flipY=!1}mt.DEFAULT_IMAGE=void 0,mt.DEFAULT_MAPPING=Ic,mt.prototype={constructor:mt,isTexture:!0,set needsUpdate(s){!0===s&&this.version++},clone:function(){return(new this.constructor).copy(this)},copy:function(s){return this.image=s.image,this.mipmaps=s.mipmaps.slice(0),this.mapping=s.mapping,this.wrapS=s.wrapS,this.wrapT=s.wrapT,this.magFilter=s.magFilter,this.minFilter=s.minFilter,this.anisotropy=s.anisotropy,this.format=s.format,this.type=s.type,this.offset.copy(s.offset),this.repeat.copy(s.repeat),this.generateMipmaps=s.generateMipmaps,this.premultiplyAlpha=s.premultiplyAlpha,this.flipY=s.flipY,this.unpackAlignment=s.unpackAlignment,this.encoding=s.encoding,this},toJSON:function(s){if(void 0!==s.textures[this.uuid])return s.textures[this.uuid];var c={metadata:{version:4.4,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],wrap:[this.wrapS,this.wrapT],minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY};if(void 0!==this.image){var d=this.image;void 0===d.uuid&&(d.uuid=dn.generateUUID()),void 0===s.images[d.uuid]&&(s.images[d.uuid]={uuid:d.uuid,url:function l(p){var m;return void 0!==p.toDataURL?m=p:((m=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")).width=p.width,m.height=p.height,m.getContext("2d").drawImage(p,0,0,p.width,p.height)),m.width>2048||m.height>2048?m.toDataURL("image/jpeg",.6):m.toDataURL("image/png")}(d)}),c.image=d.uuid}return s.textures[this.uuid]=c,c},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(s){if(this.mapping===Ic){if(s.multiply(this.repeat),s.add(this.offset),s.x<0||s.x>1)switch(this.wrapS){case ha:s.x=s.x-Math.floor(s.x);break;case Fs:s.x=s.x<0?0:1;break;case El:s.x=1===Math.abs(Math.floor(s.x)%2)?Math.ceil(s.x)-s.x:s.x-Math.floor(s.x)}if(s.y<0||s.y>1)switch(this.wrapT){case ha:s.y=s.y-Math.floor(s.y);break;case Fs:s.y=s.y<0?0:1;break;case El:s.y=1===Math.abs(Math.floor(s.y)%2)?Math.ceil(s.y)-s.y:s.y-Math.floor(s.y)}this.flipY&&(s.y=1-s.y)}}},Object.assign(mt.prototype,Tn.prototype),ri.prototype={constructor:ri,isVector4:!0,set:function(s,l,c,d){return this.x=s,this.y=l,this.z=c,this.w=d,this},setScalar:function(s){return this.x=s,this.y=s,this.z=s,this.w=s,this},setX:function(s){return this.x=s,this},setY:function(s){return this.y=s,this},setZ:function(s){return this.z=s,this},setW:function(s){return this.w=s,this},setComponent:function(s,l){switch(s){case 0:this.x=l;break;case 1:this.y=l;break;case 2:this.z=l;break;case 3:this.w=l;break;default:throw new Error("index is out of range: "+s)}return this},getComponent:function(s){switch(s){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+s)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(s){return this.x=s.x,this.y=s.y,this.z=s.z,this.w=void 0!==s.w?s.w:1,this},add:function(s,l){return void 0!==l?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(s,l)):(this.x+=s.x,this.y+=s.y,this.z+=s.z,this.w+=s.w,this)},addScalar:function(s){return this.x+=s,this.y+=s,this.z+=s,this.w+=s,this},addVectors:function(s,l){return this.x=s.x+l.x,this.y=s.y+l.y,this.z=s.z+l.z,this.w=s.w+l.w,this},addScaledVector:function(s,l){return this.x+=s.x*l,this.y+=s.y*l,this.z+=s.z*l,this.w+=s.w*l,this},sub:function(s,l){return void 0!==l?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(s,l)):(this.x-=s.x,this.y-=s.y,this.z-=s.z,this.w-=s.w,this)},subScalar:function(s){return this.x-=s,this.y-=s,this.z-=s,this.w-=s,this},subVectors:function(s,l){return this.x=s.x-l.x,this.y=s.y-l.y,this.z=s.z-l.z,this.w=s.w-l.w,this},multiplyScalar:function(s){return isFinite(s)?(this.x*=s,this.y*=s,this.z*=s,this.w*=s):(this.x=0,this.y=0,this.z=0,this.w=0),this},applyMatrix4:function(s){var l=this.x,c=this.y,d=this.z,p=this.w,m=s.elements;return this.x=m[0]*l+m[4]*c+m[8]*d+m[12]*p,this.y=m[1]*l+m[5]*c+m[9]*d+m[13]*p,this.z=m[2]*l+m[6]*c+m[10]*d+m[14]*p,this.w=m[3]*l+m[7]*c+m[11]*d+m[15]*p,this},divideScalar:function(s){return this.multiplyScalar(1/s)},setAxisAngleFromQuaternion:function(s){this.w=2*Math.acos(s.w);var l=Math.sqrt(1-s.w*s.w);return l<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=s.x/l,this.y=s.y/l,this.z=s.z/l),this},setAxisAngleFromRotationMatrix:function(s){var l,c,d,p,m=.01,v=.1,y=s.elements,b=y[0],w=y[4],T=y[8],A=y[1],R=y[5],P=y[9],L=y[2],B=y[6],U=y[10];if(Math.abs(w-A)<m&&Math.abs(T-L)<m&&Math.abs(P-B)<m){if(Math.abs(w+A)<v&&Math.abs(T+L)<v&&Math.abs(P+B)<v&&Math.abs(b+R+U-3)<v)return this.set(1,0,0,0),this;l=Math.PI;var F=(b+1)/2,V=(R+1)/2,H=(U+1)/2,J=(w+A)/4,q=(T+L)/4,ae=(P+B)/4;return F>V&&F>H?F<m?(c=0,d=.707106781,p=.707106781):(d=J/(c=Math.sqrt(F)),p=q/c):V>H?V<m?(c=.707106781,d=0,p=.707106781):(c=J/(d=Math.sqrt(V)),p=ae/d):H<m?(c=.707106781,d=.707106781,p=0):(c=q/(p=Math.sqrt(H)),d=ae/p),this.set(c,d,p,l),this}var se=Math.sqrt((B-P)*(B-P)+(T-L)*(T-L)+(A-w)*(A-w));return Math.abs(se)<.001&&(se=1),this.x=(B-P)/se,this.y=(T-L)/se,this.z=(A-w)/se,this.w=Math.acos((b+R+U-1)/2),this},min:function(s){return this.x=Math.min(this.x,s.x),this.y=Math.min(this.y,s.y),this.z=Math.min(this.z,s.z),this.w=Math.min(this.w,s.w),this},max:function(s){return this.x=Math.max(this.x,s.x),this.y=Math.max(this.y,s.y),this.z=Math.max(this.z,s.z),this.w=Math.max(this.w,s.w),this},clamp:function(s,l){return this.x=Math.max(s.x,Math.min(l.x,this.x)),this.y=Math.max(s.y,Math.min(l.y,this.y)),this.z=Math.max(s.z,Math.min(l.z,this.z)),this.w=Math.max(s.w,Math.min(l.w,this.w)),this},clampScalar:function(){var s,l;return function(d,p){return void 0===s&&(s=new ri,l=new ri),s.set(d,d,d,d),l.set(p,p,p,p),this.clamp(s,l)}}(),floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(s){return this.x*s.x+this.y*s.y+this.z*s.z+this.w*s.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(s){return this.multiplyScalar(s/this.length())},lerp:function(s,l){return this.x+=(s.x-this.x)*l,this.y+=(s.y-this.y)*l,this.z+=(s.z-this.z)*l,this.w+=(s.w-this.w)*l,this},lerpVectors:function(s,l,c){return this.subVectors(l,s).multiplyScalar(c).add(s)},equals:function(s){return s.x===this.x&&s.y===this.y&&s.z===this.z&&s.w===this.w},fromArray:function(s,l){return void 0===l&&(l=0),this.x=s[l],this.y=s[l+1],this.z=s[l+2],this.w=s[l+3],this},toArray:function(s,l){return void 0===s&&(s=[]),void 0===l&&(l=0),s[l]=this.x,s[l+1]=this.y,s[l+2]=this.z,s[l+3]=this.w,s},fromAttribute:function(s,l,c){return void 0!==c&&console.warn("THREE.Vector4: offset has been removed from .fromAttribute()."),this.x=s.getX(l),this.y=s.getY(l),this.z=s.getZ(l),this.w=s.getW(l),this}},Object.assign(Xa.prototype,Tn.prototype,{isWebGLRenderTarget:!0,setSize:function(s,l){(this.width!==s||this.height!==l)&&(this.width=s,this.height=l,this.dispose()),this.viewport.set(0,0,s,l),this.scissor.set(0,0,s,l)},clone:function(){return(new this.constructor).copy(this)},copy:function(s){return this.width=s.width,this.height=s.height,this.viewport.copy(s.viewport),this.texture=s.texture.clone(),this.depthBuffer=s.depthBuffer,this.stencilBuffer=s.stencilBuffer,this.depthTexture=s.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),(fh.prototype=Object.create(Xa.prototype)).constructor=fh,fh.prototype.isWebGLRenderTargetCube=!0,fr.prototype={constructor:fr,get x(){return this._x},set x(s){this._x=s,this.onChangeCallback()},get y(){return this._y},set y(s){this._y=s,this.onChangeCallback()},get z(){return this._z},set z(s){this._z=s,this.onChangeCallback()},get w(){return this._w},set w(s){this._w=s,this.onChangeCallback()},set:function(s,l,c,d){return this._x=s,this._y=l,this._z=c,this._w=d,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(s){return this._x=s.x,this._y=s.y,this._z=s.z,this._w=s.w,this.onChangeCallback(),this},setFromEuler:function(s,l){if(!1===(s&&s.isEuler))throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var c=Math.cos(s._x/2),d=Math.cos(s._y/2),p=Math.cos(s._z/2),m=Math.sin(s._x/2),v=Math.sin(s._y/2),y=Math.sin(s._z/2),b=s.order;return"XYZ"===b?(this._x=m*d*p+c*v*y,this._y=c*v*p-m*d*y,this._z=c*d*y+m*v*p,this._w=c*d*p-m*v*y):"YXZ"===b?(this._x=m*d*p+c*v*y,this._y=c*v*p-m*d*y,this._z=c*d*y-m*v*p,this._w=c*d*p+m*v*y):"ZXY"===b?(this._x=m*d*p-c*v*y,this._y=c*v*p+m*d*y,this._z=c*d*y+m*v*p,this._w=c*d*p-m*v*y):"ZYX"===b?(this._x=m*d*p-c*v*y,this._y=c*v*p+m*d*y,this._z=c*d*y-m*v*p,this._w=c*d*p+m*v*y):"YZX"===b?(this._x=m*d*p+c*v*y,this._y=c*v*p+m*d*y,this._z=c*d*y-m*v*p,this._w=c*d*p-m*v*y):"XZY"===b&&(this._x=m*d*p-c*v*y,this._y=c*v*p-m*d*y,this._z=c*d*y+m*v*p,this._w=c*d*p+m*v*y),!1!==l&&this.onChangeCallback(),this},setFromAxisAngle:function(s,l){var c=l/2,d=Math.sin(c);return this._x=s.x*d,this._y=s.y*d,this._z=s.z*d,this._w=Math.cos(c),this.onChangeCallback(),this},setFromRotationMatrix:function(s){var R,l=s.elements,c=l[0],d=l[4],p=l[8],m=l[1],v=l[5],y=l[9],b=l[2],w=l[6],T=l[10],A=c+v+T;return A>0?(R=.5/Math.sqrt(A+1),this._w=.25/R,this._x=(w-y)*R,this._y=(p-b)*R,this._z=(m-d)*R):c>v&&c>T?(R=2*Math.sqrt(1+c-v-T),this._w=(w-y)/R,this._x=.25*R,this._y=(d+m)/R,this._z=(p+b)/R):v>T?(R=2*Math.sqrt(1+v-c-T),this._w=(p-b)/R,this._x=(d+m)/R,this._y=.25*R,this._z=(y+w)/R):(R=2*Math.sqrt(1+T-c-v),this._w=(m-d)/R,this._x=(p+b)/R,this._y=(y+w)/R,this._z=.25*R),this.onChangeCallback(),this},setFromUnitVectors:function(){var s,l;return function(p,m){return void 0===s&&(s=new z),(l=p.dot(m)+1)<1e-6?(l=0,Math.abs(p.x)>Math.abs(p.z)?s.set(-p.y,p.x,0):s.set(0,-p.z,p.y)):s.crossVectors(p,m),this._x=s.x,this._y=s.y,this._z=s.z,this._w=l,this.normalize()}}(),inverse:function(){return this.conjugate().normalize()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this},dot:function(s){return this._x*s._x+this._y*s._y+this._z*s._z+this._w*s._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var s=this.length();return 0===s?(this._x=0,this._y=0,this._z=0,this._w=1):(this._x=this._x*(s=1/s),this._y=this._y*s,this._z=this._z*s,this._w=this._w*s),this.onChangeCallback(),this},multiply:function(s,l){return void 0!==l?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(s,l)):this.multiplyQuaternions(this,s)},premultiply:function(s){return this.multiplyQuaternions(s,this)},multiplyQuaternions:function(s,l){var c=s._x,d=s._y,p=s._z,m=s._w,v=l._x,y=l._y,b=l._z,w=l._w;return this._x=c*w+m*v+d*b-p*y,this._y=d*w+m*y+p*v-c*b,this._z=p*w+m*b+c*y-d*v,this._w=m*w-c*v-d*y-p*b,this.onChangeCallback(),this},slerp:function(s,l){if(0===l)return this;if(1===l)return this.copy(s);var c=this._x,d=this._y,p=this._z,m=this._w,v=m*s._w+c*s._x+d*s._y+p*s._z;if(v<0?(this._w=-s._w,this._x=-s._x,this._y=-s._y,this._z=-s._z,v=-v):this.copy(s),v>=1)return this._w=m,this._x=c,this._y=d,this._z=p,this;var y=Math.sqrt(1-v*v);if(Math.abs(y)<.001)return this._w=.5*(m+this._w),this._x=.5*(c+this._x),this._y=.5*(d+this._y),this._z=.5*(p+this._z),this;var b=Math.atan2(y,v),w=Math.sin((1-l)*b)/y,T=Math.sin(l*b)/y;return this._w=m*w+this._w*T,this._x=c*w+this._x*T,this._y=d*w+this._y*T,this._z=p*w+this._z*T,this.onChangeCallback(),this},equals:function(s){return s._x===this._x&&s._y===this._y&&s._z===this._z&&s._w===this._w},fromArray:function(s,l){return void 0===l&&(l=0),this._x=s[l],this._y=s[l+1],this._z=s[l+2],this._w=s[l+3],this.onChangeCallback(),this},toArray:function(s,l){return void 0===s&&(s=[]),void 0===l&&(l=0),s[l]=this._x,s[l+1]=this._y,s[l+2]=this._z,s[l+3]=this._w,s},onChange:function(s){return this.onChangeCallback=s,this},onChangeCallback:function(){}},Object.assign(fr,{slerp:function(s,l,c,d){return c.copy(s).slerp(l,d)},slerpFlat:function(s,l,c,d,p,m,v){var y=c[d+0],b=c[d+1],w=c[d+2],T=c[d+3],A=p[m+0],R=p[m+1],P=p[m+2],L=p[m+3];if(T!==L||y!==A||b!==R||w!==P){var B=1-v,U=y*A+b*R+w*P+T*L,F=U>=0?1:-1,V=1-U*U;if(V>Number.EPSILON){var H=Math.sqrt(V),J=Math.atan2(H,U*F);B=Math.sin(B*J)/H,v=Math.sin(v*J)/H}var q=v*F;if(y=y*B+A*q,b=b*B+R*q,w=w*B+P*q,T=T*B+L*q,B===1-v){var ae=1/Math.sqrt(y*y+b*b+w*w+T*T);y*=ae,b*=ae,w*=ae,T*=ae}}s[l]=y,s[l+1]=b,s[l+2]=w,s[l+3]=T}}),z.prototype={constructor:z,isVector3:!0,set:function(s,l,c){return this.x=s,this.y=l,this.z=c,this},setScalar:function(s){return this.x=s,this.y=s,this.z=s,this},setX:function(s){return this.x=s,this},setY:function(s){return this.y=s,this},setZ:function(s){return this.z=s,this},setComponent:function(s,l){switch(s){case 0:this.x=l;break;case 1:this.y=l;break;case 2:this.z=l;break;default:throw new Error("index is out of range: "+s)}return this},getComponent:function(s){switch(s){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+s)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(s){return this.x=s.x,this.y=s.y,this.z=s.z,this},add:function(s,l){return void 0!==l?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(s,l)):(this.x+=s.x,this.y+=s.y,this.z+=s.z,this)},addScalar:function(s){return this.x+=s,this.y+=s,this.z+=s,this},addVectors:function(s,l){return this.x=s.x+l.x,this.y=s.y+l.y,this.z=s.z+l.z,this},addScaledVector:function(s,l){return this.x+=s.x*l,this.y+=s.y*l,this.z+=s.z*l,this},sub:function(s,l){return void 0!==l?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(s,l)):(this.x-=s.x,this.y-=s.y,this.z-=s.z,this)},subScalar:function(s){return this.x-=s,this.y-=s,this.z-=s,this},subVectors:function(s,l){return this.x=s.x-l.x,this.y=s.y-l.y,this.z=s.z-l.z,this},multiply:function(s,l){return void 0!==l?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(s,l)):(this.x*=s.x,this.y*=s.y,this.z*=s.z,this)},multiplyScalar:function(s){return isFinite(s)?(this.x*=s,this.y*=s,this.z*=s):(this.x=0,this.y=0,this.z=0),this},multiplyVectors:function(s,l){return this.x=s.x*l.x,this.y=s.y*l.y,this.z=s.z*l.z,this},applyEuler:function(){var s;return function(c){return!1===(c&&c.isEuler)&&console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),void 0===s&&(s=new fr),this.applyQuaternion(s.setFromEuler(c))}}(),applyAxisAngle:function(){var s;return function(c,d){return void 0===s&&(s=new fr),this.applyQuaternion(s.setFromAxisAngle(c,d))}}(),applyMatrix3:function(s){var l=this.x,c=this.y,d=this.z,p=s.elements;return this.x=p[0]*l+p[3]*c+p[6]*d,this.y=p[1]*l+p[4]*c+p[7]*d,this.z=p[2]*l+p[5]*c+p[8]*d,this},applyMatrix4:function(s){var l=this.x,c=this.y,d=this.z,p=s.elements;return this.x=p[0]*l+p[4]*c+p[8]*d+p[12],this.y=p[1]*l+p[5]*c+p[9]*d+p[13],this.z=p[2]*l+p[6]*c+p[10]*d+p[14],this},applyProjection:function(s){var l=this.x,c=this.y,d=this.z,p=s.elements,m=1/(p[3]*l+p[7]*c+p[11]*d+p[15]);return this.x=(p[0]*l+p[4]*c+p[8]*d+p[12])*m,this.y=(p[1]*l+p[5]*c+p[9]*d+p[13])*m,this.z=(p[2]*l+p[6]*c+p[10]*d+p[14])*m,this},applyQuaternion:function(s){var l=this.x,c=this.y,d=this.z,p=s.x,m=s.y,v=s.z,y=s.w,b=y*l+m*d-v*c,w=y*c+v*l-p*d,T=y*d+p*c-m*l,A=-p*l-m*c-v*d;return this.x=b*y+A*-p+w*-v-T*-m,this.y=w*y+A*-m+T*-p-b*-v,this.z=T*y+A*-v+b*-m-w*-p,this},project:function(){var s;return function(c){return void 0===s&&(s=new Wt),s.multiplyMatrices(c.projectionMatrix,s.getInverse(c.matrixWorld)),this.applyProjection(s)}}(),unproject:function(){var s;return function(c){return void 0===s&&(s=new Wt),s.multiplyMatrices(c.matrixWorld,s.getInverse(c.projectionMatrix)),this.applyProjection(s)}}(),transformDirection:function(s){var l=this.x,c=this.y,d=this.z,p=s.elements;return this.x=p[0]*l+p[4]*c+p[8]*d,this.y=p[1]*l+p[5]*c+p[9]*d,this.z=p[2]*l+p[6]*c+p[10]*d,this.normalize()},divide:function(s){return this.x/=s.x,this.y/=s.y,this.z/=s.z,this},divideScalar:function(s){return this.multiplyScalar(1/s)},min:function(s){return this.x=Math.min(this.x,s.x),this.y=Math.min(this.y,s.y),this.z=Math.min(this.z,s.z),this},max:function(s){return this.x=Math.max(this.x,s.x),this.y=Math.max(this.y,s.y),this.z=Math.max(this.z,s.z),this},clamp:function(s,l){return this.x=Math.max(s.x,Math.min(l.x,this.x)),this.y=Math.max(s.y,Math.min(l.y,this.y)),this.z=Math.max(s.z,Math.min(l.z,this.z)),this},clampScalar:function(){var s,l;return function(d,p){return void 0===s&&(s=new z,l=new z),s.set(d,d,d),l.set(p,p,p),this.clamp(s,l)}}(),clampLength:function(s,l){var c=this.length();return this.multiplyScalar(Math.max(s,Math.min(l,c))/c)},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(s){return this.x*s.x+this.y*s.y+this.z*s.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(s){return this.multiplyScalar(s/this.length())},lerp:function(s,l){return this.x+=(s.x-this.x)*l,this.y+=(s.y-this.y)*l,this.z+=(s.z-this.z)*l,this},lerpVectors:function(s,l,c){return this.subVectors(l,s).multiplyScalar(c).add(s)},cross:function(s,l){if(void 0!==l)return console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(s,l);var c=this.x,d=this.y,p=this.z;return this.x=d*s.z-p*s.y,this.y=p*s.x-c*s.z,this.z=c*s.y-d*s.x,this},crossVectors:function(s,l){var c=s.x,d=s.y,p=s.z,m=l.x,v=l.y,y=l.z;return this.x=d*y-p*v,this.y=p*m-c*y,this.z=c*v-d*m,this},projectOnVector:function(s){var l=s.dot(this)/s.lengthSq();return this.copy(s).multiplyScalar(l)},projectOnPlane:function(){var s;return function(c){return void 0===s&&(s=new z),s.copy(this).projectOnVector(c),this.sub(s)}}(),reflect:function(){var s;return function(c){return void 0===s&&(s=new z),this.sub(s.copy(c).multiplyScalar(2*this.dot(c)))}}(),angleTo:function(s){var l=this.dot(s)/Math.sqrt(this.lengthSq()*s.lengthSq());return Math.acos(dn.clamp(l,-1,1))},distanceTo:function(s){return Math.sqrt(this.distanceToSquared(s))},distanceToSquared:function(s){var l=this.x-s.x,c=this.y-s.y,d=this.z-s.z;return l*l+c*c+d*d},distanceToManhattan:function(s){return Math.abs(this.x-s.x)+Math.abs(this.y-s.y)+Math.abs(this.z-s.z)},setFromSpherical:function(s){var l=Math.sin(s.phi)*s.radius;return this.x=l*Math.sin(s.theta),this.y=Math.cos(s.phi)*s.radius,this.z=l*Math.cos(s.theta),this},setFromCylindrical:function(s){return this.x=s.radius*Math.sin(s.theta),this.y=s.y,this.z=s.radius*Math.cos(s.theta),this},setFromMatrixPosition:function(s){return this.setFromMatrixColumn(s,3)},setFromMatrixScale:function(s){var l=this.setFromMatrixColumn(s,0).length(),c=this.setFromMatrixColumn(s,1).length(),d=this.setFromMatrixColumn(s,2).length();return this.x=l,this.y=c,this.z=d,this},setFromMatrixColumn:function(s,l){if("number"==typeof s){console.warn("THREE.Vector3: setFromMatrixColumn now expects ( matrix, index ).");var c=s;s=l,l=c}return this.fromArray(s.elements,4*l)},equals:function(s){return s.x===this.x&&s.y===this.y&&s.z===this.z},fromArray:function(s,l){return void 0===l&&(l=0),this.x=s[l],this.y=s[l+1],this.z=s[l+2],this},toArray:function(s,l){return void 0===s&&(s=[]),void 0===l&&(l=0),s[l]=this.x,s[l+1]=this.y,s[l+2]=this.z,s},fromAttribute:function(s,l,c){return void 0!==c&&console.warn("THREE.Vector3: offset has been removed from .fromAttribute()."),this.x=s.getX(l),this.y=s.getY(l),this.z=s.getZ(l),this}},Wt.prototype={constructor:Wt,isMatrix4:!0,set:function(s,l,c,d,p,m,v,y,b,w,T,A,R,P,L,B){var U=this.elements;return U[0]=s,U[4]=l,U[8]=c,U[12]=d,U[1]=p,U[5]=m,U[9]=v,U[13]=y,U[2]=b,U[6]=w,U[10]=T,U[14]=A,U[3]=R,U[7]=P,U[11]=L,U[15]=B,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new Wt).fromArray(this.elements)},copy:function(s){return this.elements.set(s.elements),this},copyPosition:function(s){var l=this.elements,c=s.elements;return l[12]=c[12],l[13]=c[13],l[14]=c[14],this},extractBasis:function(s,l,c){return s.setFromMatrixColumn(this,0),l.setFromMatrixColumn(this,1),c.setFromMatrixColumn(this,2),this},makeBasis:function(s,l,c){return this.set(s.x,l.x,c.x,0,s.y,l.y,c.y,0,s.z,l.z,c.z,0,0,0,0,1),this},extractRotation:function(){var s;return function(c){void 0===s&&(s=new z);var d=this.elements,p=c.elements,m=1/s.setFromMatrixColumn(c,0).length(),v=1/s.setFromMatrixColumn(c,1).length(),y=1/s.setFromMatrixColumn(c,2).length();return d[0]=p[0]*m,d[1]=p[1]*m,d[2]=p[2]*m,d[4]=p[4]*v,d[5]=p[5]*v,d[6]=p[6]*v,d[8]=p[8]*y,d[9]=p[9]*y,d[10]=p[10]*y,this}}(),makeRotationFromEuler:function(s){!1===(s&&s.isEuler)&&console.error("THREE.Matrix: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var l=this.elements,c=s.x,d=s.y,p=s.z,m=Math.cos(c),v=Math.sin(c),y=Math.cos(d),b=Math.sin(d),w=Math.cos(p),T=Math.sin(p);if("XYZ"===s.order){var A=m*w,R=m*T,P=v*w,L=v*T;l[0]=y*w,l[4]=-y*T,l[8]=b,l[1]=R+P*b,l[5]=A-L*b,l[9]=-v*y,l[2]=L-A*b,l[6]=P+R*b,l[10]=m*y}else if("YXZ"===s.order){var U=y*T,F=b*w;l[0]=(B=y*w)+(V=b*T)*v,l[4]=F*v-U,l[8]=m*b,l[1]=m*T,l[5]=m*w,l[9]=-v,l[2]=U*v-F,l[6]=V+B*v,l[10]=m*y}else if("ZXY"===s.order){var B,V;U=y*T,F=b*w,l[0]=(B=y*w)-(V=b*T)*v,l[4]=-m*T,l[8]=F+U*v,l[1]=U+F*v,l[5]=m*w,l[9]=V-B*v,l[2]=-m*b,l[6]=v,l[10]=m*y}else if("ZYX"===s.order)A=m*w,R=m*T,P=v*w,L=v*T,l[0]=y*w,l[4]=P*b-R,l[8]=A*b+L,l[1]=y*T,l[5]=L*b+A,l[9]=R*b-P,l[2]=-b,l[6]=v*y,l[10]=m*y;else if("YZX"===s.order){var H=m*y,J=m*b,q=v*y,ae=v*b;l[0]=y*w,l[4]=ae-H*T,l[8]=q*T+J,l[1]=T,l[5]=m*w,l[9]=-v*w,l[2]=-b*w,l[6]=J*T+q,l[10]=H-ae*T}else"XZY"===s.order&&(H=m*y,J=m*b,q=v*y,ae=v*b,l[0]=y*w,l[4]=-T,l[8]=b*w,l[1]=H*T+ae,l[5]=m*w,l[9]=J*T-q,l[2]=q*T-J,l[6]=v*w,l[10]=ae*T+H);return l[3]=0,l[7]=0,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,this},makeRotationFromQuaternion:function(s){var l=this.elements,c=s.x,d=s.y,p=s.z,m=s.w,v=c+c,y=d+d,b=p+p,w=c*v,T=c*y,A=c*b,R=d*y,P=d*b,L=p*b,B=m*v,U=m*y,F=m*b;return l[0]=1-(R+L),l[4]=T-F,l[8]=A+U,l[1]=T+F,l[5]=1-(w+L),l[9]=P-B,l[2]=A-U,l[6]=P+B,l[10]=1-(w+R),l[3]=0,l[7]=0,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,this},lookAt:function(){var s,l,c;return function(p,m,v){void 0===s&&(s=new z,l=new z,c=new z);var y=this.elements;return c.subVectors(p,m).normalize(),0===c.lengthSq()&&(c.z=1),s.crossVectors(v,c).normalize(),0===s.lengthSq()&&(c.z+=1e-4,s.crossVectors(v,c).normalize()),l.crossVectors(c,s),y[0]=s.x,y[4]=l.x,y[8]=c.x,y[1]=s.y,y[5]=l.y,y[9]=c.y,y[2]=s.z,y[6]=l.z,y[10]=c.z,this}}(),multiply:function(s,l){return void 0!==l?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(s,l)):this.multiplyMatrices(this,s)},premultiply:function(s){return this.multiplyMatrices(s,this)},multiplyMatrices:function(s,l){var c=s.elements,d=l.elements,p=this.elements,m=c[0],v=c[4],y=c[8],b=c[12],w=c[1],T=c[5],A=c[9],R=c[13],P=c[2],L=c[6],B=c[10],U=c[14],F=c[3],V=c[7],H=c[11],J=c[15],q=d[0],ae=d[4],se=d[8],le=d[12],ue=d[1],me=d[5],Fe=d[9],Ie=d[13],Z=d[2],ee=d[6],ve=d[10],Te=d[14],Oe=d[3],Le=d[7],Ne=d[11],Qe=d[15];return p[0]=m*q+v*ue+y*Z+b*Oe,p[4]=m*ae+v*me+y*ee+b*Le,p[8]=m*se+v*Fe+y*ve+b*Ne,p[12]=m*le+v*Ie+y*Te+b*Qe,p[1]=w*q+T*ue+A*Z+R*Oe,p[5]=w*ae+T*me+A*ee+R*Le,p[9]=w*se+T*Fe+A*ve+R*Ne,p[13]=w*le+T*Ie+A*Te+R*Qe,p[2]=P*q+L*ue+B*Z+U*Oe,p[6]=P*ae+L*me+B*ee+U*Le,p[10]=P*se+L*Fe+B*ve+U*Ne,p[14]=P*le+L*Ie+B*Te+U*Qe,p[3]=F*q+V*ue+H*Z+J*Oe,p[7]=F*ae+V*me+H*ee+J*Le,p[11]=F*se+V*Fe+H*ve+J*Ne,p[15]=F*le+V*Ie+H*Te+J*Qe,this},multiplyToArray:function(s,l,c){var d=this.elements;return this.multiplyMatrices(s,l),c[0]=d[0],c[1]=d[1],c[2]=d[2],c[3]=d[3],c[4]=d[4],c[5]=d[5],c[6]=d[6],c[7]=d[7],c[8]=d[8],c[9]=d[9],c[10]=d[10],c[11]=d[11],c[12]=d[12],c[13]=d[13],c[14]=d[14],c[15]=d[15],this},multiplyScalar:function(s){var l=this.elements;return l[0]*=s,l[4]*=s,l[8]*=s,l[12]*=s,l[1]*=s,l[5]*=s,l[9]*=s,l[13]*=s,l[2]*=s,l[6]*=s,l[10]*=s,l[14]*=s,l[3]*=s,l[7]*=s,l[11]*=s,l[15]*=s,this},applyToVector3Array:function(){var s;return function(c,d,p){void 0===s&&(s=new z),void 0===d&&(d=0),void 0===p&&(p=c.length);for(var m=0,v=d;m<p;m+=3,v+=3)s.fromArray(c,v),s.applyMatrix4(this),s.toArray(c,v);return c}}(),applyToBufferAttribute:function(){var s;return function(c){void 0===s&&(s=new z);for(var d=0,p=c.count;d<p;d++)s.x=c.getX(d),s.y=c.getY(d),s.z=c.getZ(d),s.applyMatrix4(this),c.setXYZ(d,s.x,s.y,s.z);return c}}(),determinant:function(){var s=this.elements,l=s[0],c=s[4],d=s[8],p=s[12],m=s[1],v=s[5],y=s[9],b=s[13],w=s[2],T=s[6],A=s[10],R=s[14];return s[3]*(+p*y*T-d*b*T-p*v*A+c*b*A+d*v*R-c*y*R)+s[7]*(+l*y*R-l*b*A+p*m*A-d*m*R+d*b*w-p*y*w)+s[11]*(+l*b*T-l*v*R-p*m*T+c*m*R+p*v*w-c*b*w)+s[15]*(-d*v*w-l*y*T+l*v*A+d*m*T-c*m*A+c*y*w)},transpose:function(){var l,s=this.elements;return l=s[1],s[1]=s[4],s[4]=l,l=s[2],s[2]=s[8],s[8]=l,l=s[6],s[6]=s[9],s[9]=l,l=s[3],s[3]=s[12],s[12]=l,l=s[7],s[7]=s[13],s[13]=l,l=s[11],s[11]=s[14],s[14]=l,this},setPosition:function(s){var l=this.elements;return l[12]=s.x,l[13]=s.y,l[14]=s.z,this},getInverse:function(s,l){var c=this.elements,d=s.elements,p=d[0],m=d[1],v=d[2],y=d[3],b=d[4],w=d[5],T=d[6],A=d[7],R=d[8],P=d[9],L=d[10],B=d[11],U=d[12],F=d[13],V=d[14],H=d[15],J=P*V*A-F*L*A+F*T*B-w*V*B-P*T*H+w*L*H,q=U*L*A-R*V*A-U*T*B+b*V*B+R*T*H-b*L*H,ae=R*F*A-U*P*A+U*w*B-b*F*B-R*w*H+b*P*H,se=U*P*T-R*F*T-U*w*L+b*F*L+R*w*V-b*P*V,le=p*J+m*q+v*ae+y*se;if(0===le){var ue="THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0";if(!0===l)throw new Error(ue);return console.warn(ue),this.identity()}var me=1/le;return c[0]=J*me,c[1]=(F*L*y-P*V*y-F*v*B+m*V*B+P*v*H-m*L*H)*me,c[2]=(w*V*y-F*T*y+F*v*A-m*V*A-w*v*H+m*T*H)*me,c[3]=(P*T*y-w*L*y-P*v*A+m*L*A+w*v*B-m*T*B)*me,c[4]=q*me,c[5]=(R*V*y-U*L*y+U*v*B-p*V*B-R*v*H+p*L*H)*me,c[6]=(U*T*y-b*V*y-U*v*A+p*V*A+b*v*H-p*T*H)*me,c[7]=(b*L*y-R*T*y+R*v*A-p*L*A-b*v*B+p*T*B)*me,c[8]=ae*me,c[9]=(U*P*y-R*F*y-U*m*B+p*F*B+R*m*H-p*P*H)*me,c[10]=(b*F*y-U*w*y+U*m*A-p*F*A-b*m*H+p*w*H)*me,c[11]=(R*w*y-b*P*y-R*m*A+p*P*A+b*m*B-p*w*B)*me,c[12]=se*me,c[13]=(R*F*v-U*P*v+U*m*L-p*F*L-R*m*V+p*P*V)*me,c[14]=(U*w*v-b*F*v-U*m*T+p*F*T+b*m*V-p*w*V)*me,c[15]=(b*P*v-R*w*v+R*m*T-p*P*T-b*m*L+p*w*L)*me,this},scale:function(s){var l=this.elements,c=s.x,d=s.y,p=s.z;return l[0]*=c,l[4]*=d,l[8]*=p,l[1]*=c,l[5]*=d,l[9]*=p,l[2]*=c,l[6]*=d,l[10]*=p,l[3]*=c,l[7]*=d,l[11]*=p,this},getMaxScaleOnAxis:function(){var s=this.elements;return Math.sqrt(Math.max(s[0]*s[0]+s[1]*s[1]+s[2]*s[2],s[4]*s[4]+s[5]*s[5]+s[6]*s[6],s[8]*s[8]+s[9]*s[9]+s[10]*s[10]))},makeTranslation:function(s,l,c){return this.set(1,0,0,s,0,1,0,l,0,0,1,c,0,0,0,1),this},makeRotationX:function(s){var l=Math.cos(s),c=Math.sin(s);return this.set(1,0,0,0,0,l,-c,0,0,c,l,0,0,0,0,1),this},makeRotationY:function(s){var l=Math.cos(s),c=Math.sin(s);return this.set(l,0,c,0,0,1,0,0,-c,0,l,0,0,0,0,1),this},makeRotationZ:function(s){var l=Math.cos(s),c=Math.sin(s);return this.set(l,-c,0,0,c,l,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(s,l){var c=Math.cos(l),d=Math.sin(l),p=1-c,m=s.x,v=s.y,y=s.z,b=p*m,w=p*v;return this.set(b*m+c,b*v-d*y,b*y+d*v,0,b*v+d*y,w*v+c,w*y-d*m,0,b*y-d*v,w*y+d*m,p*y*y+c,0,0,0,0,1),this},makeScale:function(s,l,c){return this.set(s,0,0,0,0,l,0,0,0,0,c,0,0,0,0,1),this},makeShear:function(s,l,c){return this.set(1,l,c,0,s,1,c,0,s,l,1,0,0,0,0,1),this},compose:function(s,l,c){return this.makeRotationFromQuaternion(l),this.scale(c),this.setPosition(s),this},decompose:function(){var s,l;return function(d,p,m){void 0===s&&(s=new z,l=new Wt);var v=this.elements,y=s.set(v[0],v[1],v[2]).length(),b=s.set(v[4],v[5],v[6]).length(),w=s.set(v[8],v[9],v[10]).length();this.determinant()<0&&(y=-y),d.x=v[12],d.y=v[13],d.z=v[14],l.elements.set(this.elements);var A=1/y,R=1/b,P=1/w;return l.elements[0]*=A,l.elements[1]*=A,l.elements[2]*=A,l.elements[4]*=R,l.elements[5]*=R,l.elements[6]*=R,l.elements[8]*=P,l.elements[9]*=P,l.elements[10]*=P,p.setFromRotationMatrix(l),m.x=y,m.y=b,m.z=w,this}}(),makeFrustum:function(s,l,c,d,p,m){var v=this.elements,b=2*p/(d-c),w=(l+s)/(l-s),T=(d+c)/(d-c),A=-(m+p)/(m-p),R=-2*m*p/(m-p);return v[0]=2*p/(l-s),v[4]=0,v[8]=w,v[12]=0,v[1]=0,v[5]=b,v[9]=T,v[13]=0,v[2]=0,v[6]=0,v[10]=A,v[14]=R,v[3]=0,v[7]=0,v[11]=-1,v[15]=0,this},makePerspective:function(s,l,c,d){var p=c*Math.tan(dn.DEG2RAD*s*.5),m=-p;return this.makeFrustum(m*l,p*l,m,p,c,d)},makeOrthographic:function(s,l,c,d,p,m){var v=this.elements,y=1/(l-s),b=1/(c-d),w=1/(m-p),T=(l+s)*y,A=(c+d)*b,R=(m+p)*w;return v[0]=2*y,v[4]=0,v[8]=0,v[12]=-T,v[1]=0,v[5]=2*b,v[9]=0,v[13]=-A,v[2]=0,v[6]=0,v[10]=-2*w,v[14]=-R,v[3]=0,v[7]=0,v[11]=0,v[15]=1,this},equals:function(s){for(var l=this.elements,c=s.elements,d=0;d<16;d++)if(l[d]!==c[d])return!1;return!0},fromArray:function(s,l){void 0===l&&(l=0);for(var c=0;c<16;c++)this.elements[c]=s[c+l];return this},toArray:function(s,l){void 0===s&&(s=[]),void 0===l&&(l=0);var c=this.elements;return s[l]=c[0],s[l+1]=c[1],s[l+2]=c[2],s[l+3]=c[3],s[l+4]=c[4],s[l+5]=c[5],s[l+6]=c[6],s[l+7]=c[7],s[l+8]=c[8],s[l+9]=c[9],s[l+10]=c[10],s[l+11]=c[11],s[l+12]=c[12],s[l+13]=c[13],s[l+14]=c[14],s[l+15]=c[15],s}},(qt.prototype=Object.create(mt.prototype)).constructor=qt,qt.prototype.isCubeTexture=!0,Object.defineProperty(qt.prototype,"images",{get:function(){return this.image},set:function(s){this.image=s}});var Kn=new mt,Py=new qt;function kM(){this.seq=[],this.map={}}var Ly=[],uf=[];function Dr(s,l,c){var d=s[0];if(d<=0||d>0)return s;var p=l*c,m=Ly[p];if(void 0===m&&(m=new Float32Array(p),Ly[p]=m),0!==l){d.toArray(m,0);for(var v=1,y=0;v!==l;++v)s[v].toArray(m,y+=c)}return m}function VM(s,l){var c=uf[l];void 0===c&&(c=new Int32Array(l),uf[l]=c);for(var d=0;d!==l;++d)c[d]=s.allocTextureUnit();return c}function zM(s,l){s.uniform1f(this.addr,l)}function dA(s,l){s.uniform1i(this.addr,l)}function Cl(s,l){void 0===l.x?s.uniform2fv(this.addr,l):s.uniform2f(this.addr,l.x,l.y)}function fA(s,l){void 0!==l.x?s.uniform3f(this.addr,l.x,l.y,l.z):void 0!==l.r?s.uniform3f(this.addr,l.r,l.g,l.b):s.uniform3fv(this.addr,l)}function pA(s,l){void 0===l.x?s.uniform4fv(this.addr,l):s.uniform4f(this.addr,l.x,l.y,l.z,l.w)}function mA(s,l){s.uniformMatrix2fv(this.addr,!1,l.elements||l)}function gA(s,l){s.uniformMatrix3fv(this.addr,!1,l.elements||l)}function HM(s,l){s.uniformMatrix4fv(this.addr,!1,l.elements||l)}function vA(s,l,c){var d=c.allocTextureUnit();s.uniform1i(this.addr,d),c.setTexture2D(l||Kn,d)}function GM(s,l,c){var d=c.allocTextureUnit();s.uniform1i(this.addr,d),c.setTextureCube(l||Py,d)}function WM(s,l){s.uniform2iv(this.addr,l)}function Bs(s,l){s.uniform3iv(this.addr,l)}function en(s,l){s.uniform4iv(this.addr,l)}function _A(s,l){s.uniform1fv(this.addr,l)}function xA(s,l){s.uniform1iv(this.addr,l)}function Zt(s,l){s.uniform2fv(this.addr,Dr(l,this.size,2))}function MA(s,l){s.uniform3fv(this.addr,Dr(l,this.size,3))}function _o(s,l){s.uniform4fv(this.addr,Dr(l,this.size,4))}function hf(s,l){s.uniformMatrix2fv(this.addr,!1,Dr(l,this.size,4))}function jM(s,l){s.uniformMatrix3fv(this.addr,!1,Dr(l,this.size,9))}function Ny(s,l){s.uniformMatrix4fv(this.addr,!1,Dr(l,this.size,16))}function $M(s,l,c){var d=l.length,p=VM(c,d);s.uniform1iv(this.addr,p);for(var m=0;m!==d;++m)c.setTexture2D(l[m]||Kn,p[m])}function df(s,l,c){var d=l.length,p=VM(c,d);s.uniform1iv(this.addr,p);for(var m=0;m!==d;++m)c.setTextureCube(l[m]||Py,p[m])}function lg(s,l,c){this.id=s,this.addr=c,this.setValue=function yA(s){switch(s){case 5126:return zM;case 35664:return Cl;case 35665:return fA;case 35666:return pA;case 35674:return mA;case 35675:return gA;case 35676:return HM;case 35678:return vA;case 35680:return GM;case 5124:case 35670:return dA;case 35667:case 35671:return WM;case 35668:case 35672:return Bs;case 35669:case 35673:return en}}(l.type)}function Oy(s,l,c){this.id=s,this.addr=c,this.size=l.size,this.setValue=function ff(s){switch(s){case 5126:return _A;case 35664:return Zt;case 35665:return MA;case 35666:return _o;case 35674:return hf;case 35675:return jM;case 35676:return Ny;case 35678:return $M;case 35680:return df;case 5124:case 35670:return xA;case 35667:case 35671:return WM;case 35668:case 35672:return Bs;case 35669:case 35673:return en}}(l.type)}function Fy(s){this.id=s,kM.call(this)}Fy.prototype.setValue=function(s,l){for(var c=this.seq,d=0,p=c.length;d!==p;++d){var m=c[d];m.setValue(s,l[m.id])}};var In=/([\w\d_]+)(\])?(\[|\.)?/g;function pf(s,l){s.seq.push(l),s.map[l.id]=l}function Uy(s,l,c){var d=s.name,p=d.length;for(In.lastIndex=0;;){var m=In.exec(d),y=m[1],w=m[3];if("]"===m[2]&&(y|=0),void 0===w||"["===w&&In.lastIndex+2===p){pf(c,void 0===w?new lg(y,s,l):new Oy(y,s,l));break}var A=c.map[y];void 0===A&&pf(c,A=new Fy(y)),c=A}}function ir(s,l,c){kM.call(this),this.renderer=c;for(var d=s.getProgramParameter(l,s.ACTIVE_UNIFORMS),p=0;p!==d;++p){var m=s.getActiveUniform(l,p);Uy(m,s.getUniformLocation(l,m.name),this)}}ir.prototype.setValue=function(s,l,c){var d=this.map[l];void 0!==d&&d.setValue(s,c,this.renderer)},ir.prototype.set=function(s,l,c){var d=this.map[c];void 0!==d&&d.setValue(s,l[c],this.renderer)},ir.prototype.setOptional=function(s,l,c){var d=l[c];void 0!==d&&this.setValue(s,c,d)},ir.upload=function(s,l,c,d){for(var p=0,m=l.length;p!==m;++p){var v=l[p],y=c[v.id];!1!==y.needsUpdate&&v.setValue(s,y.value,d)}},ir.seqWithValue=function(s,l){for(var c=[],d=0,p=s.length;d!==p;++d){var m=s[d];m.id in l&&c.push(m)}return c};var as={merge:function(s){for(var l={},c=0;c<s.length;c++){var d=this.clone(s[c]);for(var p in d)l[p]=d[p]}return l},clone:function(s){var l={};for(var c in s)for(var d in l[c]={},s[c]){var p=s[c][d];l[c][d]=p&&(p.isColor||p.isMatrix3||p.isMatrix4||p.isVector2||p.isVector3||p.isVector4||p.isTexture)?p.clone():Array.isArray(p)?p.slice():p}return l}},Wn={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif\n",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif\n",alphatest_fragment:"#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif\n",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif\n",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"\nvec3 transformed = vec3( position );\n",beginnormal_vertex:"\nvec3 objectNormal = vec3( normal );\n",bsdfs:"float punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t\tif( decayExponent > 0.0 ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\t\tfloat maxDistanceCutoffFactor = pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t\treturn distanceFalloff * maxDistanceCutoffFactor;\n#else\n\t\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n#endif\n\t\t}\n\t\treturn 1.0;\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNL = saturate( dot( geometry.normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 ltcTextureCoords( const in GeometricContext geometry, const in float roughness ) {\n\tconst float LUT_SIZE  = 64.0;\n\tconst float LUT_SCALE = (LUT_SIZE - 1.0)/LUT_SIZE;\n\tconst float LUT_BIAS  = 0.5/LUT_SIZE;\n\tvec3 N = geometry.normal;\n\tvec3 V = geometry.viewDir;\n\tvec3 P = geometry.position;\n\tfloat theta = acos( dot( N, V ) );\n\tvec2 uv = vec2(\n\t\tsqrt( saturate( roughness ) ),\n\t\tsaturate( theta / ( 0.5 * PI ) ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nvoid clipQuadToHorizon( inout vec3 L[5], out int n ) {\n\tint config = 0;\n\tif ( L[0].z > 0.0 ) config += 1;\n\tif ( L[1].z > 0.0 ) config += 2;\n\tif ( L[2].z > 0.0 ) config += 4;\n\tif ( L[3].z > 0.0 ) config += 8;\n\tn = 0;\n\tif ( config == 0 ) {\n\t} else if ( config == 1 ) {\n\t\tn = 3;\n\t\tL[1] = -L[1].z * L[0] + L[0].z * L[1];\n\t\tL[2] = -L[3].z * L[0] + L[0].z * L[3];\n\t} else if ( config == 2 ) {\n\t\tn = 3;\n\t\tL[0] = -L[0].z * L[1] + L[1].z * L[0];\n\t\tL[2] = -L[2].z * L[1] + L[1].z * L[2];\n\t} else if ( config == 3 ) {\n\t\tn = 4;\n\t\tL[2] = -L[2].z * L[1] + L[1].z * L[2];\n\t\tL[3] = -L[3].z * L[0] + L[0].z * L[3];\n\t} else if ( config == 4 ) {\n\t\tn = 3;\n\t\tL[0] = -L[3].z * L[2] + L[2].z * L[3];\n\t\tL[1] = -L[1].z * L[2] + L[2].z * L[1];\n\t} else if ( config == 5 ) {\n\t\tn = 0;\n\t} else if ( config == 6 ) {\n\t\tn = 4;\n\t\tL[0] = -L[0].z * L[1] + L[1].z * L[0];\n\t\tL[3] = -L[3].z * L[2] + L[2].z * L[3];\n\t} else if ( config == 7 ) {\n\t\tn = 5;\n\t\tL[4] = -L[3].z * L[0] + L[0].z * L[3];\n\t\tL[3] = -L[3].z * L[2] + L[2].z * L[3];\n\t} else if ( config == 8 ) {\n\t\tn = 3;\n\t\tL[0] = -L[0].z * L[3] + L[3].z * L[0];\n\t\tL[1] = -L[2].z * L[3] + L[3].z * L[2];\n\t\tL[2] =  L[3];\n\t} else if ( config == 9 ) {\n\t\tn = 4;\n\t\tL[1] = -L[1].z * L[0] + L[0].z * L[1];\n\t\tL[2] = -L[2].z * L[3] + L[3].z * L[2];\n\t} else if ( config == 10 ) {\n\t\tn = 0;\n\t} else if ( config == 11 ) {\n\t\tn = 5;\n\t\tL[4] = L[3];\n\t\tL[3] = -L[2].z * L[3] + L[3].z * L[2];\n\t\tL[2] = -L[2].z * L[1] + L[1].z * L[2];\n\t} else if ( config == 12 ) {\n\t\tn = 4;\n\t\tL[1] = -L[1].z * L[2] + L[2].z * L[1];\n\t\tL[0] = -L[0].z * L[3] + L[3].z * L[0];\n\t} else if ( config == 13 ) {\n\t\tn = 5;\n\t\tL[4] = L[3];\n\t\tL[3] = L[2];\n\t\tL[2] = -L[1].z * L[2] + L[2].z * L[1];\n\t\tL[1] = -L[1].z * L[0] + L[0].z * L[1];\n\t} else if ( config == 14 ) {\n\t\tn = 5;\n\t\tL[4] = -L[0].z * L[3] + L[3].z * L[0];\n\t\tL[0] = -L[0].z * L[1] + L[1].z * L[0];\n\t} else if ( config == 15 ) {\n\t\tn = 4;\n\t}\n\tif ( n == 3 )\n\t\tL[3] = L[0];\n\tif ( n == 4 )\n\t\tL[4] = L[0];\n}\nfloat integrateLtcBrdfOverRectEdge( vec3 v1, vec3 v2 ) {\n\tfloat cosTheta = dot( v1, v2 );\n\tfloat theta = acos( cosTheta );\n\tfloat res = cross( v1, v2 ).z * ( ( theta > 0.001 ) ? theta / sin( theta ) : 1.0 );\n\treturn res;\n}\nvoid initRectPoints( const in vec3 pos, const in vec3 halfWidth, const in vec3 halfHeight, out vec3 rectPoints[4] ) {\n\trectPoints[0] = pos - halfWidth - halfHeight;\n\trectPoints[1] = pos + halfWidth - halfHeight;\n\trectPoints[2] = pos + halfWidth + halfHeight;\n\trectPoints[3] = pos - halfWidth + halfHeight;\n}\nvec3 integrateLtcBrdfOverRect( const in GeometricContext geometry, const in mat3 brdfMat, const in vec3 rectPoints[4] ) {\n\tvec3 N = geometry.normal;\n\tvec3 V = geometry.viewDir;\n\tvec3 P = geometry.position;\n\tvec3 T1, T2;\n\tT1 = normalize(V - N * dot( V, N ));\n\tT2 = - cross( N, T1 );\n\tmat3 brdfWrtSurface = brdfMat * transpose( mat3( T1, T2, N ) );\n\tvec3 clippedRect[5];\n\tclippedRect[0] = brdfWrtSurface * ( rectPoints[0] - P );\n\tclippedRect[1] = brdfWrtSurface * ( rectPoints[1] - P );\n\tclippedRect[2] = brdfWrtSurface * ( rectPoints[2] - P );\n\tclippedRect[3] = brdfWrtSurface * ( rectPoints[3] - P );\n\tint n;\n\tclipQuadToHorizon(clippedRect, n);\n\tif ( n == 0 )\n\t\treturn vec3( 0, 0, 0 );\n\tclippedRect[0] = normalize( clippedRect[0] );\n\tclippedRect[1] = normalize( clippedRect[1] );\n\tclippedRect[2] = normalize( clippedRect[2] );\n\tclippedRect[3] = normalize( clippedRect[3] );\n\tclippedRect[4] = normalize( clippedRect[4] );\n\tfloat sum = 0.0;\n\tsum += integrateLtcBrdfOverRectEdge( clippedRect[0], clippedRect[1] );\n\tsum += integrateLtcBrdfOverRectEdge( clippedRect[1], clippedRect[2] );\n\tsum += integrateLtcBrdfOverRectEdge( clippedRect[2], clippedRect[3] );\n\tif (n >= 4)\n\t\tsum += integrateLtcBrdfOverRectEdge( clippedRect[3], clippedRect[4] );\n\tif (n == 5)\n\t\tsum += integrateLtcBrdfOverRectEdge( clippedRect[4], clippedRect[0] );\n\tsum = max( 0.0, sum );\n\tvec3 Lo_i = vec3( sum, sum, sum );\n\treturn Lo_i;\n}\nvec3 Rect_Area_Light_Specular_Reflectance(\n\t\tconst in GeometricContext geometry,\n\t\tconst in vec3 lightPos, const in vec3 lightHalfWidth, const in vec3 lightHalfHeight,\n\t\tconst in float roughness,\n\t\tconst in sampler2D ltcMat, const in sampler2D ltcMag ) {\n\tvec3 rectPoints[4];\n\tinitRectPoints( lightPos, lightHalfWidth, lightHalfHeight, rectPoints );\n\tvec2 uv = ltcTextureCoords( geometry, roughness );\n\tvec4 brdfLtcApproxParams, t;\n\tbrdfLtcApproxParams = texture2D( ltcMat, uv );\n\tt = texture2D( ltcMat, uv );\n\tfloat brdfLtcScalar = texture2D( ltcMag, uv ).a;\n\tmat3 brdfLtcApproxMat = mat3(\n\t\tvec3(   1,   0, t.y ),\n\t\tvec3(   0, t.z,   0 ),\n\t\tvec3( t.w,   0, t.x )\n\t);\n\tvec3 specularReflectance = integrateLtcBrdfOverRect( geometry, brdfLtcApproxMat, rectPoints );\n\tspecularReflectance *= brdfLtcScalar;\n\treturn specularReflectance;\n}\nvec3 Rect_Area_Light_Diffuse_Reflectance(\n\t\tconst in GeometricContext geometry,\n\t\tconst in vec3 lightPos, const in vec3 lightHalfWidth, const in vec3 lightHalfHeight ) {\n\tvec3 rectPoints[4];\n\tinitRectPoints( lightPos, lightHalfWidth, lightHalfHeight, rectPoints );\n\tmat3 diffuseBrdfMat = mat3(1);\n\tvec3 diffuseReflectance = integrateLtcBrdfOverRect( geometry, diffuseBrdfMat, rectPoints );\n\treturn diffuseReflectance;\n}\nvec3 BRDF_Specular_GGX_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 AB = vec2( -1.04, 1.04 ) * a004 + r.zw;\n\treturn specularColor * AB.x + AB.y;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = dFdx( surf_pos );\n\t\tvec3 vSigmaY = dFdy( surf_pos );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif\n",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; ++ i ) {\n\t\tvec4 plane = clippingPlanes[ i ];\n\t\tif ( dot( vViewPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t\t\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; ++ i ) {\n\t\t\tvec4 plane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vViewPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\tif ( clipped ) discard;\n\t\n\t#endif\n#endif\n",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\t#if ! defined( PHYSICAL ) && ! defined( PHONG )\n\t\tvarying vec3 vViewPosition;\n\t#endif\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif\n",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\n\tvarying vec3 vViewPosition;\n#endif\n",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n",color_fragment:"#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif\n",color_pars_vertex:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\n\tvColor.xyz = color.xyz;\n#endif",common:"#define PI 3.14159265359\n#define PI2 6.28318530718\n#define PI_HALF 1.5707963267949\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#define whiteCompliment(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transpose( const in mat3 v ) {\n\tmat3 tmp;\n\ttmp[0] = vec3(v[0].x, v[1].x, v[2].x);\n\ttmp[1] = vec3(v[0].y, v[1].y, v[2].y);\n\ttmp[2] = vec3(v[0].z, v[1].z, v[2].z);\n\treturn tmp;\n}\n",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n#define cubeUV_textureSize (1024.0)\nint getFaceFromDirection(vec3 direction) {\n\tvec3 absDirection = abs(direction);\n\tint face = -1;\n\tif( absDirection.x > absDirection.z ) {\n\t\tif(absDirection.x > absDirection.y )\n\t\t\tface = direction.x > 0.0 ? 0 : 3;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\telse {\n\t\tif(absDirection.z > absDirection.y )\n\t\t\tface = direction.z > 0.0 ? 2 : 5;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\treturn face;\n}\n#define cubeUV_maxLods1  (log2(cubeUV_textureSize*0.25) - 1.0)\n#define cubeUV_rangeClamp (exp2((6.0 - 1.0) * 2.0))\nvec2 MipLevelInfo( vec3 vec, float roughnessLevel, float roughness ) {\n\tfloat scale = exp2(cubeUV_maxLods1 - roughnessLevel);\n\tfloat dxRoughness = dFdx(roughness);\n\tfloat dyRoughness = dFdy(roughness);\n\tvec3 dx = dFdx( vec * scale * dxRoughness );\n\tvec3 dy = dFdy( vec * scale * dyRoughness );\n\tfloat d = max( dot( dx, dx ), dot( dy, dy ) );\n\td = clamp(d, 1.0, cubeUV_rangeClamp);\n\tfloat mipLevel = 0.5 * log2(d);\n\treturn vec2(floor(mipLevel), fract(mipLevel));\n}\n#define cubeUV_maxLods2 (log2(cubeUV_textureSize*0.25) - 2.0)\n#define cubeUV_rcpTextureSize (1.0 / cubeUV_textureSize)\nvec2 getCubeUV(vec3 direction, float roughnessLevel, float mipLevel) {\n\tmipLevel = roughnessLevel > cubeUV_maxLods2 - 3.0 ? 0.0 : mipLevel;\n\tfloat a = 16.0 * cubeUV_rcpTextureSize;\n\tvec2 exp2_packed = exp2( vec2( roughnessLevel, mipLevel ) );\n\tvec2 rcp_exp2_packed = vec2( 1.0 ) / exp2_packed;\n\tfloat powScale = exp2_packed.x * exp2_packed.y;\n\tfloat scale = rcp_exp2_packed.x * rcp_exp2_packed.y * 0.25;\n\tfloat mipOffset = 0.75*(1.0 - rcp_exp2_packed.y) * rcp_exp2_packed.x;\n\tbool bRes = mipLevel == 0.0;\n\tscale =  bRes && (scale < a) ? a : scale;\n\tvec3 r;\n\tvec2 offset;\n\tint face = getFaceFromDirection(direction);\n\tfloat rcpPowScale = 1.0 / powScale;\n\tif( face == 0) {\n\t\tr = vec3(direction.x, -direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ?  a : offset.y;\n\t}\n\telse if( face == 1) {\n\t\tr = vec3(direction.y, direction.x, direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ?  a : offset.y;\n\t}\n\telse if( face == 2) {\n\t\tr = vec3(direction.z, direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ?  a : offset.y;\n\t}\n\telse if( face == 3) {\n\t\tr = vec3(direction.x, direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ?  0.0 : offset.y;\n\t}\n\telse if( face == 4) {\n\t\tr = vec3(direction.y, direction.x, -direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ?  0.0 : offset.y;\n\t}\n\telse {\n\t\tr = vec3(direction.z, -direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ?  0.0 : offset.y;\n\t}\n\tr = normalize(r);\n\tfloat texelOffset = 0.5 * cubeUV_rcpTextureSize;\n\tvec2 s = ( r.yz / abs( r.x ) + vec2( 1.0 ) ) * 0.5;\n\tvec2 base = offset + vec2( texelOffset );\n\treturn base + s * ( scale - 2.0 * texelOffset );\n}\n#define cubeUV_maxLods3 (log2(cubeUV_textureSize*0.25) - 3.0)\nvec4 textureCubeUV(vec3 reflectedDirection, float roughness ) {\n\tfloat roughnessVal = roughness* cubeUV_maxLods3;\n\tfloat r1 = floor(roughnessVal);\n\tfloat r2 = r1 + 1.0;\n\tfloat t = fract(roughnessVal);\n\tvec2 mipInfo = MipLevelInfo(reflectedDirection, r1, roughness);\n\tfloat s = mipInfo.y;\n\tfloat level0 = mipInfo.x;\n\tfloat level1 = level0 + 1.0;\n\tlevel1 = level1 > 5.0 ? 5.0 : level1;\n\tlevel0 += min( floor( s + 0.5 ), 5.0 );\n\tvec2 uv_10 = getCubeUV(reflectedDirection, r1, level0);\n\tvec4 color10 = envMapTexelToLinear(texture2D(envMap, uv_10));\n\tvec2 uv_20 = getCubeUV(reflectedDirection, r2, level0);\n\tvec4 color20 = envMapTexelToLinear(texture2D(envMap, uv_20));\n\tvec4 result = mix(color10, color20, t);\n\treturn vec4(result.rgb, 1.0);\n}\n#endif\n",defaultnormal_vertex:"#ifdef FLIP_SIDED\n\tobjectNormal = -objectNormal;\n#endif\nvec3 transformedNormal = normalMatrix * objectNormal;\n",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif\n",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normal * ( texture2D( displacementMap, uv ).x * displacementScale + displacementBias );\n#endif\n",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif\n",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif\n",encodings_fragment:"  gl_FragColor = linearToOutputTexel( gl_FragColor );\n",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n  return value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n  return vec4( pow( value.xyz, vec3( gammaFactor ) ), value.w );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n  return vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n  return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n  return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n  return vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n  float maxComponent = max( max( value.r, value.g ), value.b );\n  float fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n  return vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n  return vec4( value.xyz * value.w * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n  float maxRGB = max( value.x, max( value.g, value.b ) );\n  float M      = clamp( maxRGB / maxRange, 0.0, 1.0 );\n  M            = ceil( M * 255.0 ) / 255.0;\n  return vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n    return vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n    float maxRGB = max( value.x, max( value.g, value.b ) );\n    float D      = max( maxRange / maxRGB, 1.0 );\n    D            = min( floor( D ) / 255.0, 1.0 );\n    return vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )  {\n  vec3 Xp_Y_XYZp = value.rgb * cLogLuvM;\n  Xp_Y_XYZp = max(Xp_Y_XYZp, vec3(1e-6, 1e-6, 1e-6));\n  vec4 vResult;\n  vResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n  float Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n  vResult.w = fract(Le);\n  vResult.z = (Le - (floor(vResult.w*255.0))/255.0)/255.0;\n  return vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n  float Le = value.z * 255.0 + value.w;\n  vec3 Xp_Y_XYZp;\n  Xp_Y_XYZp.y = exp2((Le - 127.0) / 2.0);\n  Xp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n  Xp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n  vec3 vRGB = Xp_Y_XYZp.rgb * cLogLuvInverseM;\n  return vec4( max(vRGB, 0.0), 1.0 );\n}\n",envmap_fragment:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\tvec2 sampleUV;\n\t\tsampleUV.y = saturate( flipNormal * reflectVec.y * 0.5 + 0.5 );\n\t\tsampleUV.x = atan( flipNormal * reflectVec.z, flipNormal * reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\tvec3 reflectView = flipNormal * normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\tenvColor = envMapTexelToLinear( envColor );\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif\n",envmap_pars_fragment:"#if defined( USE_ENVMAP ) || defined( PHYSICAL )\n\tuniform float reflectivity;\n\tuniform float envMapIntensity;\n#endif\n#ifdef USE_ENVMAP\n\t#if ! defined( PHYSICAL ) && ( defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) )\n\t\tvarying vec3 vWorldPosition;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\tuniform float flipEnvMap;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( PHYSICAL )\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif\n",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif\n",envmap_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif\n",fog_fragment:"#ifdef USE_FOG\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tfloat depth = gl_FragDepthEXT / gl_FragCoord.w;\n\t#else\n\t\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n\t#endif\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * depth * depth * LOG2 ) );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, depth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif\n",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef TOON\n\tuniform sampler2D gradientMap;\n\tvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\t\tfloat dotNL = dot( normal, lightDirection );\n\t\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t\t#ifdef USE_GRADIENTMAP\n\t\t\treturn texture2D( gradientMap, coord ).rgb;\n\t\t#else\n\t\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t\t#endif\n\t}\n#endif\n",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\treflectedLight.indirectDiffuse += PI * texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n#endif\n",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\n#if NUM_POINT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t}\n#endif\n#if NUM_DIR_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvLightFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n#endif\n",lights_pars:"uniform vec3 ambientLightColor;\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltcMat;\tuniform sampler2D ltcMag;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif\n#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( queryVec, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar - 0.79248 - 0.5 * log2( pow2( blinnShininessExponent ) + 1.0 );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in GeometricContext geometry, const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( -geometry.viewDir, geometry.normal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( -geometry.viewDir, geometry.normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( blinnShininessExponent, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\tvec4 envMapColor = textureCubeUV(queryReflectVec, BlinnExponentToGGXRoughness(blinnShininessExponent));\n\t\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\t\tvec2 sampleUV;\n\t\t\tsampleUV.y = saturate( reflectVec.y * 0.5 + 0.5 );\n\t\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif\n",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;\n",lights_phong_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\n#if NUM_RECT_AREA_LIGHTS > 0\n    void RE_Direct_RectArea_BlinnPhong( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n        vec3 matDiffColor = material.diffuseColor;\n        vec3 matSpecColor = material.specularColor;\n        vec3 lightColor   = rectAreaLight.color;\n        float roughness = BlinnExponentToGGXRoughness( material.specularShininess );\n        vec3 spec = Rect_Area_Light_Specular_Reflectance(\n                geometry,\n                rectAreaLight.position, rectAreaLight.halfWidth, rectAreaLight.halfHeight,\n                roughness,\n                ltcMat, ltcMag );\n        vec3 diff = Rect_Area_Light_Diffuse_Reflectance(\n                geometry,\n                rectAreaLight.position, rectAreaLight.halfWidth, rectAreaLight.halfHeight );\n        reflectedLight.directSpecular += lightColor * matSpecColor * spec / PI2;\n        reflectedLight.directDiffuse  += lightColor * matDiffColor * diff / PI2;\n    }\n#endif\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifdef TOON\n\t\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#else\n\t\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\t\tvec3 irradiance = dotNL * directLight.color;\n\t#endif\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)\n",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nmaterial.specularRoughness = clamp( roughnessFactor, 0.04, 1.0 );\n#ifdef STANDARD\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.clearCoat = saturate( clearCoat );\tmaterial.clearCoatRoughness = clamp( clearCoatRoughness, 0.04, 1.0 );\n#endif\n",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3\tdiffuseColor;\n\tfloat\tspecularRoughness;\n\tvec3\tspecularColor;\n\t#ifndef STANDARD\n\t\tfloat clearCoat;\n\t\tfloat clearCoatRoughness;\n\t#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearCoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n    void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n        vec3 matDiffColor = material.diffuseColor;\n        vec3 matSpecColor = material.specularColor;\n        vec3 lightColor   = rectAreaLight.color;\n        float roughness = material.specularRoughness;\n        vec3 spec = Rect_Area_Light_Specular_Reflectance(\n                geometry,\n                rectAreaLight.position, rectAreaLight.halfWidth, rectAreaLight.halfHeight,\n                roughness,\n                ltcMat, ltcMag );\n        vec3 diff = Rect_Area_Light_Diffuse_Reflectance(\n                geometry,\n                rectAreaLight.position, rectAreaLight.halfWidth, rectAreaLight.halfHeight );\n        reflectedLight.directSpecular += lightColor * matSpecColor * spec;\n        reflectedLight.directDiffuse  += lightColor * matDiffColor * diff;\n    }\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifndef STANDARD\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.directSpecular += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry, material.specularColor, material.specularRoughness );\n\treflectedLight.directDiffuse += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\t#ifndef STANDARD\n\t\treflectedLight.directSpecular += irradiance * material.clearCoat * BRDF_Specular_GGX( directLight, geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 clearCoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifndef STANDARD\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\tfloat dotNL = dotNV;\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.indirectSpecular += ( 1.0 - clearCoatDHR ) * radiance * BRDF_Specular_GGX_Environment( geometry, material.specularColor, material.specularRoughness );\n\t#ifndef STANDARD\n\t\treflectedLight.indirectSpecular += clearCoatRadiance * material.clearCoat * BRDF_Specular_GGX_Environment( geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\n#define Material_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.specularRoughness )\n#define Material_ClearCoat_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.clearCoatRoughness )\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}\n",lights_template:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = normalize( vViewPosition );\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( pointLight.shadow, directLight.visible ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( spotLight.shadow, directLight.visible ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( directionalLight.shadow, directLight.visible ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#ifdef USE_LIGHTMAP\n\t\tvec3 lightMapIrradiance = texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t \tirradiance += getLightProbeIndirectIrradiance( geometry, 8 );\n\t#endif\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tvec3 radiance = getLightProbeIndirectRadiance( geometry, Material_BlinnShininessExponent( material ), 8 );\n\t#ifndef STANDARD\n\t\tvec3 clearCoatRadiance = getLightProbeIndirectRadiance( geometry, Material_ClearCoat_BlinnShininessExponent( material ), 8 );\n\t#else\n\t\tvec3 clearCoatRadiance = vec3( 0.0 );\n\t#endif\n\t\t\n\tRE_IndirectSpecular( radiance, clearCoatRadiance, geometry, material, reflectedLight );\n#endif\n",logdepthbuf_fragment:"#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\n\tgl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#ifdef USE_LOGDEPTHBUF\n\tuniform float logDepthBufFC;\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#endif\n#endif\n",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#endif\n\tuniform float logDepthBufFC;\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\tgl_Position.z = log2(max( EPSILON, gl_Position.w + 1.0 )) * logDepthBufFC;\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t#else\n\t\tgl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\n\t#endif\n#endif\n",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif\n",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n",map_particle_fragment:"#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) * offsetRepeat.zw + offsetRepeat.xy );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n",map_particle_pars_fragment:"#ifdef USE_MAP\n\tuniform vec4 offsetRepeat;\n\tuniform sampler2D map;\n#endif\n",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.r;\n#endif\n",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n\tobjectNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n\tobjectNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n\tobjectNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n#endif\n",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\t#ifndef USE_MORPHNORMALS\n\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n\ttransformed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n\ttransformed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n\ttransformed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\ttransformed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n\ttransformed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n\ttransformed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n\ttransformed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\t#endif\n#endif\n",normal_flip:"#ifdef DOUBLE_SIDED\n\tfloat flipNormal = ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n#else\n\tfloat flipNormal = 1.0;\n#endif\n",normal_fragment:"#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal ) * flipNormal;\n#endif\n#ifdef USE_NORMALMAP\n\tnormal = perturbNormal2Arb( -vViewPosition, normal );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif\n",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 S = normalize( q0 * st1.t - q1 * st0.t );\n\t\tvec3 T = normalize( -q0 * st1.s + q1 * st0.s );\n\t\tvec3 N = normalize( surf_norm );\n\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\tmapN.xy = normalScale * mapN.xy;\n\t\tmat3 tsn = mat3( S, T, N );\n\t\treturn normalize( tsn * mapN );\n\t}\n#endif\n",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n  return normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n  return 1.0 - 2.0 * rgb.xyz;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n  return ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n  return linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n  return (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n  return ( near * far ) / ( ( far - near ) * invClipZ - far );\n}\n",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif\n",project_vertex:"#ifdef USE_SKINNING\n\tvec4 mvPosition = modelViewMatrix * skinned;\n#else\n\tvec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\n#endif\ngl_Position = projectionMatrix * mvPosition;\n",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.r;\n#endif\n",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n    #if NUM_RECT_AREA_LIGHTS > 0\n    #endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tfloat texture2DShadowLerp( sampler2D depths, vec2 size, vec2 uv, float compare ) {\n\t\tconst vec2 offset = vec2( 0.0, 1.0 );\n\t\tvec2 texelSize = vec2( 1.0 ) / size;\n\t\tvec2 centroidUV = floor( uv * size + 0.5 ) / size;\n\t\tfloat lb = texture2DCompare( depths, centroidUV + texelSize * offset.xx, compare );\n\t\tfloat lt = texture2DCompare( depths, centroidUV + texelSize * offset.xy, compare );\n\t\tfloat rb = texture2DCompare( depths, centroidUV + texelSize * offset.yx, compare );\n\t\tfloat rt = texture2DCompare( depths, centroidUV + texelSize * offset.yy, compare );\n\t\tvec2 f = fract( uv * size + 0.5 );\n\t\tfloat a = mix( lb, lt, f.y );\n\t\tfloat b = mix( rb, rt, f.y );\n\t\tfloat c = mix( a, b, f.x );\n\t\treturn c;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\treturn (\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn 1.0;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\tfloat dp = ( length( lightToPosition ) - shadowBias ) / 1000.0;\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif\n",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n    #if NUM_RECT_AREA_LIGHTS > 0\n    #endif\n#endif\n",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n    #if NUM_RECT_AREA_LIGHTS > 0\n    #endif\n#endif\n",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\tDirectionalLight directionalLight;\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tshadow *= bool( directionalLight.shadow ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\tSpotLight spotLight;\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tshadow *= bool( spotLight.shadow ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\tPointLight pointLight;\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tshadow *= bool( pointLight.shadow ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_RECT_AREA_LIGHTS > 0\n\t#endif\n\t#endif\n\treturn shadow;\n}\n",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform sampler2D boneTexture;\n\t\tuniform int boneTextureWidth;\n\t\tuniform int boneTextureHeight;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureWidth ) );\n\t\t\tfloat y = floor( j / float( boneTextureWidth ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureWidth );\n\t\t\tfloat dy = 1.0 / float( boneTextureHeight );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif\n",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\tskinned  = bindMatrixInverse * skinned;\n#endif\n",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n#endif\n",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n  gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif\n",tonemapping_pars_fragment:"#define saturate(a) clamp( a, 0.0, 1.0 )\nuniform float toneMappingExposure;\nuniform float toneMappingWhitePoint;\nvec3 LinearToneMapping( vec3 color ) {\n  return toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n  color *= toneMappingExposure;\n  return saturate( color / ( vec3( 1.0 ) + color ) );\n}\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\nvec3 Uncharted2ToneMapping( vec3 color ) {\n  color *= toneMappingExposure;\n  return saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n  color *= toneMappingExposure;\n  color = max( vec3( 0.0 ), color - 0.004 );\n  return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\n",uv_pars_fragment:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n\tuniform vec4 offsetRepeat;\n#endif\n",uv_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = uv2;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( PHYSICAL ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )\n\t#ifdef USE_SKINNING\n\t\tvec4 worldPosition = modelMatrix * skinned;\n\t#else\n\t\tvec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\n\t#endif\n#endif\n",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tgl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );\n\tgl_FragColor.a *= opacity;\n}\n",cube_vert:"varying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}\n",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( gl_FragCoord.z ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( gl_FragCoord.z );\n\t#endif\n}\n",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#include <begin_vertex>\n\t#include <displacementmap_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}\n",distanceRGBA_frag:"uniform vec3 lightPos;\nvarying vec4 vWorldPosition;\n#include <common>\n#include <packing>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tgl_FragColor = packDepthToRGBA( length( vWorldPosition.xyz - lightPos.xyz ) / 1000.0 );\n}\n",distanceRGBA_vert:"varying vec4 vWorldPosition;\n#include <common>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <skinbase_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition;\n}\n",equirect_frag:"uniform sampler2D tEquirect;\nuniform float tFlip;\nvarying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldPosition );\n\tvec2 sampleUV;\n\tsampleUV.y = saturate( tFlip * direction.y * -0.5 + 0.5 );\n\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n}\n",equirect_vert:"varying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}\n",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\tvLineDistance = scale * lineDistance;\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}\n",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\treflectedLight.indirectDiffuse += texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <normal_flip>\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n}\n",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <packing>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <bsdfs>\n#include <lights_pars>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\treflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <normal_flip>\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars>\n#include <color_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n}\n",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_flip>\n\t#include <normal_fragment>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_template>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <displacementmap_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n}\n",meshphysical_frag:"#define PHYSICAL\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifndef STANDARD\n\tuniform float clearCoat;\n\tuniform float clearCoatRoughness;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <packing>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <lights_pars>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_flip>\n\t#include <normal_fragment>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_template>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",meshphysical_vert:"#define PHYSICAL\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <displacementmap_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n}\n",normal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED  ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\t#include <normal_flip>\n\t#include <normal_fragment>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n\t#include <premultiplied_alpha_fragment>\n\t#include <encodings_fragment>\n}\n",normal_vert:"#define NORMAL\n#if defined( FLAT_SHADED  ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <displacementmap_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n#if defined( FLAT_SHADED  ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}\n",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#ifdef USE_SIZEATTENUATION\n\t\tgl_PointSize = size * ( scale / - mvPosition.z );\n\t#else\n\t\tgl_PointSize = size;\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n}\n",shadow_frag:"uniform float opacity;\n#include <common>\n#include <packing>\n#include <bsdfs>\n#include <lights_pars>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( 0.0, 0.0, 0.0, opacity * ( 1.0  - getShadowMask() ) );\n}\n",shadow_vert:"#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n}\n"};function Tt(s,l,c){return void 0===l&&void 0===c?this.set(s):this.setRGB(s,l,c)}Tt.prototype={constructor:Tt,isColor:!0,r:1,g:1,b:1,set:function(s){return s&&s.isColor?this.copy(s):"number"==typeof s?this.setHex(s):"string"==typeof s&&this.setStyle(s),this},setScalar:function(s){return this.r=s,this.g=s,this.b=s,this},setHex:function(s){return s=Math.floor(s),this.r=(s>>16&255)/255,this.g=(s>>8&255)/255,this.b=(255&s)/255,this},setRGB:function(s,l,c){return this.r=s,this.g=l,this.b=c,this},setHSL:function(){function s(l,c,d){return d<0&&(d+=1),d>1&&(d-=1),d<1/6?l+6*(c-l)*d:d<.5?c:d<2/3?l+6*(c-l)*(2/3-d):l}return function(c,d,p){if(c=dn.euclideanModulo(c,1),d=dn.clamp(d,0,1),p=dn.clamp(p,0,1),0===d)this.r=this.g=this.b=p;else{var m=p<=.5?p*(1+d):p+d-p*d,v=2*p-m;this.r=s(v,m,c+1/3),this.g=s(v,m,c),this.b=s(v,m,c-1/3)}return this}}(),setStyle:function(s){function l(A){void 0!==A&&parseFloat(A)<1&&console.warn("THREE.Color: Alpha component of "+s+" will be ignored.")}var c;if(c=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(s)){var d,m=c[2];switch(c[1]){case"rgb":case"rgba":if(d=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(m))return this.r=Math.min(255,parseInt(d[1],10))/255,this.g=Math.min(255,parseInt(d[2],10))/255,this.b=Math.min(255,parseInt(d[3],10))/255,l(d[5]),this;if(d=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(m))return this.r=Math.min(100,parseInt(d[1],10))/100,this.g=Math.min(100,parseInt(d[2],10))/100,this.b=Math.min(100,parseInt(d[3],10))/100,l(d[5]),this;break;case"hsl":case"hsla":if(d=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(m)){var v=parseFloat(d[1])/360,y=parseInt(d[2],10)/100,b=parseInt(d[3],10)/100;return l(d[5]),this.setHSL(v,y,b)}}}else if(c=/^\#([A-Fa-f0-9]+)$/.exec(s)){var w,T=(w=c[1]).length;if(3===T)return this.r=parseInt(w.charAt(0)+w.charAt(0),16)/255,this.g=parseInt(w.charAt(1)+w.charAt(1),16)/255,this.b=parseInt(w.charAt(2)+w.charAt(2),16)/255,this;if(6===T)return this.r=parseInt(w.charAt(0)+w.charAt(1),16)/255,this.g=parseInt(w.charAt(2)+w.charAt(3),16)/255,this.b=parseInt(w.charAt(4)+w.charAt(5),16)/255,this}return s&&s.length>0&&(void 0!==(w=Mh[s])?this.setHex(w):console.warn("THREE.Color: Unknown color "+s)),this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(s){return this.r=s.r,this.g=s.g,this.b=s.b,this},copyGammaToLinear:function(s,l){return void 0===l&&(l=2),this.r=Math.pow(s.r,l),this.g=Math.pow(s.g,l),this.b=Math.pow(s.b,l),this},copyLinearToGamma:function(s,l){void 0===l&&(l=2);var c=l>0?1/l:1;return this.r=Math.pow(s.r,c),this.g=Math.pow(s.g,c),this.b=Math.pow(s.b,c),this},convertGammaToLinear:function(){var s=this.r,l=this.g,c=this.b;return this.r=s*s,this.g=l*l,this.b=c*c,this},convertLinearToGamma:function(){return this.r=Math.sqrt(this.r),this.g=Math.sqrt(this.g),this.b=Math.sqrt(this.b),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(s){var y,b,l=s||{h:0,s:0,l:0},c=this.r,d=this.g,p=this.b,m=Math.max(c,d,p),v=Math.min(c,d,p),w=(v+m)/2;if(v===m)y=0,b=0;else{var T=m-v;switch(b=w<=.5?T/(m+v):T/(2-m-v),m){case c:y=(d-p)/T+(d<p?6:0);break;case d:y=(p-c)/T+2;break;case p:y=(c-d)/T+4}y/=6}return l.h=y,l.s=b,l.l=w,l},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(s,l,c){var d=this.getHSL();return d.h+=s,d.s+=l,d.l+=c,this.setHSL(d.h,d.s,d.l),this},add:function(s){return this.r+=s.r,this.g+=s.g,this.b+=s.b,this},addColors:function(s,l){return this.r=s.r+l.r,this.g=s.g+l.g,this.b=s.b+l.b,this},addScalar:function(s){return this.r+=s,this.g+=s,this.b+=s,this},sub:function(s){return this.r=Math.max(0,this.r-s.r),this.g=Math.max(0,this.g-s.g),this.b=Math.max(0,this.b-s.b),this},multiply:function(s){return this.r*=s.r,this.g*=s.g,this.b*=s.b,this},multiplyScalar:function(s){return this.r*=s,this.g*=s,this.b*=s,this},lerp:function(s,l){return this.r+=(s.r-this.r)*l,this.g+=(s.g-this.g)*l,this.b+=(s.b-this.b)*l,this},equals:function(s){return s.r===this.r&&s.g===this.g&&s.b===this.b},fromArray:function(s,l){return void 0===l&&(l=0),this.r=s[l],this.g=s[l+1],this.b=s[l+2],this},toArray:function(s,l){return void 0===s&&(s=[]),void 0===l&&(l=0),s[l]=this.r,s[l+1]=this.g,s[l+2]=this.b,s},toJSON:function(){return this.getHex()}};var Mh={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function Za(s,l,c,d,p,m,v,y,b,w,T,A){mt.call(this,null,m,v,y,b,w,d,p,T,A),this.image={data:s,width:l,height:c},this.magFilter=void 0!==b?b:Us,this.minFilter=void 0!==w?w:Us,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}(Za.prototype=Object.create(mt.prototype)).constructor=Za,Za.prototype.isDataTexture=!0;var Qt={common:{diffuse:{value:new Tt(15658734)},opacity:{value:1},map:{value:null},offsetRepeat:{value:new ri(0,0,1,1)},specularMap:{value:null},alphaMap:{value:null},envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new ut(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Tt(16777215)}},lights:{ambientLightColor:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}}},points:{diffuse:{value:new Tt(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},offsetRepeat:{value:new ri(0,0,1,1)}}},Ss={basic:{uniforms:as.merge([Qt.common,Qt.aomap,Qt.lightmap,Qt.fog]),vertexShader:Wn.meshbasic_vert,fragmentShader:Wn.meshbasic_frag},lambert:{uniforms:as.merge([Qt.common,Qt.aomap,Qt.lightmap,Qt.emissivemap,Qt.fog,Qt.lights,{emissive:{value:new Tt(0)}}]),vertexShader:Wn.meshlambert_vert,fragmentShader:Wn.meshlambert_frag},phong:{uniforms:as.merge([Qt.common,Qt.aomap,Qt.lightmap,Qt.emissivemap,Qt.bumpmap,Qt.normalmap,Qt.displacementmap,Qt.gradientmap,Qt.fog,Qt.lights,{emissive:{value:new Tt(0)},specular:{value:new Tt(1118481)},shininess:{value:30}}]),vertexShader:Wn.meshphong_vert,fragmentShader:Wn.meshphong_frag},standard:{uniforms:as.merge([Qt.common,Qt.aomap,Qt.lightmap,Qt.emissivemap,Qt.bumpmap,Qt.normalmap,Qt.displacementmap,Qt.roughnessmap,Qt.metalnessmap,Qt.fog,Qt.lights,{emissive:{value:new Tt(0)},roughness:{value:.5},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Wn.meshphysical_vert,fragmentShader:Wn.meshphysical_frag},points:{uniforms:as.merge([Qt.points,Qt.fog]),vertexShader:Wn.points_vert,fragmentShader:Wn.points_frag},dashed:{uniforms:as.merge([Qt.common,Qt.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Wn.linedashed_vert,fragmentShader:Wn.linedashed_frag},depth:{uniforms:as.merge([Qt.common,Qt.displacementmap]),vertexShader:Wn.depth_vert,fragmentShader:Wn.depth_frag},normal:{uniforms:as.merge([Qt.common,Qt.bumpmap,Qt.normalmap,Qt.displacementmap,{opacity:{value:1}}]),vertexShader:Wn.normal_vert,fragmentShader:Wn.normal_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Wn.cube_vert,fragmentShader:Wn.cube_frag},equirect:{uniforms:{tEquirect:{value:null},tFlip:{value:-1}},vertexShader:Wn.equirect_vert,fragmentShader:Wn.equirect_frag},distanceRGBA:{uniforms:{lightPos:{value:new z}},vertexShader:Wn.distanceRGBA_vert,fragmentShader:Wn.distanceRGBA_frag}};function pa(s,l){this.min=void 0!==s?s:new ut(1/0,1/0),this.max=void 0!==l?l:new ut(-1/0,-1/0)}function wh(s,l){var p,m,v,y,b,w,T,A,c=s.context,d=s.state;this.render=function(L,B,U){if(0!==l.length){var F=new z,V=U.w/U.z,H=.5*U.z,J=.5*U.w,q=16/U.w,ae=new ut(q*V,q),se=new z(1,1,0),le=new ut(1,1),ue=new pa;ue.min.set(U.x,U.y),ue.max.set(U.x+(U.z-16),U.y+(U.w-16)),void 0===y&&function R(){var L=new Float32Array([-1,-1,0,0,1,-1,1,0,1,1,1,1,-1,1,0,1]),B=new Uint16Array([0,1,2,0,2,3]);p=c.createBuffer(),m=c.createBuffer(),c.bindBuffer(c.ARRAY_BUFFER,p),c.bufferData(c.ARRAY_BUFFER,L,c.STATIC_DRAW),c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,m),c.bufferData(c.ELEMENT_ARRAY_BUFFER,B,c.STATIC_DRAW),T=c.createTexture(),A=c.createTexture(),d.bindTexture(c.TEXTURE_2D,T),c.texImage2D(c.TEXTURE_2D,0,c.RGB,16,16,0,c.RGB,c.UNSIGNED_BYTE,null),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.NEAREST),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.NEAREST),d.bindTexture(c.TEXTURE_2D,A),c.texImage2D(c.TEXTURE_2D,0,c.RGBA,16,16,0,c.RGBA,c.UNSIGNED_BYTE,null),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.NEAREST),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.NEAREST),v={vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","uniform sampler2D occlusionMap;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","varying float vVisibility;","void main() {","vUV = uv;","vec2 pos = position;","if ( renderType == 2 ) {","vec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );","vVisibility =        visibility.r / 9.0;","vVisibility *= 1.0 - visibility.g / 9.0;","vVisibility *=       visibility.b / 9.0;","vVisibility *= 1.0 - visibility.a / 9.0;","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["uniform lowp int renderType;","uniform sampler2D map;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","varying float vVisibility;","void main() {","if ( renderType == 0 ) {","gl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );","} else if ( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * vVisibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")},y=function P(L){var B=c.createProgram(),U=c.createShader(c.FRAGMENT_SHADER),F=c.createShader(c.VERTEX_SHADER),V="precision "+s.getPrecision()+" float;\n";return c.shaderSource(U,V+L.fragmentShader),c.shaderSource(F,V+L.vertexShader),c.compileShader(U),c.compileShader(F),c.attachShader(B,U),c.attachShader(B,F),c.linkProgram(B),B}(v),b={vertex:c.getAttribLocation(y,"position"),uv:c.getAttribLocation(y,"uv")},w={renderType:c.getUniformLocation(y,"renderType"),map:c.getUniformLocation(y,"map"),occlusionMap:c.getUniformLocation(y,"occlusionMap"),opacity:c.getUniformLocation(y,"opacity"),color:c.getUniformLocation(y,"color"),scale:c.getUniformLocation(y,"scale"),rotation:c.getUniformLocation(y,"rotation"),screenPosition:c.getUniformLocation(y,"screenPosition")}}(),c.useProgram(y),d.initAttributes(),d.enableAttribute(b.vertex),d.enableAttribute(b.uv),d.disableUnusedAttributes(),c.uniform1i(w.occlusionMap,0),c.uniform1i(w.map,1),c.bindBuffer(c.ARRAY_BUFFER,p),c.vertexAttribPointer(b.vertex,2,c.FLOAT,!1,16,0),c.vertexAttribPointer(b.uv,2,c.FLOAT,!1,16,8),c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,m),d.disable(c.CULL_FACE),d.setDepthWrite(!1);for(var me=0,Fe=l.length;me<Fe;me++){ae.set((q=16/U.w)*V,q);var Ie=l[me];if(F.set(Ie.matrixWorld.elements[12],Ie.matrixWorld.elements[13],Ie.matrixWorld.elements[14]),F.applyMatrix4(B.matrixWorldInverse),F.applyProjection(B.projectionMatrix),se.copy(F),le.x=U.x+se.x*H+H-8,le.y=U.y+se.y*J+J-8,!0===ue.containsPoint(le)){d.activeTexture(c.TEXTURE0),d.bindTexture(c.TEXTURE_2D,null),d.activeTexture(c.TEXTURE1),d.bindTexture(c.TEXTURE_2D,T),c.copyTexImage2D(c.TEXTURE_2D,0,c.RGB,le.x,le.y,16,16,0),c.uniform1i(w.renderType,0),c.uniform2f(w.scale,ae.x,ae.y),c.uniform3f(w.screenPosition,se.x,se.y,se.z),d.disable(c.BLEND),d.enable(c.DEPTH_TEST),c.drawElements(c.TRIANGLES,6,c.UNSIGNED_SHORT,0),d.activeTexture(c.TEXTURE0),d.bindTexture(c.TEXTURE_2D,A),c.copyTexImage2D(c.TEXTURE_2D,0,c.RGBA,le.x,le.y,16,16,0),c.uniform1i(w.renderType,1),d.disable(c.DEPTH_TEST),d.activeTexture(c.TEXTURE1),d.bindTexture(c.TEXTURE_2D,T),c.drawElements(c.TRIANGLES,6,c.UNSIGNED_SHORT,0),Ie.positionScreen.copy(se),Ie.customUpdateCallback?Ie.customUpdateCallback(Ie):Ie.updateLensFlares(),c.uniform1i(w.renderType,2),d.enable(c.BLEND);for(var Z=0,ee=Ie.lensFlares.length;Z<ee;Z++){var ve=Ie.lensFlares[Z];ve.opacity>.001&&ve.scale>.001&&(se.x=ve.x,se.y=ve.y,se.z=ve.z,ae.x=(q=ve.size*ve.scale/U.w)*V,ae.y=q,c.uniform3f(w.screenPosition,se.x,se.y,se.z),c.uniform2f(w.scale,ae.x,ae.y),c.uniform1f(w.rotation,ve.rotation),c.uniform1f(w.opacity,ve.opacity),c.uniform3f(w.color,ve.color.r,ve.color.g,ve.color.b),d.setBlending(ve.blending,ve.blendEquation,ve.blendSrc,ve.blendDst),s.setTexture2D(ve.texture,1),c.drawElements(c.TRIANGLES,6,c.UNSIGNED_SHORT,0))}}}d.enable(c.CULL_FACE),d.enable(c.DEPTH_TEST),d.setDepthWrite(!0),s.resetGLState()}}}function Un(s,l){var p,m,v,y,b,w,c=s.context,d=s.state,T=new z,A=new fr,R=new z;function B(U,F){return U.renderOrder!==F.renderOrder?U.renderOrder-F.renderOrder:U.z!==F.z?F.z-U.z:F.id-U.id}this.render=function(U,F){if(0!==l.length){void 0===v&&function P(){var U=new Float32Array([-.5,-.5,0,0,.5,-.5,1,0,.5,.5,1,1,-.5,.5,0,1]),F=new Uint16Array([0,1,2,0,2,3]);p=c.createBuffer(),m=c.createBuffer(),c.bindBuffer(c.ARRAY_BUFFER,p),c.bufferData(c.ARRAY_BUFFER,U,c.STATIC_DRAW),c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,m),c.bufferData(c.ELEMENT_ARRAY_BUFFER,F,c.STATIC_DRAW),v=function L(){var U=c.createProgram(),F=c.createShader(c.VERTEX_SHADER),V=c.createShader(c.FRAGMENT_SHADER);return c.shaderSource(F,["precision "+s.getPrecision()+" float;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float rotation;","uniform vec2 scale;","uniform vec2 uvOffset;","uniform vec2 uvScale;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uvOffset + uv * uvScale;","vec2 alignedPosition = position * scale;","vec2 rotatedPosition;","rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;","rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;","vec4 finalPosition;","finalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );","finalPosition.xy += rotatedPosition;","finalPosition = projectionMatrix * finalPosition;","gl_Position = finalPosition;","}"].join("\n")),c.shaderSource(V,["precision "+s.getPrecision()+" float;","uniform vec3 color;","uniform sampler2D map;","uniform float opacity;","uniform int fogType;","uniform vec3 fogColor;","uniform float fogDensity;","uniform float fogNear;","uniform float fogFar;","uniform float alphaTest;","varying vec2 vUV;","void main() {","vec4 texture = texture2D( map, vUV );","if ( texture.a < alphaTest ) discard;","gl_FragColor = vec4( color * texture.xyz, texture.a * opacity );","if ( fogType > 0 ) {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float fogFactor = 0.0;","if ( fogType == 1 ) {","fogFactor = smoothstep( fogNear, fogFar, depth );","} else {","const float LOG2 = 1.442695;","fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );","fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","}","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}","}"].join("\n")),c.compileShader(F),c.compileShader(V),c.attachShader(U,F),c.attachShader(U,V),c.linkProgram(U),U}(),y={position:c.getAttribLocation(v,"position"),uv:c.getAttribLocation(v,"uv")},b={uvOffset:c.getUniformLocation(v,"uvOffset"),uvScale:c.getUniformLocation(v,"uvScale"),rotation:c.getUniformLocation(v,"rotation"),scale:c.getUniformLocation(v,"scale"),color:c.getUniformLocation(v,"color"),map:c.getUniformLocation(v,"map"),opacity:c.getUniformLocation(v,"opacity"),modelViewMatrix:c.getUniformLocation(v,"modelViewMatrix"),projectionMatrix:c.getUniformLocation(v,"projectionMatrix"),fogType:c.getUniformLocation(v,"fogType"),fogDensity:c.getUniformLocation(v,"fogDensity"),fogNear:c.getUniformLocation(v,"fogNear"),fogFar:c.getUniformLocation(v,"fogFar"),fogColor:c.getUniformLocation(v,"fogColor"),alphaTest:c.getUniformLocation(v,"alphaTest")};var V=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");V.width=8,V.height=8;var H=V.getContext("2d");H.fillStyle="white",H.fillRect(0,0,8,8),(w=new mt(V)).needsUpdate=!0}(),c.useProgram(v),d.initAttributes(),d.enableAttribute(y.position),d.enableAttribute(y.uv),d.disableUnusedAttributes(),d.disable(c.CULL_FACE),d.enable(c.BLEND),c.bindBuffer(c.ARRAY_BUFFER,p),c.vertexAttribPointer(y.position,2,c.FLOAT,!1,16,0),c.vertexAttribPointer(y.uv,2,c.FLOAT,!1,16,8),c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,m),c.uniformMatrix4fv(b.projectionMatrix,!1,F.projectionMatrix.elements),d.activeTexture(c.TEXTURE0),c.uniform1i(b.map,0);var V=0,H=0,J=U.fog;J?(c.uniform3f(b.fogColor,J.color.r,J.color.g,J.color.b),J.isFog?(c.uniform1f(b.fogNear,J.near),c.uniform1f(b.fogFar,J.far),c.uniform1i(b.fogType,1),V=1,H=1):J.isFogExp2&&(c.uniform1f(b.fogDensity,J.density),c.uniform1i(b.fogType,2),V=2,H=2)):(c.uniform1i(b.fogType,0),V=0,H=0);for(var q=0,ae=l.length;q<ae;q++)(se=l[q]).modelViewMatrix.multiplyMatrices(F.matrixWorldInverse,se.matrixWorld),se.z=-se.modelViewMatrix.elements[14];l.sort(B);var le=[];for(q=0,ae=l.length;q<ae;q++){var se,ue=(se=l[q]).material;if(!1!==ue.visible){c.uniform1f(b.alphaTest,ue.alphaTest),c.uniformMatrix4fv(b.modelViewMatrix,!1,se.modelViewMatrix.elements),se.matrixWorld.decompose(T,A,R),le[0]=R.x,le[1]=R.y;var me=0;U.fog&&ue.fog&&(me=H),V!==me&&(c.uniform1i(b.fogType,me),V=me),null!==ue.map?(c.uniform2f(b.uvOffset,ue.map.offset.x,ue.map.offset.y),c.uniform2f(b.uvScale,ue.map.repeat.x,ue.map.repeat.y)):(c.uniform2f(b.uvOffset,0,0),c.uniform2f(b.uvScale,1,1)),c.uniform1f(b.opacity,ue.opacity),c.uniform3f(b.color,ue.color.r,ue.color.g,ue.color.b),c.uniform1f(b.rotation,ue.rotation),c.uniform2fv(b.scale,le),d.setBlending(ue.blending,ue.blendEquation,ue.blendSrc,ue.blendDst),d.setDepthTest(ue.depthTest),d.setDepthWrite(ue.depthWrite),s.setTexture2D(ue.map?ue.map:w,0),c.drawElements(c.TRIANGLES,6,c.UNSIGNED_SHORT,0)}}d.enable(c.CULL_FACE),s.resetGLState()}}}Ss.physical={uniforms:as.merge([Ss.standard.uniforms,{clearCoat:{value:0},clearCoatRoughness:{value:0}}]),vertexShader:Wn.meshphysical_vert,fragmentShader:Wn.meshphysical_frag},pa.prototype={constructor:pa,set:function(s,l){return this.min.copy(s),this.max.copy(l),this},setFromPoints:function(s){this.makeEmpty();for(var l=0,c=s.length;l<c;l++)this.expandByPoint(s[l]);return this},setFromCenterAndSize:function(){var s=new ut;return function(c,d){var p=s.copy(d).multiplyScalar(.5);return this.min.copy(c).sub(p),this.max.copy(c).add(p),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(s){return this.min.copy(s.min),this.max.copy(s.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function(s){var l=s||new ut;return this.isEmpty()?l.set(0,0):l.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(s){var l=s||new ut;return this.isEmpty()?l.set(0,0):l.subVectors(this.max,this.min)},expandByPoint:function(s){return this.min.min(s),this.max.max(s),this},expandByVector:function(s){return this.min.sub(s),this.max.add(s),this},expandByScalar:function(s){return this.min.addScalar(-s),this.max.addScalar(s),this},containsPoint:function(s){return!(s.x<this.min.x||s.x>this.max.x||s.y<this.min.y||s.y>this.max.y)},containsBox:function(s){return this.min.x<=s.min.x&&s.max.x<=this.max.x&&this.min.y<=s.min.y&&s.max.y<=this.max.y},getParameter:function(s,l){return(l||new ut).set((s.x-this.min.x)/(this.max.x-this.min.x),(s.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(s){return!(s.max.x<this.min.x||s.min.x>this.max.x||s.max.y<this.min.y||s.min.y>this.max.y)},clampPoint:function(s,l){return(l||new ut).copy(s).clamp(this.min,this.max)},distanceToPoint:function(){var s=new ut;return function(c){return s.copy(c).clamp(this.min,this.max).sub(c).length()}}(),intersect:function(s){return this.min.max(s.min),this.max.min(s.max),this},union:function(s){return this.min.min(s.min),this.max.max(s.max),this},translate:function(s){return this.min.add(s),this.max.add(s),this},equals:function(s){return s.min.equals(this.min)&&s.max.equals(this.max)}};var RA=0;function wn(){Object.defineProperty(this,"id",{value:RA++}),this.uuid=dn.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.lights=!0,this.blending=Wa,this.side=xs,this.shading=ss,this.vertexColors=ro,this.opacity=1,this.transparent=!1,this.blendSrc=Gm,this.blendDst=Os,this.blendEquation=Vm,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=Rc,this.depthTest=!0,this.depthWrite=!0,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.alphaTest=0,this.premultipliedAlpha=!1,this.overdraw=0,this.visible=!0,this._needsUpdate=!0}function Qr(s){wn.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,void 0!==s&&(void 0!==s.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(s))}function kr(s){wn.call(this),this.type="MeshDepthMaterial",this.depthPacking=dh,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.setValues(s)}function Vs(s,l){this.min=void 0!==s?s:new z(1/0,1/0,1/0),this.max=void 0!==l?l:new z(-1/0,-1/0,-1/0)}function or(s,l){this.center=void 0!==s?s:new z,this.radius=void 0!==l?l:0}function es(){this.elements=new Float32Array([1,0,0,0,1,0,0,0,1]),arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}function si(s,l){this.normal=void 0!==s?s:new z(1,0,0),this.constant=void 0!==l?l:0}function xf(s,l,c,d,p,m){this.planes=[void 0!==s?s:new si,void 0!==l?l:new si,void 0!==c?c:new si,void 0!==d?d:new si,void 0!==p?p:new si,void 0!==m?m:new si]}function cs(s,l,c,d){var p=s.context,m=s.state,v=new xf,y=new Wt,b=l.shadows,w=new ut,T=new ut(d.maxTextureSize,d.maxTextureSize),A=new z,R=new z,P=[],F=new Array(4),V=new Array(4),H={},J=[new z(1,0,0),new z(-1,0,0),new z(0,0,1),new z(0,0,-1),new z(0,1,0),new z(0,-1,0)],q=[new z(0,1,0),new z(0,1,0),new z(0,1,0),new z(0,1,0),new z(0,0,1),new z(0,0,-1)],ae=[new ri,new ri,new ri,new ri,new ri,new ri],se=new kr;se.depthPacking=dr,se.clipping=!0;for(var le=Ss.distanceRGBA,ue=as.clone(le.uniforms),me=0;4!==me;++me){var Fe=0!=(1&me),Ie=0!=(2&me),Z=se.clone();Z.morphTargets=Fe,Z.skinning=Ie,F[me]=Z;var ee=new Qr({defines:{USE_SHADOWMAP:""},uniforms:ue,vertexShader:le.vertexShader,fragmentShader:le.fragmentShader,morphTargets:Fe,skinning:Ie,clipping:!0});V[me]=ee}var ve=this;function Te(Le,Ne,Qe,Ye){var He=Le.geometry,ye=null,Ge=F,tt=Le.customDepthMaterial;if(Qe&&(Ge=V,tt=Le.customDistanceMaterial),tt)ye=tt;else{var Je=!1;Ne.morphTargets&&(He&&He.isBufferGeometry?Je=He.morphAttributes&&He.morphAttributes.position&&He.morphAttributes.position.length>0:He&&He.isGeometry&&(Je=He.morphTargets&&He.morphTargets.length>0));var At=0;Je&&(At|=1),Le.isSkinnedMesh&&Ne.skinning&&(At|=2),ye=Ge[At]}if(s.localClippingEnabled&&!0===Ne.clipShadows&&0!==Ne.clippingPlanes.length){var st=ye.uuid,tn=Ne.uuid,de=H[st];void 0===de&&(H[st]=de={});var oi=de[tn];void 0===oi&&(oi=ye.clone(),de[tn]=oi),ye=oi}ye.visible=Ne.visible,ye.wireframe=Ne.wireframe;var Gt=Ne.side;return ve.renderSingleSided&&Gt==Nt&&(Gt=xs),ve.renderReverseSided&&(Gt===xs?Gt=ie:Gt===ie&&(Gt=xs)),ye.side=Gt,ye.clipShadows=Ne.clipShadows,ye.clippingPlanes=Ne.clippingPlanes,ye.wireframeLinewidth=Ne.wireframeLinewidth,ye.linewidth=Ne.linewidth,Qe&&void 0!==ye.uniforms.lightPos&&ye.uniforms.lightPos.value.copy(Ye),ye}function Oe(Le,Ne,Qe){if(!1!==Le.visible){0!=(Le.layers.mask&Ne.layers.mask)&&(Le.isMesh||Le.isLine||Le.isPoints)&&Le.castShadow&&(!1===Le.frustumCulled||!0===v.intersectsObject(Le))&&!0===Le.material.visible&&(Le.modelViewMatrix.multiplyMatrices(Qe.matrixWorldInverse,Le.matrixWorld),P.push(Le));for(var ye=Le.children,Ge=0,tt=ye.length;Ge<tt;Ge++)Oe(ye[Ge],Ne,Qe)}}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=qn,this.renderReverseSided=!0,this.renderSingleSided=!0,this.render=function(Le,Ne){if(!1!==ve.enabled&&(!1!==ve.autoUpdate||!1!==ve.needsUpdate)&&0!==b.length){m.buffers.color.setClear(1,1,1,1),m.disable(p.BLEND),m.setDepthTest(!0),m.setScissorTest(!1);for(var Qe,Ye,He=0,ye=b.length;He<ye;He++){var Ge=b[He],tt=Ge.shadow;if(void 0!==tt){var Je=tt.camera;if(w.copy(tt.mapSize),w.min(T),Ge&&Ge.isPointLight){Qe=6,Ye=!0;var Lt=w.x,At=w.y;ae[0].set(2*Lt,At,Lt,At),ae[1].set(0,At,Lt,At),ae[2].set(3*Lt,At,Lt,At),ae[3].set(Lt,At,Lt,At),ae[4].set(3*Lt,0,Lt,At),ae[5].set(Lt,0,Lt,At),w.x*=4,w.y*=2}else Qe=1,Ye=!1;null===tt.map&&(tt.map=new Xa(w.x,w.y,{minFilter:Us,magFilter:Us,format:zo}),Je.updateProjectionMatrix()),tt.isSpotLightShadow&&tt.update(Ge),tt&&tt.isRectAreaLightShadow&&tt.update(Ge);var tn=tt.map,de=tt.matrix;R.setFromMatrixPosition(Ge.matrixWorld),Je.position.copy(R),s.setRenderTarget(tn),s.clear();for(var oi=0;oi<Qe;oi++){Ye?(A.copy(Je.position),A.add(J[oi]),Je.up.copy(q[oi]),Je.lookAt(A),m.viewport(ae[oi])):(A.setFromMatrixPosition(Ge.target.matrixWorld),Je.lookAt(A)),Je.updateMatrixWorld(),Je.matrixWorldInverse.getInverse(Je.matrixWorld),de.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),de.multiply(Je.projectionMatrix),de.multiply(Je.matrixWorldInverse),y.multiplyMatrices(Je.projectionMatrix,Je.matrixWorldInverse),v.setFromMatrix(y),P.length=0,Oe(Le,Ne,Je);for(var $n=0,Mt=P.length;$n<Mt;$n++){var fi=P[$n],sn=c.update(fi),fn=fi.material;if(fn&&fn.isMultiMaterial)for(var Xn=sn.groups,Zn=fn.materials,Gi=0,pi=Xn.length;Gi<pi;Gi++){var Wi=Xn[Gi],Ti=Zn[Wi.materialIndex];if(!0===Ti.visible){var Ci=Te(fi,Ti,Ye,R);s.renderBufferDirect(Je,null,sn,Ci,fi,Wi)}}else Ci=Te(fi,fn,Ye,R),s.renderBufferDirect(Je,null,sn,Ci,fi,null)}}}else console.warn("THREE.WebGLShadowMap:",Ge,"has no shadow.")}var Ln=s.getClearColor(),lr=s.getClearAlpha();s.setClearColor(Ln,lr),ve.needsUpdate=!1}}}function Yi(s,l){this.origin=void 0!==s?s:new z,this.direction=void 0!==l?l:new z}function jo(s,l,c,d){this._x=s||0,this._y=l||0,this._z=c||0,this._order=d||jo.DefaultOrder}function $o(){this.mask=1}wn.prototype={constructor:wn,isMaterial:!0,get needsUpdate(){return this._needsUpdate},set needsUpdate(s){!0===s&&this.update(),this._needsUpdate=s},setValues:function(s){if(void 0!==s)for(var l in s){var c=s[l];if(void 0!==c){var d=this[l];void 0!==d?d&&d.isColor?d.set(c):d&&d.isVector3&&c&&c.isVector3?d.copy(c):this[l]="overdraw"===l?Number(c):c:console.warn("THREE."+this.type+": '"+l+"' is not a property of this material.")}else console.warn("THREE.Material: '"+l+"' parameter is undefined.")}},toJSON:function(s){var l=void 0===s;l&&(s={textures:{},images:{}});var c={metadata:{version:4.4,type:"Material",generator:"Material.toJSON"}};function d(v){var y=[];for(var b in v){var w=v[b];delete w.metadata,y.push(w)}return y}if(c.uuid=this.uuid,c.type=this.type,""!==this.name&&(c.name=this.name),this.color&&this.color.isColor&&(c.color=this.color.getHex()),void 0!==this.roughness&&(c.roughness=this.roughness),void 0!==this.metalness&&(c.metalness=this.metalness),this.emissive&&this.emissive.isColor&&(c.emissive=this.emissive.getHex()),this.specular&&this.specular.isColor&&(c.specular=this.specular.getHex()),void 0!==this.shininess&&(c.shininess=this.shininess),void 0!==this.clearCoat&&(c.clearCoat=this.clearCoat),void 0!==this.clearCoatRoughness&&(c.clearCoatRoughness=this.clearCoatRoughness),this.map&&this.map.isTexture&&(c.map=this.map.toJSON(s).uuid),this.alphaMap&&this.alphaMap.isTexture&&(c.alphaMap=this.alphaMap.toJSON(s).uuid),this.lightMap&&this.lightMap.isTexture&&(c.lightMap=this.lightMap.toJSON(s).uuid),this.bumpMap&&this.bumpMap.isTexture&&(c.bumpMap=this.bumpMap.toJSON(s).uuid,c.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(c.normalMap=this.normalMap.toJSON(s).uuid,c.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(c.displacementMap=this.displacementMap.toJSON(s).uuid,c.displacementScale=this.displacementScale,c.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(c.roughnessMap=this.roughnessMap.toJSON(s).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(c.metalnessMap=this.metalnessMap.toJSON(s).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(c.emissiveMap=this.emissiveMap.toJSON(s).uuid),this.specularMap&&this.specularMap.isTexture&&(c.specularMap=this.specularMap.toJSON(s).uuid),this.envMap&&this.envMap.isTexture&&(c.envMap=this.envMap.toJSON(s).uuid,c.reflectivity=this.reflectivity),this.gradientMap&&this.gradientMap.isTexture&&(c.gradientMap=this.gradientMap.toJSON(s).uuid),void 0!==this.size&&(c.size=this.size),void 0!==this.sizeAttenuation&&(c.sizeAttenuation=this.sizeAttenuation),this.blending!==Wa&&(c.blending=this.blending),this.shading!==ss&&(c.shading=this.shading),this.side!==xs&&(c.side=this.side),this.vertexColors!==ro&&(c.vertexColors=this.vertexColors),this.opacity<1&&(c.opacity=this.opacity),!0===this.transparent&&(c.transparent=this.transparent),c.depthFunc=this.depthFunc,c.depthTest=this.depthTest,c.depthWrite=this.depthWrite,this.alphaTest>0&&(c.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(c.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(c.wireframe=this.wireframe),this.wireframeLinewidth>1&&(c.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(c.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(c.wireframeLinejoin=this.wireframeLinejoin),c.skinning=this.skinning,c.morphTargets=this.morphTargets,l){var p=d(s.textures),m=d(s.images);p.length>0&&(c.textures=p),m.length>0&&(c.images=m)}return c},clone:function(){return(new this.constructor).copy(this)},copy:function(s){this.name=s.name,this.fog=s.fog,this.lights=s.lights,this.blending=s.blending,this.side=s.side,this.shading=s.shading,this.vertexColors=s.vertexColors,this.opacity=s.opacity,this.transparent=s.transparent,this.blendSrc=s.blendSrc,this.blendDst=s.blendDst,this.blendEquation=s.blendEquation,this.blendSrcAlpha=s.blendSrcAlpha,this.blendDstAlpha=s.blendDstAlpha,this.blendEquationAlpha=s.blendEquationAlpha,this.depthFunc=s.depthFunc,this.depthTest=s.depthTest,this.depthWrite=s.depthWrite,this.colorWrite=s.colorWrite,this.precision=s.precision,this.polygonOffset=s.polygonOffset,this.polygonOffsetFactor=s.polygonOffsetFactor,this.polygonOffsetUnits=s.polygonOffsetUnits,this.alphaTest=s.alphaTest,this.premultipliedAlpha=s.premultipliedAlpha,this.overdraw=s.overdraw,this.visible=s.visible,this.clipShadows=s.clipShadows,this.clipIntersection=s.clipIntersection;var l=s.clippingPlanes,c=null;if(null!==l){var d=l.length;c=new Array(d);for(var p=0;p!==d;++p)c[p]=l[p].clone()}return this.clippingPlanes=c,this},update:function(){this.dispatchEvent({type:"update"})},dispose:function(){this.dispatchEvent({type:"dispose"})}},Object.assign(wn.prototype,Tn.prototype),(Qr.prototype=Object.create(wn.prototype)).constructor=Qr,Qr.prototype.isShaderMaterial=!0,Qr.prototype.copy=function(s){return wn.prototype.copy.call(this,s),this.fragmentShader=s.fragmentShader,this.vertexShader=s.vertexShader,this.uniforms=as.clone(s.uniforms),this.defines=s.defines,this.wireframe=s.wireframe,this.wireframeLinewidth=s.wireframeLinewidth,this.lights=s.lights,this.clipping=s.clipping,this.skinning=s.skinning,this.morphTargets=s.morphTargets,this.morphNormals=s.morphNormals,this.extensions=s.extensions,this},Qr.prototype.toJSON=function(s){var l=wn.prototype.toJSON.call(this,s);return l.uniforms=this.uniforms,l.vertexShader=this.vertexShader,l.fragmentShader=this.fragmentShader,l},(kr.prototype=Object.create(wn.prototype)).constructor=kr,kr.prototype.isMeshDepthMaterial=!0,kr.prototype.copy=function(s){return wn.prototype.copy.call(this,s),this.depthPacking=s.depthPacking,this.skinning=s.skinning,this.morphTargets=s.morphTargets,this.map=s.map,this.alphaMap=s.alphaMap,this.displacementMap=s.displacementMap,this.displacementScale=s.displacementScale,this.displacementBias=s.displacementBias,this.wireframe=s.wireframe,this.wireframeLinewidth=s.wireframeLinewidth,this},Vs.prototype={constructor:Vs,isBox3:!0,set:function(s,l){return this.min.copy(s),this.max.copy(l),this},setFromArray:function(s){for(var l=1/0,c=1/0,d=1/0,p=-1/0,m=-1/0,v=-1/0,y=0,b=s.length;y<b;y+=3){var w=s[y],T=s[y+1],A=s[y+2];w<l&&(l=w),T<c&&(c=T),A<d&&(d=A),w>p&&(p=w),T>m&&(m=T),A>v&&(v=A)}this.min.set(l,c,d),this.max.set(p,m,v)},setFromBufferAttribute:function(s){for(var l=1/0,c=1/0,d=1/0,p=-1/0,m=-1/0,v=-1/0,y=0,b=s.count;y<b;y++){var w=s.getX(y),T=s.getY(y),A=s.getZ(y);w<l&&(l=w),T<c&&(c=T),A<d&&(d=A),w>p&&(p=w),T>m&&(m=T),A>v&&(v=A)}this.min.set(l,c,d),this.max.set(p,m,v)},setFromPoints:function(s){this.makeEmpty();for(var l=0,c=s.length;l<c;l++)this.expandByPoint(s[l]);return this},setFromCenterAndSize:function(){var s=new z;return function(c,d){var p=s.copy(d).multiplyScalar(.5);return this.min.copy(c).sub(p),this.max.copy(c).add(p),this}}(),setFromObject:function(){var s=new z;return function(c){var d=this;return c.updateMatrixWorld(!0),this.makeEmpty(),c.traverse(function(p){var m,v,y=p.geometry;if(void 0!==y)if(y.isGeometry){var b=y.vertices;for(m=0,v=b.length;m<v;m++)s.copy(b[m]),s.applyMatrix4(p.matrixWorld),d.expandByPoint(s)}else if(y.isBufferGeometry){var w=y.attributes.position;if(void 0!==w)for(m=0,v=w.count;m<v;m++)s.fromAttribute(w,m).applyMatrix4(p.matrixWorld),d.expandByPoint(s)}}),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(s){return this.min.copy(s.min),this.max.copy(s.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(s){var l=s||new z;return this.isEmpty()?l.set(0,0,0):l.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(s){var l=s||new z;return this.isEmpty()?l.set(0,0,0):l.subVectors(this.max,this.min)},expandByPoint:function(s){return this.min.min(s),this.max.max(s),this},expandByVector:function(s){return this.min.sub(s),this.max.add(s),this},expandByScalar:function(s){return this.min.addScalar(-s),this.max.addScalar(s),this},containsPoint:function(s){return!(s.x<this.min.x||s.x>this.max.x||s.y<this.min.y||s.y>this.max.y||s.z<this.min.z||s.z>this.max.z)},containsBox:function(s){return this.min.x<=s.min.x&&s.max.x<=this.max.x&&this.min.y<=s.min.y&&s.max.y<=this.max.y&&this.min.z<=s.min.z&&s.max.z<=this.max.z},getParameter:function(s,l){return(l||new z).set((s.x-this.min.x)/(this.max.x-this.min.x),(s.y-this.min.y)/(this.max.y-this.min.y),(s.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(s){return!(s.max.x<this.min.x||s.min.x>this.max.x||s.max.y<this.min.y||s.min.y>this.max.y||s.max.z<this.min.z||s.min.z>this.max.z)},intersectsSphere:function(){var s;return function(c){return void 0===s&&(s=new z),this.clampPoint(c.center,s),s.distanceToSquared(c.center)<=c.radius*c.radius}}(),intersectsPlane:function(s){var l,c;return s.normal.x>0?(l=s.normal.x*this.min.x,c=s.normal.x*this.max.x):(l=s.normal.x*this.max.x,c=s.normal.x*this.min.x),s.normal.y>0?(l+=s.normal.y*this.min.y,c+=s.normal.y*this.max.y):(l+=s.normal.y*this.max.y,c+=s.normal.y*this.min.y),s.normal.z>0?(l+=s.normal.z*this.min.z,c+=s.normal.z*this.max.z):(l+=s.normal.z*this.max.z,c+=s.normal.z*this.min.z),l<=s.constant&&c>=s.constant},clampPoint:function(s,l){return(l||new z).copy(s).clamp(this.min,this.max)},distanceToPoint:function(){var s=new z;return function(c){return s.copy(c).clamp(this.min,this.max).sub(c).length()}}(),getBoundingSphere:function(){var s=new z;return function(c){var d=c||new or;return this.getCenter(d.center),d.radius=.5*this.getSize(s).length(),d}}(),intersect:function(s){return this.min.max(s.min),this.max.min(s.max),this.isEmpty()&&this.makeEmpty(),this},union:function(s){return this.min.min(s.min),this.max.max(s.max),this},applyMatrix4:function(){var s=[new z,new z,new z,new z,new z,new z,new z,new z];return function(c){return this.isEmpty()||(s[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(c),s[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(c),s[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(c),s[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(c),s[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(c),s[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(c),s[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(c),s[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(c),this.setFromPoints(s)),this}}(),translate:function(s){return this.min.add(s),this.max.add(s),this},equals:function(s){return s.min.equals(this.min)&&s.max.equals(this.max)}},or.prototype={constructor:or,set:function(s,l){return this.center.copy(s),this.radius=l,this},setFromPoints:function(){var s=new Vs;return function(c,d){var p=this.center;void 0!==d?p.copy(d):s.setFromPoints(c).getCenter(p);for(var m=0,v=0,y=c.length;v<y;v++)m=Math.max(m,p.distanceToSquared(c[v]));return this.radius=Math.sqrt(m),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(s){return this.center.copy(s.center),this.radius=s.radius,this},empty:function(){return this.radius<=0},containsPoint:function(s){return s.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(s){return s.distanceTo(this.center)-this.radius},intersectsSphere:function(s){var l=this.radius+s.radius;return s.center.distanceToSquared(this.center)<=l*l},intersectsBox:function(s){return s.intersectsSphere(this)},intersectsPlane:function(s){return Math.abs(this.center.dot(s.normal)-s.constant)<=this.radius},clampPoint:function(s,l){var c=this.center.distanceToSquared(s),d=l||new z;return d.copy(s),c>this.radius*this.radius&&(d.sub(this.center).normalize(),d.multiplyScalar(this.radius).add(this.center)),d},getBoundingBox:function(s){var l=s||new Vs;return l.set(this.center,this.center),l.expandByScalar(this.radius),l},applyMatrix4:function(s){return this.center.applyMatrix4(s),this.radius=this.radius*s.getMaxScaleOnAxis(),this},translate:function(s){return this.center.add(s),this},equals:function(s){return s.center.equals(this.center)&&s.radius===this.radius}},es.prototype={constructor:es,isMatrix3:!0,set:function(s,l,c,d,p,m,v,y,b){var w=this.elements;return w[0]=s,w[1]=d,w[2]=v,w[3]=l,w[4]=p,w[5]=y,w[6]=c,w[7]=m,w[8]=b,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(s){var l=s.elements;return this.set(l[0],l[3],l[6],l[1],l[4],l[7],l[2],l[5],l[8]),this},setFromMatrix4:function(s){var l=s.elements;return this.set(l[0],l[4],l[8],l[1],l[5],l[9],l[2],l[6],l[10]),this},applyToVector3Array:function(){var s;return function(c,d,p){void 0===s&&(s=new z),void 0===d&&(d=0),void 0===p&&(p=c.length);for(var m=0,v=d;m<p;m+=3,v+=3)s.fromArray(c,v),s.applyMatrix3(this),s.toArray(c,v);return c}}(),applyToBufferAttribute:function(){var s;return function(c){void 0===s&&(s=new z);for(var d=0,p=c.count;d<p;d++)s.x=c.getX(d),s.y=c.getY(d),s.z=c.getZ(d),s.applyMatrix3(this),c.setXYZ(d,s.x,s.y,s.z);return c}}(),multiplyScalar:function(s){var l=this.elements;return l[0]*=s,l[3]*=s,l[6]*=s,l[1]*=s,l[4]*=s,l[7]*=s,l[2]*=s,l[5]*=s,l[8]*=s,this},determinant:function(){var s=this.elements,l=s[0],c=s[1],d=s[2],p=s[3],m=s[4],v=s[5],y=s[6],b=s[7],w=s[8];return l*m*w-l*v*b-c*p*w+c*v*y+d*p*b-d*m*y},getInverse:function(s,l){s&&s.isMatrix4&&console.error("THREE.Matrix3.getInverse no longer takes a Matrix4 argument.");var c=s.elements,d=this.elements,p=c[0],m=c[1],v=c[2],y=c[3],b=c[4],w=c[5],T=c[6],A=c[7],R=c[8],P=R*b-w*A,L=w*T-R*y,B=A*y-b*T,U=p*P+m*L+v*B;if(0===U){var F="THREE.Matrix3.getInverse(): can't invert matrix, determinant is 0";if(!0===l)throw new Error(F);return console.warn(F),this.identity()}var V=1/U;return d[0]=P*V,d[1]=(v*A-R*m)*V,d[2]=(w*m-v*b)*V,d[3]=L*V,d[4]=(R*p-v*T)*V,d[5]=(v*y-w*p)*V,d[6]=B*V,d[7]=(m*T-A*p)*V,d[8]=(b*p-m*y)*V,this},transpose:function(){var s,l=this.elements;return s=l[1],l[1]=l[3],l[3]=s,s=l[2],l[2]=l[6],l[6]=s,s=l[5],l[5]=l[7],l[7]=s,this},getNormalMatrix:function(s){return this.setFromMatrix4(s).getInverse(this).transpose()},transposeIntoArray:function(s){var l=this.elements;return s[0]=l[0],s[1]=l[3],s[2]=l[6],s[3]=l[1],s[4]=l[4],s[5]=l[7],s[6]=l[2],s[7]=l[5],s[8]=l[8],this},fromArray:function(s,l){void 0===l&&(l=0);for(var c=0;c<9;c++)this.elements[c]=s[c+l];return this},toArray:function(s,l){void 0===s&&(s=[]),void 0===l&&(l=0);var c=this.elements;return s[l]=c[0],s[l+1]=c[1],s[l+2]=c[2],s[l+3]=c[3],s[l+4]=c[4],s[l+5]=c[5],s[l+6]=c[6],s[l+7]=c[7],s[l+8]=c[8],s}},si.prototype={constructor:si,set:function(s,l){return this.normal.copy(s),this.constant=l,this},setComponents:function(s,l,c,d){return this.normal.set(s,l,c),this.constant=d,this},setFromNormalAndCoplanarPoint:function(s,l){return this.normal.copy(s),this.constant=-l.dot(this.normal),this},setFromCoplanarPoints:function(){var s=new z,l=new z;return function(d,p,m){var v=s.subVectors(m,p).cross(l.subVectors(d,p)).normalize();return this.setFromNormalAndCoplanarPoint(v,d),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(s){return this.normal.copy(s.normal),this.constant=s.constant,this},normalize:function(){var s=1/this.normal.length();return this.normal.multiplyScalar(s),this.constant*=s,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(s){return this.normal.dot(s)+this.constant},distanceToSphere:function(s){return this.distanceToPoint(s.center)-s.radius},projectPoint:function(s,l){return this.orthoPoint(s,l).sub(s).negate()},orthoPoint:function(s,l){var c=this.distanceToPoint(s);return(l||new z).copy(this.normal).multiplyScalar(c)},intersectLine:function(){var s=new z;return function(c,d){var p=d||new z,m=c.delta(s),v=this.normal.dot(m);if(0===v)return 0===this.distanceToPoint(c.start)?p.copy(c.start):void 0;var y=-(c.start.dot(this.normal)+this.constant)/v;return y<0||y>1?void 0:p.copy(m).multiplyScalar(y).add(c.start)}}(),intersectsLine:function(s){var l=this.distanceToPoint(s.start),c=this.distanceToPoint(s.end);return l<0&&c>0||c<0&&l>0},intersectsBox:function(s){return s.intersectsPlane(this)},intersectsSphere:function(s){return s.intersectsPlane(this)},coplanarPoint:function(s){return(s||new z).copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var s=new z,l=new es;return function(d,p){var m=this.coplanarPoint(s).applyMatrix4(d),v=p||l.getNormalMatrix(d),y=this.normal.applyMatrix3(v).normalize();return this.constant=-m.dot(y),this}}(),translate:function(s){return this.constant=this.constant-s.dot(this.normal),this},equals:function(s){return s.normal.equals(this.normal)&&s.constant===this.constant}},xf.prototype={constructor:xf,set:function(s,l,c,d,p,m){var v=this.planes;return v[0].copy(s),v[1].copy(l),v[2].copy(c),v[3].copy(d),v[4].copy(p),v[5].copy(m),this},clone:function(){return(new this.constructor).copy(this)},copy:function(s){for(var l=this.planes,c=0;c<6;c++)l[c].copy(s.planes[c]);return this},setFromMatrix:function(s){var l=this.planes,c=s.elements,d=c[0],p=c[1],m=c[2],v=c[3],y=c[4],b=c[5],w=c[6],T=c[7],A=c[8],R=c[9],P=c[10],L=c[11],B=c[12],U=c[13],F=c[14],V=c[15];return l[0].setComponents(v-d,T-y,L-A,V-B).normalize(),l[1].setComponents(v+d,T+y,L+A,V+B).normalize(),l[2].setComponents(v+p,T+b,L+R,V+U).normalize(),l[3].setComponents(v-p,T-b,L-R,V-U).normalize(),l[4].setComponents(v-m,T-w,L-P,V-F).normalize(),l[5].setComponents(v+m,T+w,L+P,V+F).normalize(),this},intersectsObject:function(){var s=new or;return function(c){var d=c.geometry;return null===d.boundingSphere&&d.computeBoundingSphere(),s.copy(d.boundingSphere).applyMatrix4(c.matrixWorld),this.intersectsSphere(s)}}(),intersectsSprite:function(){var s=new or;return function(c){return s.center.set(0,0,0),s.radius=.7071067811865476,s.applyMatrix4(c.matrixWorld),this.intersectsSphere(s)}}(),intersectsSphere:function(s){for(var l=this.planes,c=s.center,d=-s.radius,p=0;p<6;p++)if(l[p].distanceToPoint(c)<d)return!1;return!0},intersectsBox:function(){var s=new z,l=new z;return function(d){for(var p=this.planes,m=0;m<6;m++){var v=p[m];s.x=v.normal.x>0?d.min.x:d.max.x,l.x=v.normal.x>0?d.max.x:d.min.x,s.y=v.normal.y>0?d.min.y:d.max.y,l.y=v.normal.y>0?d.max.y:d.min.y,s.z=v.normal.z>0?d.min.z:d.max.z,l.z=v.normal.z>0?d.max.z:d.min.z;var y=v.distanceToPoint(s),b=v.distanceToPoint(l);if(y<0&&b<0)return!1}return!0}}(),containsPoint:function(s){for(var l=this.planes,c=0;c<6;c++)if(l[c].distanceToPoint(s)<0)return!1;return!0}},Yi.prototype={constructor:Yi,set:function(s,l){return this.origin.copy(s),this.direction.copy(l),this},clone:function(){return(new this.constructor).copy(this)},copy:function(s){return this.origin.copy(s.origin),this.direction.copy(s.direction),this},at:function(s,l){return(l||new z).copy(this.direction).multiplyScalar(s).add(this.origin)},lookAt:function(s){return this.direction.copy(s).sub(this.origin).normalize(),this},recast:function(){var s=new z;return function(c){return this.origin.copy(this.at(c,s)),this}}(),closestPointToPoint:function(s,l){var c=l||new z;c.subVectors(s,this.origin);var d=c.dot(this.direction);return d<0?c.copy(this.origin):c.copy(this.direction).multiplyScalar(d).add(this.origin)},distanceToPoint:function(s){return Math.sqrt(this.distanceSqToPoint(s))},distanceSqToPoint:function(){var s=new z;return function(c){var d=s.subVectors(c,this.origin).dot(this.direction);return d<0?this.origin.distanceToSquared(c):(s.copy(this.direction).multiplyScalar(d).add(this.origin),s.distanceToSquared(c))}}(),distanceSqToSegment:function(){var s=new z,l=new z,c=new z;return function(p,m,v,y){s.copy(p).add(m).multiplyScalar(.5),l.copy(m).sub(p).normalize(),c.copy(this.origin).sub(s);var L,B,U,F,b=.5*p.distanceTo(m),w=-this.direction.dot(l),T=c.dot(this.direction),A=-c.dot(l),R=c.lengthSq(),P=Math.abs(1-w*w);if(P>0)if(B=w*T-A,F=b*P,(L=w*A-T)>=0)if(B>=-F)if(B<=F){var V=1/P;U=(L*=V)*(L+w*(B*=V)+2*T)+B*(w*L+B+2*A)+R}else B=b,U=-(L=Math.max(0,-(w*B+T)))*L+B*(B+2*A)+R;else B=-b,U=-(L=Math.max(0,-(w*B+T)))*L+B*(B+2*A)+R;else B<=-F?U=-(L=Math.max(0,-(-w*b+T)))*L+(B=L>0?-b:Math.min(Math.max(-b,-A),b))*(B+2*A)+R:B<=F?(L=0,U=(B=Math.min(Math.max(-b,-A),b))*(B+2*A)+R):U=-(L=Math.max(0,-(w*b+T)))*L+(B=L>0?b:Math.min(Math.max(-b,-A),b))*(B+2*A)+R;else B=w>0?-b:b,U=-(L=Math.max(0,-(w*B+T)))*L+B*(B+2*A)+R;return v&&v.copy(this.direction).multiplyScalar(L).add(this.origin),y&&y.copy(l).multiplyScalar(B).add(s),U}}(),intersectSphere:function(){var s=new z;return function(c,d){s.subVectors(c.center,this.origin);var p=s.dot(this.direction),m=s.dot(s)-p*p,v=c.radius*c.radius;if(m>v)return null;var y=Math.sqrt(v-m),b=p-y,w=p+y;return b<0&&w<0?null:this.at(b<0?w:b,d)}}(),intersectsSphere:function(s){return this.distanceToPoint(s.center)<=s.radius},distanceToPlane:function(s){var l=s.normal.dot(this.direction);if(0===l)return 0===s.distanceToPoint(this.origin)?0:null;var c=-(this.origin.dot(s.normal)+s.constant)/l;return c>=0?c:null},intersectPlane:function(s,l){var c=this.distanceToPlane(s);return null===c?null:this.at(c,l)},intersectsPlane:function(s){var l=s.distanceToPoint(this.origin);return 0===l||s.normal.dot(this.direction)*l<0},intersectBox:function(s,l){var c,d,p,m,v,y,b=1/this.direction.x,w=1/this.direction.y,T=1/this.direction.z,A=this.origin;return b>=0?(c=(s.min.x-A.x)*b,d=(s.max.x-A.x)*b):(c=(s.max.x-A.x)*b,d=(s.min.x-A.x)*b),w>=0?(p=(s.min.y-A.y)*w,m=(s.max.y-A.y)*w):(p=(s.max.y-A.y)*w,m=(s.min.y-A.y)*w),c>m||p>d||((p>c||c!=c)&&(c=p),(m<d||d!=d)&&(d=m),T>=0?(v=(s.min.z-A.z)*T,y=(s.max.z-A.z)*T):(v=(s.max.z-A.z)*T,y=(s.min.z-A.z)*T),c>y||v>d)||((v>c||c!=c)&&(c=v),(y<d||d!=d)&&(d=y),d<0)?null:this.at(c>=0?c:d,l)},intersectsBox:function(){var s=new z;return function(c){return null!==this.intersectBox(c,s)}}(),intersectTriangle:function(){var s=new z,l=new z,c=new z,d=new z;return function(m,v,y,b,w){l.subVectors(v,m),c.subVectors(y,m),d.crossVectors(l,c);var A,T=this.direction.dot(d);if(T>0){if(b)return null;A=1}else{if(!(T<0))return null;A=-1,T=-T}s.subVectors(this.origin,m);var R=A*this.direction.dot(c.crossVectors(s,c));if(R<0)return null;var P=A*this.direction.dot(l.cross(s));if(P<0||R+P>T)return null;var L=-A*s.dot(d);return L<0?null:this.at(L/T,w)}}(),applyMatrix4:function(s){return this.direction.add(this.origin).applyMatrix4(s),this.origin.applyMatrix4(s),this.direction.sub(this.origin),this.direction.normalize(),this},equals:function(s){return s.origin.equals(this.origin)&&s.direction.equals(this.direction)}},jo.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],jo.DefaultOrder="XYZ",jo.prototype={constructor:jo,isEuler:!0,get x(){return this._x},set x(s){this._x=s,this.onChangeCallback()},get y(){return this._y},set y(s){this._y=s,this.onChangeCallback()},get z(){return this._z},set z(s){this._z=s,this.onChangeCallback()},get order(){return this._order},set order(s){this._order=s,this.onChangeCallback()},set:function(s,l,c,d){return this._x=s,this._y=l,this._z=c,this._order=d||this._order,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(s){return this._x=s._x,this._y=s._y,this._z=s._z,this._order=s._order,this.onChangeCallback(),this},setFromRotationMatrix:function(s,l,c){var d=dn.clamp,p=s.elements,m=p[0],v=p[4],y=p[8],b=p[1],w=p[5],T=p[9],A=p[2],R=p[6],P=p[10];return"XYZ"===(l=l||this._order)?(this._y=Math.asin(d(y,-1,1)),Math.abs(y)<.99999?(this._x=Math.atan2(-T,P),this._z=Math.atan2(-v,m)):(this._x=Math.atan2(R,w),this._z=0)):"YXZ"===l?(this._x=Math.asin(-d(T,-1,1)),Math.abs(T)<.99999?(this._y=Math.atan2(y,P),this._z=Math.atan2(b,w)):(this._y=Math.atan2(-A,m),this._z=0)):"ZXY"===l?(this._x=Math.asin(d(R,-1,1)),Math.abs(R)<.99999?(this._y=Math.atan2(-A,P),this._z=Math.atan2(-v,w)):(this._y=0,this._z=Math.atan2(b,m))):"ZYX"===l?(this._y=Math.asin(-d(A,-1,1)),Math.abs(A)<.99999?(this._x=Math.atan2(R,P),this._z=Math.atan2(b,m)):(this._x=0,this._z=Math.atan2(-v,w))):"YZX"===l?(this._z=Math.asin(d(b,-1,1)),Math.abs(b)<.99999?(this._x=Math.atan2(-T,w),this._y=Math.atan2(-A,m)):(this._x=0,this._y=Math.atan2(y,P))):"XZY"===l?(this._z=Math.asin(-d(v,-1,1)),Math.abs(v)<.99999?(this._x=Math.atan2(R,w),this._y=Math.atan2(y,m)):(this._x=Math.atan2(-T,P),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+l),this._order=l,!1!==c&&this.onChangeCallback(),this},setFromQuaternion:function(){var s;return function(c,d,p){return void 0===s&&(s=new Wt),s.makeRotationFromQuaternion(c),this.setFromRotationMatrix(s,d,p)}}(),setFromVector3:function(s,l){return this.set(s.x,s.y,s.z,l||this._order)},reorder:function(){var s=new fr;return function(c){return s.setFromEuler(this),this.setFromQuaternion(s,c)}}(),equals:function(s){return s._x===this._x&&s._y===this._y&&s._z===this._z&&s._order===this._order},fromArray:function(s){return this._x=s[0],this._y=s[1],this._z=s[2],void 0!==s[3]&&(this._order=s[3]),this.onChangeCallback(),this},toArray:function(s,l){return void 0===s&&(s=[]),void 0===l&&(l=0),s[l]=this._x,s[l+1]=this._y,s[l+2]=this._z,s[l+3]=this._order,s},toVector3:function(s){return s?s.set(this._x,this._y,this._z):new z(this._x,this._y,this._z)},onChange:function(s){return this.onChangeCallback=s,this},onChangeCallback:function(){}},$o.prototype={constructor:$o,set:function(s){this.mask=1<<s},enable:function(s){this.mask|=1<<s},toggle:function(s){this.mask^=1<<s},disable:function(s){this.mask&=~(1<<s)},test:function(s){return 0!=(this.mask&s.mask)}};var Mf=0;function at(){Object.defineProperty(this,"id",{value:Mf++}),this.uuid=dn.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=at.DefaultUp.clone();var s=new z,l=new jo,c=new fr,d=new z(1,1,1);l.onChange(function p(){c.setFromEuler(l,!1)}),c.onChange(function m(){l.setFromQuaternion(c,void 0,!1)}),Object.defineProperties(this,{position:{enumerable:!0,value:s},rotation:{enumerable:!0,value:l},quaternion:{enumerable:!0,value:c},scale:{enumerable:!0,value:d},modelViewMatrix:{value:new Wt},normalMatrix:{value:new es}}),this.matrix=new Wt,this.matrixWorld=new Wt,this.matrixAutoUpdate=at.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new $o,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={},this.onBeforeRender=function(){},this.onAfterRender=function(){}}function ma(s,l){this.start=void 0!==s?s:new z,this.end=void 0!==l?l:new z}function oo(s,l,c){this.a=void 0!==s?s:new z,this.b=void 0!==l?l:new z,this.c=void 0!==c?c:new z}function zs(s,l,c,d,p,m){this.a=s,this.b=l,this.c=c,this.normal=d&&d.isVector3?d:new z,this.vertexNormals=Array.isArray(d)?d:[],this.color=p&&p.isColor?p:new Tt,this.vertexColors=Array.isArray(p)?p:[],this.materialIndex=void 0!==m?m:0}function Hs(s){wn.call(this),this.type="MeshBasicMaterial",this.color=new Tt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Yd,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.lights=!1,this.setValues(s)}function lt(s,l,c){if(Array.isArray(s))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.uuid=dn.generateUUID(),this.array=s,this.itemSize=l,this.count=void 0!==s?s.length/l:0,this.normalized=!0===c,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.onUploadCallback=function(){},this.version=0}function bh(s,l){lt.call(this,new Int8Array(s),l)}function wf(s,l){lt.call(this,new Uint8Array(s),l)}function bf(s,l){lt.call(this,new Uint8ClampedArray(s),l)}function Ef(s,l){lt.call(this,new Int16Array(s),l)}function Ja(s,l){lt.call(this,new Uint16Array(s),l)}function Sf(s,l){lt.call(this,new Int32Array(s),l)}function Ka(s,l){lt.call(this,new Uint32Array(s),l)}function On(s,l){lt.call(this,new Float32Array(s),l)}function Tf(s,l){lt.call(this,new Float64Array(s),l)}function _w(){this.indices=[],this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}function vn(){Object.defineProperty(this,"id",{value:t_()}),this.uuid=dn.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}at.DefaultUp=new z(0,1,0),at.DefaultMatrixAutoUpdate=!0,Object.assign(at.prototype,Tn.prototype,{isObject3D:!0,applyMatrix:function(s){this.matrix.multiplyMatrices(s,this.matrix),this.matrix.decompose(this.position,this.quaternion,this.scale)},setRotationFromAxisAngle:function(s,l){this.quaternion.setFromAxisAngle(s,l)},setRotationFromEuler:function(s){this.quaternion.setFromEuler(s,!0)},setRotationFromMatrix:function(s){this.quaternion.setFromRotationMatrix(s)},setRotationFromQuaternion:function(s){this.quaternion.copy(s)},rotateOnAxis:function(){var s=new fr;return function(c,d){return s.setFromAxisAngle(c,d),this.quaternion.multiply(s),this}}(),rotateX:function(){var s=new z(1,0,0);return function(c){return this.rotateOnAxis(s,c)}}(),rotateY:function(){var s=new z(0,1,0);return function(c){return this.rotateOnAxis(s,c)}}(),rotateZ:function(){var s=new z(0,0,1);return function(c){return this.rotateOnAxis(s,c)}}(),translateOnAxis:function(){var s=new z;return function(c,d){return s.copy(c).applyQuaternion(this.quaternion),this.position.add(s.multiplyScalar(d)),this}}(),translateX:function(){var s=new z(1,0,0);return function(c){return this.translateOnAxis(s,c)}}(),translateY:function(){var s=new z(0,1,0);return function(c){return this.translateOnAxis(s,c)}}(),translateZ:function(){var s=new z(0,0,1);return function(c){return this.translateOnAxis(s,c)}}(),localToWorld:function(s){return s.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var s=new Wt;return function(c){return c.applyMatrix4(s.getInverse(this.matrixWorld))}}(),lookAt:function(){var s=new Wt;return function(c){s.lookAt(c,this.position,this.up),this.quaternion.setFromRotationMatrix(s)}}(),add:function(s){if(arguments.length>1){for(var l=0;l<arguments.length;l++)this.add(arguments[l]);return this}return s===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",s),this):(s&&s.isObject3D?(null!==s.parent&&s.parent.remove(s),s.parent=this,s.dispatchEvent({type:"added"}),this.children.push(s)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",s),this)},remove:function(s){if(arguments.length>1)for(var l=0;l<arguments.length;l++)this.remove(arguments[l]);var c=this.children.indexOf(s);-1!==c&&(s.parent=null,s.dispatchEvent({type:"removed"}),this.children.splice(c,1))},getObjectById:function(s){return this.getObjectByProperty("id",s)},getObjectByName:function(s){return this.getObjectByProperty("name",s)},getObjectByProperty:function(s,l){if(this[s]===l)return this;for(var c=0,d=this.children.length;c<d;c++){var m=this.children[c].getObjectByProperty(s,l);if(void 0!==m)return m}},getWorldPosition:function(s){var l=s||new z;return this.updateMatrixWorld(!0),l.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(){var s=new z,l=new z;return function(d){var p=d||new fr;return this.updateMatrixWorld(!0),this.matrixWorld.decompose(s,p,l),p}}(),getWorldRotation:function(){var s=new fr;return function(c){var d=c||new jo;return this.getWorldQuaternion(s),d.setFromQuaternion(s,this.rotation.order,!1)}}(),getWorldScale:function(){var s=new z,l=new fr;return function(d){var p=d||new z;return this.updateMatrixWorld(!0),this.matrixWorld.decompose(s,l,p),p}}(),getWorldDirection:function(){var s=new fr;return function(c){var d=c||new z;return this.getWorldQuaternion(s),d.set(0,0,1).applyQuaternion(s)}}(),raycast:function(){},traverse:function(s){s(this);for(var l=this.children,c=0,d=l.length;c<d;c++)l[c].traverse(s)},traverseVisible:function(s){if(!1!==this.visible){s(this);for(var l=this.children,c=0,d=l.length;c<d;c++)l[c].traverseVisible(s)}},traverseAncestors:function(s){var l=this.parent;null!==l&&(s(l),l.traverseAncestors(s))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(s){!0===this.matrixAutoUpdate&&this.updateMatrix(),(!0===this.matrixWorldNeedsUpdate||!0===s)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,s=!0);for(var l=this.children,c=0,d=l.length;c<d;c++)l[c].updateMatrixWorld(s)},toJSON:function(s){var l=void 0===s||""===s,c={};l&&(s={geometries:{},materials:{},textures:{},images:{}},c.metadata={version:4.4,type:"Object",generator:"Object3D.toJSON"});var d={};if(d.uuid=this.uuid,d.type=this.type,""!==this.name&&(d.name=this.name),"{}"!==JSON.stringify(this.userData)&&(d.userData=this.userData),!0===this.castShadow&&(d.castShadow=!0),!0===this.receiveShadow&&(d.receiveShadow=!0),!1===this.visible&&(d.visible=!1),d.matrix=this.matrix.toArray(),void 0!==this.geometry&&(void 0===s.geometries[this.geometry.uuid]&&(s.geometries[this.geometry.uuid]=this.geometry.toJSON(s)),d.geometry=this.geometry.uuid),void 0!==this.material&&(void 0===s.materials[this.material.uuid]&&(s.materials[this.material.uuid]=this.material.toJSON(s)),d.material=this.material.uuid),this.children.length>0){d.children=[];for(var p=0;p<this.children.length;p++)d.children.push(this.children[p].toJSON(s).object)}if(l){var m=w(s.geometries),v=w(s.materials),y=w(s.textures),b=w(s.images);m.length>0&&(c.geometries=m),v.length>0&&(c.materials=v),y.length>0&&(c.textures=y),b.length>0&&(c.images=b)}return c.object=d,c;function w(T){var A=[];for(var R in T){var P=T[R];delete P.metadata,A.push(P)}return A}},clone:function(s){return(new this.constructor).copy(this,s)},copy:function(s,l){if(void 0===l&&(l=!0),this.name=s.name,this.up.copy(s.up),this.position.copy(s.position),this.quaternion.copy(s.quaternion),this.scale.copy(s.scale),this.matrix.copy(s.matrix),this.matrixWorld.copy(s.matrixWorld),this.matrixAutoUpdate=s.matrixAutoUpdate,this.matrixWorldNeedsUpdate=s.matrixWorldNeedsUpdate,this.layers.mask=s.layers.mask,this.visible=s.visible,this.castShadow=s.castShadow,this.receiveShadow=s.receiveShadow,this.frustumCulled=s.frustumCulled,this.renderOrder=s.renderOrder,this.userData=JSON.parse(JSON.stringify(s.userData)),!0===l)for(var c=0;c<s.children.length;c++)this.add(s.children[c].clone());return this}}),ma.prototype={constructor:ma,set:function(s,l){return this.start.copy(s),this.end.copy(l),this},clone:function(){return(new this.constructor).copy(this)},copy:function(s){return this.start.copy(s.start),this.end.copy(s.end),this},getCenter:function(s){return(s||new z).addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(s){return(s||new z).subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(s,l){var c=l||new z;return this.delta(c).multiplyScalar(s).add(this.start)},closestPointToPointParameter:function(){var s=new z,l=new z;return function(d,p){s.subVectors(d,this.start),l.subVectors(this.end,this.start);var m=l.dot(l),y=l.dot(s)/m;return p&&(y=dn.clamp(y,0,1)),y}}(),closestPointToPoint:function(s,l,c){var d=this.closestPointToPointParameter(s,l),p=c||new z;return this.delta(p).multiplyScalar(d).add(this.start)},applyMatrix4:function(s){return this.start.applyMatrix4(s),this.end.applyMatrix4(s),this},equals:function(s){return s.start.equals(this.start)&&s.end.equals(this.end)}},oo.normal=function(){var s=new z;return function(c,d,p,m){var v=m||new z;v.subVectors(p,d),s.subVectors(c,d),v.cross(s);var y=v.lengthSq();return y>0?v.multiplyScalar(1/Math.sqrt(y)):v.set(0,0,0)}}(),oo.barycoordFromPoint=function(){var s=new z,l=new z,c=new z;return function(p,m,v,y,b){s.subVectors(y,m),l.subVectors(v,m),c.subVectors(p,m);var w=s.dot(s),T=s.dot(l),A=s.dot(c),R=l.dot(l),P=l.dot(c),L=w*R-T*T,B=b||new z;if(0===L)return B.set(-2,-1,-1);var U=1/L,F=(R*A-T*P)*U,V=(w*P-T*A)*U;return B.set(1-F-V,V,F)}}(),oo.containsPoint=function(){var s=new z;return function(c,d,p,m){var v=oo.barycoordFromPoint(c,d,p,m,s);return v.x>=0&&v.y>=0&&v.x+v.y<=1}}(),oo.prototype={constructor:oo,set:function(s,l,c){return this.a.copy(s),this.b.copy(l),this.c.copy(c),this},setFromPointsAndIndices:function(s,l,c,d){return this.a.copy(s[l]),this.b.copy(s[c]),this.c.copy(s[d]),this},clone:function(){return(new this.constructor).copy(this)},copy:function(s){return this.a.copy(s.a),this.b.copy(s.b),this.c.copy(s.c),this},area:function(){var s=new z,l=new z;return function(){return s.subVectors(this.c,this.b),l.subVectors(this.a,this.b),.5*s.cross(l).length()}}(),midpoint:function(s){return(s||new z).addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(s){return oo.normal(this.a,this.b,this.c,s)},plane:function(s){return(s||new si).setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(s,l){return oo.barycoordFromPoint(s,this.a,this.b,this.c,l)},containsPoint:function(s){return oo.containsPoint(s,this.a,this.b,this.c)},closestPointToPoint:function(){var s,l,c,d;return function(m,v){void 0===s&&(s=new si,l=[new ma,new ma,new ma],c=new z,d=new z);var y=v||new z,b=1/0;if(s.setFromCoplanarPoints(this.a,this.b,this.c),s.projectPoint(m,c),!0===this.containsPoint(c))y.copy(c);else{l[0].set(this.a,this.b),l[1].set(this.b,this.c),l[2].set(this.c,this.a);for(var w=0;w<l.length;w++){l[w].closestPointToPoint(c,!0,d);var T=c.distanceToSquared(d);T<b&&(b=T,y.copy(d))}}return y}}(),equals:function(s){return s.a.equals(this.a)&&s.b.equals(this.b)&&s.c.equals(this.c)}},zs.prototype={constructor:zs,clone:function(){return(new this.constructor).copy(this)},copy:function(s){this.a=s.a,this.b=s.b,this.c=s.c,this.normal.copy(s.normal),this.color.copy(s.color),this.materialIndex=s.materialIndex;for(var l=0,c=s.vertexNormals.length;l<c;l++)this.vertexNormals[l]=s.vertexNormals[l].clone();for(l=0,c=s.vertexColors.length;l<c;l++)this.vertexColors[l]=s.vertexColors[l].clone();return this}},(Hs.prototype=Object.create(wn.prototype)).constructor=Hs,Hs.prototype.isMeshBasicMaterial=!0,Hs.prototype.copy=function(s){return wn.prototype.copy.call(this,s),this.color.copy(s.color),this.map=s.map,this.lightMap=s.lightMap,this.lightMapIntensity=s.lightMapIntensity,this.aoMap=s.aoMap,this.aoMapIntensity=s.aoMapIntensity,this.specularMap=s.specularMap,this.alphaMap=s.alphaMap,this.envMap=s.envMap,this.combine=s.combine,this.reflectivity=s.reflectivity,this.refractionRatio=s.refractionRatio,this.wireframe=s.wireframe,this.wireframeLinewidth=s.wireframeLinewidth,this.wireframeLinecap=s.wireframeLinecap,this.wireframeLinejoin=s.wireframeLinejoin,this.skinning=s.skinning,this.morphTargets=s.morphTargets,this},lt.prototype={constructor:lt,isBufferAttribute:!0,set needsUpdate(s){!0===s&&this.version++},setArray:function(s){if(Array.isArray(s))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.count=void 0!==s?s.length/this.itemSize:0,this.array=s},setDynamic:function(s){return this.dynamic=s,this},copy:function(s){return this.array=new s.array.constructor(s.array),this.itemSize=s.itemSize,this.count=s.count,this.normalized=s.normalized,this.dynamic=s.dynamic,this},copyAt:function(s,l,c){s*=this.itemSize,c*=l.itemSize;for(var d=0,p=this.itemSize;d<p;d++)this.array[s+d]=l.array[c+d];return this},copyArray:function(s){return this.array.set(s),this},copyColorsArray:function(s){for(var l=this.array,c=0,d=0,p=s.length;d<p;d++){var m=s[d];void 0===m&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",d),m=new Tt),l[c++]=m.r,l[c++]=m.g,l[c++]=m.b}return this},copyIndicesArray:function(s){for(var l=this.array,c=0,d=0,p=s.length;d<p;d++){var m=s[d];l[c++]=m.a,l[c++]=m.b,l[c++]=m.c}return this},copyVector2sArray:function(s){for(var l=this.array,c=0,d=0,p=s.length;d<p;d++){var m=s[d];void 0===m&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",d),m=new ut),l[c++]=m.x,l[c++]=m.y}return this},copyVector3sArray:function(s){for(var l=this.array,c=0,d=0,p=s.length;d<p;d++){var m=s[d];void 0===m&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",d),m=new z),l[c++]=m.x,l[c++]=m.y,l[c++]=m.z}return this},copyVector4sArray:function(s){for(var l=this.array,c=0,d=0,p=s.length;d<p;d++){var m=s[d];void 0===m&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",d),m=new ri),l[c++]=m.x,l[c++]=m.y,l[c++]=m.z,l[c++]=m.w}return this},set:function(s,l){return void 0===l&&(l=0),this.array.set(s,l),this},getX:function(s){return this.array[s*this.itemSize]},setX:function(s,l){return this.array[s*this.itemSize]=l,this},getY:function(s){return this.array[s*this.itemSize+1]},setY:function(s,l){return this.array[s*this.itemSize+1]=l,this},getZ:function(s){return this.array[s*this.itemSize+2]},setZ:function(s,l){return this.array[s*this.itemSize+2]=l,this},getW:function(s){return this.array[s*this.itemSize+3]},setW:function(s,l){return this.array[s*this.itemSize+3]=l,this},setXY:function(s,l,c){return this.array[0+(s*=this.itemSize)]=l,this.array[s+1]=c,this},setXYZ:function(s,l,c,d){return this.array[0+(s*=this.itemSize)]=l,this.array[s+1]=c,this.array[s+2]=d,this},setXYZW:function(s,l,c,d,p){return this.array[0+(s*=this.itemSize)]=l,this.array[s+1]=c,this.array[s+2]=d,this.array[s+3]=p,this},onUpload:function(s){return this.onUploadCallback=s,this},clone:function(){return(new this.constructor).copy(this)}},(bh.prototype=Object.create(lt.prototype)).constructor=bh,(wf.prototype=Object.create(lt.prototype)).constructor=wf,(bf.prototype=Object.create(lt.prototype)).constructor=bf,(Ef.prototype=Object.create(lt.prototype)).constructor=Ef,(Ja.prototype=Object.create(lt.prototype)).constructor=Ja,(Sf.prototype=Object.create(lt.prototype)).constructor=Sf,(Ka.prototype=Object.create(lt.prototype)).constructor=Ka,(On.prototype=Object.create(lt.prototype)).constructor=On,(Tf.prototype=Object.create(lt.prototype)).constructor=Tf,Object.assign(_w.prototype,{computeGroups:function(s){for(var l,c=[],d=void 0,p=s.faces,m=0;m<p.length;m++){var v=p[m];v.materialIndex!==d&&(d=v.materialIndex,void 0!==l&&(l.count=3*m-l.start,c.push(l)),l={start:3*m,materialIndex:d})}void 0!==l&&(l.count=3*m-l.start,c.push(l)),this.groups=c},fromGeometry:function(s){var b,l=s.faces,c=s.vertices,d=s.faceVertexUvs,p=d[0]&&d[0].length>0,m=d[1]&&d[1].length>0,v=s.morphTargets,y=v.length;if(y>0){b=[];for(var w=0;w<y;w++)b[w]=[];this.morphTargets.position=b}var R,T=s.morphNormals,A=T.length;if(A>0){for(R=[],w=0;w<A;w++)R[w]=[];this.morphTargets.normal=R}var P=s.skinIndices,L=s.skinWeights,B=P.length===c.length,U=L.length===c.length;for(w=0;w<l.length;w++){var F=l[w];this.vertices.push(c[F.a],c[F.b],c[F.c]);var V=F.vertexNormals;if(3===V.length)this.normals.push(V[0],V[1],V[2]);else{var H=F.normal;this.normals.push(H,H,H)}var ae,J=F.vertexColors;if(3===J.length)this.colors.push(J[0],J[1],J[2]);else{var q=F.color;this.colors.push(q,q,q)}!0===p&&(void 0!==(ae=d[0][w])?this.uvs.push(ae[0],ae[1],ae[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",w),this.uvs.push(new ut,new ut,new ut))),!0===m&&(void 0!==(ae=d[1][w])?this.uvs2.push(ae[0],ae[1],ae[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",w),this.uvs2.push(new ut,new ut,new ut)));for(var se=0;se<y;se++){var le=v[se].vertices;b[se].push(le[F.a],le[F.b],le[F.c])}for(se=0;se<A;se++){var ue=T[se].vertexNormals[w];R[se].push(ue.a,ue.b,ue.c)}B&&this.skinIndices.push(P[F.a],P[F.b],P[F.c]),U&&this.skinWeights.push(L[F.a],L[F.b],L[F.c])}return this.computeGroups(s),this.verticesNeedUpdate=s.verticesNeedUpdate,this.normalsNeedUpdate=s.normalsNeedUpdate,this.colorsNeedUpdate=s.colorsNeedUpdate,this.uvsNeedUpdate=s.uvsNeedUpdate,this.groupsNeedUpdate=s.groupsNeedUpdate,this}}),Object.assign(vn.prototype,Tn.prototype,{isGeometry:!0,applyMatrix:function(s){for(var l=(new es).getNormalMatrix(s),c=0,d=this.vertices.length;c<d;c++)this.vertices[c].applyMatrix4(s);for(c=0,d=this.faces.length;c<d;c++){var m=this.faces[c];m.normal.applyMatrix3(l).normalize();for(var v=0,y=m.vertexNormals.length;v<y;v++)m.vertexNormals[v].applyMatrix3(l).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(){var s;return function(c){return void 0===s&&(s=new Wt),s.makeRotationX(c),this.applyMatrix(s),this}}(),rotateY:function(){var s;return function(c){return void 0===s&&(s=new Wt),s.makeRotationY(c),this.applyMatrix(s),this}}(),rotateZ:function(){var s;return function(c){return void 0===s&&(s=new Wt),s.makeRotationZ(c),this.applyMatrix(s),this}}(),translate:function(){var s;return function(c,d,p){return void 0===s&&(s=new Wt),s.makeTranslation(c,d,p),this.applyMatrix(s),this}}(),scale:function(){var s;return function(c,d,p){return void 0===s&&(s=new Wt),s.makeScale(c,d,p),this.applyMatrix(s),this}}(),lookAt:function(){var s;return function(c){void 0===s&&(s=new at),s.lookAt(c),s.updateMatrix(),this.applyMatrix(s.matrix)}}(),fromBufferGeometry:function(s){var l=this,c=null!==s.index?s.index.array:void 0,d=s.attributes,p=d.position.array,m=void 0!==d.normal?d.normal.array:void 0,v=void 0!==d.color?d.color.array:void 0,y=void 0!==d.uv?d.uv.array:void 0,b=void 0!==d.uv2?d.uv2.array:void 0;void 0!==b&&(this.faceVertexUvs[1]=[]);for(var w=[],T=[],A=[],R=0,P=0;R<p.length;R+=3,P+=2)l.vertices.push(new z(p[R],p[R+1],p[R+2])),void 0!==m&&w.push(new z(m[R],m[R+1],m[R+2])),void 0!==v&&l.colors.push(new Tt(v[R],v[R+1],v[R+2])),void 0!==y&&T.push(new ut(y[P],y[P+1])),void 0!==b&&A.push(new ut(b[P],b[P+1]));function L(J,q,ae,se){var me=new zs(J,q,ae,void 0!==m?[w[J].clone(),w[q].clone(),w[ae].clone()]:[],void 0!==v?[l.colors[J].clone(),l.colors[q].clone(),l.colors[ae].clone()]:[],se);l.faces.push(me),void 0!==y&&l.faceVertexUvs[0].push([T[J].clone(),T[q].clone(),T[ae].clone()]),void 0!==b&&l.faceVertexUvs[1].push([A[J].clone(),A[q].clone(),A[ae].clone()])}if(void 0!==c){var B=s.groups;if(B.length>0)for(R=0;R<B.length;R++)for(var U=B[R],F=U.start,H=(P=F,F+U.count);P<H;P+=3)L(c[P],c[P+1],c[P+2],U.materialIndex);else for(R=0;R<c.length;R+=3)L(c[R],c[R+1],c[R+2])}else for(R=0;R<p.length/3;R+=3)L(R,R+1,R+2);return this.computeFaceNormals(),null!==s.boundingBox&&(this.boundingBox=s.boundingBox.clone()),null!==s.boundingSphere&&(this.boundingSphere=s.boundingSphere.clone()),this},center:function(){this.computeBoundingBox();var s=this.boundingBox.getCenter().negate();return this.translate(s.x,s.y,s.z),s},normalize:function(){this.computeBoundingSphere();var s=this.boundingSphere.center,l=this.boundingSphere.radius,c=0===l?1:1/l,d=new Wt;return d.set(c,0,0,-c*s.x,0,c,0,-c*s.y,0,0,c,-c*s.z,0,0,0,1),this.applyMatrix(d),this},computeFaceNormals:function(){for(var s=new z,l=new z,c=0,d=this.faces.length;c<d;c++){var p=this.faces[c],m=this.vertices[p.a],v=this.vertices[p.b];s.subVectors(this.vertices[p.c],v),l.subVectors(m,v),s.cross(l),s.normalize(),p.normal.copy(s)}},computeVertexNormals:function(s){var l,c,d,p,m,v;for(void 0===s&&(s=!0),v=new Array(this.vertices.length),l=0,c=this.vertices.length;l<c;l++)v[l]=new z;if(s){var y,b,T=new z,A=new z;for(d=0,p=this.faces.length;d<p;d++)y=this.vertices[(m=this.faces[d]).a],T.subVectors(this.vertices[m.c],b=this.vertices[m.b]),A.subVectors(y,b),T.cross(A),v[m.a].add(T),v[m.b].add(T),v[m.c].add(T)}else for(this.computeFaceNormals(),d=0,p=this.faces.length;d<p;d++)v[(m=this.faces[d]).a].add(m.normal),v[m.b].add(m.normal),v[m.c].add(m.normal);for(l=0,c=this.vertices.length;l<c;l++)v[l].normalize();for(d=0,p=this.faces.length;d<p;d++){var R=(m=this.faces[d]).vertexNormals;3===R.length?(R[0].copy(v[m.a]),R[1].copy(v[m.b]),R[2].copy(v[m.c])):(R[0]=v[m.a].clone(),R[1]=v[m.b].clone(),R[2]=v[m.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){var s,l,c;for(this.computeFaceNormals(),s=0,l=this.faces.length;s<l;s++){var d=(c=this.faces[s]).vertexNormals;3===d.length?(d[0].copy(c.normal),d[1].copy(c.normal),d[2].copy(c.normal)):(d[0]=c.normal.clone(),d[1]=c.normal.clone(),d[2]=c.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var s,l,c,d,p;for(c=0,d=this.faces.length;c<d;c++)for((p=this.faces[c]).__originalFaceNormal?p.__originalFaceNormal.copy(p.normal):p.__originalFaceNormal=p.normal.clone(),p.__originalVertexNormals||(p.__originalVertexNormals=[]),s=0,l=p.vertexNormals.length;s<l;s++)p.__originalVertexNormals[s]?p.__originalVertexNormals[s].copy(p.vertexNormals[s]):p.__originalVertexNormals[s]=p.vertexNormals[s].clone();var m=new vn;for(m.faces=this.faces,s=0,l=this.morphTargets.length;s<l;s++){if(!this.morphNormals[s]){this.morphNormals[s]={},this.morphNormals[s].faceNormals=[],this.morphNormals[s].vertexNormals=[];var v=this.morphNormals[s].faceNormals,y=this.morphNormals[s].vertexNormals;for(c=0,d=this.faces.length;c<d;c++)w=new z,T={a:new z,b:new z,c:new z},v.push(w),y.push(T)}var w,T,b=this.morphNormals[s];for(m.vertices=this.morphTargets[s].vertices,m.computeFaceNormals(),m.computeVertexNormals(),c=0,d=this.faces.length;c<d;c++)T=b.vertexNormals[c],(w=b.faceNormals[c]).copy((p=this.faces[c]).normal),T.a.copy(p.vertexNormals[0]),T.b.copy(p.vertexNormals[1]),T.c.copy(p.vertexNormals[2])}for(c=0,d=this.faces.length;c<d;c++)(p=this.faces[c]).normal=p.__originalFaceNormal,p.vertexNormals=p.__originalVertexNormals},computeLineDistances:function(){for(var s=0,l=this.vertices,c=0,d=l.length;c<d;c++)c>0&&(s+=l[c].distanceTo(l[c-1])),this.lineDistances[c]=s},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Vs),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new or),this.boundingSphere.setFromPoints(this.vertices)},merge:function(s,l,c){if(!1!==(s&&s.isGeometry)){var d,p=this.vertices.length,m=this.vertices,v=s.vertices,y=this.faces,b=s.faces,w=this.faceVertexUvs[0],T=s.faceVertexUvs[0],A=this.colors,R=s.colors;void 0===c&&(c=0),void 0!==l&&(d=(new es).getNormalMatrix(l));for(var P=0,L=v.length;P<L;P++){var U=v[P].clone();void 0!==l&&U.applyMatrix4(l),m.push(U)}for(P=0,L=R.length;P<L;P++)A.push(R[P].clone());for(P=0,L=b.length;P<L;P++){var V,H,F=b[P],q=F.vertexNormals,ae=F.vertexColors;(V=new zs(F.a+p,F.b+p,F.c+p)).normal.copy(F.normal),void 0!==d&&V.normal.applyMatrix3(d).normalize();for(var se=0,le=q.length;se<le;se++)H=q[se].clone(),void 0!==d&&H.applyMatrix3(d).normalize(),V.vertexNormals.push(H);for(V.color.copy(F.color),se=0,le=ae.length;se<le;se++)V.vertexColors.push(ae[se].clone());V.materialIndex=F.materialIndex+c,y.push(V)}for(P=0,L=T.length;P<L;P++){var ue=T[P],me=[];if(void 0!==ue){for(se=0,le=ue.length;se<le;se++)me.push(ue[se].clone());w.push(me)}}}else console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",s)},mergeMesh:function(s){!1!==(s&&s.isMesh)?(s.matrixAutoUpdate&&s.updateMatrix(),this.merge(s.geometry,s.matrix)):console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",s)},mergeVertices:function(){var d,p,y,b,w,T,A,R,s={},l=[],c=[],v=Math.pow(10,4);for(y=0,b=this.vertices.length;y<b;y++)d=this.vertices[y],void 0===s[p=Math.round(d.x*v)+"_"+Math.round(d.y*v)+"_"+Math.round(d.z*v)]?(s[p]=y,l.push(this.vertices[y]),c[y]=l.length-1):c[y]=c[s[p]];var P=[];for(y=0,b=this.faces.length;y<b;y++){(w=this.faces[y]).a=c[w.a],w.b=c[w.b],w.c=c[w.c],T=[w.a,w.b,w.c];for(var B=0;B<3;B++)if(T[B]===T[(B+1)%3]){P.push(y);break}}for(y=P.length-1;y>=0;y--){var U=P[y];for(this.faces.splice(U,1),A=0,R=this.faceVertexUvs.length;A<R;A++)this.faceVertexUvs[A].splice(U,1)}var F=this.vertices.length-l.length;return this.vertices=l,F},sortFacesByMaterialIndex:function(){for(var s=this.faces,l=s.length,c=0;c<l;c++)s[c]._id=c;s.sort(function d(w,T){return w.materialIndex-T.materialIndex});var v,y,p=this.faceVertexUvs[0],m=this.faceVertexUvs[1];for(p&&p.length===l&&(v=[]),m&&m.length===l&&(y=[]),c=0;c<l;c++){var b=s[c]._id;v&&v.push(p[b]),y&&y.push(m[b])}v&&(this.faceVertexUvs[0]=v),y&&(this.faceVertexUvs[1]=y)},toJSON:function(){var s={metadata:{version:4.4,type:"Geometry",generator:"Geometry.toJSON"}};if(s.uuid=this.uuid,s.type=this.type,""!==this.name&&(s.name=this.name),void 0!==this.parameters){var l=this.parameters;for(var c in l)void 0!==l[c]&&(s[c]=l[c]);return s}for(var d=[],p=0;p<this.vertices.length;p++){var m=this.vertices[p];d.push(m.x,m.y,m.z)}var v=[],y=[],b={},w=[],T={},A=[],R={};for(p=0;p<this.faces.length;p++){var P=this.faces[p],U=void 0!==this.faceVertexUvs[0][p],F=P.normal.length()>0,V=P.vertexNormals.length>0,H=1!==P.color.r||1!==P.color.g||1!==P.color.b,J=P.vertexColors.length>0,q=0;if(q=ue(q,0,0),q=ue(q,1,!0),q=ue(q,2,!1),q=ue(q,3,U),q=ue(q,4,F),q=ue(q,5,V),q=ue(q,6,H),q=ue(q,7,J),v.push(q),v.push(P.a,P.b,P.c),v.push(P.materialIndex),U){var ae=this.faceVertexUvs[0][p];v.push(Ie(ae[0]),Ie(ae[1]),Ie(ae[2]))}if(F&&v.push(me(P.normal)),V){var se=P.vertexNormals;v.push(me(se[0]),me(se[1]),me(se[2]))}if(H&&v.push(Fe(P.color)),J){var le=P.vertexColors;v.push(Fe(le[0]),Fe(le[1]),Fe(le[2]))}}function ue(Z,ee,ve){return ve?Z|1<<ee:Z&~(1<<ee)}function me(Z){var ee=Z.x.toString()+Z.y.toString()+Z.z.toString();return void 0!==b[ee]||(b[ee]=y.length/3,y.push(Z.x,Z.y,Z.z)),b[ee]}function Fe(Z){var ee=Z.r.toString()+Z.g.toString()+Z.b.toString();return void 0!==T[ee]||(T[ee]=w.length,w.push(Z.getHex())),T[ee]}function Ie(Z){var ee=Z.x.toString()+Z.y.toString();return void 0!==R[ee]||(R[ee]=A.length/2,A.push(Z.x,Z.y)),R[ee]}return s.data={},s.data.vertices=d,s.data.normals=y,w.length>0&&(s.data.colors=w),A.length>0&&(s.data.uvs=[A]),s.data.faces=v,s},clone:function(){return(new vn).copy(this)},copy:function(s){this.vertices=[],this.faces=[],this.faceVertexUvs=[[]],this.colors=[];for(var l=s.vertices,c=0,d=l.length;c<d;c++)this.vertices.push(l[c].clone());var p=s.colors;for(c=0,d=p.length;c<d;c++)this.colors.push(p[c].clone());var m=s.faces;for(c=0,d=m.length;c<d;c++)this.faces.push(m[c].clone());for(c=0,d=s.faceVertexUvs.length;c<d;c++){var v=s.faceVertexUvs[c];void 0===this.faceVertexUvs[c]&&(this.faceVertexUvs[c]=[]);for(var y=0,b=v.length;y<b;y++){for(var w=v[y],T=[],A=0,R=w.length;A<R;A++)T.push(w[A].clone());this.faceVertexUvs[c].push(T)}}return this},dispose:function(){this.dispatchEvent({type:"dispose"})}});var IA=0;function t_(){return IA++}function kt(){Object.defineProperty(this,"id",{value:t_()}),this.uuid=dn.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0}}function br(s,l){at.call(this),this.type="Mesh",this.geometry=void 0!==s?s:new kt,this.material=void 0!==l?l:new Hs({color:16777215*Math.random()}),this.drawMode=ag,this.updateMorphTargets()}function zc(s,l,c,d,p,m){kt.call(this),this.type="BoxBufferGeometry",this.parameters={width:s,height:l,depth:c,widthSegments:d,heightSegments:p,depthSegments:m};var v=this,y=function V(q,ae,se){var le=0;return le+=(q+1)*(ae+1)*2,(le+=(q+1)*(se+1)*2)+(se+1)*(ae+1)*2}(d=Math.floor(d)||1,p=Math.floor(p)||1,m=Math.floor(m)||1),b=function H(q,ae,se){var le=0;return le+=q*ae*2,6*((le+=q*se*2)+se*ae*2)}(d,p,m),w=new(b>65535?Uint32Array:Uint16Array)(b),T=new Float32Array(3*y),A=new Float32Array(3*y),R=new Float32Array(2*y),P=0,L=0,B=0,U=0,F=0;function J(q,ae,se,le,ue,me,Fe,Ie,Z,ee,ve){for(var Te=me/Z,Oe=Fe/ee,Le=me/2,Ne=Fe/2,Qe=Ie/2,Ye=Z+1,He=ee+1,ye=0,Ge=0,tt=new z,Je=0;Je<He;Je++)for(var Lt=Je*Oe-Ne,At=0;At<Ye;At++)tt[q]=(At*Te-Le)*le,tt[ae]=Lt*ue,tt[se]=Qe,T[P]=tt.x,T[P+1]=tt.y,T[P+2]=tt.z,tt[q]=0,tt[ae]=0,tt[se]=Ie>0?1:-1,A[P]=tt.x,A[P+1]=tt.y,A[P+2]=tt.z,R[L]=At/Z,R[L+1]=1-Je/ee,P+=3,L+=2,ye+=1;for(Je=0;Je<ee;Je++)for(At=0;At<Z;At++){var de=U+At+Ye*(Je+1),oi=U+(At+1)+Ye*(Je+1),Gt=U+(At+1)+Ye*Je;w[B]=U+At+Ye*Je,w[B+1]=de,w[B+2]=Gt,w[B+3]=de,w[B+4]=oi,w[B+5]=Gt,B+=6,Ge+=6}v.addGroup(F,Ge,ve),F+=Ge,U+=ye}J("z","y","x",-1,-1,c,l,s,m,p,0),J("z","y","x",1,-1,c,l,-s,m,p,1),J("x","z","y",1,1,s,c,l,d,m,2),J("x","z","y",1,-1,s,c,-l,d,m,3),J("x","y","z",1,-1,s,l,c,d,p,4),J("x","y","z",-1,-1,s,l,-c,d,p,5),this.setIndex(new lt(w,1)),this.addAttribute("position",new lt(T,3)),this.addAttribute("normal",new lt(A,3)),this.addAttribute("uv",new lt(R,2))}function Hc(s,l,c,d){kt.call(this),this.type="PlaneBufferGeometry",this.parameters={width:s,height:l,widthSegments:c,heightSegments:d};for(var p=s/2,m=l/2,v=Math.floor(c)||1,y=Math.floor(d)||1,b=v+1,w=y+1,T=s/v,A=l/y,R=new Float32Array(b*w*3),P=new Float32Array(b*w*3),L=new Float32Array(b*w*2),B=0,U=0,F=0;F<w;F++)for(var V=F*A-m,H=0;H<b;H++)R[B]=H*T-p,R[B+1]=-V,P[B+2]=1,L[U]=H/v,L[U+1]=1-F/y,B+=3,U+=2;B=0;var q=new(R.length/3>65535?Uint32Array:Uint16Array)(v*y*6);for(F=0;F<y;F++)for(H=0;H<v;H++){var se=H+b*(F+1),le=H+1+b*(F+1),ue=H+1+b*F;q[B]=H+b*F,q[B+1]=se,q[B+2]=ue,q[B+3]=se,q[B+4]=le,q[B+5]=ue,B+=6}this.setIndex(new lt(q,1)),this.addAttribute("position",new lt(R,3)),this.addAttribute("normal",new lt(P,3)),this.addAttribute("uv",new lt(L,2))}function us(){at.call(this),this.type="Camera",this.matrixWorldInverse=new Wt,this.projectionMatrix=new Wt}function Zi(s,l,c,d){us.call(this),this.type="PerspectiveCamera",this.fov=void 0!==s?s:50,this.zoom=1,this.near=void 0!==c?c:.1,this.far=void 0!==d?d:2e3,this.focus=10,this.aspect=void 0!==l?l:1,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}function Gs(s,l,c,d,p,m){us.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=s,this.right=l,this.top=c,this.bottom=d,this.near=void 0!==p?p:.1,this.far=void 0!==m?m:2e3,this.updateProjectionMatrix()}function PA(s,l,c){var d,m,v;return{setMode:function p(T){d=T},setIndex:function y(T){T.array instanceof Uint32Array&&l.get("OES_element_index_uint")?(m=s.UNSIGNED_INT,v=4):T.array instanceof Uint16Array?(m=s.UNSIGNED_SHORT,v=2):(m=s.UNSIGNED_BYTE,v=1)},render:function b(T,A){s.drawElements(d,A,m,T*v),c.calls++,c.vertices+=A,d===s.TRIANGLES&&(c.faces+=A/3)},renderInstances:function w(T,A,R){var P=l.get("ANGLE_instanced_arrays");null!==P?(P.drawElementsInstancedANGLE(d,R,m,A*v,T.maxInstancedCount),c.calls++,c.vertices+=R*T.maxInstancedCount,d===s.TRIANGLES&&(c.faces+=T.maxInstancedCount*R/3)):console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.")}}}function LA(s,l,c){var d;return{setMode:function p(y){d=y},render:function m(y,b){s.drawArrays(d,y,b),c.calls++,c.vertices+=b,d===s.TRIANGLES&&(c.faces+=b/3)},renderInstances:function v(y){var b=l.get("ANGLE_instanced_arrays");if(null!==b){var w=y.attributes.position,T=0;b.drawArraysInstancedANGLE(d,0,T=w.isInterleavedBufferAttribute?w.data.count:w.count,y.maxInstancedCount),c.calls++,c.vertices+=T*y.maxInstancedCount,d===s.TRIANGLES&&(c.faces+=y.maxInstancedCount*T/3)}else console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.")}}}function Vr(){var s={};return{get:function(l){if(void 0!==s[l.id])return s[l.id];var c;switch(l.type){case"DirectionalLight":c={direction:new z,color:new Tt,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new ut};break;case"SpotLight":c={position:new z,direction:new z,color:new Tt,distance:0,coneCos:0,penumbraCos:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new ut};break;case"PointLight":c={position:new z,color:new Tt,distance:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new ut};break;case"HemisphereLight":c={direction:new z,skyColor:new Tt,groundColor:new Tt};break;case"RectAreaLight":c={color:new Tt,position:new z,halfWidth:new z,halfHeight:new z}}return s[l.id]=c,c}}}function Ws(s,l,c){var d=s.createShader(l);return s.shaderSource(d,c),s.compileShader(d),!1===s.getShaderParameter(d,s.COMPILE_STATUS)&&console.error("THREE.WebGLShader: Shader couldn't compile."),""!==s.getShaderInfoLog(d)&&console.warn("THREE.WebGLShader: gl.getShaderInfoLog()",l===s.VERTEX_SHADER?"vertex":"fragment",s.getShaderInfoLog(d),function Cf(s){for(var l=s.split("\n"),c=0;c<l.length;c++)l[c]=c+1+": "+l[c];return l.join("\n")}(c)),d}Object.assign(kt.prototype,Tn.prototype,{isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(s){this.index=s},addAttribute:function(s,l){return!1===(l&&l.isBufferAttribute)&&!1===(l&&l.isInterleavedBufferAttribute)?(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),void this.addAttribute(s,new lt(arguments[1],arguments[2]))):"index"===s?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),void this.setIndex(l)):(this.attributes[s]=l,this)},getAttribute:function(s){return this.attributes[s]},removeAttribute:function(s){return delete this.attributes[s],this},addGroup:function(s,l,c){this.groups.push({start:s,count:l,materialIndex:void 0!==c?c:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(s,l){this.drawRange.start=s,this.drawRange.count=l},applyMatrix:function(s){var l=this.attributes.position;void 0!==l&&(s.applyToVector3Array(l.array),l.needsUpdate=!0);var c=this.attributes.normal;return void 0!==c&&((new es).getNormalMatrix(s).applyToVector3Array(c.array),c.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(){var s;return function(c){return void 0===s&&(s=new Wt),s.makeRotationX(c),this.applyMatrix(s),this}}(),rotateY:function(){var s;return function(c){return void 0===s&&(s=new Wt),s.makeRotationY(c),this.applyMatrix(s),this}}(),rotateZ:function(){var s;return function(c){return void 0===s&&(s=new Wt),s.makeRotationZ(c),this.applyMatrix(s),this}}(),translate:function(){var s;return function(c,d,p){return void 0===s&&(s=new Wt),s.makeTranslation(c,d,p),this.applyMatrix(s),this}}(),scale:function(){var s;return function(c,d,p){return void 0===s&&(s=new Wt),s.makeScale(c,d,p),this.applyMatrix(s),this}}(),lookAt:function(){var s;return function(c){void 0===s&&(s=new at),s.lookAt(c),s.updateMatrix(),this.applyMatrix(s.matrix)}}(),center:function(){this.computeBoundingBox();var s=this.boundingBox.getCenter().negate();return this.translate(s.x,s.y,s.z),s},setFromObject:function(s){var l=s.geometry;if(s.isPoints||s.isLine){var c=new On(3*l.vertices.length,3),d=new On(3*l.colors.length,3);if(this.addAttribute("position",c.copyVector3sArray(l.vertices)),this.addAttribute("color",d.copyColorsArray(l.colors)),l.lineDistances&&l.lineDistances.length===l.vertices.length){var p=new On(l.lineDistances.length,1);this.addAttribute("lineDistance",p.copyArray(l.lineDistances))}null!==l.boundingSphere&&(this.boundingSphere=l.boundingSphere.clone()),null!==l.boundingBox&&(this.boundingBox=l.boundingBox.clone())}else s.isMesh&&l&&l.isGeometry&&this.fromGeometry(l);return this},updateFromObject:function(s){var d,l=s.geometry;if(s.isMesh){var c=l.__directGeometry;if(!0===l.elementsNeedUpdate&&(c=void 0,l.elementsNeedUpdate=!1),void 0===c)return this.fromGeometry(l);c.verticesNeedUpdate=l.verticesNeedUpdate,c.normalsNeedUpdate=l.normalsNeedUpdate,c.colorsNeedUpdate=l.colorsNeedUpdate,c.uvsNeedUpdate=l.uvsNeedUpdate,c.groupsNeedUpdate=l.groupsNeedUpdate,l.verticesNeedUpdate=!1,l.normalsNeedUpdate=!1,l.colorsNeedUpdate=!1,l.uvsNeedUpdate=!1,l.groupsNeedUpdate=!1,l=c}return!0===l.verticesNeedUpdate&&(void 0!==(d=this.attributes.position)&&(d.copyVector3sArray(l.vertices),d.needsUpdate=!0),l.verticesNeedUpdate=!1),!0===l.normalsNeedUpdate&&(void 0!==(d=this.attributes.normal)&&(d.copyVector3sArray(l.normals),d.needsUpdate=!0),l.normalsNeedUpdate=!1),!0===l.colorsNeedUpdate&&(void 0!==(d=this.attributes.color)&&(d.copyColorsArray(l.colors),d.needsUpdate=!0),l.colorsNeedUpdate=!1),l.uvsNeedUpdate&&(void 0!==(d=this.attributes.uv)&&(d.copyVector2sArray(l.uvs),d.needsUpdate=!0),l.uvsNeedUpdate=!1),l.lineDistancesNeedUpdate&&(void 0!==(d=this.attributes.lineDistance)&&(d.copyArray(l.lineDistances),d.needsUpdate=!0),l.lineDistancesNeedUpdate=!1),l.groupsNeedUpdate&&(l.computeGroups(s.geometry),this.groups=l.groups,l.groupsNeedUpdate=!1),this},fromGeometry:function(s){return s.__directGeometry=(new _w).fromGeometry(s),this.fromDirectGeometry(s.__directGeometry)},fromDirectGeometry:function(s){var l=new Float32Array(3*s.vertices.length);if(this.addAttribute("position",new lt(l,3).copyVector3sArray(s.vertices)),s.normals.length>0){var c=new Float32Array(3*s.normals.length);this.addAttribute("normal",new lt(c,3).copyVector3sArray(s.normals))}if(s.colors.length>0){var d=new Float32Array(3*s.colors.length);this.addAttribute("color",new lt(d,3).copyColorsArray(s.colors))}if(s.uvs.length>0){var p=new Float32Array(2*s.uvs.length);this.addAttribute("uv",new lt(p,2).copyVector2sArray(s.uvs))}if(s.uvs2.length>0){var m=new Float32Array(2*s.uvs2.length);this.addAttribute("uv2",new lt(m,2).copyVector2sArray(s.uvs2))}if(s.indices.length>0){var y=new(s.vertices.length>65535?Uint32Array:Uint16Array)(3*s.indices.length);this.setIndex(new lt(y,1).copyIndicesArray(s.indices))}for(var b in this.groups=s.groups,s.morphTargets){for(var w=[],T=s.morphTargets[b],A=0,R=T.length;A<R;A++){var P=T[A],L=new On(3*P.length,3);w.push(L.copyVector3sArray(P))}this.morphAttributes[b]=w}if(s.skinIndices.length>0){var B=new On(4*s.skinIndices.length,4);this.addAttribute("skinIndex",B.copyVector4sArray(s.skinIndices))}if(s.skinWeights.length>0){var U=new On(4*s.skinWeights.length,4);this.addAttribute("skinWeight",U.copyVector4sArray(s.skinWeights))}return null!==s.boundingSphere&&(this.boundingSphere=s.boundingSphere.clone()),null!==s.boundingBox&&(this.boundingBox=s.boundingBox.clone()),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Vs);var s=this.attributes.position;void 0!==s?this.boundingBox.setFromBufferAttribute(s):this.boundingBox.makeEmpty(),(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){var s=new Vs,l=new z;return function(){null===this.boundingSphere&&(this.boundingSphere=new or);var d=this.attributes.position;if(d){var p=this.boundingSphere.center;s.setFromBufferAttribute(d),s.getCenter(p);for(var m=0,v=0,y=d.count;v<y;v++)l.x=d.getX(v),l.y=d.getY(v),l.z=d.getZ(v),m=Math.max(m,p.distanceToSquared(l));this.boundingSphere.radius=Math.sqrt(m),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){var s=this.index,l=this.attributes,c=this.groups;if(l.position){var d=l.position.array;if(void 0===l.normal)this.addAttribute("normal",new lt(new Float32Array(d.length),3));else for(var p=l.normal.array,m=0,v=p.length;m<v;m++)p[m]=0;var b,w,T,y=l.normal.array,A=new z,R=new z,P=new z,L=new z,B=new z;if(s){var U=s.array;0===c.length&&this.addGroup(0,U.length);for(var F=0,V=c.length;F<V;++F){var H=c[F],J=H.start;for(m=J,v=J+H.count;m<v;m+=3)w=3*U[m+1],T=3*U[m+2],A.fromArray(d,b=3*U[m+0]),R.fromArray(d,w),P.fromArray(d,T),L.subVectors(P,R),B.subVectors(A,R),L.cross(B),y[b]+=L.x,y[b+1]+=L.y,y[b+2]+=L.z,y[w]+=L.x,y[w+1]+=L.y,y[w+2]+=L.z,y[T]+=L.x,y[T+1]+=L.y,y[T+2]+=L.z}}else for(m=0,v=d.length;m<v;m+=9)A.fromArray(d,m),R.fromArray(d,m+3),P.fromArray(d,m+6),L.subVectors(P,R),B.subVectors(A,R),L.cross(B),y[m]=L.x,y[m+1]=L.y,y[m+2]=L.z,y[m+3]=L.x,y[m+4]=L.y,y[m+5]=L.z,y[m+6]=L.x,y[m+7]=L.y,y[m+8]=L.z;this.normalizeNormals(),l.normal.needsUpdate=!0}},merge:function(s,l){if(!1!==(s&&s.isBufferGeometry)){void 0===l&&(l=0);var c=this.attributes;for(var d in c)if(void 0!==s.attributes[d])for(var m=c[d].array,v=s.attributes[d],y=v.array,w=0,T=v.itemSize*l;w<y.length;w++,T++)m[T]=y[w];return this}console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",s)},normalizeNormals:function(){for(var l,c,d,p,s=this.attributes.normal.array,m=0,v=s.length;m<v;m+=3)l=s[m],c=s[m+1],d=s[m+2],p=1/Math.sqrt(l*l+c*c+d*d),s[m]*=p,s[m+1]*=p,s[m+2]*=p},toNonIndexed:function(){if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;var s=new kt,l=this.index.array,c=this.attributes;for(var d in c){for(var p=c[d],m=p.array,v=p.itemSize,y=new m.constructor(l.length*v),b=0,w=0,T=0,A=l.length;T<A;T++){b=l[T]*v;for(var R=0;R<v;R++)y[w++]=m[b++]}s.addAttribute(d,new lt(y,v))}return s},toJSON:function(){var s={metadata:{version:4.4,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(s.uuid=this.uuid,s.type=this.type,""!==this.name&&(s.name=this.name),void 0!==this.parameters){var l=this.parameters;for(var c in l)void 0!==l[c]&&(s[c]=l[c]);return s}s.data={attributes:{}};var d=this.index;if(null!==d){var p=Array.prototype.slice.call(d.array);s.data.index={type:d.array.constructor.name,array:p}}var m=this.attributes;for(var c in m){var v=m[c];p=Array.prototype.slice.call(v.array),s.data.attributes[c]={itemSize:v.itemSize,type:v.array.constructor.name,array:p,normalized:v.normalized}}var y=this.groups;y.length>0&&(s.data.groups=JSON.parse(JSON.stringify(y)));var b=this.boundingSphere;return null!==b&&(s.data.boundingSphere={center:b.center.toArray(),radius:b.radius}),s},clone:function(){return(new kt).copy(this)},copy:function(s){var l=s.index;null!==l&&this.setIndex(l.clone());var c=s.attributes;for(var d in c)this.addAttribute(d,c[d].clone());for(var m=s.groups,v=0,y=m.length;v<y;v++){var b=m[v];this.addGroup(b.start,b.count,b.materialIndex)}return this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),kt.MaxIndex=65535,br.prototype=Object.assign(Object.create(at.prototype),{constructor:br,isMesh:!0,setDrawMode:function(s){this.drawMode=s},copy:function(s){return at.prototype.copy.call(this,s),this.drawMode=s.drawMode,this},updateMorphTargets:function(){var s=this.geometry.morphTargets;if(void 0!==s&&s.length>0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var l=0,c=s.length;l<c;l++)this.morphTargetInfluences.push(0),this.morphTargetDictionary[s[l].name]=l}},raycast:function(){var s=new Wt,l=new Yi,c=new or,d=new z,p=new z,m=new z,v=new z,y=new z,b=new z,w=new ut,T=new ut,A=new ut,R=new z,P=new z,L=new z;function B(V,H,J,q,ae,se,le){return oo.barycoordFromPoint(V,H,J,q,R),ae.multiplyScalar(R.x),se.multiplyScalar(R.y),le.multiplyScalar(R.z),ae.add(se).add(le),ae.clone()}function U(V,H,J,q,ae,se,le){var me=V.material;if(null===(me.side===ie?J.intersectTriangle(se,ae,q,!0,le):J.intersectTriangle(q,ae,se,me.side!==Nt,le)))return null;L.copy(le),L.applyMatrix4(V.matrixWorld);var Fe=H.ray.origin.distanceTo(L);return Fe<H.near||Fe>H.far?null:{distance:Fe,point:L.clone(),object:V}}function F(V,H,J,q,ae,se,le,ue){d.fromArray(q,3*se),p.fromArray(q,3*le),m.fromArray(q,3*ue);var me=U(V,H,J,d,p,m,P);return me&&(ae&&(w.fromArray(ae,2*se),T.fromArray(ae,2*le),A.fromArray(ae,2*ue),me.uv=B(P,d,p,m,w,T,A)),me.face=new zs(se,le,ue,oo.normal(d,p,m)),me.faceIndex=se),me}return function(H,J){var le,ue,q=this.geometry,ae=this.material,se=this.matrixWorld;if(void 0!==ae&&(null===q.boundingSphere&&q.computeBoundingSphere(),c.copy(q.boundingSphere),c.applyMatrix4(se),!1!==H.ray.intersectsSphere(c)&&(s.getInverse(se),l.copy(H.ray).applyMatrix4(s),null===q.boundingBox||!1!==l.intersectsBox(q.boundingBox))))if(q.isBufferGeometry){var me,Z=q.index,ee=q.attributes,ve=ee.position.array;if(void 0!==ee.uv&&(le=ee.uv.array),null!==Z)for(var Te=Z.array,Oe=0,Le=Te.length;Oe<Le;Oe+=3)(ue=F(this,H,l,ve,le,me=Te[Oe],Te[Oe+1],Te[Oe+2]))&&(ue.faceIndex=Math.floor(Oe/3),J.push(ue));else for(Oe=0,Le=ve.length;Oe<Le;Oe+=9)(ue=F(this,H,l,ve,le,me=Oe/3,me+1,me+2))&&(ue.index=me,J.push(ue))}else if(q.isGeometry){var Ne,Qe,Ye,He=ae&&ae.isMultiMaterial,ye=!0===He?ae.materials:null,Ge=q.vertices,tt=q.faces,Je=q.faceVertexUvs[0];Je.length>0&&(le=Je);for(var Lt=0,At=tt.length;Lt<At;Lt++){var st=tt[Lt],tn=!0===He?ye[st.materialIndex]:ae;if(void 0!==tn){if(Ne=Ge[st.a],Qe=Ge[st.b],Ye=Ge[st.c],!0===tn.morphTargets){var de=q.morphTargets,oi=this.morphTargetInfluences;d.set(0,0,0),p.set(0,0,0),m.set(0,0,0);for(var Gt=0,$n=de.length;Gt<$n;Gt++){var Mt=oi[Gt];if(0!==Mt){var fi=de[Gt].vertices;d.addScaledVector(v.subVectors(fi[st.a],Ne),Mt),p.addScaledVector(y.subVectors(fi[st.b],Qe),Mt),m.addScaledVector(b.subVectors(fi[st.c],Ye),Mt)}}d.add(Ne),p.add(Qe),m.add(Ye),Ne=d,Qe=p,Ye=m}if(ue=U(this,H,l,Ne,Qe,Ye,P)){if(le){var sn=le[Lt];w.copy(sn[0]),T.copy(sn[1]),A.copy(sn[2]),ue.uv=B(P,Ne,Qe,Ye,w,T,A)}ue.face=st,ue.faceIndex=Lt,J.push(ue)}}}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),(zc.prototype=Object.create(kt.prototype)).constructor=zc,(Hc.prototype=Object.create(kt.prototype)).constructor=Hc,(us.prototype=Object.create(at.prototype)).constructor=us,us.prototype.isCamera=!0,us.prototype.getWorldDirection=function(){var s=new fr;return function(c){var d=c||new z;return this.getWorldQuaternion(s),d.set(0,0,-1).applyQuaternion(s)}}(),us.prototype.lookAt=function(){var s=new Wt;return function(c){s.lookAt(this.position,c,this.up),this.quaternion.setFromRotationMatrix(s)}}(),us.prototype.clone=function(){return(new this.constructor).copy(this)},us.prototype.copy=function(s){return at.prototype.copy.call(this,s),this.matrixWorldInverse.copy(s.matrixWorldInverse),this.projectionMatrix.copy(s.projectionMatrix),this},Zi.prototype=Object.assign(Object.create(us.prototype),{constructor:Zi,isPerspectiveCamera:!0,copy:function(s){return us.prototype.copy.call(this,s),this.fov=s.fov,this.zoom=s.zoom,this.near=s.near,this.far=s.far,this.focus=s.focus,this.aspect=s.aspect,this.view=null===s.view?null:Object.assign({},s.view),this.filmGauge=s.filmGauge,this.filmOffset=s.filmOffset,this},setFocalLength:function(s){var l=.5*this.getFilmHeight()/s;this.fov=2*dn.RAD2DEG*Math.atan(l),this.updateProjectionMatrix()},getFocalLength:function(){var s=Math.tan(.5*dn.DEG2RAD*this.fov);return.5*this.getFilmHeight()/s},getEffectiveFOV:function(){return 2*dn.RAD2DEG*Math.atan(Math.tan(.5*dn.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(s,l,c,d,p,m){this.aspect=s/l,this.view={fullWidth:s,fullHeight:l,offsetX:c,offsetY:d,width:p,height:m},this.updateProjectionMatrix()},clearViewOffset:function(){this.view=null,this.updateProjectionMatrix()},updateProjectionMatrix:function(){var s=this.near,l=s*Math.tan(.5*dn.DEG2RAD*this.fov)/this.zoom,c=2*l,d=this.aspect*c,p=-.5*d,m=this.view;if(null!==m){var v=m.fullWidth,y=m.fullHeight;p+=m.offsetX*d/v,l-=m.offsetY*c/y,d*=m.width/v,c*=m.height/y}var b=this.filmOffset;0!==b&&(p+=s*b/this.getFilmWidth()),this.projectionMatrix.makeFrustum(p,p+d,l-c,l,s,this.far)},toJSON:function(s){var l=at.prototype.toJSON.call(this,s);return l.object.fov=this.fov,l.object.zoom=this.zoom,l.object.near=this.near,l.object.far=this.far,l.object.focus=this.focus,l.object.aspect=this.aspect,null!==this.view&&(l.object.view=Object.assign({},this.view)),l.object.filmGauge=this.filmGauge,l.object.filmOffset=this.filmOffset,l}}),Gs.prototype=Object.assign(Object.create(us.prototype),{constructor:Gs,isOrthographicCamera:!0,copy:function(s){return us.prototype.copy.call(this,s),this.left=s.left,this.right=s.right,this.top=s.top,this.bottom=s.bottom,this.near=s.near,this.far=s.far,this.zoom=s.zoom,this.view=null===s.view?null:Object.assign({},s.view),this},setViewOffset:function(s,l,c,d,p,m){this.view={fullWidth:s,fullHeight:l,offsetX:c,offsetY:d,width:p,height:m},this.updateProjectionMatrix()},clearViewOffset:function(){this.view=null,this.updateProjectionMatrix()},updateProjectionMatrix:function(){var s=(this.right-this.left)/(2*this.zoom),l=(this.top-this.bottom)/(2*this.zoom),c=(this.right+this.left)/2,d=(this.top+this.bottom)/2,p=c-s,m=c+s,v=d+l,y=d-l;if(null!==this.view){var b=this.zoom/(this.view.width/this.view.fullWidth),w=this.zoom/(this.view.height/this.view.fullHeight),T=(this.right-this.left)/this.view.width,A=(this.top-this.bottom)/this.view.height;m=(p+=T*(this.view.offsetX/b))+T*(this.view.width/b),y=(v-=A*(this.view.offsetY/w))-A*(this.view.height/w)}this.projectionMatrix.makeOrthographic(p,m,v,y,this.near,this.far)},toJSON:function(s){var l=at.prototype.toJSON.call(this,s);return l.object.zoom=this.zoom,l.object.left=this.left,l.object.right=this.right,l.object.top=this.top,l.object.bottom=this.bottom,l.object.near=this.near,l.object.far=this.far,null!==this.view&&(l.object.view=Object.assign({},this.view)),l}});var n_=0;function yg(s){switch(s){case Jr:return["Linear","( value )"];case on:return["sRGB","( value )"];case cf:return["RGBE","( value )"];case Ry:return["RGBM","( value, 7.0 )"];case Iy:return["RGBM","( value, 16.0 )"];case ni:return["RGBD","( value, 256.0 )"];case lf:return["Gamma","( value, float( GAMMA_FACTOR ) )"];default:throw new Error("unsupported encoding: "+s)}}function Af(s,l){var c=yg(l);return"vec4 "+s+"( vec4 value ) { return "+c[0]+"ToLinear"+c[1]+"; }"}function i_(s,l){var c=yg(l);return"vec4 "+s+"( vec4 value ) { return LinearTo"+c[0]+c[1]+"; }"}function _g(s,l){var c;switch(l){case Jd:c="Linear";break;case wy:c="Reinhard";break;case Kd:c="Uncharted2";break;case by:c="OptimizedCineon";break;default:throw new Error("unsupported toneMapping: "+l)}return"vec3 "+s+"( vec3 color ) { return "+c+"ToneMapping( color ); }"}function Gc(s){return""!==s}function wg(s,l){return s.replace(/NUM_DIR_LIGHTS/g,l.numDirLights).replace(/NUM_SPOT_LIGHTS/g,l.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,l.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,l.numPointLights).replace(/NUM_HEMI_LIGHTS/g,l.numHemiLights)}function Df(s){return s.replace(/#include +<([\w\d.]+)>/g,function c(d,p){var m=Wn[p];if(void 0===m)throw new Error("Can not resolve #include <"+p+">");return Df(m)})}function Eh(s){return s.replace(/for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,function c(d,p,m,v){for(var y="",b=parseInt(p);b<parseInt(m);b++)y+=v.replace(/\[ i \]/g,"[ "+b+" ]");return y})}function Sh(s,l,c,d){var p=s.context,m=c.extensions,v=c.defines,y=c.__webglShader.vertexShader,b=c.__webglShader.fragmentShader,w="SHADOWMAP_TYPE_BASIC";d.shadowMapType===qn?w="SHADOWMAP_TYPE_PCF":d.shadowMapType===Ur&&(w="SHADOWMAP_TYPE_PCF_SOFT");var T="ENVMAP_TYPE_CUBE",A="ENVMAP_MODE_REFLECTION",R="ENVMAP_BLENDING_MULTIPLY";if(d.envMap){switch(c.envMap.mapping){case nh:case Qd:T="ENVMAP_TYPE_CUBE";break;case ih:case tf:T="ENVMAP_TYPE_CUBE_UV";break;case $m:case ef:T="ENVMAP_TYPE_EQUIREC";break;case Vo:T="ENVMAP_TYPE_SPHERE"}switch(c.envMap.mapping){case Qd:case ef:A="ENVMAP_MODE_REFRACTION"}switch(c.combine){case Yd:R="ENVMAP_BLENDING_MULTIPLY";break;case FM:R="ENVMAP_BLENDING_MIX";break;case UM:R="ENVMAP_BLENDING_ADD"}}var F,V,P=s.gammaFactor>0?s.gammaFactor:1,L=function r_(s,l,c){return[(s=s||{}).derivatives||l.envMapCubeUV||l.bumpMap||l.normalMap||l.flatShading?"#extension GL_OES_standard_derivatives : enable":"",(s.fragDepth||l.logarithmicDepthBuffer)&&c.get("EXT_frag_depth")?"#extension GL_EXT_frag_depth : enable":"",s.drawBuffers&&c.get("WEBGL_draw_buffers")?"#extension GL_EXT_draw_buffers : require":"",(s.shaderTextureLOD||l.envMap)&&c.get("EXT_shader_texture_lod")?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Gc).join("\n")}(m,d,s.extensions),B=function xg(s){var l=[];for(var c in s){var d=s[c];!1!==d&&l.push("#define "+c+" "+d)}return l.join("\n")}(v),U=p.createProgram();c.isRawShaderMaterial?(F=[B,"\n"].filter(Gc).join("\n"),V=[L,B,"\n"].filter(Gc).join("\n")):(F=["precision "+d.precision+" float;","precision "+d.precision+" int;","#define SHADER_NAME "+c.__webglShader.name,B,d.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+P,"#define MAX_BONES "+d.maxBones,d.map?"#define USE_MAP":"",d.envMap?"#define USE_ENVMAP":"",d.envMap?"#define "+A:"",d.lightMap?"#define USE_LIGHTMAP":"",d.aoMap?"#define USE_AOMAP":"",d.emissiveMap?"#define USE_EMISSIVEMAP":"",d.bumpMap?"#define USE_BUMPMAP":"",d.normalMap?"#define USE_NORMALMAP":"",d.displacementMap&&d.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",d.specularMap?"#define USE_SPECULARMAP":"",d.roughnessMap?"#define USE_ROUGHNESSMAP":"",d.metalnessMap?"#define USE_METALNESSMAP":"",d.alphaMap?"#define USE_ALPHAMAP":"",d.vertexColors?"#define USE_COLOR":"",d.flatShading?"#define FLAT_SHADED":"",d.skinning?"#define USE_SKINNING":"",d.useVertexTexture?"#define BONE_TEXTURE":"",d.morphTargets?"#define USE_MORPHTARGETS":"",d.morphNormals&&!1===d.flatShading?"#define USE_MORPHNORMALS":"",d.doubleSided?"#define DOUBLE_SIDED":"",d.flipSided?"#define FLIP_SIDED":"","#define NUM_CLIPPING_PLANES "+d.numClippingPlanes,d.shadowMapEnabled?"#define USE_SHADOWMAP":"",d.shadowMapEnabled?"#define "+w:"",d.sizeAttenuation?"#define USE_SIZEATTENUATION":"",d.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",d.logarithmicDepthBuffer&&s.extensions.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(Gc).join("\n"),V=[L,"precision "+d.precision+" float;","precision "+d.precision+" int;","#define SHADER_NAME "+c.__webglShader.name,B,d.alphaTest?"#define ALPHATEST "+d.alphaTest:"","#define GAMMA_FACTOR "+P,d.useFog&&d.fog?"#define USE_FOG":"",d.useFog&&d.fogExp?"#define FOG_EXP2":"",d.map?"#define USE_MAP":"",d.envMap?"#define USE_ENVMAP":"",d.envMap?"#define "+T:"",d.envMap?"#define "+A:"",d.envMap?"#define "+R:"",d.lightMap?"#define USE_LIGHTMAP":"",d.aoMap?"#define USE_AOMAP":"",d.emissiveMap?"#define USE_EMISSIVEMAP":"",d.bumpMap?"#define USE_BUMPMAP":"",d.normalMap?"#define USE_NORMALMAP":"",d.specularMap?"#define USE_SPECULARMAP":"",d.roughnessMap?"#define USE_ROUGHNESSMAP":"",d.metalnessMap?"#define USE_METALNESSMAP":"",d.alphaMap?"#define USE_ALPHAMAP":"",d.vertexColors?"#define USE_COLOR":"",d.gradientMap?"#define USE_GRADIENTMAP":"",d.flatShading?"#define FLAT_SHADED":"",d.doubleSided?"#define DOUBLE_SIDED":"",d.flipSided?"#define FLIP_SIDED":"","#define NUM_CLIPPING_PLANES "+d.numClippingPlanes,"#define UNION_CLIPPING_PLANES "+(d.numClippingPlanes-d.numClipIntersection),d.shadowMapEnabled?"#define USE_SHADOWMAP":"",d.shadowMapEnabled?"#define "+w:"",d.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",d.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",d.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",d.logarithmicDepthBuffer&&s.extensions.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"",d.envMap&&s.extensions.get("EXT_shader_texture_lod")?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",d.toneMapping!==Zd?"#define TONE_MAPPING":"",d.toneMapping!==Zd?Wn.tonemapping_pars_fragment:"",d.toneMapping!==Zd?_g("toneMapping",d.toneMapping):"",d.outputEncoding||d.mapEncoding||d.envMapEncoding||d.emissiveMapEncoding?Wn.encodings_pars_fragment:"",d.mapEncoding?Af("mapTexelToLinear",d.mapEncoding):"",d.envMapEncoding?Af("envMapTexelToLinear",d.envMapEncoding):"",d.emissiveMapEncoding?Af("emissiveMapTexelToLinear",d.emissiveMapEncoding):"",d.outputEncoding?i_("linearToOutputTexel",d.outputEncoding):"",d.depthPacking?"#define DEPTH_PACKING "+c.depthPacking:"","\n"].filter(Gc).join("\n")),y=wg(y=Df(y),d),b=wg(b=Df(b),d),c.isShaderMaterial||(y=Eh(y),b=Eh(b));var J=V+b,q=Ws(p,p.VERTEX_SHADER,F+y),ae=Ws(p,p.FRAGMENT_SHADER,J);p.attachShader(U,q),p.attachShader(U,ae),void 0!==c.index0AttributeName?p.bindAttribLocation(U,0,c.index0AttributeName):!0===d.morphTargets&&p.bindAttribLocation(U,0,"position"),p.linkProgram(U);var Ie,Z,se=p.getProgramInfoLog(U),le=p.getShaderInfoLog(q),ue=p.getShaderInfoLog(ae),me=!0,Fe=!0;return!1===p.getProgramParameter(U,p.LINK_STATUS)?(me=!1,console.error("THREE.WebGLProgram: shader error: ",p.getError(),"gl.VALIDATE_STATUS",p.getProgramParameter(U,p.VALIDATE_STATUS),"gl.getProgramInfoLog",se,le,ue)):""!==se?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",se):(""===le||""===ue)&&(Fe=!1),Fe&&(this.diagnostics={runnable:me,material:c,programLog:se,vertexShader:{log:le,prefix:F},fragmentShader:{log:ue,prefix:V}}),p.deleteShader(q),p.deleteShader(ae),this.getUniforms=function(){return void 0===Ie&&(Ie=new ir(p,U,s)),Ie},this.getAttributes=function(){return void 0===Z&&(Z=function Mg(s,l,c){for(var d={},p=s.getProgramParameter(l,s.ACTIVE_ATTRIBUTES),m=0;m<p;m++){var y=s.getActiveAttrib(l,m).name;d[y]=s.getAttribLocation(l,y)}return d}(p,U)),Z},this.destroy=function(){p.deleteProgram(U),this.program=void 0},Object.defineProperties(this,{uniforms:{get:function(){return console.warn("THREE.WebGLProgram: .uniforms is now .getUniforms()."),this.getUniforms()}},attributes:{get:function(){return console.warn("THREE.WebGLProgram: .attributes is now .getAttributes()."),this.getAttributes()}}}),this.id=n_++,this.code=l,this.usedTimes=1,this.program=U,this.vertexShader=q,this.fragmentShader=ae,this}function Wc(s,l){var c=[],d={MeshDepthMaterial:"depth",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"phong",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points"},p=["precision","supportsVertexTextures","map","mapEncoding","envMap","envMapMode","envMapEncoding","lightMap","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","fog","useFog","fogExp","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking"];function v(y,b){var w;return y?y.isTexture?w=y.encoding:y.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),w=y.texture.encoding):w=Jr,w===Jr&&b&&(w=lf),w}this.getParameters=function(y,b,w,T,A,R){var P=d[y.type],L=function m(y){if(l.floatVertexTextures&&y&&y.skeleton&&y.skeleton.useVertexTexture)return 1024;var T=Math.floor((l.maxVertexUniforms-20)/4);return void 0!==y&&y&&y.isSkinnedMesh&&(T=Math.min(y.skeleton.bones.length,T))<y.skeleton.bones.length&&console.warn("WebGLRenderer: too many bones - "+y.skeleton.bones.length+", this GPU supports just "+T+" (try OpenGL instead of ANGLE)"),T}(R),B=s.getPrecision();null!==y.precision&&(B=l.getMaxPrecision(y.precision))!==y.precision&&console.warn("THREE.WebGLProgram.getParameters:",y.precision,"not supported, using",B,"instead.");var U=s.getCurrentRenderTarget();return{shaderID:P,precision:B,supportsVertexTextures:l.vertexTextures,outputEncoding:v(U?U.texture:null,s.gammaOutput),map:!!y.map,mapEncoding:v(y.map,s.gammaInput),envMap:!!y.envMap,envMapMode:y.envMap&&y.envMap.mapping,envMapEncoding:v(y.envMap,s.gammaInput),envMapCubeUV:!!y.envMap&&(y.envMap.mapping===ih||y.envMap.mapping===tf),lightMap:!!y.lightMap,aoMap:!!y.aoMap,emissiveMap:!!y.emissiveMap,emissiveMapEncoding:v(y.emissiveMap,s.gammaInput),bumpMap:!!y.bumpMap,normalMap:!!y.normalMap,displacementMap:!!y.displacementMap,roughnessMap:!!y.roughnessMap,metalnessMap:!!y.metalnessMap,specularMap:!!y.specularMap,alphaMap:!!y.alphaMap,gradientMap:!!y.gradientMap,combine:y.combine,vertexColors:y.vertexColors,fog:!!w,useFog:y.fog,fogExp:w&&w.isFogExp2,flatShading:y.shading===Ms,sizeAttenuation:y.sizeAttenuation,logarithmicDepthBuffer:l.logarithmicDepthBuffer,skinning:y.skinning,maxBones:L,useVertexTexture:l.floatVertexTextures&&R&&R.skeleton&&R.skeleton.useVertexTexture,morphTargets:y.morphTargets,morphNormals:y.morphNormals,maxMorphTargets:s.maxMorphTargets,maxMorphNormals:s.maxMorphNormals,numDirLights:b.directional.length,numPointLights:b.point.length,numSpotLights:b.spot.length,numRectAreaLights:b.rectArea.length,numHemiLights:b.hemi.length,numClippingPlanes:T,numClipIntersection:A,shadowMapEnabled:s.shadowMap.enabled&&R.receiveShadow&&b.shadows.length>0,shadowMapType:s.shadowMap.type,toneMapping:s.toneMapping,physicallyCorrectLights:s.physicallyCorrectLights,premultipliedAlpha:y.premultipliedAlpha,alphaTest:y.alphaTest,doubleSided:y.side===Nt,flipSided:y.side===ie,depthPacking:void 0!==y.depthPacking&&y.depthPacking}},this.getProgramCode=function(y,b){var w=[];if(b.shaderID?w.push(b.shaderID):(w.push(y.fragmentShader),w.push(y.vertexShader)),void 0!==y.defines)for(var T in y.defines)w.push(T),w.push(y.defines[T]);for(var A=0;A<p.length;A++)w.push(b[p[A]]);return w.join()},this.acquireProgram=function(y,b,w){for(var T,A=0,R=c.length;A<R;A++){var P=c[A];if(P.code===w){++(T=P).usedTimes;break}}return void 0===T&&(T=new Sh(s,w,y,b),c.push(T)),T},this.releaseProgram=function(y){if(0==--y.usedTimes){var b=c.indexOf(y);c[b]=c[c.length-1],c.pop(),y.destroy()}},this.programs=c}function s_(s,l,c){var d={};function p(w){var T=w.target,A=d[T.id];null!==A.index&&v(A.index),function y(w){for(var T in w)v(w[T])}(A.attributes),T.removeEventListener("dispose",p),delete d[T.id];var R=l.get(T);R.wireframe&&v(R.wireframe),l.delete(T);var P=l.get(A);P.wireframe&&v(P.wireframe),l.delete(A),c.memory.geometries--}function v(w){var T=function m(w){return w.isInterleavedBufferAttribute?l.get(w.data).__webglBuffer:l.get(w).__webglBuffer}(w);void 0!==T&&(s.deleteBuffer(T),function b(w){l.delete(w.isInterleavedBufferAttribute?w.data:w)}(w))}return{get:function(w){var A,T=w.geometry;return void 0!==d[T.id]?d[T.id]:(T.addEventListener("dispose",p),T.isBufferGeometry?A=T:T.isGeometry&&(void 0===T._bufferGeometry&&(T._bufferGeometry=(new kt).setFromObject(w)),A=T._bufferGeometry),d[T.id]=A,c.memory.geometries++,A)}}}function NA(s,l,c){var d=new s_(s,l,c);function m(A,R){var P=A.isInterleavedBufferAttribute?A.data:A,L=l.get(P);void 0===L.__webglBuffer?function v(A,R,P){A.__webglBuffer=s.createBuffer(),s.bindBuffer(P,A.__webglBuffer),s.bufferData(P,R.array,R.dynamic?s.DYNAMIC_DRAW:s.STATIC_DRAW);var B=s.FLOAT,U=R.array;U instanceof Float32Array?B=s.FLOAT:U instanceof Float64Array?console.warn("Unsupported data buffer format: Float64Array"):U instanceof Uint16Array?B=s.UNSIGNED_SHORT:U instanceof Int16Array?B=s.SHORT:U instanceof Uint32Array?B=s.UNSIGNED_INT:U instanceof Int32Array?B=s.INT:U instanceof Int8Array?B=s.BYTE:U instanceof Uint8Array&&(B=s.UNSIGNED_BYTE),A.bytesPerElement=U.BYTES_PER_ELEMENT,A.type=B,A.version=R.version,R.onUploadCallback()}(L,P,R):L.version!==P.version&&function y(A,R,P){s.bindBuffer(P,A.__webglBuffer),!1===R.dynamic?s.bufferData(P,R.array,s.STATIC_DRAW):-1===R.updateRange.count?s.bufferSubData(P,0,R.array):0===R.updateRange.count?console.error("THREE.WebGLObjects.updateBuffer: dynamic THREE.BufferAttribute marked as needsUpdate but updateRange.count is 0, ensure you are using set methods or updating manually."):(s.bufferSubData(P,R.updateRange.offset*R.array.BYTES_PER_ELEMENT,R.array.subarray(R.updateRange.offset,R.updateRange.offset+R.updateRange.count)),R.updateRange.count=0),A.version=R.version}(L,P,R)}return{getAttributeBuffer:function b(A){return A.isInterleavedBufferAttribute?l.get(A.data).__webglBuffer:l.get(A).__webglBuffer},getAttributeProperties:function w(A){return l.get(A.isInterleavedBufferAttribute?A.data:A)},getWireframeAttribute:function T(A){var R=l.get(A);if(void 0!==R.wireframe)return R.wireframe;var V,P=[],L=A.index,B=A.attributes,U=B.position;if(null!==L)for(var H=0,J=(V=L.array).length;H<J;H+=3)P.push(q=V[H+0],ae=V[H+1],ae,se=V[H+2],se,q);else for(H=0,J=(V=B.position.array).length/3-1;H<J;H+=3){var q,ae,se;P.push(q=H+0,ae=H+1,ae,se=H+2,se,q)}var ue=new lt(new(U.count>65535?Uint32Array:Uint16Array)(P),1);return m(ue,s.ELEMENT_ARRAY_BUFFER),R.wireframe=ue,ue},update:function p(A){var R=d.get(A);A.geometry.isGeometry&&R.updateFromObject(A);var P=R.index,L=R.attributes;for(var B in null!==P&&m(P,s.ELEMENT_ARRAY_BUFFER),L)m(L[B],s.ARRAY_BUFFER);var U=R.morphAttributes;for(var B in U)for(var F=U[B],V=0,H=F.length;V<H;V++)m(F[V],s.ARRAY_BUFFER);return R}}}function OA(s,l,c,d,p,m,v){var y=v.memory,b=typeof WebGL2RenderingContext<"u"&&s instanceof WebGL2RenderingContext;function w(Z,ee){if(Z.width>ee||Z.height>ee){var ve=ee/Math.max(Z.width,Z.height),Te=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return Te.width=Math.floor(Z.width*ve),Te.height=Math.floor(Z.height*ve),Te.getContext("2d").drawImage(Z,0,0,Z.width,Z.height,0,0,Te.width,Te.height),console.warn("THREE.WebGLRenderer: image is too big ("+Z.width+"x"+Z.height+"). Resized to "+Te.width+"x"+Te.height,Z),Te}return Z}function T(Z){return dn.isPowerOfTwo(Z.width)&&dn.isPowerOfTwo(Z.height)}function P(Z){return Z===Us||Z===nf||Z===rf?s.NEAREST:s.LINEAR}function L(Z){var ee=Z.target;ee.removeEventListener("dispose",L),function U(Z){var ee=d.get(Z);if(Z.image&&ee.__image__webglTextureCube)s.deleteTexture(ee.__image__webglTextureCube);else{if(void 0===ee.__webglInit)return;s.deleteTexture(ee.__webglTexture)}d.delete(Z)}(ee),y.textures--}function B(Z){var ee=Z.target;ee.removeEventListener("dispose",B),function F(Z){var ee=d.get(Z),ve=d.get(Z.texture);if(Z){if(void 0!==ve.__webglTexture&&s.deleteTexture(ve.__webglTexture),Z.depthTexture&&Z.depthTexture.dispose(),Z.isWebGLRenderTargetCube)for(var Te=0;Te<6;Te++)s.deleteFramebuffer(ee.__webglFramebuffer[Te]),ee.__webglDepthbuffer&&s.deleteRenderbuffer(ee.__webglDepthbuffer[Te]);else s.deleteFramebuffer(ee.__webglFramebuffer),ee.__webglDepthbuffer&&s.deleteRenderbuffer(ee.__webglDepthbuffer);d.delete(Z.texture),d.delete(Z)}}(ee),y.textures--}function V(Z,ee){var ve=d.get(Z);if(Z.version>0&&ve.__version!==Z.version){var Te=Z.image;if(void 0===Te)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined",Z);else{if(!1!==Te.complete)return void function ae(Z,ee,ve){void 0===Z.__webglInit&&(Z.__webglInit=!0,ee.addEventListener("dispose",L),Z.__webglTexture=s.createTexture(),y.textures++),c.activeTexture(s.TEXTURE0+ve),c.bindTexture(s.TEXTURE_2D,Z.__webglTexture),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,ee.flipY),s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,ee.premultiplyAlpha),s.pixelStorei(s.UNPACK_ALIGNMENT,ee.unpackAlignment);var Te=w(ee.image,p.maxTextureSize);(function R(Z){return Z.wrapS!==Fs||Z.wrapT!==Fs||Z.minFilter!==Us&&Z.minFilter!==ws})(ee)&&!1===T(Te)&&(Te=function A(Z){if(Z instanceof HTMLImageElement||Z instanceof HTMLCanvasElement){var ee=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return ee.width=dn.nearestPowerOfTwo(Z.width),ee.height=dn.nearestPowerOfTwo(Z.height),ee.getContext("2d").drawImage(Z,0,0,ee.width,ee.height),console.warn("THREE.WebGLRenderer: image is not power of two ("+Z.width+"x"+Z.height+"). Resized to "+ee.width+"x"+ee.height,Z),ee}return Z}(Te));var Oe=T(Te),Le=m(ee.format),Ne=m(ee.type);q(s.TEXTURE_2D,ee,Oe);var Qe,Ye=ee.mipmaps;if(ee.isDepthTexture){var He=s.DEPTH_COMPONENT;if(ee.type===Sl){if(!b)throw new Error("Float Depth Texture only supported in WebGL2.0");He=s.DEPTH_COMPONENT32F}else b&&(He=s.DEPTH_COMPONENT16);ee.format===os&&He===s.DEPTH_COMPONENT&&ee.type!==Pc&&ee.type!==Qm&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),ee.type=Pc,Ne=m(ee.type)),ee.format===Nc&&(He=s.DEPTH_STENCIL,ee.type!==ah&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),ee.type=ah,Ne=m(ee.type))),c.texImage2D(s.TEXTURE_2D,0,He,Te.width,Te.height,0,Le,Ne,null)}else if(ee.isDataTexture)if(Ye.length>0&&Oe){for(var ye=0,Ge=Ye.length;ye<Ge;ye++)c.texImage2D(s.TEXTURE_2D,ye,Le,(Qe=Ye[ye]).width,Qe.height,0,Le,Ne,Qe.data);ee.generateMipmaps=!1}else c.texImage2D(s.TEXTURE_2D,0,Le,Te.width,Te.height,0,Le,Ne,Te.data);else if(ee.isCompressedTexture)for(ye=0,Ge=Ye.length;ye<Ge;ye++)Qe=Ye[ye],ee.format!==zo&&ee.format!==Lc?c.getCompressedTextureFormats().indexOf(Le)>-1?c.compressedTexImage2D(s.TEXTURE_2D,ye,Le,Qe.width,Qe.height,0,Qe.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):c.texImage2D(s.TEXTURE_2D,ye,Le,Qe.width,Qe.height,0,Le,Ne,Qe.data);else if(Ye.length>0&&Oe){for(ye=0,Ge=Ye.length;ye<Ge;ye++)c.texImage2D(s.TEXTURE_2D,ye,Le,Le,Ne,Qe=Ye[ye]);ee.generateMipmaps=!1}else c.texImage2D(s.TEXTURE_2D,0,Le,Le,Ne,Te);ee.generateMipmaps&&Oe&&s.generateMipmap(s.TEXTURE_2D),Z.__version=ee.version,ee.onUpdate&&ee.onUpdate(ee)}(ve,Z,ee);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete",Z)}}c.activeTexture(s.TEXTURE0+ee),c.bindTexture(s.TEXTURE_2D,ve.__webglTexture)}function q(Z,ee,ve){var Te;if(ve?(s.texParameteri(Z,s.TEXTURE_WRAP_S,m(ee.wrapS)),s.texParameteri(Z,s.TEXTURE_WRAP_T,m(ee.wrapT)),s.texParameteri(Z,s.TEXTURE_MAG_FILTER,m(ee.magFilter)),s.texParameteri(Z,s.TEXTURE_MIN_FILTER,m(ee.minFilter))):(s.texParameteri(Z,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(Z,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),(ee.wrapS!==Fs||ee.wrapT!==Fs)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping.",ee),s.texParameteri(Z,s.TEXTURE_MAG_FILTER,P(ee.magFilter)),s.texParameteri(Z,s.TEXTURE_MIN_FILTER,P(ee.minFilter)),ee.minFilter!==Us&&ee.minFilter!==ws&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.",ee)),Te=l.get("EXT_texture_filter_anisotropic")){if(ee.type===Sl&&null===l.get("OES_texture_float_linear")||ee.type===oh&&null===l.get("OES_texture_half_float_linear"))return;(ee.anisotropy>1||d.get(ee).__currentAnisotropy)&&(s.texParameterf(Z,Te.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(ee.anisotropy,p.getMaxAnisotropy())),d.get(ee).__currentAnisotropy=ee.anisotropy)}}function se(Z,ee,ve,Te){var Oe=m(ee.texture.format),Le=m(ee.texture.type);c.texImage2D(Te,0,Oe,ee.width,ee.height,0,Oe,Le,null),s.bindFramebuffer(s.FRAMEBUFFER,Z),s.framebufferTexture2D(s.FRAMEBUFFER,ve,Te,d.get(ee.texture).__webglTexture,0),s.bindFramebuffer(s.FRAMEBUFFER,null)}function le(Z,ee){s.bindRenderbuffer(s.RENDERBUFFER,Z),ee.depthBuffer&&!ee.stencilBuffer?(s.renderbufferStorage(s.RENDERBUFFER,s.DEPTH_COMPONENT16,ee.width,ee.height),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.RENDERBUFFER,Z)):ee.depthBuffer&&ee.stencilBuffer?(s.renderbufferStorage(s.RENDERBUFFER,s.DEPTH_STENCIL,ee.width,ee.height),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.RENDERBUFFER,Z)):s.renderbufferStorage(s.RENDERBUFFER,s.RGBA4,ee.width,ee.height),s.bindRenderbuffer(s.RENDERBUFFER,null)}this.setTexture2D=V,this.setTextureCube=function H(Z,ee){var ve=d.get(Z);if(6===Z.image.length)if(Z.version>0&&ve.__version!==Z.version){ve.__image__webglTextureCube||(Z.addEventListener("dispose",L),ve.__image__webglTextureCube=s.createTexture(),y.textures++),c.activeTexture(s.TEXTURE0+ee),c.bindTexture(s.TEXTURE_CUBE_MAP,ve.__image__webglTextureCube),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,Z.flipY);for(var Te=Z&&Z.isCompressedTexture,Oe=Z.image[0]&&Z.image[0].isDataTexture,Le=[],Ne=0;Ne<6;Ne++)Le[Ne]=Te||Oe?Oe?Z.image[Ne].image:Z.image[Ne]:w(Z.image[Ne],p.maxCubemapSize);var Ye=T(Le[0]),He=m(Z.format),ye=m(Z.type);for(q(s.TEXTURE_CUBE_MAP,Z,Ye),Ne=0;Ne<6;Ne++)if(Te)for(var Ge,tt=Le[Ne].mipmaps,Je=0,Lt=tt.length;Je<Lt;Je++)Ge=tt[Je],Z.format!==zo&&Z.format!==Lc?c.getCompressedTextureFormats().indexOf(He)>-1?c.compressedTexImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+Ne,Je,He,Ge.width,Ge.height,0,Ge.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):c.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+Ne,Je,He,Ge.width,Ge.height,0,He,ye,Ge.data);else Oe?c.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+Ne,0,He,Le[Ne].width,Le[Ne].height,0,He,ye,Le[Ne].data):c.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+Ne,0,He,He,ye,Le[Ne]);Z.generateMipmaps&&Ye&&s.generateMipmap(s.TEXTURE_CUBE_MAP),ve.__version=Z.version,Z.onUpdate&&Z.onUpdate(Z)}else c.activeTexture(s.TEXTURE0+ee),c.bindTexture(s.TEXTURE_CUBE_MAP,ve.__image__webglTextureCube)},this.setTextureCubeDynamic=function J(Z,ee){c.activeTexture(s.TEXTURE0+ee),c.bindTexture(s.TEXTURE_CUBE_MAP,d.get(Z).__webglTexture)},this.setupRenderTarget=function Fe(Z){var ee=d.get(Z),ve=d.get(Z.texture);Z.addEventListener("dispose",B),ve.__webglTexture=s.createTexture(),y.textures++;var Te=!0===Z.isWebGLRenderTargetCube,Oe=T(Z);if(Te){ee.__webglFramebuffer=[];for(var Le=0;Le<6;Le++)ee.__webglFramebuffer[Le]=s.createFramebuffer()}else ee.__webglFramebuffer=s.createFramebuffer();if(Te){for(c.bindTexture(s.TEXTURE_CUBE_MAP,ve.__webglTexture),q(s.TEXTURE_CUBE_MAP,Z.texture,Oe),Le=0;Le<6;Le++)se(ee.__webglFramebuffer[Le],Z,s.COLOR_ATTACHMENT0,s.TEXTURE_CUBE_MAP_POSITIVE_X+Le);Z.texture.generateMipmaps&&Oe&&s.generateMipmap(s.TEXTURE_CUBE_MAP),c.bindTexture(s.TEXTURE_CUBE_MAP,null)}else c.bindTexture(s.TEXTURE_2D,ve.__webglTexture),q(s.TEXTURE_2D,Z.texture,Oe),se(ee.__webglFramebuffer,Z,s.COLOR_ATTACHMENT0,s.TEXTURE_2D),Z.texture.generateMipmaps&&Oe&&s.generateMipmap(s.TEXTURE_2D),c.bindTexture(s.TEXTURE_2D,null);Z.depthBuffer&&function me(Z){var ee=d.get(Z),ve=!0===Z.isWebGLRenderTargetCube;if(Z.depthTexture){if(ve)throw new Error("target.depthTexture not supported in Cube render targets");!function ue(Z,ee){if(ee&&ee.isWebGLRenderTargetCube)throw new Error("Depth Texture with cube render targets is not supported!");if(s.bindFramebuffer(s.FRAMEBUFFER,Z),!ee.depthTexture||!ee.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!d.get(ee.depthTexture).__webglTexture||ee.depthTexture.image.width!==ee.width||ee.depthTexture.image.height!==ee.height)&&(ee.depthTexture.image.width=ee.width,ee.depthTexture.image.height=ee.height,ee.depthTexture.needsUpdate=!0),V(ee.depthTexture,0);var Te=d.get(ee.depthTexture).__webglTexture;if(ee.depthTexture.format===os)s.framebufferTexture2D(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.TEXTURE_2D,Te,0);else{if(ee.depthTexture.format!==Nc)throw new Error("Unknown depthTexture format");s.framebufferTexture2D(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.TEXTURE_2D,Te,0)}}(ee.__webglFramebuffer,Z)}else if(ve){ee.__webglDepthbuffer=[];for(var Te=0;Te<6;Te++)s.bindFramebuffer(s.FRAMEBUFFER,ee.__webglFramebuffer[Te]),ee.__webglDepthbuffer[Te]=s.createRenderbuffer(),le(ee.__webglDepthbuffer[Te],Z)}else s.bindFramebuffer(s.FRAMEBUFFER,ee.__webglFramebuffer),ee.__webglDepthbuffer=s.createRenderbuffer(),le(ee.__webglDepthbuffer,Z);s.bindFramebuffer(s.FRAMEBUFFER,null)}(Z)},this.updateRenderTargetMipmap=function Ie(Z){var ee=Z.texture;if(ee.generateMipmaps&&T(Z)&&ee.minFilter!==Us&&ee.minFilter!==ws){var ve=Z&&Z.isWebGLRenderTargetCube?s.TEXTURE_CUBE_MAP:s.TEXTURE_2D,Te=d.get(ee).__webglTexture;c.bindTexture(ve,Te),s.generateMipmap(ve),c.bindTexture(ve,null)}}}function FA(){var s={};return{get:function(l){var c=l.uuid,d=s[c];return void 0===d&&(s[c]=d={}),d},delete:function(l){delete s[l.uuid]},clear:function(){s={}}}}function xw(s,l,c){var v=new function d(){var Ee=!1,nn=new ri,En=null,Ii=new ri;return{setMask:function(ln){En!==ln&&!Ee&&(s.colorMask(ln,ln,ln,ln),En=ln)},setLocked:function(ln){Ee=ln},setClear:function(ln,Pi,jr,mr,Kl){!0===Kl&&(ln*=mr,Pi*=mr,jr*=mr),nn.set(ln,Pi,jr,mr),!1===Ii.equals(nn)&&(s.clearColor(ln,Pi,jr,mr),Ii.copy(nn))},reset:function(){Ee=!1,En=null,Ii.set(0,0,0,1)}}},y=new function p(){var Ee=!1,nn=null,En=null,Ii=null;return{setTest:function(ln){ln?Lt(s.DEPTH_TEST):At(s.DEPTH_TEST)},setMask:function(ln){nn!==ln&&!Ee&&(s.depthMask(ln),nn=ln)},setFunc:function(ln){if(En!==ln){if(ln)switch(ln){case hi:s.depthFunc(s.NEVER);break;case qd:s.depthFunc(s.ALWAYS);break;case yy:s.depthFunc(s.LESS);break;case Rc:s.depthFunc(s.LEQUAL);break;case _y:s.depthFunc(s.EQUAL);break;case xy:s.depthFunc(s.GEQUAL);break;case My:s.depthFunc(s.GREATER);break;case OM:s.depthFunc(s.NOTEQUAL);break;default:s.depthFunc(s.LEQUAL)}else s.depthFunc(s.LEQUAL);En=ln}},setLocked:function(ln){Ee=ln},setClear:function(ln){Ii!==ln&&(s.clearDepth(ln),Ii=ln)},reset:function(){Ee=!1,nn=null,En=null,Ii=null}}},b=new function m(){var Ee=!1,nn=null,En=null,Ii=null,ln=null,Pi=null,jr=null,mr=null,Kl=null;return{setTest:function(Li){Li?Lt(s.STENCIL_TEST):At(s.STENCIL_TEST)},setMask:function(Li){nn!==Li&&!Ee&&(s.stencilMask(Li),nn=Li)},setFunc:function(Li,To,Ca){(En!==Li||Ii!==To||ln!==Ca)&&(s.stencilFunc(Li,To,Ca),En=Li,Ii=To,ln=Ca)},setOp:function(Li,To,Ca){(Pi!==Li||jr!==To||mr!==Ca)&&(s.stencilOp(Li,To,Ca),Pi=Li,jr=To,mr=Ca)},setLocked:function(Li){Ee=Li},setClear:function(Li){Kl!==Li&&(s.clearStencil(Li),Kl=Li)},reset:function(){Ee=!1,nn=null,En=null,Ii=null,ln=null,Pi=null,jr=null,mr=null,Kl=null}}},w=s.getParameter(s.MAX_VERTEX_ATTRIBS),T=new Uint8Array(w),A=new Uint8Array(w),R=new Uint8Array(w),P={},L=null,B=null,U=null,F=null,V=null,H=null,J=null,q=null,ae=!1,se=null,le=null,ue=null,me=null,Fe=null,Ie=null,Z=s.getParameter(s.MAX_TEXTURE_IMAGE_UNITS),ee=parseFloat(/^WebGL\ ([0-9])/.exec(s.getParameter(s.VERSION))[1]),ve=parseFloat(ee)>=1,Te=null,Oe={},Le=new ri,Ne=new ri;function Qe(Ee,nn,En){var Ii=new Uint8Array(4),ln=s.createTexture();s.bindTexture(Ee,ln),s.texParameteri(Ee,s.TEXTURE_MIN_FILTER,s.NEAREST),s.texParameteri(Ee,s.TEXTURE_MAG_FILTER,s.NEAREST);for(var Pi=0;Pi<En;Pi++)s.texImage2D(nn+Pi,0,s.RGBA,1,1,0,s.RGBA,s.UNSIGNED_BYTE,Ii);return ln}var Ye={};function Lt(Ee){!0!==P[Ee]&&(s.enable(Ee),P[Ee]=!0)}function At(Ee){!1!==P[Ee]&&(s.disable(Ee),P[Ee]=!1)}function tn(Ee,nn,En,Ii,ln,Pi,jr,mr){Ee!==th?Lt(s.BLEND):At(s.BLEND),(Ee!==B||mr!==ae)&&(Ee===Bm?mr?(s.blendEquationSeparate(s.FUNC_ADD,s.FUNC_ADD),s.blendFuncSeparate(s.ONE,s.ONE,s.ONE,s.ONE)):(s.blendEquation(s.FUNC_ADD),s.blendFunc(s.SRC_ALPHA,s.ONE)):Ee===bl?mr?(s.blendEquationSeparate(s.FUNC_ADD,s.FUNC_ADD),s.blendFuncSeparate(s.ZERO,s.ZERO,s.ONE_MINUS_SRC_COLOR,s.ONE_MINUS_SRC_ALPHA)):(s.blendEquation(s.FUNC_ADD),s.blendFunc(s.ZERO,s.ONE_MINUS_SRC_COLOR)):Ee===Dc?mr?(s.blendEquationSeparate(s.FUNC_ADD,s.FUNC_ADD),s.blendFuncSeparate(s.ZERO,s.SRC_COLOR,s.ZERO,s.SRC_ALPHA)):(s.blendEquation(s.FUNC_ADD),s.blendFunc(s.ZERO,s.SRC_COLOR)):mr?(s.blendEquationSeparate(s.FUNC_ADD,s.FUNC_ADD),s.blendFuncSeparate(s.ONE,s.ONE_MINUS_SRC_ALPHA,s.ONE,s.ONE_MINUS_SRC_ALPHA)):(s.blendEquationSeparate(s.FUNC_ADD,s.FUNC_ADD),s.blendFuncSeparate(s.SRC_ALPHA,s.ONE_MINUS_SRC_ALPHA,s.ONE,s.ONE_MINUS_SRC_ALPHA)),B=Ee,ae=mr),Ee===km?(ln=ln||nn,Pi=Pi||En,jr=jr||Ii,(nn!==U||ln!==H)&&(s.blendEquationSeparate(c(nn),c(ln)),U=nn,H=ln),(En!==F||Ii!==V||Pi!==J||jr!==q)&&(s.blendFuncSeparate(c(En),c(Ii),c(Pi),c(jr)),F=En,V=Ii,J=Pi,q=jr)):(U=null,F=null,V=null,H=null,J=null,q=null)}function $n(Ee){y.setFunc(Ee)}function Xn(Ee){se!==Ee&&(s.frontFace(Ee?s.CW:s.CCW),se=Ee)}function Zn(Ee){Ee!==wl?(Lt(s.CULL_FACE),Ee!==le&&s.cullFace(Ee===er?s.BACK:Ee===Ga?s.FRONT:s.FRONT_AND_BACK)):At(s.CULL_FACE),le=Ee}function Ci(Ee){void 0===Ee&&(Ee=s.TEXTURE0+Z-1),Te!==Ee&&(s.activeTexture(Ee),Te=Ee)}return Ye[s.TEXTURE_2D]=Qe(s.TEXTURE_2D,s.TEXTURE_2D,1),Ye[s.TEXTURE_CUBE_MAP]=Qe(s.TEXTURE_CUBE_MAP,s.TEXTURE_CUBE_MAP_POSITIVE_X,6),{buffers:{color:v,depth:y,stencil:b},init:function He(){v.setClear(0,0,0,1),y.setClear(1),b.setClear(0),Lt(s.DEPTH_TEST),$n(Rc),Xn(!1),Zn(er),Lt(s.CULL_FACE),Lt(s.BLEND),tn(Wa)},initAttributes:function ye(){for(var Ee=0,nn=T.length;Ee<nn;Ee++)T[Ee]=0},enableAttribute:function Ge(Ee){T[Ee]=1,0===A[Ee]&&(s.enableVertexAttribArray(Ee),A[Ee]=1),0!==R[Ee]&&(l.get("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(Ee,0),R[Ee]=0)},enableAttributeAndDivisor:function tt(Ee,nn,En){T[Ee]=1,0===A[Ee]&&(s.enableVertexAttribArray(Ee),A[Ee]=1),R[Ee]!==nn&&(En.vertexAttribDivisorANGLE(Ee,nn),R[Ee]=nn)},disableUnusedAttributes:function Je(){for(var Ee=0,nn=A.length;Ee!==nn;++Ee)A[Ee]!==T[Ee]&&(s.disableVertexAttribArray(Ee),A[Ee]=0)},enable:Lt,disable:At,getCompressedTextureFormats:function st(){if(null===L&&(L=[],l.get("WEBGL_compressed_texture_pvrtc")||l.get("WEBGL_compressed_texture_s3tc")||l.get("WEBGL_compressed_texture_etc1")))for(var Ee=s.getParameter(s.COMPRESSED_TEXTURE_FORMATS),nn=0;nn<Ee.length;nn++)L.push(Ee[nn]);return L},setBlending:tn,setColorWrite:function de(Ee){v.setMask(Ee)},setDepthTest:function oi(Ee){y.setTest(Ee)},setDepthWrite:function Gt(Ee){y.setMask(Ee)},setDepthFunc:$n,setStencilTest:function Mt(Ee){b.setTest(Ee)},setStencilWrite:function fi(Ee){b.setMask(Ee)},setStencilFunc:function sn(Ee,nn,En){b.setFunc(Ee,nn,En)},setStencilOp:function fn(Ee,nn,En){b.setOp(Ee,nn,En)},setFlipSided:Xn,setCullFace:Zn,setLineWidth:function Gi(Ee){Ee!==ue&&(ve&&s.lineWidth(Ee),ue=Ee)},setPolygonOffset:function pi(Ee,nn,En){Ee?(Lt(s.POLYGON_OFFSET_FILL),(me!==nn||Fe!==En)&&(s.polygonOffset(nn,En),me=nn,Fe=En)):At(s.POLYGON_OFFSET_FILL)},getScissorTest:function Wi(){return Ie},setScissorTest:function Ti(Ee){Ie=Ee,Ee?Lt(s.SCISSOR_TEST):At(s.SCISSOR_TEST)},activeTexture:Ci,bindTexture:function Ln(Ee,nn){null===Te&&Ci();var En=Oe[Te];void 0===En&&(Oe[Te]=En={type:void 0,texture:void 0}),(En.type!==Ee||En.texture!==nn)&&(s.bindTexture(Ee,nn||Ye[Ee]),En.type=Ee,En.texture=nn)},compressedTexImage2D:function lr(){try{s.compressedTexImage2D.apply(s,arguments)}catch(Ee){console.error(Ee)}},texImage2D:function Ta(){try{s.texImage2D.apply(s,arguments)}catch(Ee){console.error(Ee)}},scissor:function ol(Ee){!1===Le.equals(Ee)&&(s.scissor(Ee.x,Ee.y,Ee.z,Ee.w),Le.copy(Ee))},viewport:function Jl(Ee){!1===Ne.equals(Ee)&&(s.viewport(Ee.x,Ee.y,Ee.z,Ee.w),Ne.copy(Ee))},reset:function al(){for(var Ee=0;Ee<A.length;Ee++)1===A[Ee]&&(s.disableVertexAttribArray(Ee),A[Ee]=0);P={},L=null,Te=null,Oe={},B=null,se=null,le=null,v.reset(),y.reset(),b.reset()}}}function Mw(s,l,c){var d;function m(J){if("highp"===J){if(s.getShaderPrecisionFormat(s.VERTEX_SHADER,s.HIGH_FLOAT).precision>0&&s.getShaderPrecisionFormat(s.FRAGMENT_SHADER,s.HIGH_FLOAT).precision>0)return"highp";J="mediump"}return"mediump"===J&&s.getShaderPrecisionFormat(s.VERTEX_SHADER,s.MEDIUM_FLOAT).precision>0&&s.getShaderPrecisionFormat(s.FRAGMENT_SHADER,s.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}var v=void 0!==c.precision?c.precision:"highp",y=m(v);y!==v&&(console.warn("THREE.WebGLRenderer:",v,"not supported, using",y,"instead."),v=y);var b=!0===c.logarithmicDepthBuffer&&!!l.get("EXT_frag_depth"),w=s.getParameter(s.MAX_TEXTURE_IMAGE_UNITS),T=s.getParameter(s.MAX_VERTEX_TEXTURE_IMAGE_UNITS),A=s.getParameter(s.MAX_TEXTURE_SIZE),R=s.getParameter(s.MAX_CUBE_MAP_TEXTURE_SIZE),P=s.getParameter(s.MAX_VERTEX_ATTRIBS),L=s.getParameter(s.MAX_VERTEX_UNIFORM_VECTORS),B=s.getParameter(s.MAX_VARYING_VECTORS),U=s.getParameter(s.MAX_FRAGMENT_UNIFORM_VECTORS),F=T>0,V=!!l.get("OES_texture_float");return{getMaxAnisotropy:function p(){if(void 0!==d)return d;var J=l.get("EXT_texture_filter_anisotropic");return d=null!==J?s.getParameter(J.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0},getMaxPrecision:m,precision:v,logarithmicDepthBuffer:b,maxTextures:w,maxVertexTextures:T,maxTextureSize:A,maxCubemapSize:R,maxAttributes:P,maxVertexUniforms:L,maxVaryings:B,maxFragmentUniforms:U,vertexTextures:F,floatFragmentTextures:V,floatVertexTextures:F&&V}}function UA(s){var l={};return{get:function(c){if(void 0!==l[c])return l[c];var d;switch(c){case"WEBGL_depth_texture":d=s.getExtension("WEBGL_depth_texture")||s.getExtension("MOZ_WEBGL_depth_texture")||s.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":d=s.getExtension("EXT_texture_filter_anisotropic")||s.getExtension("MOZ_EXT_texture_filter_anisotropic")||s.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":d=s.getExtension("WEBGL_compressed_texture_s3tc")||s.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||s.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":d=s.getExtension("WEBGL_compressed_texture_pvrtc")||s.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;case"WEBGL_compressed_texture_etc1":d=s.getExtension("WEBGL_compressed_texture_etc1");break;default:d=s.getExtension(c)}return null===d&&console.warn("THREE.WebGLRenderer: "+c+" extension not supported."),l[c]=d,d}}}function o_(){var s=this,l=null,c=0,d=!1,p=!1,m=new si,v=new es,y={value:null,needsUpdate:!1};function b(){y.value!==l&&(y.value=l,y.needsUpdate=c>0),s.numPlanes=c,s.numIntersection=0}function w(T,A,R,P){var L=null!==T?T.length:0,B=null;if(0!==L){if(B=y.value,!0!==P||null===B){var U=R+4*L,F=A.matrixWorldInverse;v.getNormalMatrix(F),(null===B||B.length<U)&&(B=new Float32Array(U));for(var V=0,H=R;V!==L;++V,H+=4)m.copy(T[V]).applyMatrix4(F,v),m.normal.toArray(B,H),B[H+3]=m.constant}y.value=B,y.needsUpdate=!0}return s.numPlanes=L,B}this.uniform=y,this.numPlanes=0,this.numIntersection=0,this.init=function(T,A,R){var P=0!==T.length||A||0!==c||d;return d=A,l=w(T,R,0),c=T.length,P},this.beginShadows=function(){p=!0,w(null)},this.endShadows=function(){p=!1,b()},this.setState=function(T,A,R,P,L,B){if(!d||null===T||0===T.length||p&&!R)p?w(null):b();else{var U=p?0:c,F=4*U,V=L.clippingState||null;y.value=V,V=w(T,P,F,B);for(var H=0;H!==F;++H)V[H]=l[H];L.clippingState=V,this.numIntersection=A?this.numPlanes:0,this.numPlanes+=U}}}function Th(s){console.log("THREE.WebGLRenderer",zn);var l=void 0!==(s=s||{}).canvas?s.canvas:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),c=void 0!==s.context?s.context:null,d=void 0!==s.alpha&&s.alpha,p=void 0===s.depth||s.depth,m=void 0===s.stencil||s.stencil,v=void 0!==s.antialias&&s.antialias,y=void 0===s.premultipliedAlpha||s.premultipliedAlpha,b=void 0!==s.preserveDrawingBuffer&&s.preserveDrawingBuffer,w=[],T=[],A=-1,R=[],P=-1,L=new Float32Array(8),B=[],U=[];this.domElement=l,this.context=null,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.gammaInput=!1,this.gammaOutput=!1,this.physicallyCorrectLights=!1,this.toneMapping=Jd,this.toneMappingExposure=1,this.toneMappingWhitePoint=1,this.maxMorphTargets=8,this.maxMorphNormals=4;var de,F=this,V=null,H=null,J=null,q=-1,ae="",se=null,le=new ri,ue=null,me=new ri,Fe=0,Ie=new Tt(0),Z=0,ee=l.width,ve=l.height,Te=1,Oe=new ri(0,0,ee,ve),Le=!1,Ne=new ri(0,0,ee,ve),Qe=new xf,Ye=new o_,He=!1,ye=!1,Ge=new or,tt=new Wt,Je=new z,Lt=new Wt,At=new Wt,st={hash:"",ambient:[0,0,0],directional:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],point:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],shadows:[]},tn={calls:0,vertices:0,faces:0,points:0};this.info={render:tn,memory:{geometries:0,textures:0},programs:null};try{var oi={alpha:d,depth:p,stencil:m,antialias:v,premultipliedAlpha:y,preserveDrawingBuffer:b};if(null===(de=c||l.getContext("webgl",oi)||l.getContext("experimental-webgl",oi)))throw null!==l.getContext("webgl")?"Error creating WebGL context with your selected attributes.":"Error creating WebGL context.";void 0===de.getShaderPrecisionFormat&&(de.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}}),l.addEventListener("webglcontextlost",En,!1)}catch(k){console.error("THREE.WebGLRenderer: "+k)}var Gt=new UA(de);Gt.get("WEBGL_depth_texture"),Gt.get("OES_texture_float"),Gt.get("OES_texture_float_linear"),Gt.get("OES_texture_half_float"),Gt.get("OES_texture_half_float_linear"),Gt.get("OES_standard_derivatives"),Gt.get("ANGLE_instanced_arrays"),Gt.get("OES_element_index_uint")&&(kt.MaxIndex=4294967296);var $n=new Mw(de,Gt,s),Mt=new xw(de,Gt,uo),fi=new FA,sn=new OA(de,Gt,Mt,fi,$n,uo,this.info),fn=new NA(de,fi,this.info),Xn=new Wc(this,$n),Zn=new Vr;this.info.programs=Xn.programs;var Gi=new LA(de,Gt,tn),pi=new PA(de,Gt,tn),Wi=new Gs(-1,1,1,-1,0,1),Ti=new Zi,Ci=new br(new Hc(2,2),new Hs({depthTest:!1,depthWrite:!1,fog:!1})),Ln=Ss.cube,lr=new br(new zc(5,5,5),new Qr({uniforms:Ln.uniforms,vertexShader:Ln.vertexShader,fragmentShader:Ln.fragmentShader,side:ie,depthTest:!1,depthWrite:!1,fog:!1}));function Ta(){return null===H?Te:1}function ol(){Mt.init(),Mt.scissor(le.copy(Oe).multiplyScalar(Te)),Mt.viewport(me.copy(Ne).multiplyScalar(Te)),Mt.buffers.color.setClear(Ie.r,Ie.g,Ie.b,Z,y)}function Jl(){V=null,se=null,ae="",q=-1,Mt.reset()}ol(),this.context=de,this.capabilities=$n,this.extensions=Gt,this.properties=fi,this.state=Mt;var al=new cs(this,st,fn,$n);this.shadowMap=al;var k,Ee=new Un(this,B),nn=new wh(this,U);function En(k){k.preventDefault(),Jl(),ol(),fi.clear()}function Ii(k){var te=k.target;te.removeEventListener("dispose",Ii),function ln(k){Pi(k),fi.delete(k)}(te)}function Pi(k){var te=fi.get(k).program;k.program=void 0,void 0!==te&&Xn.releaseProgram(te)}function mr(k,te){return Math.abs(te[0])-Math.abs(k[0])}function Kl(k,te){return k.object.renderOrder!==te.object.renderOrder?k.object.renderOrder-te.object.renderOrder:k.material.program&&te.material.program&&k.material.program!==te.material.program?k.material.program.id-te.material.program.id:k.material.id!==te.material.id?k.material.id-te.material.id:k.z!==te.z?k.z-te.z:k.id-te.id}function Li(k,te){return k.object.renderOrder!==te.object.renderOrder?k.object.renderOrder-te.object.renderOrder:k.z!==te.z?te.z-k.z:k.id-te.id}function To(k,te,he,je,Me){var jt,Bn;he.transparent?(jt=R,Bn=++P):(jt=T,Bn=++A);var _t=jt[Bn];void 0!==_t?(_t.id=k.id,_t.object=k,_t.geometry=te,_t.material=he,_t.z=Je.z,_t.group=Me):jt.push(_t={id:k.id,object:k,geometry:te,material:he,z:Je.z,group:Me})}function Lg(k){if(!Qe.intersectsSphere(k))return!1;var te=Ye.numPlanes;if(0===te)return!0;var he=F.clippingPlanes,je=k.center,Me=-k.radius,jt=0;do{if(he[jt].distanceToPoint(je)<Me)return!1}while(++jt!==te);return!0}function Ng(k,te){if(!1!==k.visible){if(0!=(k.layers.mask&te.layers.mask))if(k.isLight)w.push(k);else if(k.isSprite)(!1===k.frustumCulled||!0===function v_(k){return Ge.center.set(0,0,0),Ge.radius=.7071067811865476,Ge.applyMatrix4(k.matrixWorld),Lg(Ge)}(k))&&B.push(k);else if(k.isLensFlare)U.push(k);else if(k.isImmediateRenderObject)!0===F.sortObjects&&(Je.setFromMatrixPosition(k.matrixWorld),Je.applyProjection(tt)),To(k,null,k.material,0,null);else if((k.isMesh||k.isLine||k.isPoints)&&(k.isSkinnedMesh&&k.skeleton.update(),!1===k.frustumCulled||!0===function Ca(k){var te=k.geometry;return null===te.boundingSphere&&te.computeBoundingSphere(),Ge.copy(te.boundingSphere).applyMatrix4(k.matrixWorld),Lg(Ge)}(k))){var je=k.material;if(!0===je.visible){!0===F.sortObjects&&(Je.setFromMatrixPosition(k.matrixWorld),Je.applyProjection(tt));var Me=fn.update(k);if(je.isMultiMaterial)for(var jt=Me.groups,Bn=je.materials,_t=0,kn=jt.length;_t<kn;_t++){var $t=jt[_t],Dt=Bn[$t.materialIndex];!0===Dt.visible&&To(k,Me,Dt,0,$t)}else To(k,Me,je,0,null)}}var yt=k.children;for(_t=0,kn=yt.length;_t<kn;_t++)Ng(yt[_t],te)}}function Aa(k,te,he,je){for(var Me=0,jt=k.length;Me<jt;Me++){var Bn=k[Me],_t=Bn.object,kn=Bn.geometry,$t=void 0===je?Bn.material:je,Dt=Bn.group;if(_t.modelViewMatrix.multiplyMatrices(he.matrixWorldInverse,_t.matrixWorld),_t.normalMatrix.getNormalMatrix(_t.modelViewMatrix),_t.onBeforeRender(F,te,he,kn,$t,Dt),_t.isImmediateRenderObject){Og($t);var yt=tp(he,te.fog,$t,_t);ae="",_t.render(function(Ai){F.renderBufferImmediate(Ai,yt,$t)})}else F.renderBufferDirect(he,te.fog,kn,$t,_t,Dt);_t.onAfterRender(F,te,he,kn,$t,Dt)}}function Og(k){k.side===Nt?Mt.disable(de.CULL_FACE):Mt.enable(de.CULL_FACE),Mt.setFlipSided(k.side===ie),!0===k.transparent?Mt.setBlending(k.blending,k.blendEquation,k.blendSrc,k.blendDst,k.blendEquationAlpha,k.blendSrcAlpha,k.blendDstAlpha,k.premultipliedAlpha):Mt.setBlending(th),Mt.setDepthFunc(k.depthFunc),Mt.setDepthTest(k.depthTest),Mt.setDepthWrite(k.depthWrite),Mt.setColorWrite(k.colorWrite),Mt.setPolygonOffset(k.polygonOffset,k.polygonOffsetFactor,k.polygonOffsetUnits)}function tp(k,te,he,je){Fe=0;var Me=fi.get(he);He&&(ye||k!==se)&&Ye.setState(he.clippingPlanes,he.clipIntersection,he.clipShadows,k,Me,k===se&&he.id===q),!1===he.needsUpdate&&(void 0===Me.program||he.fog&&Me.fog!==te||he.lights&&Me.lightsHash!==st.hash||void 0!==Me.numClippingPlanes&&(Me.numClippingPlanes!==Ye.numPlanes||Me.numIntersection!==Ye.numIntersection))&&(he.needsUpdate=!0),he.needsUpdate&&(function ep(k,te,he){var je=fi.get(k),Me=Xn.getParameters(k,st,te,Ye.numPlanes,Ye.numIntersection,he),jt=Xn.getProgramCode(k,Me),Bn=je.program,_t=!0;if(void 0===Bn)k.addEventListener("dispose",Ii);else if(Bn.code!==jt)Pi(k);else{if(void 0!==Me.shaderID)return;_t=!1}if(_t){if(Me.shaderID){var kn=Ss[Me.shaderID];je.__webglShader={name:k.type,uniforms:as.clone(kn.uniforms),vertexShader:kn.vertexShader,fragmentShader:kn.fragmentShader}}else je.__webglShader={name:k.type,uniforms:k.uniforms,vertexShader:k.vertexShader,fragmentShader:k.fragmentShader};k.__webglShader=je.__webglShader,Bn=Xn.acquireProgram(k,Me,jt),je.program=Bn,k.program=Bn}var $t=Bn.getAttributes();if(k.morphTargets){k.numSupportedMorphTargets=0;for(var Dt=0;Dt<F.maxMorphTargets;Dt++)$t["morphTarget"+Dt]>=0&&k.numSupportedMorphTargets++}if(k.morphNormals)for(k.numSupportedMorphNormals=0,Dt=0;Dt<F.maxMorphNormals;Dt++)$t["morphNormal"+Dt]>=0&&k.numSupportedMorphNormals++;var yt=je.__webglShader.uniforms;(!k.isShaderMaterial&&!k.isRawShaderMaterial||!0===k.clipping)&&(je.numClippingPlanes=Ye.numPlanes,je.numIntersection=Ye.numIntersection,yt.clippingPlanes=Ye.uniform),je.fog=te,je.lightsHash=st.hash,k.lights&&(yt.ambientLightColor.value=st.ambient,yt.directionalLights.value=st.directional,yt.spotLights.value=st.spot,yt.rectAreaLights.value=st.rectArea,yt.pointLights.value=st.point,yt.hemisphereLights.value=st.hemi,yt.directionalShadowMap.value=st.directionalShadowMap,yt.directionalShadowMatrix.value=st.directionalShadowMatrix,yt.spotShadowMap.value=st.spotShadowMap,yt.spotShadowMatrix.value=st.spotShadowMatrix,yt.pointShadowMap.value=st.pointShadowMap,yt.pointShadowMatrix.value=st.pointShadowMatrix);var Ai=je.program.getUniforms(),Ni=ir.seqWithValue(Ai.seq,yt);je.uniformsList=Ni}(he,te,je),he.needsUpdate=!1);var Bn=!1,_t=!1,kn=!1,$t=Me.program,Dt=$t.getUniforms(),yt=Me.__webglShader.uniforms;if($t.id!==V&&(de.useProgram($t.program),V=$t.id,Bn=!0,_t=!0,kn=!0),he.id!==q&&(q=he.id,_t=!0),Bn||k!==se){if(Dt.set(de,k,"projectionMatrix"),$n.logarithmicDepthBuffer&&Dt.setValue(de,"logDepthBufFC",2/(Math.log(k.far+1)/Math.LN2)),k!==se&&(se=k,_t=!0,kn=!0),he.isShaderMaterial||he.isMeshPhongMaterial||he.isMeshStandardMaterial||he.envMap){var Ai=Dt.map.cameraPosition;void 0!==Ai&&Ai.setValue(de,Je.setFromMatrixPosition(k.matrixWorld))}(he.isMeshPhongMaterial||he.isMeshLambertMaterial||he.isMeshBasicMaterial||he.isMeshStandardMaterial||he.isShaderMaterial||he.skinning)&&Dt.setValue(de,"viewMatrix",k.matrixWorldInverse),Dt.set(de,F,"toneMappingExposure"),Dt.set(de,F,"toneMappingWhitePoint")}if(he.skinning){Dt.setOptional(de,je,"bindMatrix"),Dt.setOptional(de,je,"bindMatrixInverse");var Ni=je.skeleton;Ni&&($n.floatVertexTextures&&Ni.useVertexTexture?(Dt.set(de,Ni,"boneTexture"),Dt.set(de,Ni,"boneTextureWidth"),Dt.set(de,Ni,"boneTextureHeight")):Dt.setOptional(de,Ni,"boneMatrices"))}return _t&&(he.lights&&function kw(k,te){k.ambientLightColor.needsUpdate=te,k.directionalLights.needsUpdate=te,k.pointLights.needsUpdate=te,k.spotLights.needsUpdate=te,k.rectAreaLights.needsUpdate=te,k.hemisphereLights.needsUpdate=te}(yt,kn),te&&he.fog&&function Uw(k,te){k.fogColor.value=te.color,te.isFog?(k.fogNear.value=te.near,k.fogFar.value=te.far):te.isFogExp2&&(k.fogDensity.value=te.density)}(yt,te),(he.isMeshBasicMaterial||he.isMeshLambertMaterial||he.isMeshPhongMaterial||he.isMeshStandardMaterial||he.isMeshNormalMaterial||he.isMeshDepthMaterial)&&function np(k,te){var he;if(k.opacity.value=te.opacity,k.diffuse.value=te.color,te.emissive&&k.emissive.value.copy(te.emissive).multiplyScalar(te.emissiveIntensity),k.map.value=te.map,k.specularMap.value=te.specularMap,k.alphaMap.value=te.alphaMap,te.lightMap&&(k.lightMap.value=te.lightMap,k.lightMapIntensity.value=te.lightMapIntensity),te.aoMap&&(k.aoMap.value=te.aoMap,k.aoMapIntensity.value=te.aoMapIntensity),te.map?he=te.map:te.specularMap?he=te.specularMap:te.displacementMap?he=te.displacementMap:te.normalMap?he=te.normalMap:te.bumpMap?he=te.bumpMap:te.roughnessMap?he=te.roughnessMap:te.metalnessMap?he=te.metalnessMap:te.alphaMap?he=te.alphaMap:te.emissiveMap&&(he=te.emissiveMap),void 0!==he){he.isWebGLRenderTarget&&(he=he.texture);var je=he.offset,Me=he.repeat;k.offsetRepeat.value.set(je.x,je.y,Me.x,Me.y)}k.envMap.value=te.envMap,k.flipEnvMap.value=te.envMap&&te.envMap.isCubeTexture?-1:1,k.reflectivity.value=te.reflectivity,k.refractionRatio.value=te.refractionRatio}(yt,he),he.isLineBasicMaterial?y_(yt,he):he.isLineDashedMaterial?(y_(yt,he),function Ow(k,te){k.dashSize.value=te.dashSize,k.totalSize.value=te.dashSize+te.gapSize,k.scale.value=te.scale}(yt,he)):he.isPointsMaterial?function Fw(k,te){if(k.diffuse.value=te.color,k.opacity.value=te.opacity,k.size.value=te.size*Te,k.scale.value=.5*ve,k.map.value=te.map,null!==te.map){var he=te.map.offset,je=te.map.repeat;k.offsetRepeat.value.set(he.x,he.y,je.x,je.y)}}(yt,he):he.isMeshLambertMaterial?function Bw(k,te){te.emissiveMap&&(k.emissiveMap.value=te.emissiveMap)}(yt,he):he.isMeshToonMaterial?function x_(k,te){__(k,te),te.gradientMap&&(k.gradientMap.value=te.gradientMap)}(yt,he):he.isMeshPhongMaterial?__(yt,he):he.isMeshPhysicalMaterial?function Fg(k,te){k.clearCoat.value=te.clearCoat,k.clearCoatRoughness.value=te.clearCoatRoughness,nd(k,te)}(yt,he):he.isMeshStandardMaterial?nd(yt,he):he.isMeshDepthMaterial?he.displacementMap&&(yt.displacementMap.value=he.displacementMap,yt.displacementScale.value=he.displacementScale,yt.displacementBias.value=he.displacementBias):he.isMeshNormalMaterial&&function Ug(k,te){te.bumpMap&&(k.bumpMap.value=te.bumpMap,k.bumpScale.value=te.bumpScale),te.normalMap&&(k.normalMap.value=te.normalMap,k.normalScale.value.copy(te.normalScale)),te.displacementMap&&(k.displacementMap.value=te.displacementMap,k.displacementScale.value=te.displacementScale,k.displacementBias.value=te.displacementBias)}(yt,he),void 0!==yt.ltcMat&&(yt.ltcMat.value=THREE.UniformsLib.LTC_MAT_TEXTURE),void 0!==yt.ltcMag&&(yt.ltcMag.value=THREE.UniformsLib.LTC_MAG_TEXTURE),ir.upload(de,Me.uniformsList,yt,F)),Dt.set(de,je,"modelViewMatrix"),Dt.set(de,je,"normalMatrix"),Dt.setValue(de,"modelMatrix",je.matrixWorld),$t}function y_(k,te){k.diffuse.value=te.color,k.opacity.value=te.opacity}function __(k,te){k.specular.value=te.specular,k.shininess.value=Math.max(te.shininess,1e-4),te.emissiveMap&&(k.emissiveMap.value=te.emissiveMap),te.bumpMap&&(k.bumpMap.value=te.bumpMap,k.bumpScale.value=te.bumpScale),te.normalMap&&(k.normalMap.value=te.normalMap,k.normalScale.value.copy(te.normalScale)),te.displacementMap&&(k.displacementMap.value=te.displacementMap,k.displacementScale.value=te.displacementScale,k.displacementBias.value=te.displacementBias)}function nd(k,te){k.roughness.value=te.roughness,k.metalness.value=te.metalness,te.roughnessMap&&(k.roughnessMap.value=te.roughnessMap),te.metalnessMap&&(k.metalnessMap.value=te.metalnessMap),te.emissiveMap&&(k.emissiveMap.value=te.emissiveMap),te.bumpMap&&(k.bumpMap.value=te.bumpMap,k.bumpScale.value=te.bumpScale),te.normalMap&&(k.normalMap.value=te.normalMap,k.normalScale.value.copy(te.normalScale)),te.displacementMap&&(k.displacementMap.value=te.displacementMap,k.displacementScale.value=te.displacementScale,k.displacementBias.value=te.displacementBias),te.envMap&&(k.envMapIntensity.value=te.envMapIntensity)}function uo(k){var te;if(k===ha)return de.REPEAT;if(k===Fs)return de.CLAMP_TO_EDGE;if(k===El)return de.MIRRORED_REPEAT;if(k===Us)return de.NEAREST;if(k===nf)return de.NEAREST_MIPMAP_NEAREST;if(k===rf)return de.NEAREST_MIPMAP_LINEAR;if(k===ws)return de.LINEAR;if(k===Ym)return de.LINEAR_MIPMAP_NEAREST;if(k===rh)return de.LINEAR_MIPMAP_LINEAR;if(k===sh)return de.UNSIGNED_BYTE;if(k===eg)return de.UNSIGNED_SHORT_4_4_4_4;if(k===tg)return de.UNSIGNED_SHORT_5_5_5_1;if(k===bs)return de.UNSIGNED_SHORT_5_6_5;if(k===Zm)return de.BYTE;if(k===Jm)return de.SHORT;if(k===Pc)return de.UNSIGNED_SHORT;if(k===Km)return de.INT;if(k===Qm)return de.UNSIGNED_INT;if(k===Sl)return de.FLOAT;if(k===oh&&null!==(te=Gt.get("OES_texture_half_float")))return te.HALF_FLOAT_OES;if(k===Sy)return de.ALPHA;if(k===Lc)return de.RGB;if(k===zo)return de.RGBA;if(k===ng)return de.LUMINANCE;if(k===Ty)return de.LUMINANCE_ALPHA;if(k===os)return de.DEPTH_COMPONENT;if(k===Nc)return de.DEPTH_STENCIL;if(k===Vm)return de.FUNC_ADD;if(k===$d)return de.FUNC_SUBTRACT;if(k===ua)return de.FUNC_REVERSE_SUBTRACT;if(k===tr)return de.ZERO;if(k===Hm)return de.ONE;if(k===my)return de.SRC_COLOR;if(k===gy)return de.ONE_MINUS_SRC_COLOR;if(k===Gm)return de.SRC_ALPHA;if(k===Os)return de.ONE_MINUS_SRC_ALPHA;if(k===Wm)return de.DST_ALPHA;if(k===jm)return de.ONE_MINUS_DST_ALPHA;if(k===hr)return de.DST_COLOR;if(k===nr)return de.ONE_MINUS_DST_COLOR;if(k===vy)return de.SRC_ALPHA_SATURATE;if((k===Mr||k===ja||k===so||k===Cy)&&null!==(te=Gt.get("WEBGL_compressed_texture_s3tc"))){if(k===Mr)return te.COMPRESSED_RGB_S3TC_DXT1_EXT;if(k===ja)return te.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(k===so)return te.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(k===Cy)return te.COMPRESSED_RGBA_S3TC_DXT5_EXT}if((k===ig||k===rg||k===lh||k===sf)&&null!==(te=Gt.get("WEBGL_compressed_texture_pvrtc"))){if(k===ig)return te.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(k===rg)return te.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(k===lh)return te.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(k===sf)return te.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(k===Oc&&null!==(te=Gt.get("WEBGL_compressed_texture_etc1")))return te.COMPRESSED_RGB_ETC1_WEBGL;if((k===zm||k===Xd)&&null!==(te=Gt.get("EXT_blend_minmax"))){if(k===zm)return te.MIN_EXT;if(k===Xd)return te.MAX_EXT}return k===ah&&null!==(te=Gt.get("WEBGL_depth_texture"))?te.UNSIGNED_INT_24_8_WEBGL:0}this.getContext=function(){return de},this.getContextAttributes=function(){return de.getContextAttributes()},this.forceContextLoss=function(){Gt.get("WEBGL_lose_context").loseContext()},this.getMaxAnisotropy=function(){return $n.getMaxAnisotropy()},this.getPrecision=function(){return $n.precision},this.getPixelRatio=function(){return Te},this.setPixelRatio=function(k){void 0!==k&&(Te=k,this.setSize(Ne.z,Ne.w,!1))},this.getSize=function(){return{width:ee,height:ve}},this.setSize=function(k,te,he){ee=k,ve=te,l.width=k*Te,l.height=te*Te,!1!==he&&(l.style.width=k+"px",l.style.height=te+"px"),this.setViewport(0,0,k,te)},this.setViewport=function(k,te,he,je){Mt.viewport(Ne.set(k,te,he,je))},this.setScissor=function(k,te,he,je){Mt.scissor(Oe.set(k,te,he,je))},this.setScissorTest=function(k){Mt.setScissorTest(Le=k)},this.getClearColor=function(){return Ie},this.setClearColor=function(k,te){Ie.set(k),Mt.buffers.color.setClear(Ie.r,Ie.g,Ie.b,Z=void 0!==te?te:1,y)},this.getClearAlpha=function(){return Z},this.setClearAlpha=function(k){Mt.buffers.color.setClear(Ie.r,Ie.g,Ie.b,Z=k,y)},this.clear=function(k,te,he){var je=0;(void 0===k||k)&&(je|=de.COLOR_BUFFER_BIT),(void 0===te||te)&&(je|=de.DEPTH_BUFFER_BIT),(void 0===he||he)&&(je|=de.STENCIL_BUFFER_BIT),de.clear(je)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.clearTarget=function(k,te,he,je){this.setRenderTarget(k),this.clear(te,he,je)},this.resetGLState=Jl,this.dispose=function(){R=[],P=-1,T=[],A=-1,l.removeEventListener("webglcontextlost",En,!1)},this.renderBufferImmediate=function(k,te,he){Mt.initAttributes();var je=fi.get(k);k.hasPositions&&!je.position&&(je.position=de.createBuffer()),k.hasNormals&&!je.normal&&(je.normal=de.createBuffer()),k.hasUvs&&!je.uv&&(je.uv=de.createBuffer()),k.hasColors&&!je.color&&(je.color=de.createBuffer());var Me=te.getAttributes();if(k.hasPositions&&(de.bindBuffer(de.ARRAY_BUFFER,je.position),de.bufferData(de.ARRAY_BUFFER,k.positionArray,de.DYNAMIC_DRAW),Mt.enableAttribute(Me.position),de.vertexAttribPointer(Me.position,3,de.FLOAT,!1,0,0)),k.hasNormals){if(de.bindBuffer(de.ARRAY_BUFFER,je.normal),!he.isMeshPhongMaterial&&!he.isMeshStandardMaterial&&!he.isMeshNormalMaterial&&he.shading===Ms)for(var jt=0,Bn=3*k.count;jt<Bn;jt+=9){var _t=k.normalArray,kn=(_t[jt+0]+_t[jt+3]+_t[jt+6])/3,$t=(_t[jt+1]+_t[jt+4]+_t[jt+7])/3,Dt=(_t[jt+2]+_t[jt+5]+_t[jt+8])/3;_t[jt+0]=kn,_t[jt+1]=$t,_t[jt+2]=Dt,_t[jt+3]=kn,_t[jt+4]=$t,_t[jt+5]=Dt,_t[jt+6]=kn,_t[jt+7]=$t,_t[jt+8]=Dt}de.bufferData(de.ARRAY_BUFFER,k.normalArray,de.DYNAMIC_DRAW),Mt.enableAttribute(Me.normal),de.vertexAttribPointer(Me.normal,3,de.FLOAT,!1,0,0)}k.hasUvs&&he.map&&(de.bindBuffer(de.ARRAY_BUFFER,je.uv),de.bufferData(de.ARRAY_BUFFER,k.uvArray,de.DYNAMIC_DRAW),Mt.enableAttribute(Me.uv),de.vertexAttribPointer(Me.uv,2,de.FLOAT,!1,0,0)),k.hasColors&&he.vertexColors!==ro&&(de.bindBuffer(de.ARRAY_BUFFER,je.color),de.bufferData(de.ARRAY_BUFFER,k.colorArray,de.DYNAMIC_DRAW),Mt.enableAttribute(Me.color),de.vertexAttribPointer(Me.color,3,de.FLOAT,!1,0,0)),Mt.disableUnusedAttributes(),de.drawArrays(de.TRIANGLES,0,k.count),k.count=0},this.renderBufferDirect=function(k,te,he,je,Me,jt){Og(je);var Bn=tp(k,te,je,Me),_t=!1,kn=he.id+"_"+Bn.id+"_"+je.wireframe;kn!==ae&&(ae=kn,_t=!0);var $t=Me.morphTargetInfluences;if(void 0!==$t){for(var Dt=[],yt=0,Ai=$t.length;yt<Ai;yt++)Dt.push([Ni=$t[yt],yt]);Dt.sort(mr),Dt.length>8&&(Dt.length=8);var $r=he.morphAttributes;for(yt=0,Ai=Dt.length;yt<Ai;yt++){var Ni;if(L[yt]=(Ni=Dt[yt])[0],0!==Ni[0]){var Tr=Ni[1];!0===je.morphTargets&&$r.position&&he.addAttribute("morphTarget"+yt,$r.position[Tr]),!0===je.morphNormals&&$r.normal&&he.addAttribute("morphNormal"+yt,$r.normal[Tr])}else!0===je.morphTargets&&he.removeAttribute("morphTarget"+yt),!0===je.morphNormals&&he.removeAttribute("morphNormal"+yt)}yt=Dt.length;for(var Ys=L.length;yt<Ys;yt++)L[yt]=0;Bn.getUniforms().setValue(de,"morphTargetInfluences",L),_t=!0}Tr=he.index;var As,ps=he.attributes.position,Ct=1;!0===je.wireframe&&(Tr=fn.getWireframeAttribute(he),Ct=2),null!==Tr?(As=pi).setIndex(Tr):As=Gi,_t&&(function jr(k,te,he,je){var Me;if(he&&he.isInstancedBufferGeometry&&null===(Me=Gt.get("ANGLE_instanced_arrays")))console.error("THREE.WebGLRenderer.setupVertexAttributes: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");else{void 0===je&&(je=0),Mt.initAttributes();var jt=he.attributes,Bn=te.getAttributes(),_t=k.defaultAttributeValues;for(var kn in Bn){var $t=Bn[kn];if($t>=0){var Dt=jt[kn];if(void 0!==Dt){var yt=Dt.normalized,Ai=Dt.itemSize,Ni=fn.getAttributeProperties(Dt),$r=Ni.__webglBuffer,Ys=Ni.type,Tr=Ni.bytesPerElement;if(Dt.isInterleavedBufferAttribute){var ps=Dt.data,Ct=ps.stride,As=Dt.offset;ps&&ps.isInstancedInterleavedBuffer?(Mt.enableAttributeAndDivisor($t,ps.meshPerAttribute,Me),void 0===he.maxInstancedCount&&(he.maxInstancedCount=ps.meshPerAttribute*ps.count)):Mt.enableAttribute($t),de.bindBuffer(de.ARRAY_BUFFER,$r),de.vertexAttribPointer($t,Ai,Ys,yt,Ct*Tr,(je*Ct+As)*Tr)}else Dt.isInstancedBufferAttribute?(Mt.enableAttributeAndDivisor($t,Dt.meshPerAttribute,Me),void 0===he.maxInstancedCount&&(he.maxInstancedCount=Dt.meshPerAttribute*Dt.count)):Mt.enableAttribute($t),de.bindBuffer(de.ARRAY_BUFFER,$r),de.vertexAttribPointer($t,Ai,Ys,yt,0,je*Ai*Tr)}else if(void 0!==_t){var Co=_t[kn];if(void 0!==Co)switch(Co.length){case 2:de.vertexAttrib2fv($t,Co);break;case 3:de.vertexAttrib3fv($t,Co);break;case 4:de.vertexAttrib4fv($t,Co);break;default:de.vertexAttrib1fv($t,Co)}}}}Mt.disableUnusedAttributes()}}(je,Bn,he),null!==Tr&&de.bindBuffer(de.ELEMENT_ARRAY_BUFFER,fn.getAttributeBuffer(Tr)));var Co=0;null!==Tr?Co=Tr.count:void 0!==ps&&(Co=ps.count);var w_=he.drawRange.start*Ct,zw=he.drawRange.count*Ct,b_=null!==jt?jt.start*Ct:0,E_=null!==jt?jt.count*Ct:1/0,ip=Math.max(w_,b_),rp=Math.min(Co,w_+zw,b_+E_)-1,id=Math.max(0,rp-ip+1);if(0!==id){if(Me.isMesh)if(!0===je.wireframe)Mt.setLineWidth(je.wireframeLinewidth*Ta()),As.setMode(de.LINES);else switch(Me.drawMode){case ag:As.setMode(de.TRIANGLES);break;case wr:As.setMode(de.TRIANGLE_STRIP);break;case Dy:As.setMode(de.TRIANGLE_FAN)}else if(Me.isLine){var ll=je.linewidth;void 0===ll&&(ll=1),Mt.setLineWidth(ll*Ta()),As.setMode(Me.isLineSegments?de.LINES:de.LINE_STRIP)}else Me.isPoints&&As.setMode(de.POINTS);he&&he.isInstancedBufferGeometry?he.maxInstancedCount>0&&As.renderInstances(he,ip,id):As.render(ip,id)}},this.render=function(k,te,he,je){if(void 0===te||!0===te.isCamera){ae="",q=-1,se=null,!0===k.autoUpdate&&k.updateMatrixWorld(),null===te.parent&&te.updateMatrixWorld(),te.matrixWorldInverse.getInverse(te.matrixWorld),tt.multiplyMatrices(te.projectionMatrix,te.matrixWorldInverse),Qe.setFromMatrix(tt),w.length=0,A=-1,P=-1,B.length=0,U.length=0,He=Ye.init(this.clippingPlanes,ye=this.localClippingEnabled,te),Ng(k,te),T.length=A+1,R.length=P+1,!0===F.sortObjects&&(T.sort(Kl),R.sort(Li)),He&&Ye.beginShadows(),function Vw(k){for(var te=0,he=0,je=k.length;he<je;he++){var Me=k[he];Me.castShadow&&(st.shadows[te++]=Me)}st.shadows.length=te}(w),al.render(k,te),function Bg(k,te){var he,je,Me,kn,$t,Dt,yt,jt=0,Bn=0,_t=0,Ai=te.matrixWorldInverse,Ni=0,$r=0,Ys=0,Tr=0,ps=0;for(he=0,je=k.length;he<je;he++)if(kn=(Me=k[he]).color,$t=Me.intensity,Dt=Me.distance,yt=Me.shadow&&Me.shadow.map?Me.shadow.map.texture:null,Me.isAmbientLight)jt+=kn.r*$t,Bn+=kn.g*$t,_t+=kn.b*$t;else if(Me.isDirectionalLight)(Ct=Zn.get(Me)).color.copy(Me.color).multiplyScalar(Me.intensity),Ct.direction.setFromMatrixPosition(Me.matrixWorld),Je.setFromMatrixPosition(Me.target.matrixWorld),Ct.direction.sub(Je),Ct.direction.transformDirection(Ai),Ct.shadow=Me.castShadow,Me.castShadow&&(Ct.shadowBias=Me.shadow.bias,Ct.shadowRadius=Me.shadow.radius,Ct.shadowMapSize=Me.shadow.mapSize),st.directionalShadowMap[Ni]=yt,st.directionalShadowMatrix[Ni]=Me.shadow.matrix,st.directional[Ni++]=Ct;else if(Me.isSpotLight)(Ct=Zn.get(Me)).position.setFromMatrixPosition(Me.matrixWorld),Ct.position.applyMatrix4(Ai),Ct.color.copy(kn).multiplyScalar($t),Ct.distance=Dt,Ct.direction.setFromMatrixPosition(Me.matrixWorld),Je.setFromMatrixPosition(Me.target.matrixWorld),Ct.direction.sub(Je),Ct.direction.transformDirection(Ai),Ct.coneCos=Math.cos(Me.angle),Ct.penumbraCos=Math.cos(Me.angle*(1-Me.penumbra)),Ct.decay=0===Me.distance?0:Me.decay,Ct.shadow=Me.castShadow,Me.castShadow&&(Ct.shadowBias=Me.shadow.bias,Ct.shadowRadius=Me.shadow.radius,Ct.shadowMapSize=Me.shadow.mapSize),st.spotShadowMap[Ys]=yt,st.spotShadowMatrix[Ys]=Me.shadow.matrix,st.spot[Ys++]=Ct;else if(Me.isRectAreaLight)(Ct=Zn.get(Me)).color.copy(kn).multiplyScalar($t/(Me.width*Me.height)),Ct.position.setFromMatrixPosition(Me.matrixWorld),Ct.position.applyMatrix4(Ai),At.identity(),Lt.copy(Me.matrixWorld),Lt.premultiply(Ai),At.extractRotation(Lt),Ct.halfWidth.set(.5*Me.width,0,0),Ct.halfHeight.set(0,.5*Me.height,0),Ct.halfWidth.applyMatrix4(At),Ct.halfHeight.applyMatrix4(At),st.rectArea[Tr++]=Ct;else if(Me.isPointLight)(Ct=Zn.get(Me)).position.setFromMatrixPosition(Me.matrixWorld),Ct.position.applyMatrix4(Ai),Ct.color.copy(Me.color).multiplyScalar(Me.intensity),Ct.distance=Me.distance,Ct.decay=0===Me.distance?0:Me.decay,Ct.shadow=Me.castShadow,Me.castShadow&&(Ct.shadowBias=Me.shadow.bias,Ct.shadowRadius=Me.shadow.radius,Ct.shadowMapSize=Me.shadow.mapSize),st.pointShadowMap[$r]=yt,void 0===st.pointShadowMatrix[$r]&&(st.pointShadowMatrix[$r]=new Wt),Je.setFromMatrixPosition(Me.matrixWorld).negate(),st.pointShadowMatrix[$r].identity().setPosition(Je),st.point[$r++]=Ct;else if(Me.isHemisphereLight){var Ct;(Ct=Zn.get(Me)).direction.setFromMatrixPosition(Me.matrixWorld),Ct.direction.transformDirection(Ai),Ct.direction.normalize(),Ct.skyColor.copy(Me.color).multiplyScalar($t),Ct.groundColor.copy(Me.groundColor).multiplyScalar($t),st.hemi[ps++]=Ct}st.ambient[0]=jt,st.ambient[1]=Bn,st.ambient[2]=_t,st.directional.length=Ni,st.spot.length=Ys,st.rectArea.length=Tr,st.point.length=$r,st.hemi.length=ps,st.hash=Ni+","+$r+","+Ys+","+Tr+","+ps+","+st.shadows.length}(w,te),He&&Ye.endShadows(),tn.calls=0,tn.vertices=0,tn.faces=0,tn.points=0,void 0===he&&(he=null),this.setRenderTarget(he);var Me=k.background;if(null===Me?Mt.buffers.color.setClear(Ie.r,Ie.g,Ie.b,Z,y):Me&&Me.isColor&&(Mt.buffers.color.setClear(Me.r,Me.g,Me.b,1,y),je=!0),(this.autoClear||je)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil),Me&&Me.isCubeTexture?(Ti.projectionMatrix.copy(te.projectionMatrix),Ti.matrixWorld.extractRotation(te.matrixWorld),Ti.matrixWorldInverse.getInverse(Ti.matrixWorld),lr.material.uniforms.tCube.value=Me,lr.modelViewMatrix.multiplyMatrices(Ti.matrixWorldInverse,lr.matrixWorld),fn.update(lr),F.renderBufferDirect(Ti,null,lr.geometry,lr.material,lr,null)):Me&&Me.isTexture&&(Ci.material.map=Me,fn.update(Ci),F.renderBufferDirect(Wi,null,Ci.geometry,Ci.material,Ci,null)),k.overrideMaterial){var jt=k.overrideMaterial;Aa(T,k,te,jt),Aa(R,k,te,jt)}else Mt.setBlending(th),Aa(T,k,te),Aa(R,k,te);Ee.render(k,te),nn.render(k,te,me),he&&sn.updateRenderTargetMipmap(he),Mt.setDepthTest(!0),Mt.setDepthWrite(!0),Mt.setColorWrite(!0)}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.setFaceCulling=function(k,te){Mt.setCullFace(k),Mt.setFlipSided(te===Qu)},this.allocTextureUnit=function M_(){var k=Fe;return k>=$n.maxTextures&&console.warn("WebGLRenderer: trying to use "+k+" texture units while this GPU supports only "+$n.maxTextures),Fe+=1,k},this.setTexture2D=(k=!1,function(he,je){he&&he.isWebGLRenderTarget&&(k||(console.warn("THREE.WebGLRenderer.setTexture2D: don't use render targets as textures. Use their .texture property instead."),k=!0),he=he.texture),sn.setTexture2D(he,je)}),this.setTexture=function(){var k=!1;return function(he,je){k||(console.warn("THREE.WebGLRenderer: .setTexture is deprecated, use setTexture2D instead."),k=!0),sn.setTexture2D(he,je)}}(),this.setTextureCube=function(){var k=!1;return function(he,je){he&&he.isWebGLRenderTargetCube&&(k||(console.warn("THREE.WebGLRenderer.setTextureCube: don't use cube render targets as textures. Use their .texture property instead."),k=!0),he=he.texture),he&&he.isCubeTexture||Array.isArray(he.image)&&6===he.image.length?sn.setTextureCube(he,je):sn.setTextureCubeDynamic(he,je)}}(),this.getCurrentRenderTarget=function(){return H},this.setRenderTarget=function(k){H=k,k&&void 0===fi.get(k).__webglFramebuffer&&sn.setupRenderTarget(k);var he,te=k&&k.isWebGLRenderTargetCube;if(k){var je=fi.get(k);he=te?je.__webglFramebuffer[k.activeCubeFace]:je.__webglFramebuffer,le.copy(k.scissor),ue=k.scissorTest,me.copy(k.viewport)}else he=null,le.copy(Oe).multiplyScalar(Te),ue=Le,me.copy(Ne).multiplyScalar(Te);if(J!==he&&(de.bindFramebuffer(de.FRAMEBUFFER,he),J=he),Mt.scissor(le),Mt.setScissorTest(ue),Mt.viewport(me),te){var Me=fi.get(k.texture);de.framebufferTexture2D(de.FRAMEBUFFER,de.COLOR_ATTACHMENT0,de.TEXTURE_CUBE_MAP_POSITIVE_X+k.activeCubeFace,Me.__webglTexture,k.activeMipMapLevel)}},this.readRenderTargetPixels=function(k,te,he,je,Me,jt){if(!1!==(k&&k.isWebGLRenderTarget)){var Bn=fi.get(k).__webglFramebuffer;if(Bn){var _t=!1;Bn!==J&&(de.bindFramebuffer(de.FRAMEBUFFER,Bn),_t=!0);try{var kn=k.texture,$t=kn.format,Dt=kn.type;if($t!==zo&&uo($t)!==de.getParameter(de.IMPLEMENTATION_COLOR_READ_FORMAT))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!(Dt===sh||uo(Dt)===de.getParameter(de.IMPLEMENTATION_COLOR_READ_TYPE)||Dt===Sl&&(Gt.get("OES_texture_float")||Gt.get("WEBGL_color_buffer_float"))||Dt===oh&&Gt.get("EXT_color_buffer_half_float")))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");de.checkFramebufferStatus(de.FRAMEBUFFER)===de.FRAMEBUFFER_COMPLETE?te>=0&&te<=k.width-je&&he>=0&&he<=k.height-Me&&de.readPixels(te,he,je,Me,uo($t),uo(Dt),jt):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{_t&&de.bindFramebuffer(de.FRAMEBUFFER,J)}}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")}}function jc(s,l){this.name="",this.color=new Tt(s),this.density=void 0!==l?l:25e-5}function Qa(s,l,c){this.name="",this.color=new Tt(s),this.near=void 0!==l?l:1,this.far=void 0!==c?c:1e3}function $c(){at.call(this),this.type="Scene",this.background=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0}function a_(s,l,c,d,p){at.call(this),this.lensFlares=[],this.positionScreen=new z,this.customUpdateCallback=void 0,void 0!==s&&this.add(s,l,c,d,p)}function Dl(s){wn.call(this),this.type="SpriteMaterial",this.color=new Tt(16777215),this.map=null,this.rotation=0,this.fog=!1,this.lights=!1,this.setValues(s)}function Xc(s){at.call(this),this.type="Sprite",this.material=void 0!==s?s:new Dl}function qc(){at.call(this),this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}})}function Rf(s,l,c){if(this.useVertexTexture=void 0===c||c,this.identityMatrix=new Wt,this.bones=(s=s||[]).slice(0),this.useVertexTexture){var d=Math.sqrt(4*this.bones.length);d=dn.nextPowerOfTwo(Math.ceil(d)),d=Math.max(d,4),this.boneTextureWidth=d,this.boneTextureHeight=d,this.boneMatrices=new Float32Array(this.boneTextureWidth*this.boneTextureHeight*4),this.boneTexture=new Za(this.boneMatrices,this.boneTextureWidth,this.boneTextureHeight,zo,Sl)}else this.boneMatrices=new Float32Array(16*this.bones.length);if(void 0===l)this.calculateInverses();else if(this.bones.length===l.length)this.boneInverses=l.slice(0);else{console.warn("THREE.Skeleton bonInverses is the wrong length."),this.boneInverses=[];for(var p=0,m=this.bones.length;p<m;p++)this.boneInverses.push(new Wt)}}function If(){at.call(this),this.type="Bone"}function Pf(s,l,c){br.call(this,s,l),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Wt,this.bindMatrixInverse=new Wt;var d=[];if(this.geometry&&void 0!==this.geometry.bones){for(var p,m,v=0,y=this.geometry.bones.length;v<y;++v)m=this.geometry.bones[v],p=new If,d.push(p),p.name=m.name,p.position.fromArray(m.pos),p.quaternion.fromArray(m.rotq),void 0!==m.scl&&p.scale.fromArray(m.scl);for(v=0,y=this.geometry.bones.length;v<y;++v)-1!==(m=this.geometry.bones[v]).parent&&null!==m.parent&&void 0!==d[m.parent]?d[m.parent].add(d[v]):this.add(d[v])}this.normalizeSkinWeights(),this.updateMatrixWorld(!0),this.bind(new Rf(d,void 0,c),this.matrixWorld)}function Ji(s){wn.call(this),this.type="LineBasicMaterial",this.color=new Tt(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.lights=!1,this.setValues(s)}function ga(s,l,c){if(1===c)return console.warn("THREE.Line: parameter THREE.LinePieces no longer supported. Created THREE.LineSegments instead."),new Di(s,l);at.call(this),this.type="Line",this.geometry=void 0!==s?s:new kt,this.material=void 0!==l?l:new Ji({color:16777215*Math.random()})}function Di(s,l){ga.call(this,s,l),this.type="LineSegments"}function bo(s){wn.call(this),this.type="PointsMaterial",this.color=new Tt(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.lights=!1,this.setValues(s)}function Ch(s,l){at.call(this),this.type="Points",this.geometry=void 0!==s?s:new kt,this.material=void 0!==l?l:new bo({color:16777215*Math.random()})}function Ah(){at.call(this),this.type="Group"}function hs(s,l,c,d,p,m,v,y,b){mt.call(this,s,l,c,d,p,m,v,y,b),this.generateMipmaps=!1;var w=this;!function T(){requestAnimationFrame(T),s.readyState>=s.HAVE_CURRENT_DATA&&(w.needsUpdate=!0)}()}function Rl(s,l,c,d,p,m,v,y,b,w,T,A){mt.call(this,null,m,v,y,b,w,d,p,T,A),this.image={width:l,height:c},this.mipmaps=s,this.flipY=!1,this.generateMipmaps=!1}function Lf(s,l,c,d,p,m,v,y,b){mt.call(this,s,l,c,d,p,m,v,y,b),this.needsUpdate=!0}function Dh(s,l,c,d,p,m,v,y,b,w){if((w=void 0!==w?w:os)!==os&&w!==Nc)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===c&&w===os&&(c=Pc),void 0===c&&w===Nc&&(c=ah),mt.call(this,null,d,p,m,v,y,w,c,b),this.image={width:s,height:l},this.magFilter=void 0!==v?v:Us,this.minFilter=void 0!==y?y:Us,this.flipY=!1,this.generateMipmaps=!1}function Il(s){kt.call(this);var l=[0,0],c={};function d(Ie,Z){return Ie-Z}var p=["a","b","c"];if(s&&s.isGeometry){for(var m=s.vertices,v=s.faces,y=0,b=new Uint32Array(6*v.length),w=0,T=v.length;w<T;w++)for(var A=v[w],R=0;R<3;R++)l[0]=A[p[R]],l[1]=A[p[(R+1)%3]],l.sort(d),void 0===c[P=l.toString()]&&(b[2*y]=l[0],b[2*y+1]=l[1],c[P]=!0,y++);var L=new Float32Array(2*y*3);for(w=0,T=y;w<T;w++)for(R=0;R<2;R++){var B=m[b[2*w+R]];L[0+(U=6*w+3*R)]=B.x,L[U+1]=B.y,L[U+2]=B.z}this.addAttribute("position",new lt(L,3))}else if(s&&s.isBufferGeometry)if(null!==s.index){var F=s.index.array,V=(m=s.attributes.position,s.groups);y=0,0===V.length&&s.addGroup(0,F.length),b=new Uint32Array(2*F.length);for(var H=0,J=V.length;H<J;++H)for(var q=V[H],ae=q.start,le=(w=ae,ae+q.count);w<le;w+=3)for(R=0;R<3;R++){var P;l[0]=F[w+R],l[1]=F[w+(R+1)%3],l.sort(d),void 0===c[P=l.toString()]&&(b[2*y]=l[0],b[2*y+1]=l[1],c[P]=!0,y++)}for(L=new Float32Array(2*y*3),w=0,T=y;w<T;w++)for(R=0;R<2;R++)L[0+(U=6*w+3*R)]=m.getX(ue=b[2*w+R]),L[U+1]=m.getY(ue),L[U+2]=m.getZ(ue);this.addAttribute("position",new lt(L,3))}else{var me=(y=(m=s.attributes.position.array).length/3)/3;for(L=new Float32Array(2*y*3),w=0,T=me;w<T;w++)for(R=0;R<3;R++){var U,ue,Fe=9*w+3*R;L[0+(U=18*w+6*R)]=m[Fe],L[U+1]=m[Fe+1],L[U+2]=m[Fe+2],L[U+3]=m[ue=9*w+(R+1)%3*3],L[U+4]=m[ue+1],L[U+5]=m[ue+2]}this.addAttribute("position",new lt(L,3))}}function Pl(s,l,c){kt.call(this),this.type="ParametricBufferGeometry",this.parameters={func:s,slices:l,stacks:c};var m,v,y,b,w,d=[],p=[],T=l+1;for(m=0;m<=c;m++)for(w=m/c,v=0;v<=l;v++)y=s(b=v/l,w),d.push(y.x,y.y,y.z),p.push(b,w);var P,L,B,A=[];for(m=0;m<c;m++)for(v=0;v<l;v++)L=(m+1)*T+v+1,A.push(m*T+v,P=m*T+v+1,B=(m+1)*T+v),A.push(P,L,B);this.setIndex(new(A.length>65535?Ka:Ja)(A,1)),this.addAttribute("position",new On(d,3)),this.addAttribute("uv",new On(p,2)),this.computeVertexNormals()}function Rh(s,l,c){vn.call(this),this.type="ParametricGeometry",this.parameters={func:s,slices:l,stacks:c},this.fromBufferGeometry(new Pl(s,l,c)),this.mergeVertices()}function ts(s,l,c,d){kt.call(this),this.type="PolyhedronBufferGeometry",this.parameters={vertices:s,indices:l,radius:c,detail:d},c=c||1;var p=[],m=[];function y(F,V,H,J){var se,le,q=Math.pow(2,J),ae=[];for(se=0;se<=q;se++){ae[se]=[];var ue=F.clone().lerp(H,se/q),me=V.clone().lerp(H,se/q),Fe=q-se;for(le=0;le<=Fe;le++)ae[se][le]=0===le&&se===q?ue:ue.clone().lerp(me,le/Fe)}for(se=0;se<q;se++)for(le=0;le<2*(q-se)-1;le++){var Ie=Math.floor(le/2);le%2==0?(A(ae[se][Ie+1]),A(ae[se+1][Ie]),A(ae[se][Ie])):(A(ae[se][Ie+1]),A(ae[se+1][Ie+1]),A(ae[se+1][Ie]))}}function A(F){p.push(F.x,F.y,F.z)}function R(F,V){var H=3*F;V.x=s[H+0],V.y=s[H+1],V.z=s[H+2]}function L(F,V,H,J){J<0&&1===F.x&&(m[V]=F.x-1),0===H.x&&0===H.z&&(m[V]=J/2/Math.PI+.5)}function B(F){return Math.atan2(F.z,-F.x)}function U(F){return Math.atan2(-F.y,Math.sqrt(F.x*F.x+F.z*F.z))}(function v(F){for(var V=new z,H=new z,J=new z,q=0;q<l.length;q+=3)R(l[q+0],V),R(l[q+1],H),R(l[q+2],J),y(V,H,J,F)})(d=d||0),function b(F){for(var V=new z,H=0;H<p.length;H+=3)V.x=p[H+0],V.y=p[H+1],V.z=p[H+2],V.normalize().multiplyScalar(F),p[H+0]=V.x,p[H+1]=V.y,p[H+2]=V.z}(c),function w(){for(var F=new z,V=0;V<p.length;V+=3){F.x=p[V+0],F.y=p[V+1],F.z=p[V+2];var H=B(F)/2/Math.PI+.5,J=U(F)/Math.PI+.5;m.push(H,1-J)}(function P(){for(var F=new z,V=new z,H=new z,J=new z,q=new ut,ae=new ut,se=new ut,le=0,ue=0;le<p.length;le+=9,ue+=6){F.set(p[le+0],p[le+1],p[le+2]),V.set(p[le+3],p[le+4],p[le+5]),H.set(p[le+6],p[le+7],p[le+8]),q.set(m[ue+0],m[ue+1]),ae.set(m[ue+2],m[ue+3]),se.set(m[ue+4],m[ue+5]),J.copy(F).add(V).add(H).divideScalar(3);var me=B(J);L(q,ue+0,F,me),L(ae,ue+2,V,me),L(se,ue+4,H,me)}})(),function T(){for(var F=0;F<m.length;F+=6){var V=m[F+0],H=m[F+2],J=m[F+4],q=Math.max(V,H,J),ae=Math.min(V,H,J);q>.9&&ae<.1&&(V<.2&&(m[F+0]+=1),H<.2&&(m[F+2]+=1),J<.2&&(m[F+4]+=1))}}()}(),this.addAttribute("position",new On(p,3)),this.addAttribute("normal",new On(p.slice(),3)),this.addAttribute("uv",new On(m,2)),this.normalizeNormals(),this.boundingSphere=new or(new z,c)}function Yc(s,l){ts.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],s,l),this.type="TetrahedronBufferGeometry",this.parameters={radius:s,detail:l}}function Ts(s,l){vn.call(this),this.type="TetrahedronGeometry",this.parameters={radius:s,detail:l},this.fromBufferGeometry(new Yc(s,l)),this.mergeVertices()}function el(s,l){ts.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],s,l),this.type="OctahedronBufferGeometry",this.parameters={radius:s,detail:l}}function Zc(s,l){vn.call(this),this.type="OctahedronGeometry",this.parameters={radius:s,detail:l},this.fromBufferGeometry(new el(s,l)),this.mergeVertices()}function Qn(s,l){var c=(1+Math.sqrt(5))/2;ts.call(this,[-1,c,0,1,c,0,-1,-c,0,1,-c,0,0,-1,c,0,1,c,0,-1,-c,0,1,-c,c,0,-1,c,0,1,-c,0,-1,-c,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],s,l),this.type="IcosahedronBufferGeometry",this.parameters={radius:s,detail:l}}function Ll(s,l){vn.call(this),this.type="IcosahedronGeometry",this.parameters={radius:s,detail:l},this.fromBufferGeometry(new Qn(s,l)),this.mergeVertices()}function va(s,l){var c=(1+Math.sqrt(5))/2,d=1/c;ts.call(this,[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-d,-c,0,-d,c,0,d,-c,0,d,c,-d,-c,0,-d,c,0,d,-c,0,d,c,0,-c,0,-d,c,0,-d,-c,0,d,c,0,d],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],s,l),this.type="DodecahedronBufferGeometry",this.parameters={radius:s,detail:l}}function Rr(s,l){vn.call(this),this.type="DodecahedronGeometry",this.parameters={radius:s,detail:l},this.fromBufferGeometry(new va(s,l)),this.mergeVertices()}function Ih(s,l,c,d){vn.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:s,indices:l,radius:c,detail:d},this.fromBufferGeometry(new ts(s,l,c,d)),this.mergeVertices()}function Nl(s,l,c,d,p){kt.call(this),this.type="TubeBufferGeometry",this.parameters={path:s,tubularSegments:l,radius:c,radialSegments:d,closed:p},c=c||1,d=d||8;var m=s.computeFrenetFrames(l=l||64,p=p||!1);this.tangents=m.tangents,this.normals=m.normals,this.binormals=m.binormals;var w,T,v=new z,y=new z,b=new ut,A=[],R=[],P=[],L=[];function U(H){var J=s.getPointAt(H/l),q=m.normals[H],ae=m.binormals[H];for(T=0;T<=d;T++){var se=T/d*Math.PI*2,le=Math.sin(se),ue=-Math.cos(se);y.x=ue*q.x+le*ae.x,y.y=ue*q.y+le*ae.y,y.z=ue*q.z+le*ae.z,y.normalize(),R.push(y.x,y.y,y.z),v.x=J.x+c*y.x,v.y=J.y+c*y.y,v.z=J.z+c*y.z,A.push(v.x,v.y,v.z)}}(function B(){for(w=0;w<l;w++)U(w);U(!1===p?l:0),function V(){for(w=0;w<=l;w++)for(T=0;T<=d;T++)b.x=w/l,b.y=T/d,P.push(b.x,b.y)}(),function F(){for(T=1;T<=l;T++)for(w=1;w<=d;w++){var J=(d+1)*T+(w-1),q=(d+1)*T+w,ae=(d+1)*(T-1)+w;L.push((d+1)*(T-1)+(w-1),J,ae),L.push(J,q,ae)}}()})(),this.setIndex(new(L.length>65535?Ka:Ja)(L,1)),this.addAttribute("position",new On(A,3)),this.addAttribute("normal",new On(R,3)),this.addAttribute("uv",new On(P,2))}function Xo(s,l,c,d,p,m){vn.call(this),this.type="TubeGeometry",this.parameters={path:s,tubularSegments:l,radius:c,radialSegments:d,closed:p},void 0!==m&&console.warn("THREE.TubeGeometry: taper has been removed.");var v=new Nl(s,l,c,d,p);this.tangents=v.tangents,this.normals=v.normals,this.binormals=v.binormals,this.fromBufferGeometry(v),this.mergeVertices()}function Ir(s,l,c,d,p,m){kt.call(this),this.type="TorusKnotBufferGeometry",this.parameters={radius:s,tube:l,tubularSegments:c,radialSegments:d,p,q:m},s=s||100,l=l||40,c=Math.floor(c)||64,p=p||2,m=m||3;var R,P,v=((d=Math.floor(d)||8)+1)*(c+1),y=d*c*2*3,b=new lt(new(y>65535?Uint32Array:Uint16Array)(y),1),w=new lt(new Float32Array(3*v),3),T=new lt(new Float32Array(3*v),3),A=new lt(new Float32Array(2*v),2),L=0,B=0,U=new z,F=new z,V=new ut,H=new z,J=new z,q=new z,ae=new z,se=new z;for(R=0;R<=c;++R){var le=R/c*p*Math.PI*2;for(Te(le,p,m,s,H),Te(le+.01,p,m,s,J),ae.subVectors(J,H),se.addVectors(J,H),q.crossVectors(ae,se),se.crossVectors(q,ae),q.normalize(),se.normalize(),P=0;P<=d;++P){var ue=P/d*Math.PI*2,me=-l*Math.cos(ue),Fe=l*Math.sin(ue);U.x=H.x+(me*se.x+Fe*q.x),U.y=H.y+(me*se.y+Fe*q.y),U.z=H.z+(me*se.z+Fe*q.z),w.setXYZ(L,U.x,U.y,U.z),F.subVectors(U,H).normalize(),T.setXYZ(L,F.x,F.y,F.z),V.x=R/c,V.y=P/d,A.setXY(L,V.x,V.y),L++}}for(P=1;P<=c;P++)for(R=1;R<=d;R++){var Z=(d+1)*P+(R-1),ee=(d+1)*P+R,ve=(d+1)*(P-1)+R;b.setX(B,(d+1)*(P-1)+(R-1)),B++,b.setX(B,Z),B++,b.setX(B,ve),B++,b.setX(B,Z),B++,b.setX(B,ee),B++,b.setX(B,ve),B++}function Te(Oe,Le,Ne,Qe,Ye){var He=Math.cos(Oe),ye=Math.sin(Oe),Ge=Ne/Le*Oe,tt=Math.cos(Ge);Ye.x=Qe*(2+tt)*.5*He,Ye.y=Qe*(2+tt)*ye*.5,Ye.z=Qe*Math.sin(Ge)*.5}this.setIndex(b),this.addAttribute("position",w),this.addAttribute("normal",T),this.addAttribute("uv",A)}function Ph(s,l,c,d,p,m,v){vn.call(this),this.type="TorusKnotGeometry",this.parameters={radius:s,tube:l,tubularSegments:c,radialSegments:d,p,q:m},void 0!==v&&console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead."),this.fromBufferGeometry(new Ir(s,l,c,d,p,m)),this.mergeVertices()}function Jc(s,l,c,d,p){kt.call(this),this.type="TorusBufferGeometry",this.parameters={radius:s,tube:l,radialSegments:c,tubularSegments:d,arc:p},s=s||100,l=l||40,c=Math.floor(c)||8,d=Math.floor(d)||6,p=p||2*Math.PI;var F,V,m=(c+1)*(d+1),v=c*d*2*3,y=new(v>65535?Uint32Array:Uint16Array)(v),b=new Float32Array(3*m),w=new Float32Array(3*m),T=new Float32Array(2*m),A=0,R=0,P=0,L=new z,B=new z,U=new z;for(F=0;F<=c;F++)for(V=0;V<=d;V++){var H=V/d*p,J=F/c*Math.PI*2;B.x=(s+l*Math.cos(J))*Math.cos(H),B.y=(s+l*Math.cos(J))*Math.sin(H),B.z=l*Math.sin(J),b[A]=B.x,b[A+1]=B.y,b[A+2]=B.z,L.x=s*Math.cos(H),L.y=s*Math.sin(H),U.subVectors(B,L).normalize(),w[A]=U.x,w[A+1]=U.y,w[A+2]=U.z,T[R]=V/d,T[R+1]=F/c,A+=3,R+=2}for(F=1;F<=c;F++)for(V=1;V<=d;V++){var ae=(d+1)*(F-1)+V-1,se=(d+1)*(F-1)+V,le=(d+1)*F+V;y[P]=(d+1)*F+V-1,y[P+1]=ae,y[P+2]=le,y[P+3]=ae,y[P+4]=se,y[P+5]=le,P+=6}this.setIndex(new lt(y,1)),this.addAttribute("position",new lt(b,3)),this.addAttribute("normal",new lt(w,3)),this.addAttribute("uv",new lt(T,2))}function Lh(s,l,c,d,p){vn.call(this),this.type="TorusGeometry",this.parameters={radius:s,tube:l,radialSegments:c,tubularSegments:d,arc:p},this.fromBufferGeometry(new Jc(s,l,c,d,p))}jc.prototype.isFogExp2=!0,jc.prototype.clone=function(){return new jc(this.color.getHex(),this.density)},jc.prototype.toJSON=function(s){return{type:"FogExp2",color:this.color.getHex(),density:this.density}},Qa.prototype.isFog=!0,Qa.prototype.clone=function(){return new Qa(this.color.getHex(),this.near,this.far)},Qa.prototype.toJSON=function(s){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}},($c.prototype=Object.create(at.prototype)).constructor=$c,$c.prototype.copy=function(s,l){return at.prototype.copy.call(this,s,l),null!==s.background&&(this.background=s.background.clone()),null!==s.fog&&(this.fog=s.fog.clone()),null!==s.overrideMaterial&&(this.overrideMaterial=s.overrideMaterial.clone()),this.autoUpdate=s.autoUpdate,this.matrixAutoUpdate=s.matrixAutoUpdate,this},$c.prototype.toJSON=function(s){var l=at.prototype.toJSON.call(this,s);return null!==this.background&&(l.object.background=this.background.toJSON(s)),null!==this.fog&&(l.object.fog=this.fog.toJSON()),l},a_.prototype=Object.assign(Object.create(at.prototype),{constructor:a_,isLensFlare:!0,copy:function(s){at.prototype.copy.call(this,s),this.positionScreen.copy(s.positionScreen),this.customUpdateCallback=s.customUpdateCallback;for(var l=0,c=s.lensFlares.length;l<c;l++)this.lensFlares.push(s.lensFlares[l]);return this},add:function(s,l,c,d,p,m){void 0===l&&(l=-1),void 0===c&&(c=0),void 0===m&&(m=1),void 0===p&&(p=new Tt(16777215)),void 0===d&&(d=Wa),c=Math.min(c,Math.max(0,c)),this.lensFlares.push({texture:s,size:l,distance:c,x:0,y:0,z:0,scale:1,rotation:0,opacity:m,color:p,blending:d})},updateLensFlares:function(){var s,c,l=this.lensFlares.length,d=2*-this.positionScreen.x,p=2*-this.positionScreen.y;for(s=0;s<l;s++)(c=this.lensFlares[s]).x=this.positionScreen.x+d*c.distance,c.y=this.positionScreen.y+p*c.distance,c.wantedRotation=c.x*Math.PI*.25,c.rotation+=.25*(c.wantedRotation-c.rotation)}}),(Dl.prototype=Object.create(wn.prototype)).constructor=Dl,Dl.prototype.copy=function(s){return wn.prototype.copy.call(this,s),this.color.copy(s.color),this.map=s.map,this.rotation=s.rotation,this},Xc.prototype=Object.assign(Object.create(at.prototype),{constructor:Xc,isSprite:!0,raycast:function(){var s=new z;return function(c,d){s.setFromMatrixPosition(this.matrixWorld);var p=c.ray.distanceSqToPoint(s);p>this.scale.x*this.scale.y/4||d.push({distance:Math.sqrt(p),point:this.position,face:null,object:this})}}(),clone:function(){return new this.constructor(this.material).copy(this)}}),qc.prototype=Object.assign(Object.create(at.prototype),{constructor:qc,copy:function(s){at.prototype.copy.call(this,s,!1);for(var l=s.levels,c=0,d=l.length;c<d;c++){var p=l[c];this.addLevel(p.object.clone(),p.distance)}return this},addLevel:function(s,l){void 0===l&&(l=0),l=Math.abs(l);for(var c=this.levels,d=0;d<c.length&&!(l<c[d].distance);d++);c.splice(d,0,{distance:l,object:s}),this.add(s)},getObjectForDistance:function(s){for(var l=this.levels,c=1,d=l.length;c<d&&!(s<l[c].distance);c++);return l[c-1].object},raycast:function(){var s=new z;return function(c,d){s.setFromMatrixPosition(this.matrixWorld);var p=c.ray.origin.distanceTo(s);this.getObjectForDistance(p).raycast(c,d)}}(),update:function(){var s=new z,l=new z;return function(d){var p=this.levels;if(p.length>1){s.setFromMatrixPosition(d.matrixWorld),l.setFromMatrixPosition(this.matrixWorld);var m=s.distanceTo(l);p[0].object.visible=!0;for(var v=1,y=p.length;v<y&&m>=p[v].distance;v++)p[v-1].object.visible=!1,p[v].object.visible=!0;for(;v<y;v++)p[v].object.visible=!1}}}(),toJSON:function(s){var l=at.prototype.toJSON.call(this,s);l.object.levels=[];for(var c=this.levels,d=0,p=c.length;d<p;d++){var m=c[d];l.object.levels.push({object:m.object.uuid,distance:m.distance})}return l}}),Object.assign(Rf.prototype,{calculateInverses:function(){this.boneInverses=[];for(var s=0,l=this.bones.length;s<l;s++){var c=new Wt;this.bones[s]&&c.getInverse(this.bones[s].matrixWorld),this.boneInverses.push(c)}},pose:function(){for(var s,l=0,c=this.bones.length;l<c;l++)(s=this.bones[l])&&s.matrixWorld.getInverse(this.boneInverses[l]);for(l=0,c=this.bones.length;l<c;l++)(s=this.bones[l])&&(s.parent&&s.parent.isBone?(s.matrix.getInverse(s.parent.matrixWorld),s.matrix.multiply(s.matrixWorld)):s.matrix.copy(s.matrixWorld),s.matrix.decompose(s.position,s.quaternion,s.scale))},update:function(){var s=new Wt;return function(){for(var c=0,d=this.bones.length;c<d;c++)s.multiplyMatrices(this.bones[c]?this.bones[c].matrixWorld:this.identityMatrix,this.boneInverses[c]),s.toArray(this.boneMatrices,16*c);this.useVertexTexture&&(this.boneTexture.needsUpdate=!0)}}(),clone:function(){return new Rf(this.bones,this.boneInverses,this.useVertexTexture)}}),If.prototype=Object.assign(Object.create(at.prototype),{constructor:If,isBone:!0}),Pf.prototype=Object.assign(Object.create(br.prototype),{constructor:Pf,isSkinnedMesh:!0,bind:function(s,l){this.skeleton=s,void 0===l&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),l=this.matrixWorld),this.bindMatrix.copy(l),this.bindMatrixInverse.getInverse(l)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){if(this.geometry&&this.geometry.isGeometry)for(var s=0;s<this.geometry.skinWeights.length;s++){var l=this.geometry.skinWeights[s];(c=1/l.lengthManhattan())!=1/0?l.multiplyScalar(c):l.set(1,0,0,0)}else if(this.geometry&&this.geometry.isBufferGeometry){var d=new ri,p=this.geometry.attributes.skinWeight;for(s=0;s<p.count;s++){var c;d.x=p.getX(s),d.y=p.getY(s),d.z=p.getZ(s),d.w=p.getW(s),(c=1/d.lengthManhattan())!=1/0?d.multiplyScalar(c):d.set(1,0,0,0),p.setXYZW(s,d.x,d.y,d.z,d.w)}}},updateMatrixWorld:function(s){br.prototype.updateMatrixWorld.call(this,!0),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh unrecognized bindMode: "+this.bindMode)},clone:function(){return new this.constructor(this.geometry,this.material,this.skeleton.useVertexTexture).copy(this)}}),(Ji.prototype=Object.create(wn.prototype)).constructor=Ji,Ji.prototype.isLineBasicMaterial=!0,Ji.prototype.copy=function(s){return wn.prototype.copy.call(this,s),this.color.copy(s.color),this.linewidth=s.linewidth,this.linecap=s.linecap,this.linejoin=s.linejoin,this},ga.prototype=Object.assign(Object.create(at.prototype),{constructor:ga,isLine:!0,raycast:function(){var s=new Wt,l=new Yi,c=new or;return function(p,m){var v=p.linePrecision,y=v*v,b=this.geometry,w=this.matrixWorld;if(null===b.boundingSphere&&b.computeBoundingSphere(),c.copy(b.boundingSphere),c.applyMatrix4(w),!1!==p.ray.intersectsSphere(c)){s.getInverse(w),l.copy(p.ray).applyMatrix4(s);var T=new z,A=new z,R=new z,P=new z,L=this&&this.isLineSegments?2:1;if(b.isBufferGeometry){var B=b.index,F=b.attributes.position.array;if(null!==B)for(var V=B.array,H=0,J=V.length-1;H<J;H+=L){var ae=V[H+1];T.fromArray(F,3*V[H]),A.fromArray(F,3*ae),l.distanceSqToSegment(T,A,P,R)>y||(P.applyMatrix4(this.matrixWorld),(le=p.ray.origin.distanceTo(P))<p.near||le>p.far||m.push({distance:le,point:R.clone().applyMatrix4(this.matrixWorld),index:H,face:null,faceIndex:null,object:this}))}else for(H=0,J=F.length/3-1;H<J;H+=L)T.fromArray(F,3*H),A.fromArray(F,3*H+3),l.distanceSqToSegment(T,A,P,R)>y||(P.applyMatrix4(this.matrixWorld),(le=p.ray.origin.distanceTo(P))<p.near||le>p.far||m.push({distance:le,point:R.clone().applyMatrix4(this.matrixWorld),index:H,face:null,faceIndex:null,object:this}))}else if(b.isGeometry){var ue=b.vertices,me=ue.length;for(H=0;H<me-1;H+=L){var le;l.distanceSqToSegment(ue[H],ue[H+1],P,R)>y||(P.applyMatrix4(this.matrixWorld),(le=p.ray.origin.distanceTo(P))<p.near||le>p.far||m.push({distance:le,point:R.clone().applyMatrix4(this.matrixWorld),index:H,face:null,faceIndex:null,object:this}))}}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),Di.prototype=Object.assign(Object.create(ga.prototype),{constructor:Di,isLineSegments:!0}),(bo.prototype=Object.create(wn.prototype)).constructor=bo,bo.prototype.isPointsMaterial=!0,bo.prototype.copy=function(s){return wn.prototype.copy.call(this,s),this.color.copy(s.color),this.map=s.map,this.size=s.size,this.sizeAttenuation=s.sizeAttenuation,this},Ch.prototype=Object.assign(Object.create(at.prototype),{constructor:Ch,isPoints:!0,raycast:function(){var s=new Wt,l=new Yi,c=new or;return function(p,m){var v=this,y=this.geometry,b=this.matrixWorld,w=p.params.Points.threshold;if(null===y.boundingSphere&&y.computeBoundingSphere(),c.copy(y.boundingSphere),c.applyMatrix4(b),!1!==p.ray.intersectsSphere(c)){s.getInverse(b),l.copy(p.ray).applyMatrix4(s);var T=w/((this.scale.x+this.scale.y+this.scale.z)/3),A=T*T,R=new z;if(y.isBufferGeometry){var L=y.index,U=y.attributes.position.array;if(null!==L)for(var F=L.array,V=0,H=F.length;V<H;V++){var J=F[V];R.fromArray(U,3*J),P(R,J)}else{V=0;for(var q=U.length/3;V<q;V++)R.fromArray(U,3*V),P(R,V)}}else{var ae=y.vertices;for(V=0,q=ae.length;V<q;V++)P(ae[V],V)}}function P(se,le){var ue=l.distanceSqToPoint(se);if(ue<A){var me=l.closestPointToPoint(se);me.applyMatrix4(b);var Fe=p.ray.origin.distanceTo(me);if(Fe<p.near||Fe>p.far)return;m.push({distance:Fe,distanceToRay:Math.sqrt(ue),point:me.clone(),index:le,face:null,object:v})}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),Ah.prototype=Object.assign(Object.create(at.prototype),{constructor:Ah}),(hs.prototype=Object.create(mt.prototype)).constructor=hs,(Rl.prototype=Object.create(mt.prototype)).constructor=Rl,Rl.prototype.isCompressedTexture=!0,(Lf.prototype=Object.create(mt.prototype)).constructor=Lf,(Dh.prototype=Object.create(mt.prototype)).constructor=Dh,Dh.prototype.isDepthTexture=!0,(Il.prototype=Object.create(kt.prototype)).constructor=Il,(Pl.prototype=Object.create(kt.prototype)).constructor=Pl,(Rh.prototype=Object.create(vn.prototype)).constructor=Rh,(ts.prototype=Object.create(kt.prototype)).constructor=ts,(Yc.prototype=Object.create(ts.prototype)).constructor=Yc,(Ts.prototype=Object.create(vn.prototype)).constructor=Ts,(el.prototype=Object.create(ts.prototype)).constructor=el,(Zc.prototype=Object.create(vn.prototype)).constructor=Zc,(Qn.prototype=Object.create(ts.prototype)).constructor=Qn,(Ll.prototype=Object.create(vn.prototype)).constructor=Ll,(va.prototype=Object.create(ts.prototype)).constructor=va,(Rr.prototype=Object.create(vn.prototype)).constructor=Rr,(Ih.prototype=Object.create(vn.prototype)).constructor=Ih,(Nl.prototype=Object.create(kt.prototype)).constructor=Nl,(Xo.prototype=Object.create(vn.prototype)).constructor=Xo,(Ir.prototype=Object.create(kt.prototype)).constructor=Ir,(Ph.prototype=Object.create(vn.prototype)).constructor=Ph,(Jc.prototype=Object.create(kt.prototype)).constructor=Jc,(Lh.prototype=Object.create(vn.prototype)).constructor=Lh;var Ui={area:function(s){for(var l=s.length,c=0,d=l-1,p=0;p<l;d=p++)c+=s[d].x*s[p].y-s[p].x*s[d].y;return.5*c},triangulate:function(){function s(l,c,d,p,m,v){var y,b,w,T,A,R,P,L,B,U,F,V,H,J,q;if(((T=l[v[d]].x)-(b=l[v[c]].x))*((P=l[v[p]].y)-(w=l[v[c]].y))-((A=l[v[d]].y)-w)*((R=l[v[p]].x)-b)<=0)return!1;for(U=R-T,F=P-A,V=b-R,H=w-P,J=T-b,q=A-w,y=0;y<m;y++)if(B=l[v[y]].y,!((L=l[v[y]].x)===b&&B===w||L===T&&B===A||L===R&&B===P)&&U*(B-A)-F*(L-T)>=-Number.EPSILON&&V*(B-P)-H*(L-R)>=-Number.EPSILON&&J*(B-w)-q*(L-b)>=-Number.EPSILON)return!1;return!0}return function(c,d){var p=c.length;if(p<3)return null;var b,w,T,m=[],v=[],y=[];if(Ui.area(c)>0)for(w=0;w<p;w++)v[w]=w;else for(w=0;w<p;w++)v[w]=p-1-w;var A=p,R=2*A;for(w=A-1;A>2;){if(R--<=0)return console.warn("THREE.ShapeUtils: Unable to triangulate polygon! in triangulate()"),d?y:m;if(A<=(b=w)&&(b=0),A<=(w=b+1)&&(w=0),A<=(T=w+1)&&(T=0),s(c,b,w,T,A,v)){var U,F;for(m.push([c[v[b]],c[v[w]],c[v[T]]]),y.push([v[b],v[w],v[T]]),U=w,F=w+1;F<A;U++,F++)v[U]=v[F];R=2*--A}}return d?y:m}}(),triangulateShape:function(s,l){function c(H){var J=H.length;J>2&&H[J-1].equals(H[0])&&H.pop()}function d(H,J,q){return H.x!==J.x?H.x<J.x?H.x<=q.x&&q.x<=J.x:J.x<=q.x&&q.x<=H.x:H.y<J.y?H.y<=q.y&&q.y<=J.y:J.y<=q.y&&q.y<=H.y}function p(H,J,q,ae,se){var le=J.x-H.x,ue=J.y-H.y,me=ae.x-q.x,Fe=ae.y-q.y,Ie=H.x-q.x,Z=H.y-q.y,ee=ue*me-le*Fe,ve=ue*Ie-le*Z;if(Math.abs(ee)>Number.EPSILON){var Te;if(ee>0){if(ve<0||ve>ee)return[];if((Te=Fe*Ie-me*Z)<0||Te>ee)return[]}else{if(ve>0||ve<ee)return[];if((Te=Fe*Ie-me*Z)>0||Te<ee)return[]}if(0===Te)return!se||0!==ve&&ve!==ee?[H]:[];if(Te===ee)return!se||0!==ve&&ve!==ee?[J]:[];if(0===ve)return[q];if(ve===ee)return[ae];var Oe=Te/ee;return[{x:H.x+Oe*le,y:H.y+Oe*ue}]}if(0!==ve||Fe*Ie!=me*Z)return[];var Qe,Ye,He,ye,Ge,tt,Je,Lt,Le=0===le&&0===ue,Ne=0===me&&0===Fe;return Le&&Ne?H.x!==q.x||H.y!==q.y?[]:[H]:Le?d(q,ae,H)?[H]:[]:Ne?d(H,J,q)?[q]:[]:(0!==le?(H.x<J.x?(Qe=H,He=H.x,Ye=J,ye=J.x):(Qe=J,He=J.x,Ye=H,ye=H.x),q.x<ae.x?(Ge=q,Je=q.x,tt=ae,Lt=ae.x):(Ge=ae,Je=ae.x,tt=q,Lt=q.x)):(H.y<J.y?(Qe=H,He=H.y,Ye=J,ye=J.y):(Qe=J,He=J.y,Ye=H,ye=H.y),q.y<ae.y?(Ge=q,Je=q.y,tt=ae,Lt=ae.y):(Ge=ae,Je=ae.y,tt=q,Lt=q.y)),He<=Je?ye<Je?[]:ye===Je?se?[]:[Ge]:ye<=Lt?[Ge,Ye]:[Ge,tt]:He>Lt?[]:He===Lt?se?[]:[Qe]:ye<=Lt?[Qe,Ye]:[Qe,tt])}function m(H,J,q,ae){var se=J.x-H.x,le=J.y-H.y,ue=q.x-H.x,me=q.y-H.y,Fe=ae.x-H.x,Ie=ae.y-H.y,Z=se*me-le*ue,ee=se*Ie-le*Fe;if(Math.abs(Z)>Number.EPSILON){var ve=Fe*me-Ie*ue;return Z>0?ee>=0&&ve>=0:ee>=0||ve>=0}return ee>0}c(s),l.forEach(c);for(var y,b,w,T,A,R,P={},L=s.concat(),B=0,U=l.length;B<U;B++)Array.prototype.push.apply(L,l[B]);for(y=0,b=L.length;y<b;y++)void 0!==P[A=L[y].x+":"+L[y].y]&&console.warn("THREE.ShapeUtils: Duplicate point",A,y),P[A]=y;var F=function v(H,J){var ae,q=H.concat();function se(Lt,At){var st=q.length-1,tn=Lt-1;tn<0&&(tn=st);var de=Lt+1;de>st&&(de=0);var oi=m(q[Lt],q[tn],q[de],ae[At]);if(!oi)return!1;var Gt=ae.length-1,$n=At-1;$n<0&&($n=Gt);var Mt=At+1;return Mt>Gt&&(Mt=0),!!(oi=m(ae[At],ae[$n],ae[Mt],q[Lt]))}function le(Lt,At){var st,tn;for(st=0;st<q.length;st++)if(tn=st+1,p(Lt,At,q[st],q[tn%=q.length],!0).length>0)return!0;return!1}var ue=[];function me(Lt,At){var st,tn,de,oi;for(st=0;st<ue.length;st++)for(tn=J[ue[st]],de=0;de<tn.length;de++)if(oi=de+1,p(Lt,At,tn[de],tn[oi%=tn.length],!0).length>0)return!0;return!1}for(var Fe,Ie,Z,ee,ve,Te,Le,Ne,Qe,Ye,Oe=[],He=0,ye=J.length;He<ye;He++)ue.push(He);for(var Ge=0,tt=2*ue.length;ue.length>0;){if(--tt<0){console.log("Infinite Loop! Holes left:"+ue.length+", Probably Hole outside Shape!");break}for(Ie=Ge;Ie<q.length;Ie++){for(Z=q[Ie],Fe=-1,He=0;He<ue.length;He++)if(void 0===Oe[Te=Z.x+":"+Z.y+":"+(ve=ue[He])]){ae=J[ve];for(var Je=0;Je<ae.length;Je++)if(ee=ae[Je],se(Ie,Je)&&!le(Z,ee)&&!me(Z,ee)){Fe=Je,ue.splice(He,1),Le=q.slice(0,Ie+1),Ne=q.slice(Ie),Qe=ae.slice(Fe),Ye=ae.slice(0,Fe+1),q=Le.concat(Qe).concat(Ye).concat(Ne),Ge=Ie;break}if(Fe>=0)break;Oe[Te]=!0}if(Fe>=0)break}}return q}(s,l),V=Ui.triangulate(F,!1);for(y=0,b=V.length;y<b;y++)for(T=V[y],w=0;w<3;w++)void 0!==(R=P[A=T[w].x+":"+T[w].y])&&(T[w]=R);return V.concat()},isClockWise:function(s){return Ui.area(s)<0},b2:function(p,m,v,y){return function s(d,p){var m=1-d;return m*m*p}(p,m)+function l(d,p){return 2*(1-d)*d*p}(p,v)+function c(d,p){return d*d*p}(p,y)},b3:function(m,v,y,b,w){return function s(p,m){var v=1-p;return v*v*v*m}(m,v)+function l(p,m){var v=1-p;return 3*v*v*p*m}(m,y)+function c(p,m){return 3*(1-p)*p*p*m}(m,b)+function d(p,m){return p*p*p*m}(m,w)}};function js(s,l){typeof s>"u"?s=[]:(vn.call(this),this.type="ExtrudeGeometry",s=Array.isArray(s)?s:[s],this.addShapeList(s,l),this.computeFaceNormals())}function Nh(s,l){var c=(l=l||{}).font;if(!1===(c&&c.isFont))return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new vn;var d=c.generateShapes(s,l.size,l.curveSegments);l.amount=void 0!==l.height?l.height:50,void 0===l.bevelThickness&&(l.bevelThickness=10),void 0===l.bevelSize&&(l.bevelSize=8),void 0===l.bevelEnabled&&(l.bevelEnabled=!1),js.call(this,d,l),this.type="TextGeometry"}function tl(s,l,c,d,p,m,v){kt.call(this),this.type="SphereBufferGeometry",this.parameters={radius:s,widthSegments:l,heightSegments:c,phiStart:d,phiLength:p,thetaStart:m,thetaLength:v},s=s||50,l=Math.max(3,Math.floor(l)||8),c=Math.max(2,Math.floor(c)||6),d=void 0!==d?d:0,p=void 0!==p?p:2*Math.PI;for(var y=(m=void 0!==m?m:0)+(v=void 0!==v?v:Math.PI),b=(l+1)*(c+1),w=new lt(new Float32Array(3*b),3),T=new lt(new Float32Array(3*b),3),A=new lt(new Float32Array(2*b),2),R=0,P=[],L=new z,B=0;B<=c;B++){for(var U=[],F=B/c,V=0;V<=l;V++){var H=V/l,J=-s*Math.cos(d+H*p)*Math.sin(m+F*v),q=s*Math.cos(m+F*v),ae=s*Math.sin(d+H*p)*Math.sin(m+F*v);L.set(J,q,ae).normalize(),w.setXYZ(R,J,q,ae),T.setXYZ(R,L.x,L.y,L.z),A.setXY(R,H,1-F),U.push(R),R++}P.push(U)}var se=[];for(B=0;B<c;B++)for(V=0;V<l;V++){var ue=P[B][V],me=P[B+1][V],Fe=P[B+1][V+1];(0!==B||m>0)&&se.push(P[B][V+1],ue,Fe),(B!==c-1||y<Math.PI)&&se.push(ue,me,Fe)}this.setIndex(new(w.count>65535?Ka:Ja)(se,1)),this.addAttribute("position",w),this.addAttribute("normal",T),this.addAttribute("uv",A),this.boundingSphere=new or(new z,s)}function Kc(s,l,c,d,p,m,v){vn.call(this),this.type="SphereGeometry",this.parameters={radius:s,widthSegments:l,heightSegments:c,phiStart:d,phiLength:p,thetaStart:m,thetaLength:v},this.fromBufferGeometry(new tl(s,l,c,d,p,m,v))}function Ol(s,l,c,d,p,m){kt.call(this),this.type="RingBufferGeometry",this.parameters={innerRadius:s,outerRadius:l,thetaSegments:c,phiSegments:d,thetaStart:p,thetaLength:m},s=s||20,l=l||50,p=void 0!==p?p:0,m=void 0!==m?m:2*Math.PI;var L,H,J,v=((c=void 0!==c?Math.max(3,c):8)+1)*((d=void 0!==d?Math.max(1,d):1)+1),y=c*d*2*3,b=new lt(new(y>65535?Uint32Array:Uint16Array)(y),1),w=new lt(new Float32Array(3*v),3),T=new lt(new Float32Array(3*v),3),A=new lt(new Float32Array(2*v),2),R=0,P=0,B=s,U=(l-s)/d,F=new z,V=new ut;for(H=0;H<=d;H++){for(J=0;J<=c;J++)L=p+J/c*m,F.x=B*Math.cos(L),F.y=B*Math.sin(L),w.setXYZ(R,F.x,F.y,F.z),T.setXYZ(R,0,0,1),V.x=(F.x/l+1)/2,V.y=(F.y/l+1)/2,A.setXY(R,V.x,V.y),R++;B+=U}for(H=0;H<d;H++){var q=H*(c+1);for(J=0;J<c;J++){var ae=L=J+q,se=L+c+1,le=L+c+2,ue=L+1;b.setX(P,ae),P++,b.setX(P,se),P++,b.setX(P,le),P++,b.setX(P,ae),P++,b.setX(P,le),P++,b.setX(P,ue),P++}}this.setIndex(b),this.addAttribute("position",w),this.addAttribute("normal",T),this.addAttribute("uv",A)}function Oh(s,l,c,d,p,m){vn.call(this),this.type="RingGeometry",this.parameters={innerRadius:s,outerRadius:l,thetaSegments:c,phiSegments:d,thetaStart:p,thetaLength:m},this.fromBufferGeometry(new Ol(s,l,c,d,p,m))}function Yt(s,l,c,d){vn.call(this),this.type="PlaneGeometry",this.parameters={width:s,height:l,widthSegments:c,heightSegments:d},this.fromBufferGeometry(new Hc(s,l,c,d))}function Fl(s,l,c,d){kt.call(this),this.type="LatheBufferGeometry",this.parameters={points:s,segments:l,phiStart:c,phiLength:d},l=Math.floor(l)||12,c=c||0,d=d||2*Math.PI,d=dn.clamp(d,0,2*Math.PI);var A,B,U,p=(l+1)*s.length,m=l*s.length*2*3,v=new lt(new(m>65535?Uint32Array:Uint16Array)(m),1),y=new lt(new Float32Array(3*p),3),b=new lt(new Float32Array(2*p),2),w=0,T=0,R=1/l,P=new z,L=new ut;for(B=0;B<=l;B++){var F=c+B*R*d,V=Math.sin(F),H=Math.cos(F);for(U=0;U<=s.length-1;U++)P.x=s[U].x*V,P.y=s[U].y,P.z=s[U].x*H,y.setXYZ(w,P.x,P.y,P.z),L.x=B/l,L.y=U/(s.length-1),b.setXY(w,L.x,L.y),w++}for(B=0;B<l;B++)for(U=0;U<s.length-1;U++){var q=(A=U+B*s.length)+s.length,ae=A+s.length+1,se=A+1;v.setX(T,A),T++,v.setX(T,q),T++,v.setX(T,se),T++,v.setX(T,q),T++,v.setX(T,ae),T++,v.setX(T,se),T++}if(this.setIndex(v),this.addAttribute("position",y),this.addAttribute("uv",b),this.computeVertexNormals(),d===2*Math.PI){var le=this.attributes.normal.array,ue=new z,me=new z,Fe=new z;for(A=l*s.length*3,B=0,U=0;B<s.length;B++,U+=3)ue.x=le[U+0],ue.y=le[U+1],ue.z=le[U+2],me.x=le[A+U+0],me.y=le[A+U+1],me.z=le[A+U+2],Fe.addVectors(ue,me).normalize(),le[U+0]=le[A+U+0]=Fe.x,le[U+1]=le[A+U+1]=Fe.y,le[U+2]=le[A+U+2]=Fe.z}}function Nf(s,l,c,d){vn.call(this),this.type="LatheGeometry",this.parameters={points:s,segments:l,phiStart:c,phiLength:d},this.fromBufferGeometry(new Fl(s,l,c,d)),this.mergeVertices()}function Qc(s,l){kt.call(this),this.type="ShapeBufferGeometry",this.parameters={shapes:s,curveSegments:l},l=l||12;var c=[],d=[],p=[],m=[],v=0,y=0;if(!1===Array.isArray(s))w(s);else for(var b=0;b<s.length;b++)w(s[b]),this.addGroup(v,y,b),v+=y,y=0;function w(T){var A,R,P,L=c.length/3,B=T.extractPoints(l),U=B.shape,F=B.holes;if(!1===Ui.isClockWise(U))for(U=U.reverse(),A=0,R=F.length;A<R;A++)!0===Ui.isClockWise(P=F[A])&&(F[A]=P.reverse());var V=Ui.triangulateShape(U,F);for(A=0,R=F.length;A<R;A++)U=U.concat(P=F[A]);for(A=0,R=U.length;A<R;A++){var H=U[A];c.push(H.x,H.y,0),d.push(0,0,1),p.push(H.x,H.y)}for(A=0,R=V.length;A<R;A++){var J=V[A];m.push(J[0]+L,J[1]+L,J[2]+L),y+=3}}this.setIndex(new(m.length>65535?Ka:Ja)(m,1)),this.addAttribute("position",new On(c,3)),this.addAttribute("normal",new On(d,3)),this.addAttribute("uv",new On(p,2))}function eu(s,l){vn.call(this),this.type="ShapeGeometry","object"==typeof l&&(console.warn("THREE.ShapeGeometry: Options parameter has been removed."),l=l.curveSegments),this.parameters={shapes:s,curveSegments:l},this.fromBufferGeometry(new Qc(s,l)),this.mergeVertices()}function tu(s,l){kt.call(this),l=void 0!==l?l:1;var c=Math.cos(dn.DEG2RAD*l),d=[0,0],p={};function m(V,H){return V-H}var y,v=["a","b","c"];s.isBufferGeometry?(y=new vn).fromBufferGeometry(s):y=s.clone(),y.mergeVertices(),y.computeFaceNormals();for(var b=y.vertices,w=y.faces,T=0,A=w.length;T<A;T++)for(var R=w[T],P=0;P<3;P++)d[0]=R[v[P]],d[1]=R[v[(P+1)%3]],d.sort(m),void 0===p[L=d.toString()]?p[L]={vert1:d[0],vert2:d[1],face1:T,face2:void 0}:p[L].face2=T;var B=[];for(var L in p){var U=p[L];if(void 0===U.face2||w[U.face1].normal.dot(w[U.face2].normal)<=c){var F=b[U.vert1];B.push(F.x),B.push(F.y),B.push(F.z),B.push((F=b[U.vert2]).x),B.push(F.y),B.push(F.z)}}this.addAttribute("position",new On(B,3))}function qo(s,l,c,d,p,m,v,y){kt.call(this),this.type="CylinderBufferGeometry",this.parameters={radiusTop:s,radiusBottom:l,height:c,radialSegments:d,heightSegments:p,openEnded:m,thetaStart:v,thetaLength:y};var b=this;s=void 0!==s?s:20,l=void 0!==l?l:20,c=void 0!==c?c:100,d=Math.floor(d)||8,p=Math.floor(p)||1,m=void 0!==m&&m,v=void 0!==v?v:0,y=void 0!==y?y:2*Math.PI;var w=0;!1===m&&(s>0&&w++,l>0&&w++);var T=function q(){var ue=(d+1)*(p+1);return!1===m&&(ue+=(d+1)*w+d*w),ue}(),A=function ae(){var ue=d*p*2*3;return!1===m&&(ue+=d*w*3),ue}(),R=new lt(new(A>65535?Uint32Array:Uint16Array)(A),1),P=new lt(new Float32Array(3*T),3),L=new lt(new Float32Array(3*T),3),B=new lt(new Float32Array(2*T),2),U=0,F=0,V=[],H=c/2,J=0;function le(ue){var me,Fe,Ie,Z=new ut,ee=new z,ve=0,Te=!0===ue?s:l,Oe=!0===ue?1:-1;for(Fe=U,me=1;me<=d;me++)P.setXYZ(U,0,H*Oe,0),L.setXYZ(U,0,Oe,0),Z.x=.5,Z.y=.5,B.setXY(U,Z.x,Z.y),U++;for(Ie=U,me=0;me<=d;me++){var Ne=me/d*y+v,Qe=Math.cos(Ne),Ye=Math.sin(Ne);ee.x=Te*Ye,ee.y=H*Oe,ee.z=Te*Qe,P.setXYZ(U,ee.x,ee.y,ee.z),L.setXYZ(U,0,Oe,0),Z.x=.5*Qe+.5,Z.y=.5*Ye*Oe+.5,B.setXY(U,Z.x,Z.y),U++}for(me=0;me<d;me++){var He=Fe+me,ye=Ie+me;!0===ue?(R.setX(F,ye),F++,R.setX(F,ye+1),F++,R.setX(F,He),F++):(R.setX(F,ye+1),F++,R.setX(F,ye),F++,R.setX(F,He),F++),ve+=3}b.addGroup(J,ve,!0===ue?1:2),J+=ve}(function se(){var ue,me,Fe=new z,Ie=new z,Z=0,ee=(l-s)/c;for(me=0;me<=p;me++){var ve=[],Te=me/p,Oe=Te*(l-s)+s;for(ue=0;ue<=d;ue++){var Le=ue/d,Ne=Le*y+v,Qe=Math.sin(Ne),Ye=Math.cos(Ne);Ie.x=Oe*Qe,Ie.y=-Te*c+H,Ie.z=Oe*Ye,P.setXYZ(U,Ie.x,Ie.y,Ie.z),Fe.set(Qe,ee,Ye).normalize(),L.setXYZ(U,Fe.x,Fe.y,Fe.z),B.setXY(U,Le,1-Te),ve.push(U),U++}V.push(ve)}for(ue=0;ue<d;ue++)for(me=0;me<p;me++){var ye=V[me+1][ue],Ge=V[me+1][ue+1],tt=V[me][ue+1];R.setX(F,V[me][ue]),F++,R.setX(F,ye),F++,R.setX(F,tt),F++,R.setX(F,ye),F++,R.setX(F,Ge),F++,R.setX(F,tt),F++,Z+=6}b.addGroup(J,Z,0),J+=Z})(),!1===m&&(s>0&&le(!0),l>0&&le(!1)),this.setIndex(R),this.addAttribute("position",P),this.addAttribute("normal",L),this.addAttribute("uv",B)}function ao(s,l,c,d,p,m,v,y){vn.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:s,radiusBottom:l,height:c,radialSegments:d,heightSegments:p,openEnded:m,thetaStart:v,thetaLength:y},this.fromBufferGeometry(new qo(s,l,c,d,p,m,v,y)),this.mergeVertices()}function Fh(s,l,c,d,p,m,v){ao.call(this,0,s,l,c,d,p,m,v),this.type="ConeGeometry",this.parameters={radius:s,height:l,radialSegments:c,heightSegments:d,openEnded:p,thetaStart:m,thetaLength:v}}function Uh(s,l,c,d,p,m,v){qo.call(this,0,s,l,c,d,p,m,v),this.type="ConeBufferGeometry",this.parameters={radius:s,height:l,radialSegments:c,heightSegments:d,openEnded:p,thetaStart:m,thetaLength:v}}function nu(s,l,c,d){kt.call(this),this.type="CircleBufferGeometry",this.parameters={radius:s,segments:l,thetaStart:c,thetaLength:d},s=s||50,l=void 0!==l?Math.max(3,l):8,c=void 0!==c?c:0,d=void 0!==d?d:2*Math.PI;var p=l+2,m=new Float32Array(3*p),v=new Float32Array(3*p),y=new Float32Array(2*p);v[2]=1,y[0]=.5,y[1]=.5;for(var b=0,w=3,T=2;b<=l;b++,w+=3,T+=2){var A=c+b/l*d;m[w]=s*Math.cos(A),m[w+1]=s*Math.sin(A),v[w+2]=1,y[T]=(m[w]/s+1)/2,y[T+1]=(m[w+1]/s+1)/2}var R=[];for(w=1;w<=l;w++)R.push(w,w+1,0);this.setIndex(new lt(new Uint16Array(R),1)),this.addAttribute("position",new lt(m,3)),this.addAttribute("normal",new lt(v,3)),this.addAttribute("uv",new lt(y,2)),this.boundingSphere=new or(new z,s)}function Bh(s,l,c,d){vn.call(this),this.type="CircleGeometry",this.parameters={radius:s,segments:l,thetaStart:c,thetaLength:d},this.fromBufferGeometry(new nu(s,l,c,d))}function iu(s,l,c,d,p,m){vn.call(this),this.type="BoxGeometry",this.parameters={width:s,height:l,depth:c,widthSegments:d,heightSegments:p,depthSegments:m},this.fromBufferGeometry(new zc(s,l,c,d,p,m)),this.mergeVertices()}(js.prototype=Object.create(vn.prototype)).constructor=js,js.prototype.addShapeList=function(s,l){for(var c=s.length,d=0;d<c;d++)this.addShape(s[d],l)},js.prototype.addShape=function(s,l){var T,P,L,B,U,c=void 0!==l.amount?l.amount:100,d=void 0!==l.bevelThickness?l.bevelThickness:6,p=void 0!==l.bevelSize?l.bevelSize:d-2,m=void 0!==l.bevelSegments?l.bevelSegments:3,v=void 0===l.bevelEnabled||l.bevelEnabled,y=void 0!==l.curveSegments?l.curveSegments:12,b=void 0!==l.steps?l.steps:1,w=l.extrudePath,A=!1,R=void 0!==l.UVGenerator?l.UVGenerator:js.WorldUVGenerator;w&&(T=w.getSpacedPoints(b),A=!0,v=!1,P=void 0!==l.frames?l.frames:w.computeFrenetFrames(b,!1),L=new z,B=new z,U=new z),v||(m=0,d=0,p=0);var F,V,H,J=this,q=this.vertices.length,ae=s.extractPoints(y),se=ae.shape,le=ae.holes,ue=!Ui.isClockWise(se);if(ue){for(se=se.reverse(),V=0,H=le.length;V<H;V++)Ui.isClockWise(F=le[V])&&(le[V]=F.reverse());ue=!1}var me=Ui.triangulateShape(se,le),Fe=se;for(V=0,H=le.length;V<H;V++)se=se.concat(F=le[V]);function Ie(sn,fn,Xn){return fn||console.error("THREE.ExtrudeGeometry: vec does not exist"),fn.clone().multiplyScalar(Xn).add(sn)}var Z,ee,ve,Te,Oe,Ne,Le=se.length,Qe=me.length;function Ye(sn,fn,Xn){var Zn,Gi,pi=1,Wi=sn.x-fn.x,Ti=sn.y-fn.y,Ci=Xn.x-sn.x,Ln=Xn.y-sn.y,lr=Wi*Wi+Ti*Ti;if(Math.abs(Wi*Ln-Ti*Ci)>Number.EPSILON){var ol=Math.sqrt(lr),Jl=Math.sqrt(Ci*Ci+Ln*Ln),al=fn.x-Ti/ol,Ee=fn.y+Wi/ol,Ii=((Xn.x-Ln/Jl-al)*Ln-(Xn.y+Ci/Jl-Ee)*Ci)/(Wi*Ln-Ti*Ci),ln=(Zn=al+Wi*Ii-sn.x)*Zn+(Gi=Ee+Ti*Ii-sn.y)*Gi;if(ln<=2)return new ut(Zn,Gi);pi=Math.sqrt(ln/2)}else{var Pi=!1;Wi>Number.EPSILON?Ci>Number.EPSILON&&(Pi=!0):Wi<-Number.EPSILON?Ci<-Number.EPSILON&&(Pi=!0):Math.sign(Ti)===Math.sign(Ln)&&(Pi=!0),Pi?(Zn=-Ti,Gi=Wi,pi=Math.sqrt(lr)):(Zn=Wi,Gi=Ti,pi=Math.sqrt(lr/2))}return new ut(Zn/pi,Gi/pi)}for(var He=[],ye=0,Ge=Fe.length,tt=Ge-1,Je=ye+1;ye<Ge;ye++,tt++,Je++)tt===Ge&&(tt=0),Je===Ge&&(Je=0),He[ye]=Ye(Fe[ye],Fe[tt],Fe[Je]);var At,tn,Lt=[],st=He.concat();for(V=0,H=le.length;V<H;V++){for(At=[],tt=(Ge=(F=le[V]).length)-1,Je=1+(ye=0);ye<Ge;ye++,tt++,Je++)tt===Ge&&(tt=0),Je===Ge&&(Je=0),At[ye]=Ye(F[ye],F[tt],F[Je]);Lt.push(At),st=st.concat(At)}for(Z=0;Z<m;Z++){for(ve=Z/m,Te=d*Math.cos(ve*Math.PI/2),ee=p*Math.sin(ve*Math.PI/2),ye=0,Ge=Fe.length;ye<Ge;ye++)$n((Oe=Ie(Fe[ye],He[ye],ee)).x,Oe.y,-Te);for(V=0,H=le.length;V<H;V++)for(At=Lt[V],ye=0,Ge=(F=le[V]).length;ye<Ge;ye++)$n((Oe=Ie(F[ye],At[ye],ee)).x,Oe.y,-Te)}for(ee=p,ye=0;ye<Le;ye++)Oe=v?Ie(se[ye],st[ye],ee):se[ye],A?(B.copy(P.normals[0]).multiplyScalar(Oe.x),L.copy(P.binormals[0]).multiplyScalar(Oe.y),U.copy(T[0]).add(B).add(L),$n(U.x,U.y,U.z)):$n(Oe.x,Oe.y,0);for(tn=1;tn<=b;tn++)for(ye=0;ye<Le;ye++)Oe=v?Ie(se[ye],st[ye],ee):se[ye],A?(B.copy(P.normals[tn]).multiplyScalar(Oe.x),L.copy(P.binormals[tn]).multiplyScalar(Oe.y),U.copy(T[tn]).add(B).add(L),$n(U.x,U.y,U.z)):$n(Oe.x,Oe.y,c/b*tn);for(Z=m-1;Z>=0;Z--){for(ve=Z/m,Te=d*Math.cos(ve*Math.PI/2),ee=p*Math.sin(ve*Math.PI/2),ye=0,Ge=Fe.length;ye<Ge;ye++)$n((Oe=Ie(Fe[ye],He[ye],ee)).x,Oe.y,c+Te);for(V=0,H=le.length;V<H;V++)for(At=Lt[V],ye=0,Ge=(F=le[V]).length;ye<Ge;ye++)Oe=Ie(F[ye],At[ye],ee),A?$n(Oe.x,Oe.y+T[b-1].y,T[b-1].x+Te):$n(Oe.x,Oe.y,c+Te)}function Gt(sn,fn){var Xn,Zn;for(ye=sn.length;--ye>=0;){Xn=ye,(Zn=ye-1)<0&&(Zn=sn.length-1);var Gi=0,pi=b+2*m;for(Gi=0;Gi<pi;Gi++){var Wi=Le*Gi,Ti=Le*(Gi+1);fi(fn+Xn+Wi,fn+Zn+Wi,fn+Zn+Ti,fn+Xn+Ti)}}}function $n(sn,fn,Xn){J.vertices.push(new z(sn,fn,Xn))}function Mt(sn,fn,Xn){J.faces.push(new zs(sn+=q,fn+=q,Xn+=q,null,null,0));var Zn=R.generateTopUV(J,sn,fn,Xn);J.faceVertexUvs[0].push(Zn)}function fi(sn,fn,Xn,Zn,Gi,pi,Wi,Ti,Ci){Xn+=q,J.faces.push(new zs(sn+=q,fn+=q,Zn+=q,null,null,1)),J.faces.push(new zs(fn,Xn,Zn,null,null,1));var Ln=R.generateSideWallUV(J,sn,fn,Xn,Zn);J.faceVertexUvs[0].push([Ln[0],Ln[1],Ln[3]]),J.faceVertexUvs[0].push([Ln[1],Ln[2],Ln[3]])}(function de(){if(v){var sn=0,fn=Le*sn;for(ye=0;ye<Qe;ye++)Mt((Ne=me[ye])[2]+fn,Ne[1]+fn,Ne[0]+fn);for(fn=Le*(sn=b+2*m),ye=0;ye<Qe;ye++)Mt((Ne=me[ye])[0]+fn,Ne[1]+fn,Ne[2]+fn)}else{for(ye=0;ye<Qe;ye++)Mt((Ne=me[ye])[2],Ne[1],Ne[0]);for(ye=0;ye<Qe;ye++)Mt((Ne=me[ye])[0]+Le*b,Ne[1]+Le*b,Ne[2]+Le*b)}})(),function oi(){var sn=0;for(Gt(Fe,sn),sn+=Fe.length,V=0,H=le.length;V<H;V++)Gt(F=le[V],sn),sn+=F.length}()},js.WorldUVGenerator={generateTopUV:function(s,l,c,d){var p=s.vertices,m=p[l],v=p[c],y=p[d];return[new ut(m.x,m.y),new ut(v.x,v.y),new ut(y.x,y.y)]},generateSideWallUV:function(s,l,c,d,p){var m=s.vertices,v=m[l],y=m[c],b=m[d],w=m[p];return Math.abs(v.y-y.y)<.01?[new ut(v.x,1-v.z),new ut(y.x,1-y.z),new ut(b.x,1-b.z),new ut(w.x,1-w.z)]:[new ut(v.y,1-v.z),new ut(y.y,1-y.z),new ut(b.y,1-b.z),new ut(w.y,1-w.z)]}},(Nh.prototype=Object.create(js.prototype)).constructor=Nh,(tl.prototype=Object.create(kt.prototype)).constructor=tl,(Kc.prototype=Object.create(vn.prototype)).constructor=Kc,(Ol.prototype=Object.create(kt.prototype)).constructor=Ol,(Oh.prototype=Object.create(vn.prototype)).constructor=Oh,(Yt.prototype=Object.create(vn.prototype)).constructor=Yt,(Fl.prototype=Object.create(kt.prototype)).constructor=Fl,(Nf.prototype=Object.create(vn.prototype)).constructor=Nf,(Qc.prototype=Object.create(kt.prototype)).constructor=Qc,(eu.prototype=Object.create(vn.prototype)).constructor=eu,(tu.prototype=Object.create(kt.prototype)).constructor=tu,(qo.prototype=Object.create(kt.prototype)).constructor=qo,(ao.prototype=Object.create(vn.prototype)).constructor=ao,(Fh.prototype=Object.create(ao.prototype)).constructor=Fh,(Uh.prototype=Object.create(qo.prototype)).constructor=Uh,(nu.prototype=Object.create(kt.prototype)).constructor=nu,(Bh.prototype=Object.create(vn.prototype)).constructor=Bh,(iu.prototype=Object.create(vn.prototype)).constructor=iu;var Re=Object.freeze({WireframeGeometry:Il,ParametricGeometry:Rh,ParametricBufferGeometry:Pl,TetrahedronGeometry:Ts,TetrahedronBufferGeometry:Yc,OctahedronGeometry:Zc,OctahedronBufferGeometry:el,IcosahedronGeometry:Ll,IcosahedronBufferGeometry:Qn,DodecahedronGeometry:Rr,DodecahedronBufferGeometry:va,PolyhedronGeometry:Ih,PolyhedronBufferGeometry:ts,TubeGeometry:Xo,TubeBufferGeometry:Nl,TorusKnotGeometry:Ph,TorusKnotBufferGeometry:Ir,TorusGeometry:Lh,TorusBufferGeometry:Jc,TextGeometry:Nh,SphereBufferGeometry:tl,SphereGeometry:Kc,RingGeometry:Oh,RingBufferGeometry:Ol,PlaneBufferGeometry:Hc,PlaneGeometry:Yt,LatheGeometry:Nf,LatheBufferGeometry:Fl,ShapeGeometry:eu,ShapeBufferGeometry:Qc,ExtrudeGeometry:js,EdgesGeometry:tu,ConeGeometry:Fh,ConeBufferGeometry:Uh,CylinderGeometry:ao,CylinderBufferGeometry:qo,CircleBufferGeometry:nu,CircleGeometry:Bh,BoxBufferGeometry:zc,BoxGeometry:iu});function Pn(){Qr.call(this,{uniforms:as.merge([Qt.lights,{opacity:{value:1}}]),vertexShader:Wn.shadow_vert,fragmentShader:Wn.shadow_frag}),this.lights=!0,this.transparent=!0,Object.defineProperties(this,{opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(s){this.uniforms.opacity.value=s}}})}function ru(s){Qr.call(this,s),this.type="RawShaderMaterial"}function kh(s){this.uuid=dn.generateUUID(),this.type="MultiMaterial",this.materials=Array.isArray(s)?s:[],this.visible=!0}function Si(s){wn.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Tt(16777215),this.roughness=.5,this.metalness=.5,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Tt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new ut(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(s)}function nl(s){Si.call(this),this.defines={PHYSICAL:""},this.type="MeshPhysicalMaterial",this.reflectivity=.5,this.clearCoat=0,this.clearCoatRoughness=0,this.setValues(s)}function ds(s){wn.call(this),this.type="MeshPhongMaterial",this.color=new Tt(16777215),this.specular=new Tt(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Tt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new ut(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Yd,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(s)}function ns(s){ds.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.gradientMap=null,this.setValues(s)}function ya(s){wn.call(this,s),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new ut(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(s)}function _a(s){wn.call(this),this.type="MeshLambertMaterial",this.color=new Tt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Tt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Yd,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(s)}function Ul(s){wn.call(this),this.type="LineDashedMaterial",this.color=new Tt(16777215),this.linewidth=1,this.scale=1,this.dashSize=3,this.gapSize=1,this.lights=!1,this.setValues(s)}(Pn.prototype=Object.create(Qr.prototype)).constructor=Pn,Pn.prototype.isShadowMaterial=!0,(ru.prototype=Object.create(Qr.prototype)).constructor=ru,ru.prototype.isRawShaderMaterial=!0,kh.prototype={constructor:kh,isMultiMaterial:!0,toJSON:function(s){for(var l={metadata:{version:4.2,type:"material",generator:"MaterialExporter"},uuid:this.uuid,type:this.type,materials:[]},c=this.materials,d=0,p=c.length;d<p;d++){var m=c[d].toJSON(s);delete m.metadata,l.materials.push(m)}return l.visible=this.visible,l},clone:function(){for(var s=new this.constructor,l=0;l<this.materials.length;l++)s.materials.push(this.materials[l].clone());return s.visible=this.visible,s}},(Si.prototype=Object.create(wn.prototype)).constructor=Si,Si.prototype.isMeshStandardMaterial=!0,Si.prototype.copy=function(s){return wn.prototype.copy.call(this,s),this.defines={STANDARD:""},this.color.copy(s.color),this.roughness=s.roughness,this.metalness=s.metalness,this.map=s.map,this.lightMap=s.lightMap,this.lightMapIntensity=s.lightMapIntensity,this.aoMap=s.aoMap,this.aoMapIntensity=s.aoMapIntensity,this.emissive.copy(s.emissive),this.emissiveMap=s.emissiveMap,this.emissiveIntensity=s.emissiveIntensity,this.bumpMap=s.bumpMap,this.bumpScale=s.bumpScale,this.normalMap=s.normalMap,this.normalScale.copy(s.normalScale),this.displacementMap=s.displacementMap,this.displacementScale=s.displacementScale,this.displacementBias=s.displacementBias,this.roughnessMap=s.roughnessMap,this.metalnessMap=s.metalnessMap,this.alphaMap=s.alphaMap,this.envMap=s.envMap,this.envMapIntensity=s.envMapIntensity,this.refractionRatio=s.refractionRatio,this.wireframe=s.wireframe,this.wireframeLinewidth=s.wireframeLinewidth,this.wireframeLinecap=s.wireframeLinecap,this.wireframeLinejoin=s.wireframeLinejoin,this.skinning=s.skinning,this.morphTargets=s.morphTargets,this.morphNormals=s.morphNormals,this},(nl.prototype=Object.create(Si.prototype)).constructor=nl,nl.prototype.isMeshPhysicalMaterial=!0,nl.prototype.copy=function(s){return Si.prototype.copy.call(this,s),this.defines={PHYSICAL:""},this.reflectivity=s.reflectivity,this.clearCoat=s.clearCoat,this.clearCoatRoughness=s.clearCoatRoughness,this},(ds.prototype=Object.create(wn.prototype)).constructor=ds,ds.prototype.isMeshPhongMaterial=!0,ds.prototype.copy=function(s){return wn.prototype.copy.call(this,s),this.color.copy(s.color),this.specular.copy(s.specular),this.shininess=s.shininess,this.map=s.map,this.lightMap=s.lightMap,this.lightMapIntensity=s.lightMapIntensity,this.aoMap=s.aoMap,this.aoMapIntensity=s.aoMapIntensity,this.emissive.copy(s.emissive),this.emissiveMap=s.emissiveMap,this.emissiveIntensity=s.emissiveIntensity,this.bumpMap=s.bumpMap,this.bumpScale=s.bumpScale,this.normalMap=s.normalMap,this.normalScale.copy(s.normalScale),this.displacementMap=s.displacementMap,this.displacementScale=s.displacementScale,this.displacementBias=s.displacementBias,this.specularMap=s.specularMap,this.alphaMap=s.alphaMap,this.envMap=s.envMap,this.combine=s.combine,this.reflectivity=s.reflectivity,this.refractionRatio=s.refractionRatio,this.wireframe=s.wireframe,this.wireframeLinewidth=s.wireframeLinewidth,this.wireframeLinecap=s.wireframeLinecap,this.wireframeLinejoin=s.wireframeLinejoin,this.skinning=s.skinning,this.morphTargets=s.morphTargets,this.morphNormals=s.morphNormals,this},(ns.prototype=Object.create(ds.prototype)).constructor=ns,ns.prototype.isMeshToonMaterial=!0,ns.prototype.copy=function(s){return ds.prototype.copy.call(this,s),this.gradientMap=s.gradientMap,this},(ya.prototype=Object.create(wn.prototype)).constructor=ya,ya.prototype.isMeshNormalMaterial=!0,ya.prototype.copy=function(s){return wn.prototype.copy.call(this,s),this.bumpMap=s.bumpMap,this.bumpScale=s.bumpScale,this.normalMap=s.normalMap,this.normalScale.copy(s.normalScale),this.displacementMap=s.displacementMap,this.displacementScale=s.displacementScale,this.displacementBias=s.displacementBias,this.wireframe=s.wireframe,this.wireframeLinewidth=s.wireframeLinewidth,this.skinning=s.skinning,this.morphTargets=s.morphTargets,this.morphNormals=s.morphNormals,this},(_a.prototype=Object.create(wn.prototype)).constructor=_a,_a.prototype.isMeshLambertMaterial=!0,_a.prototype.copy=function(s){return wn.prototype.copy.call(this,s),this.color.copy(s.color),this.map=s.map,this.lightMap=s.lightMap,this.lightMapIntensity=s.lightMapIntensity,this.aoMap=s.aoMap,this.aoMapIntensity=s.aoMapIntensity,this.emissive.copy(s.emissive),this.emissiveMap=s.emissiveMap,this.emissiveIntensity=s.emissiveIntensity,this.specularMap=s.specularMap,this.alphaMap=s.alphaMap,this.envMap=s.envMap,this.combine=s.combine,this.reflectivity=s.reflectivity,this.refractionRatio=s.refractionRatio,this.wireframe=s.wireframe,this.wireframeLinewidth=s.wireframeLinewidth,this.wireframeLinecap=s.wireframeLinecap,this.wireframeLinejoin=s.wireframeLinejoin,this.skinning=s.skinning,this.morphTargets=s.morphTargets,this.morphNormals=s.morphNormals,this},(Ul.prototype=Object.create(wn.prototype)).constructor=Ul,Ul.prototype.isLineDashedMaterial=!0,Ul.prototype.copy=function(s){return wn.prototype.copy.call(this,s),this.color.copy(s.color),this.linewidth=s.linewidth,this.scale=s.scale,this.dashSize=s.dashSize,this.gapSize=s.gapSize,this};var BA=Object.freeze({ShadowMaterial:Pn,SpriteMaterial:Dl,RawShaderMaterial:ru,ShaderMaterial:Qr,PointsMaterial:bo,MultiMaterial:kh,MeshPhysicalMaterial:nl,MeshStandardMaterial:Si,MeshPhongMaterial:ds,MeshToonMaterial:ns,MeshNormalMaterial:ya,MeshLambertMaterial:_a,MeshDepthMaterial:kr,MeshBasicMaterial:Hs,LineDashedMaterial:Ul,LineBasicMaterial:Ji,Material:wn}),Of={enabled:!1,files:{},add:function(s,l){!1!==this.enabled&&(this.files[s]=l)},get:function(s){if(!1!==this.enabled)return this.files[s]},remove:function(s){delete this.files[s]},clear:function(){this.files={}}};function zr(s,l,c){var d=this,p=!1,m=0,v=0;this.onStart=void 0,this.onLoad=s,this.onProgress=l,this.onError=c,this.itemStart=function(y){v++,!1===p&&void 0!==d.onStart&&d.onStart(y,m,v),p=!0},this.itemEnd=function(y){m++,void 0!==d.onProgress&&d.onProgress(y,m,v),m===v&&(p=!1,void 0!==d.onLoad&&d.onLoad())},this.itemError=function(y){void 0!==d.onError&&d.onError(y)}}var ar=new zr;function $s(s){this.manager=void 0!==s?s:ar}function Bl(s){this.manager=void 0!==s?s:ar,this._parser=null}Object.assign($s.prototype,{load:function(s,l,c,d){void 0===s&&(s=""),void 0!==this.path&&(s=this.path+s);var p=this,m=Of.get(s);if(void 0!==m)return p.manager.itemStart(s),setTimeout(function(){l&&l(m),p.manager.itemEnd(s)},0),m;var y=s.match(/^data:(.*?)(;base64)?,(.*)$/);if(y){var b=y[1],w=!!y[2],T=y[3];T=window.decodeURIComponent(T),w&&(T=window.atob(T));try{var A,R=(this.responseType||"").toLowerCase();switch(R){case"arraybuffer":case"blob":A=new ArrayBuffer(T.length);for(var P=new Uint8Array(A),L=0;L<T.length;L++)P[L]=T.charCodeAt(L);"blob"===R&&(A=new Blob([A],{type:b}));break;case"document":var B=new DOMParser;A=B.parseFromString(T,b);break;case"json":A=JSON.parse(T);break;default:A=T}window.setTimeout(function(){l&&l(A),p.manager.itemEnd(s)},0)}catch(F){window.setTimeout(function(){d&&d(F),p.manager.itemError(s)},0)}}else{var U=new XMLHttpRequest;U.open("GET",s,!0),U.addEventListener("load",function(F){var V=F.target.response;Of.add(s,V),200===this.status?(l&&l(V),p.manager.itemEnd(s)):0===this.status?(console.warn("THREE.FileLoader: HTTP Status 0 received."),l&&l(V),p.manager.itemEnd(s)):(d&&d(F),p.manager.itemError(s))},!1),void 0!==c&&U.addEventListener("progress",function(F){c(F)},!1),U.addEventListener("error",function(F){d&&d(F),p.manager.itemError(s)},!1),void 0!==this.responseType&&(U.responseType=this.responseType),void 0!==this.withCredentials&&(U.withCredentials=this.withCredentials),U.overrideMimeType&&U.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain"),U.send(null)}return p.manager.itemStart(s),U},setPath:function(s){return this.path=s,this},setResponseType:function(s){return this.responseType=s,this},setWithCredentials:function(s){return this.withCredentials=s,this},setMimeType:function(s){return this.mimeType=s,this}}),Object.assign(Bl.prototype,{load:function(s,l,c,d){var p=this,m=[],v=new Rl;v.image=m;var y=new $s(this.manager);function b(R){y.load(s[R],function(P){var L=p._parser(P,!0);m[R]={width:L.width,height:L.height,format:L.format,mipmaps:L.mipmaps},6===(w+=1)&&(1===L.mipmapCount&&(v.minFilter=ws),v.format=L.format,v.needsUpdate=!0,l&&l(v))},c,d)}if(y.setPath(this.path),y.setResponseType("arraybuffer"),Array.isArray(s))for(var w=0,T=0,A=s.length;T<A;++T)b(T);else y.load(s,function(R){var P=p._parser(R,!0);if(P.isCubemap)for(var L=P.mipmaps.length/P.mipmapCount,B=0;B<L;B++){m[B]={mipmaps:[]};for(var U=0;U<P.mipmapCount;U++)m[B].mipmaps.push(P.mipmaps[B*P.mipmapCount+U]),m[B].format=P.format,m[B].width=P.width,m[B].height=P.height}else v.image.width=P.width,v.image.height=P.height,v.mipmaps=P.mipmaps;1===P.mipmapCount&&(v.minFilter=ws),v.format=P.format,v.needsUpdate=!0,l&&l(v)},c,d);return v},setPath:function(s){return this.path=s,this}});var xa=bg;function bg(s){this.manager=void 0!==s?s:ar,this._parser=null}function su(s){this.manager=void 0!==s?s:ar}function Eg(s){this.manager=void 0!==s?s:ar}function Ff(s){this.manager=void 0!==s?s:ar}function zi(s,l){at.call(this),this.type="Light",this.color=new Tt(s),this.intensity=void 0!==l?l:1,this.receiveShadow=void 0}function ou(s,l,c){zi.call(this,s,c),this.type="HemisphereLight",this.castShadow=void 0,this.position.copy(at.DefaultUp),this.updateMatrix(),this.groundColor=new Tt(l)}function il(s){this.camera=s,this.bias=0,this.radius=1,this.mapSize=new ut(512,512),this.map=null,this.matrix=new Wt}function au(){il.call(this,new Zi(50,1,.5,500))}function Uf(s,l,c,d,p,m){zi.call(this,s,l),this.type="SpotLight",this.position.copy(at.DefaultUp),this.updateMatrix(),this.target=new at,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(v){this.intensity=v/Math.PI}}),this.distance=void 0!==c?c:0,this.angle=void 0!==d?d:Math.PI/3,this.penumbra=void 0!==p?p:0,this.decay=void 0!==m?m:1,this.shadow=new au}function Vh(s,l,c,d){zi.call(this,s,l),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(p){this.intensity=p/(4*Math.PI)}}),this.distance=void 0!==c?c:0,this.decay=void 0!==d?d:1,this.shadow=new il(new Zi(90,1,.5,500))}function lu(s){il.call(this,new Gs(-5,5,5,-5,.5,500))}function zh(s,l){zi.call(this,s,l),this.type="DirectionalLight",this.position.copy(at.DefaultUp),this.updateMatrix(),this.target=new at,this.shadow=new lu}function Hh(s,l){zi.call(this,s,l),this.type="AmbientLight",this.castShadow=void 0}Object.assign(bg.prototype,{load:function(s,l,c,d){var p=this,m=new Za,v=new $s(this.manager);return v.setResponseType("arraybuffer"),v.load(s,function(y){var b=p._parser(y);b&&(void 0!==b.image?m.image=b.image:void 0!==b.data&&(m.image.width=b.width,m.image.height=b.height,m.image.data=b.data),m.wrapS=void 0!==b.wrapS?b.wrapS:Fs,m.wrapT=void 0!==b.wrapT?b.wrapT:Fs,m.magFilter=void 0!==b.magFilter?b.magFilter:ws,m.minFilter=void 0!==b.minFilter?b.minFilter:rh,m.anisotropy=void 0!==b.anisotropy?b.anisotropy:1,void 0!==b.format&&(m.format=b.format),void 0!==b.type&&(m.type=b.type),void 0!==b.mipmaps&&(m.mipmaps=b.mipmaps),1===b.mipmapCount&&(m.minFilter=ws),m.needsUpdate=!0,l&&l(m,b))},c,d),m}}),Object.assign(su.prototype,{load:function(s,l,c,d){var p=this,m=document.createElementNS("http://www.w3.org/1999/xhtml","img");if(m.onload=function(){m.onload=null,URL.revokeObjectURL(m.src),l&&l(m),p.manager.itemEnd(s)},m.onerror=d,0===s.indexOf("data:"))m.src=s;else if(void 0!==this.crossOrigin)m.crossOrigin=this.crossOrigin,m.src=s;else{var v=new $s;v.setPath(this.path),v.setResponseType("blob"),v.setWithCredentials(this.withCredentials),v.load(s,function(y){m.src=URL.createObjectURL(y)},c,d)}return p.manager.itemStart(s),m},setCrossOrigin:function(s){return this.crossOrigin=s,this},setWithCredentials:function(s){return this.withCredentials=s,this},setPath:function(s){return this.path=s,this}}),Object.assign(Eg.prototype,{load:function(s,l,c,d){var p=new qt,m=new su(this.manager);m.setCrossOrigin(this.crossOrigin),m.setPath(this.path);var v=0;function y(w){m.load(s[w],function(T){p.images[w]=T,6==++v&&(p.needsUpdate=!0,l&&l(p))},void 0,d)}for(var b=0;b<s.length;++b)y(b);return p},setCrossOrigin:function(s){return this.crossOrigin=s,this},setPath:function(s){return this.path=s,this}}),Object.assign(Ff.prototype,{load:function(s,l,c,d){var p=new mt,m=new su(this.manager);return m.setCrossOrigin(this.crossOrigin),m.setWithCredentials(this.withCredentials),m.setPath(this.path),m.load(s,function(v){var y=s.search(/\.(jpg|jpeg)$/)>0||0===s.search(/^data\:image\/jpeg/);p.format=y?Lc:zo,p.image=v,p.needsUpdate=!0,void 0!==l&&l(p)},c,d),p},setCrossOrigin:function(s){return this.crossOrigin=s,this},setWithCredentials:function(s){return this.withCredentials=s,this},setPath:function(s){return this.path=s,this}}),zi.prototype=Object.assign(Object.create(at.prototype),{constructor:zi,isLight:!0,copy:function(s){return at.prototype.copy.call(this,s),this.color.copy(s.color),this.intensity=s.intensity,this},toJSON:function(s){var l=at.prototype.toJSON.call(this,s);return l.object.color=this.color.getHex(),l.object.intensity=this.intensity,void 0!==this.groundColor&&(l.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(l.object.distance=this.distance),void 0!==this.angle&&(l.object.angle=this.angle),void 0!==this.decay&&(l.object.decay=this.decay),void 0!==this.penumbra&&(l.object.penumbra=this.penumbra),void 0!==this.shadow&&(l.object.shadow=this.shadow.toJSON()),l}}),ou.prototype=Object.assign(Object.create(zi.prototype),{constructor:ou,isHemisphereLight:!0,copy:function(s){return zi.prototype.copy.call(this,s),this.groundColor.copy(s.groundColor),this}}),Object.assign(il.prototype,{copy:function(s){return this.camera=s.camera.clone(),this.bias=s.bias,this.radius=s.radius,this.mapSize.copy(s.mapSize),this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var s={};return 0!==this.bias&&(s.bias=this.bias),1!==this.radius&&(s.radius=this.radius),(512!==this.mapSize.x||512!==this.mapSize.y)&&(s.mapSize=this.mapSize.toArray()),s.camera=this.camera.toJSON(!1).object,delete s.camera.matrix,s}}),au.prototype=Object.assign(Object.create(il.prototype),{constructor:au,isSpotLightShadow:!0,update:function(s){var l=2*dn.RAD2DEG*s.angle,c=this.mapSize.width/this.mapSize.height,d=s.distance||500,p=this.camera;(l!==p.fov||c!==p.aspect||d!==p.far)&&(p.fov=l,p.aspect=c,p.far=d,p.updateProjectionMatrix())}}),Uf.prototype=Object.assign(Object.create(zi.prototype),{constructor:Uf,isSpotLight:!0,copy:function(s){return zi.prototype.copy.call(this,s),this.distance=s.distance,this.angle=s.angle,this.penumbra=s.penumbra,this.decay=s.decay,this.target=s.target.clone(),this.shadow=s.shadow.clone(),this}}),Vh.prototype=Object.assign(Object.create(zi.prototype),{constructor:Vh,isPointLight:!0,copy:function(s){return zi.prototype.copy.call(this,s),this.distance=s.distance,this.decay=s.decay,this.shadow=s.shadow.clone(),this}}),lu.prototype=Object.assign(Object.create(il.prototype),{constructor:lu}),zh.prototype=Object.assign(Object.create(zi.prototype),{constructor:zh,isDirectionalLight:!0,copy:function(s){return zi.prototype.copy.call(this,s),this.target=s.target.clone(),this.shadow=s.shadow.clone(),this}}),Hh.prototype=Object.assign(Object.create(zi.prototype),{constructor:Hh,isAmbientLight:!0});var Hi,Hr={arraySlice:function(s,l,c){return Hr.isTypedArray(s)?new s.constructor(s.subarray(l,c)):s.slice(l,c)},convertArray:function(s,l,c){return!s||!c&&s.constructor===l?s:"number"==typeof l.BYTES_PER_ELEMENT?new l(s):Array.prototype.slice.call(s)},isTypedArray:function(s){return ArrayBuffer.isView(s)&&!(s instanceof DataView)},getKeyframeOrder:function(s){for(var c=s.length,d=new Array(c),p=0;p!==c;++p)d[p]=p;return d.sort(function l(m,v){return s[m]-s[v]}),d},sortedArray:function(s,l,c){for(var d=s.length,p=new s.constructor(d),m=0,v=0;v!==d;++m)for(var y=c[m]*l,b=0;b!==l;++b)p[v++]=s[y+b];return p},flattenJSON:function(s,l,c,d){for(var p=1,m=s[0];void 0!==m&&void 0===m[d];)m=s[p++];if(void 0!==m){var v=m[d];if(void 0!==v)if(Array.isArray(v))do{void 0!==(v=m[d])&&(l.push(m.time),c.push.apply(c,v)),m=s[p++]}while(void 0!==m);else if(void 0!==v.toArray)do{void 0!==(v=m[d])&&(l.push(m.time),v.toArray(c,c.length)),m=s[p++]}while(void 0!==m);else do{void 0!==(v=m[d])&&(l.push(m.time),c.push(v)),m=s[p++]}while(void 0!==m)}}};function fs(s,l,c,d){this.parameterPositions=s,this._cachedIndex=0,this.resultBuffer=void 0!==d?d:new l.constructor(c),this.sampleValues=l,this.valueSize=c}function cu(s,l,c,d){fs.call(this,s,l,c,d),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}function Gh(s,l,c,d){fs.call(this,s,l,c,d)}function Bf(s,l,c,d){fs.call(this,s,l,c,d)}function Xs(s,l,c,d){if(void 0===s)throw new Error("track name is undefined");if(void 0===l||0===l.length)throw new Error("no keyframes in track named "+s);this.name=s,this.times=Hr.convertArray(l,this.TimeBufferType),this.values=Hr.convertArray(c,this.ValueBufferType),this.setInterpolation(d||this.DefaultInterpolation),this.validate(),this.optimize()}function di(s,l,c,d){Xs.call(this,s,l,c,d)}function kf(s,l,c,d){fs.call(this,s,l,c,d)}function Wh(s,l,c,d){Xs.call(this,s,l,c,d)}function uu(s,l,c,d){Xs.call(this,s,l,c,d)}function Vf(s,l,c,d){Xs.call(this,s,l,c,d)}function jh(s,l,c){Xs.call(this,s,l,c)}function $h(s,l,c,d){Xs.call(this,s,l,c,d)}function Yo(s,l,c,d){Xs.apply(this,arguments)}function pr(s,l,c){this.name=s,this.tracks=c,this.duration=void 0!==l?l:-1,this.uuid=dn.generateUUID(),this.duration<0&&this.resetDuration(),this.optimize()}function zf(s){this.manager=void 0!==s?s:ar,this.textures={}}function hu(s){this.manager=void 0!==s?s:ar}function Zo(){this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){}}function du(s){"boolean"==typeof s&&(console.warn("THREE.JSONLoader: showStatus parameter has been removed from constructor."),s=void 0),this.manager=void 0!==s?s:ar,this.withCredentials=!1}function Hf(s){this.manager=void 0!==s?s:ar,this.texturePath=""}function Gr(){}function Eo(s,l){this.v1=s,this.v2=l}function Xh(){this.curves=[],this.autoClose=!1}function Cs(s,l,c,d,p,m,v,y){this.aX=s,this.aY=l,this.xRadius=c,this.yRadius=d,this.aStartAngle=p,this.aEndAngle=m,this.aClockwise=v,this.aRotation=y||0}fs.prototype={constructor:fs,evaluate:function(s){var l=this.parameterPositions,c=this._cachedIndex,d=l[c],p=l[c-1];e:{t:{var m;n:{i:if(!(s<d)){for(var v=c+2;;){if(void 0===d){if(s<p)break i;return this._cachedIndex=c=l.length,this.afterEnd_(c-1,s,p)}if(c===v)break;if(p=d,s<(d=l[++c]))break t}m=l.length;break n}if(s>=p)break e;var y=l[1];for(s<y&&(c=2,p=y),v=c-2;;){if(void 0===p)return this._cachedIndex=0,this.beforeStart_(0,s,d);if(c===v)break;if(d=p,s>=(p=l[--c-1]))break t}m=c,c=0}for(;c<m;){var b=c+m>>>1;s<l[b]?m=b:c=b+1}if(d=l[c],void 0===(p=l[c-1]))return this._cachedIndex=0,this.beforeStart_(0,s,d);if(void 0===d)return this._cachedIndex=c=l.length,this.afterEnd_(c-1,p,s)}this._cachedIndex=c,this.intervalChanged_(c,p,d)}return this.interpolate_(c,p,s,d)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(s){for(var l=this.resultBuffer,c=this.sampleValues,d=this.valueSize,p=s*d,m=0;m!==d;++m)l[m]=c[p+m];return l},interpolate_:function(s,l,c,d){throw new Error("call to abstract method")},intervalChanged_:function(s,l,c){}},Object.assign(fs.prototype,{beforeStart_:fs.prototype.copySampleValue_,afterEnd_:fs.prototype.copySampleValue_}),cu.prototype=Object.assign(Object.create(fs.prototype),{constructor:cu,DefaultSettings_:{endingStart:Tl,endingEnd:Tl},intervalChanged_:function(s,l,c){var d=this.parameterPositions,p=s-2,m=s+1,v=d[p],y=d[m];if(void 0===v)switch(this.getSettings_().endingStart){case $a:p=s,v=2*l-c;break;case hh:v=l+d[p=d.length-2]-d[p+1];break;default:p=s,v=c}if(void 0===y)switch(this.getSettings_().endingEnd){case $a:m=s,y=2*c-l;break;case hh:m=1,y=c+d[1]-d[0];break;default:m=s-1,y=l}var b=.5*(c-l),w=this.valueSize;this._weightPrev=b/(l-v),this._weightNext=b/(y-c),this._offsetPrev=p*w,this._offsetNext=m*w},interpolate_:function(s,l,c,d){for(var p=this.resultBuffer,m=this.sampleValues,v=this.valueSize,y=s*v,b=y-v,w=this._offsetPrev,T=this._offsetNext,A=this._weightPrev,R=this._weightNext,P=(c-l)/(d-l),L=P*P,B=L*P,U=-A*B+2*A*L-A*P,F=(1+A)*B+(-1.5-2*A)*L+(-.5+A)*P+1,V=(-1-R)*B+(1.5+R)*L+.5*P,H=R*B-R*L,J=0;J!==v;++J)p[J]=U*m[w+J]+F*m[b+J]+V*m[y+J]+H*m[T+J];return p}}),Gh.prototype=Object.assign(Object.create(fs.prototype),{constructor:Gh,interpolate_:function(s,l,c,d){for(var p=this.resultBuffer,m=this.sampleValues,v=this.valueSize,y=s*v,b=y-v,w=(c-l)/(d-l),T=1-w,A=0;A!==v;++A)p[A]=m[b+A]*T+m[y+A]*w;return p}}),Bf.prototype=Object.assign(Object.create(fs.prototype),{constructor:Bf,interpolate_:function(s,l,c,d){return this.copySampleValue_(s-1)}}),Hi={TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:uh,InterpolantFactoryMethodDiscrete:function(s){return new Bf(this.times,this.values,this.getValueSize(),s)},InterpolantFactoryMethodLinear:function(s){return new Gh(this.times,this.values,this.getValueSize(),s)},InterpolantFactoryMethodSmooth:function(s){return new cu(this.times,this.values,this.getValueSize(),s)},setInterpolation:function(s){var l;switch(s){case ch:l=this.InterpolantFactoryMethodDiscrete;break;case uh:l=this.InterpolantFactoryMethodLinear;break;case af:l=this.InterpolantFactoryMethodSmooth}if(void 0!==l)this.createInterpolant=l;else{var c="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(s===this.DefaultInterpolation)throw new Error(c);this.setInterpolation(this.DefaultInterpolation)}console.warn(c)}},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return ch;case this.InterpolantFactoryMethodLinear:return uh;case this.InterpolantFactoryMethodSmooth:return af}},getValueSize:function(){return this.values.length/this.times.length},shift:function(s){if(0!==s)for(var l=this.times,c=0,d=l.length;c!==d;++c)l[c]+=s;return this},scale:function(s){if(1!==s)for(var l=this.times,c=0,d=l.length;c!==d;++c)l[c]*=s;return this},trim:function(s,l){for(var c=this.times,d=c.length,p=0,m=d-1;p!==d&&c[p]<s;)++p;for(;-1!==m&&c[m]>l;)--m;if(++m,0!==p||m!==d){p>=m&&(p=(m=Math.max(m,1))-1);var v=this.getValueSize();this.times=Hr.arraySlice(c,p,m),this.values=Hr.arraySlice(this.values,p*v,m*v)}return this},validate:function(){var s=!0,l=this.getValueSize();l-Math.floor(l)!=0&&(console.error("invalid value size in track",this),s=!1);var c=this.times,d=this.values,p=c.length;0===p&&(console.error("track is empty",this),s=!1);for(var m=null,v=0;v!==p;v++){var y=c[v];if("number"==typeof y&&isNaN(y)){console.error("time is not a valid number",this,v,y),s=!1;break}if(null!==m&&m>y){console.error("out of order keys",this,v,y,m),s=!1;break}m=y}if(void 0!==d&&Hr.isTypedArray(d)){v=0;for(var b=d.length;v!==b;++v){var w=d[v];if(isNaN(w)){console.error("value is not a valid number",this,v,w),s=!1;break}}}return s},optimize:function(){for(var s=this.times,l=this.values,c=this.getValueSize(),d=this.getInterpolation()===af,p=1,m=s.length-1,v=1;v<m;++v){var y=!1,b=s[v];if(b!==s[v+1]&&(1!==v||b!==b[0]))if(d)y=!0;else for(var T=v*c,A=T-c,R=T+c,P=0;P!==c;++P){var L=l[T+P];if(L!==l[A+P]||L!==l[R+P]){y=!0;break}}if(y){if(v!==p){s[p]=s[v];var B=v*c,U=p*c;for(P=0;P!==c;++P)l[U+P]=l[B+P]}++p}}if(m>0){for(s[p]=s[m],B=m*c,U=p*c,P=0;P!==c;++P)l[U+P]=l[B+P];++p}return p!==s.length&&(this.times=Hr.arraySlice(s,0,p),this.values=Hr.arraySlice(l,0,p*c)),this}},di.prototype=Object.assign(Object.create(Hi),{constructor:di,ValueTypeName:"vector"}),kf.prototype=Object.assign(Object.create(fs.prototype),{constructor:kf,interpolate_:function(s,l,c,d){for(var p=this.resultBuffer,m=this.sampleValues,v=this.valueSize,y=s*v,b=(c-l)/(d-l),w=y+v;y!==w;y+=4)fr.slerpFlat(p,0,m,y-v,m,y,b);return p}}),Wh.prototype=Object.assign(Object.create(Hi),{constructor:Wh,ValueTypeName:"quaternion",DefaultInterpolation:uh,InterpolantFactoryMethodLinear:function(s){return new kf(this.times,this.values,this.getValueSize(),s)},InterpolantFactoryMethodSmooth:void 0}),uu.prototype=Object.assign(Object.create(Hi),{constructor:uu,ValueTypeName:"number"}),Vf.prototype=Object.assign(Object.create(Hi),{constructor:Vf,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:ch,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),jh.prototype=Object.assign(Object.create(Hi),{constructor:jh,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:ch,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),$h.prototype=Object.assign(Object.create(Hi),{constructor:$h,ValueTypeName:"color"}),Yo.prototype=Hi,Hi.constructor=Yo,Object.assign(Yo,{parse:function(s){if(void 0===s.type)throw new Error("track type undefined, can not parse");var l=Yo._getTrackTypeForValueTypeName(s.type);if(void 0===s.times){var c=[],d=[];Hr.flattenJSON(s.keys,c,d,"value"),s.times=c,s.values=d}return void 0!==l.parse?l.parse(s):new l(s.name,s.times,s.values,s.interpolation)},toJSON:function(s){var c,l=s.constructor;if(void 0!==l.toJSON)c=l.toJSON(s);else{c={name:s.name,times:Hr.convertArray(s.times,Array),values:Hr.convertArray(s.values,Array)};var d=s.getInterpolation();d!==s.DefaultInterpolation&&(c.interpolation=d)}return c.type=s.ValueTypeName,c},_getTrackTypeForValueTypeName:function(s){switch(s.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return uu;case"vector":case"vector2":case"vector3":case"vector4":return di;case"color":return $h;case"quaternion":return Wh;case"bool":case"boolean":return jh;case"string":return Vf}throw new Error("Unsupported typeName: "+s)}}),pr.prototype={constructor:pr,resetDuration:function(){for(var l=0,c=0,d=this.tracks.length;c!==d;++c){var p=this.tracks[c];l=Math.max(l,p.times[p.times.length-1])}this.duration=l},trim:function(){for(var s=0;s<this.tracks.length;s++)this.tracks[s].trim(0,this.duration);return this},optimize:function(){for(var s=0;s<this.tracks.length;s++)this.tracks[s].optimize();return this}},Object.assign(pr,{parse:function(s){for(var l=[],c=s.tracks,d=1/(s.fps||1),p=0,m=c.length;p!==m;++p)l.push(Yo.parse(c[p]).scale(d));return new pr(s.name,s.duration,l)},toJSON:function(s){for(var l=[],c=s.tracks,d={name:s.name,duration:s.duration,tracks:l},p=0,m=c.length;p!==m;++p)l.push(Yo.toJSON(c[p]));return d},CreateFromMorphTargetSequence:function(s,l,c,d){for(var p=l.length,m=[],v=0;v<p;v++){var y=[],b=[];y.push((v+p-1)%p,v,(v+1)%p),b.push(0,1,0);var w=Hr.getKeyframeOrder(y);y=Hr.sortedArray(y,1,w),b=Hr.sortedArray(b,1,w),!d&&0===y[0]&&(y.push(p),b.push(b[0])),m.push(new uu(".morphTargetInfluences["+l[v].name+"]",y,b).scale(1/c))}return new pr(s,-1,m)},findByName:function(s,l){var c=s;Array.isArray(s)||(c=s.geometry&&s.geometry.animations||s.animations);for(var p=0;p<c.length;p++)if(c[p].name===l)return c[p];return null},CreateClipsFromMorphTargetSequences:function(s,l,c){for(var d={},p=/^([\w-]*?)([\d]+)$/,m=0,v=s.length;m<v;m++){var y=s[m],b=y.name.match(p);if(b&&b.length>1){var T=d[w=b[1]];T||(d[w]=T=[]),T.push(y)}}var A=[];for(var w in d)A.push(pr.CreateFromMorphTargetSequence(w,d[w],l,c));return A},parseAnimation:function(s,l){if(!s)return console.error("  no animation in JSONLoader data"),null;for(var c=function(H,J,q,ae,se){if(0!==q.length){var le=[],ue=[];Hr.flattenJSON(q,le,ue,ae),0!==le.length&&se.push(new H(J,le,ue))}},d=[],p=s.name||"default",m=s.length||-1,v=s.fps||30,y=s.hierarchy||[],b=0;b<y.length;b++){var w=y[b].keys;if(w&&0!==w.length)if(w[0].morphTargets){for(var T={},A=0;A<w.length;A++)if(w[A].morphTargets)for(var R=0;R<w[A].morphTargets.length;R++)T[w[A].morphTargets[R]]=-1;for(var P in T){var L=[],B=[];for(R=0;R!==w[A].morphTargets.length;++R){var U=w[A];L.push(U.time),B.push(U.morphTarget===P?1:0)}d.push(new uu(".morphTargetInfluence["+P+"]",L,B))}m=T.length*(v||1)}else{var F=".bones["+l[b].name+"]";c(di,F+".position",w,"pos",d),c(Wh,F+".quaternion",w,"rot",d),c(di,F+".scale",w,"scl",d)}}return 0===d.length?null:new pr(p,m,d)}}),Object.assign(zf.prototype,{load:function(s,l,c,d){var p=this;new $s(p.manager).load(s,function(v){l(p.parse(JSON.parse(v)))},c,d)},setTextures:function(s){this.textures=s},parse:function(s){var l=this.textures;function c(y){return void 0===l[y]&&console.warn("THREE.MaterialLoader: Undefined texture",y),l[y]}var d=new BA[s.type];if(void 0!==s.uuid&&(d.uuid=s.uuid),void 0!==s.name&&(d.name=s.name),void 0!==s.color&&d.color.setHex(s.color),void 0!==s.roughness&&(d.roughness=s.roughness),void 0!==s.metalness&&(d.metalness=s.metalness),void 0!==s.emissive&&d.emissive.setHex(s.emissive),void 0!==s.specular&&d.specular.setHex(s.specular),void 0!==s.shininess&&(d.shininess=s.shininess),void 0!==s.clearCoat&&(d.clearCoat=s.clearCoat),void 0!==s.clearCoatRoughness&&(d.clearCoatRoughness=s.clearCoatRoughness),void 0!==s.uniforms&&(d.uniforms=s.uniforms),void 0!==s.vertexShader&&(d.vertexShader=s.vertexShader),void 0!==s.fragmentShader&&(d.fragmentShader=s.fragmentShader),void 0!==s.vertexColors&&(d.vertexColors=s.vertexColors),void 0!==s.fog&&(d.fog=s.fog),void 0!==s.shading&&(d.shading=s.shading),void 0!==s.blending&&(d.blending=s.blending),void 0!==s.side&&(d.side=s.side),void 0!==s.opacity&&(d.opacity=s.opacity),void 0!==s.transparent&&(d.transparent=s.transparent),void 0!==s.alphaTest&&(d.alphaTest=s.alphaTest),void 0!==s.depthTest&&(d.depthTest=s.depthTest),void 0!==s.depthWrite&&(d.depthWrite=s.depthWrite),void 0!==s.colorWrite&&(d.colorWrite=s.colorWrite),void 0!==s.wireframe&&(d.wireframe=s.wireframe),void 0!==s.wireframeLinewidth&&(d.wireframeLinewidth=s.wireframeLinewidth),void 0!==s.wireframeLinecap&&(d.wireframeLinecap=s.wireframeLinecap),void 0!==s.wireframeLinejoin&&(d.wireframeLinejoin=s.wireframeLinejoin),void 0!==s.skinning&&(d.skinning=s.skinning),void 0!==s.morphTargets&&(d.morphTargets=s.morphTargets),void 0!==s.size&&(d.size=s.size),void 0!==s.sizeAttenuation&&(d.sizeAttenuation=s.sizeAttenuation),void 0!==s.map&&(d.map=c(s.map)),void 0!==s.alphaMap&&(d.alphaMap=c(s.alphaMap),d.transparent=!0),void 0!==s.bumpMap&&(d.bumpMap=c(s.bumpMap)),void 0!==s.bumpScale&&(d.bumpScale=s.bumpScale),void 0!==s.normalMap&&(d.normalMap=c(s.normalMap)),void 0!==s.normalScale){var p=s.normalScale;!1===Array.isArray(p)&&(p=[p,p]),d.normalScale=(new ut).fromArray(p)}if(void 0!==s.displacementMap&&(d.displacementMap=c(s.displacementMap)),void 0!==s.displacementScale&&(d.displacementScale=s.displacementScale),void 0!==s.displacementBias&&(d.displacementBias=s.displacementBias),void 0!==s.roughnessMap&&(d.roughnessMap=c(s.roughnessMap)),void 0!==s.metalnessMap&&(d.metalnessMap=c(s.metalnessMap)),void 0!==s.emissiveMap&&(d.emissiveMap=c(s.emissiveMap)),void 0!==s.emissiveIntensity&&(d.emissiveIntensity=s.emissiveIntensity),void 0!==s.specularMap&&(d.specularMap=c(s.specularMap)),void 0!==s.envMap&&(d.envMap=c(s.envMap)),void 0!==s.reflectivity&&(d.reflectivity=s.reflectivity),void 0!==s.lightMap&&(d.lightMap=c(s.lightMap)),void 0!==s.lightMapIntensity&&(d.lightMapIntensity=s.lightMapIntensity),void 0!==s.aoMap&&(d.aoMap=c(s.aoMap)),void 0!==s.aoMapIntensity&&(d.aoMapIntensity=s.aoMapIntensity),void 0!==s.gradientMap&&(d.gradientMap=c(s.gradientMap)),void 0!==s.materials)for(var m=0,v=s.materials.length;m<v;m++)d.materials.push(this.parse(s.materials[m]));return d}}),Object.assign(hu.prototype,{load:function(s,l,c,d){var p=this;new $s(p.manager).load(s,function(v){l(p.parse(JSON.parse(v)))},c,d)},parse:function(s){var l=new kt,c=s.data.index,d={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};if(void 0!==c){var p=new d[c.type](c.array);l.setIndex(new lt(p,1))}var m=s.data.attributes;for(var v in m){var y=m[v];p=new d[y.type](y.array),l.addAttribute(v,new lt(p,y.itemSize,y.normalized))}var b=s.data.groups||s.data.drawcalls||s.data.offsets;if(void 0!==b)for(var w=0,T=b.length;w!==T;++w){var A=b[w];l.addGroup(A.start,A.count,A.materialIndex)}var R=s.data.boundingSphere;if(void 0!==R){var P=new z;void 0!==R.center&&P.fromArray(R.center),l.boundingSphere=new or(P,R.radius)}return l}}),Zo.prototype={constructor:Zo,crossOrigin:void 0,extractUrlBase:function(s){var l=s.split("/");return 1===l.length?"./":(l.pop(),l.join("/")+"/")},initMaterials:function(s,l,c){for(var d=[],p=0;p<s.length;++p)d[p]=this.createMaterial(s[p],l,c);return d},createMaterial:function(){var s,l,c;return function(p,m,v){void 0===s&&(s=new Tt),void 0===l&&(l=new Ff),void 0===c&&(c=new zf);var y={};function b(R,P,L,B,U){var H,F=m+R,V=Zo.Handlers.get(F);null!==V?H=V.load(F):(l.setCrossOrigin(v),H=l.load(F)),void 0!==P&&(H.repeat.fromArray(P),1!==P[0]&&(H.wrapS=ha),1!==P[1]&&(H.wrapT=ha)),void 0!==L&&H.offset.fromArray(L),void 0!==B&&("repeat"===B[0]&&(H.wrapS=ha),"mirror"===B[0]&&(H.wrapS=El),"repeat"===B[1]&&(H.wrapT=ha),"mirror"===B[1]&&(H.wrapT=El)),void 0!==U&&(H.anisotropy=U);var J=dn.generateUUID();return y[J]=H,J}var w={uuid:dn.generateUUID(),type:"MeshLambertMaterial"};for(var T in p){var A=p[T];switch(T){case"DbgColor":case"DbgIndex":case"opticalDensity":case"illumination":case"mapDiffuseRepeat":case"mapDiffuseOffset":case"mapDiffuseWrap":case"mapDiffuseAnisotropy":case"mapEmissiveRepeat":case"mapEmissiveOffset":case"mapEmissiveWrap":case"mapEmissiveAnisotropy":case"mapLightRepeat":case"mapLightOffset":case"mapLightWrap":case"mapLightAnisotropy":case"mapAORepeat":case"mapAOOffset":case"mapAOWrap":case"mapAOAnisotropy":case"mapBumpRepeat":case"mapBumpOffset":case"mapBumpWrap":case"mapBumpAnisotropy":case"mapNormalRepeat":case"mapNormalOffset":case"mapNormalWrap":case"mapNormalAnisotropy":case"mapSpecularRepeat":case"mapSpecularOffset":case"mapSpecularWrap":case"mapSpecularAnisotropy":case"mapMetalnessRepeat":case"mapMetalnessOffset":case"mapMetalnessWrap":case"mapMetalnessAnisotropy":case"mapRoughnessRepeat":case"mapRoughnessOffset":case"mapRoughnessWrap":case"mapRoughnessAnisotropy":case"mapAlphaRepeat":case"mapAlphaOffset":case"mapAlphaWrap":case"mapAlphaAnisotropy":break;case"DbgName":w.name=A;break;case"blending":w.blending=jd[A];break;case"colorAmbient":case"mapAmbient":console.warn("THREE.Loader.createMaterial:",T,"is no longer supported.");break;case"colorDiffuse":w.color=s.fromArray(A).getHex();break;case"colorSpecular":w.specular=s.fromArray(A).getHex();break;case"colorEmissive":w.emissive=s.fromArray(A).getHex();break;case"specularCoef":w.shininess=A;break;case"shading":"basic"===A.toLowerCase()&&(w.type="MeshBasicMaterial"),"phong"===A.toLowerCase()&&(w.type="MeshPhongMaterial"),"standard"===A.toLowerCase()&&(w.type="MeshStandardMaterial");break;case"mapDiffuse":w.map=b(A,p.mapDiffuseRepeat,p.mapDiffuseOffset,p.mapDiffuseWrap,p.mapDiffuseAnisotropy);break;case"mapEmissive":w.emissiveMap=b(A,p.mapEmissiveRepeat,p.mapEmissiveOffset,p.mapEmissiveWrap,p.mapEmissiveAnisotropy);break;case"mapLight":w.lightMap=b(A,p.mapLightRepeat,p.mapLightOffset,p.mapLightWrap,p.mapLightAnisotropy);break;case"mapAO":w.aoMap=b(A,p.mapAORepeat,p.mapAOOffset,p.mapAOWrap,p.mapAOAnisotropy);break;case"mapBump":w.bumpMap=b(A,p.mapBumpRepeat,p.mapBumpOffset,p.mapBumpWrap,p.mapBumpAnisotropy);break;case"mapBumpScale":w.bumpScale=A;break;case"mapNormal":w.normalMap=b(A,p.mapNormalRepeat,p.mapNormalOffset,p.mapNormalWrap,p.mapNormalAnisotropy);break;case"mapNormalFactor":w.normalScale=[A,A];break;case"mapSpecular":w.specularMap=b(A,p.mapSpecularRepeat,p.mapSpecularOffset,p.mapSpecularWrap,p.mapSpecularAnisotropy);break;case"mapMetalness":w.metalnessMap=b(A,p.mapMetalnessRepeat,p.mapMetalnessOffset,p.mapMetalnessWrap,p.mapMetalnessAnisotropy);break;case"mapRoughness":w.roughnessMap=b(A,p.mapRoughnessRepeat,p.mapRoughnessOffset,p.mapRoughnessWrap,p.mapRoughnessAnisotropy);break;case"mapAlpha":w.alphaMap=b(A,p.mapAlphaRepeat,p.mapAlphaOffset,p.mapAlphaWrap,p.mapAlphaAnisotropy);break;case"flipSided":w.side=ie;break;case"doubleSided":w.side=Nt;break;case"transparency":console.warn("THREE.Loader.createMaterial: transparency has been renamed to opacity"),w.opacity=A;break;case"depthTest":case"depthWrite":case"colorWrite":case"opacity":case"reflectivity":case"transparent":case"visible":case"wireframe":w[T]=A;break;case"vertexColors":!0===A&&(w.vertexColors=ca),"face"===A&&(w.vertexColors=eh);break;default:console.error("THREE.Loader.createMaterial: Unsupported",T,A)}}return"MeshBasicMaterial"===w.type&&delete w.emissive,"MeshPhongMaterial"!==w.type&&delete w.specular,w.opacity<1&&(w.transparent=!0),c.setTextures(y),c.parse(w)}}()},Zo.Handlers={handlers:[],add:function(s,l){this.handlers.push(s,l)},get:function(s){for(var l=this.handlers,c=0,d=l.length;c<d;c+=2){var m=l[c+1];if(l[c].test(s))return m}return null}},Object.assign(du.prototype,{load:function(s,l,c,d){var p=this,m=this.texturePath&&"string"==typeof this.texturePath?this.texturePath:Zo.prototype.extractUrlBase(s),v=new $s(this.manager);v.setWithCredentials(this.withCredentials),v.load(s,function(y){var b=JSON.parse(y),w=b.metadata;if(void 0!==w){var T=w.type;if(void 0!==T){if("object"===T.toLowerCase())return void console.error("THREE.JSONLoader: "+s+" should be loaded with THREE.ObjectLoader instead.");if("scene"===T.toLowerCase())return void console.error("THREE.JSONLoader: "+s+" should be loaded with THREE.SceneLoader instead.")}}var A=p.parse(b,m);l(A.geometry,A.materials)},c,d)},setTexturePath:function(s){this.texturePath=s},parse:function(s,l){var c=new vn,d=void 0!==s.scale?1/s.scale:1;if(function p(w){function T(Lt,At){return Lt&1<<At}var A,R,P,L,B,U,F,V,H,J,q,ae,se,le,ue,me,Fe,Ie,Z,ee,ve,Te,Oe,Le,Ne,He=s.faces,ye=s.vertices,Ge=s.normals,tt=s.colors,Je=0;if(void 0!==s.uvs){for(A=0;A<s.uvs.length;A++)s.uvs[A].length&&Je++;for(A=0;A<Je;A++)c.faceVertexUvs[A]=[]}for(L=0,B=ye.length;L<B;)(Ie=new z).x=ye[L++]*w,Ie.y=ye[L++]*w,Ie.z=ye[L++]*w,c.vertices.push(Ie);for(L=0,B=He.length;L<B;)if(q=T(J=He[L++],0),ae=T(J,1),se=T(J,3),le=T(J,4),ue=T(J,5),me=T(J,6),Fe=T(J,7),q){if((ee=new zs).a=He[L],ee.b=He[L+1],ee.c=He[L+3],(ve=new zs).a=He[L+1],ve.b=He[L+2],ve.c=He[L+3],L+=4,ae&&(H=He[L++],ee.materialIndex=H,ve.materialIndex=H),P=c.faces.length,se)for(A=0;A<Je;A++)for(Le=s.uvs[A],c.faceVertexUvs[A][P]=[],c.faceVertexUvs[A][P+1]=[],R=0;R<4;R++)Ne=new ut(Le[2*(V=He[L++])],Le[2*V+1]),2!==R&&c.faceVertexUvs[A][P].push(Ne),0!==R&&c.faceVertexUvs[A][P+1].push(Ne);if(le&&(F=3*He[L++],ee.normal.set(Ge[F++],Ge[F++],Ge[F]),ve.normal.copy(ee.normal)),ue)for(A=0;A<4;A++)F=3*He[L++],Oe=new z(Ge[F++],Ge[F++],Ge[F]),2!==A&&ee.vertexNormals.push(Oe),0!==A&&ve.vertexNormals.push(Oe);if(me&&(U=He[L++],ee.color.setHex(Te=tt[U]),ve.color.setHex(Te)),Fe)for(A=0;A<4;A++)Te=tt[U=He[L++]],2!==A&&ee.vertexColors.push(new Tt(Te)),0!==A&&ve.vertexColors.push(new Tt(Te));c.faces.push(ee),c.faces.push(ve)}else{if((Z=new zs).a=He[L++],Z.b=He[L++],Z.c=He[L++],ae&&(H=He[L++],Z.materialIndex=H),P=c.faces.length,se)for(A=0;A<Je;A++)for(Le=s.uvs[A],c.faceVertexUvs[A][P]=[],R=0;R<3;R++)Ne=new ut(Le[2*(V=He[L++])],Le[2*V+1]),c.faceVertexUvs[A][P].push(Ne);if(le&&(F=3*He[L++],Z.normal.set(Ge[F++],Ge[F++],Ge[F])),ue)for(A=0;A<3;A++)F=3*He[L++],Oe=new z(Ge[F++],Ge[F++],Ge[F]),Z.vertexNormals.push(Oe);if(me&&(U=He[L++],Z.color.setHex(tt[U])),Fe)for(A=0;A<3;A++)U=He[L++],Z.vertexColors.push(new Tt(tt[U]));c.faces.push(Z)}}(d),function m(){var w=void 0!==s.influencesPerVertex?s.influencesPerVertex:2;if(s.skinWeights)for(var T=0,A=s.skinWeights.length;T<A;T+=w)c.skinWeights.push(new ri(s.skinWeights[T],w>1?s.skinWeights[T+1]:0,w>2?s.skinWeights[T+2]:0,w>3?s.skinWeights[T+3]:0));if(s.skinIndices)for(T=0,A=s.skinIndices.length;T<A;T+=w)c.skinIndices.push(new ri(s.skinIndices[T],w>1?s.skinIndices[T+1]:0,w>2?s.skinIndices[T+2]:0,w>3?s.skinIndices[T+3]:0));c.bones=s.bones,c.bones&&c.bones.length>0&&(c.skinWeights.length!==c.skinIndices.length||c.skinIndices.length!==c.vertices.length)&&console.warn("When skinning, number of vertices ("+c.vertices.length+"), skinIndices ("+c.skinIndices.length+"), and skinWeights ("+c.skinWeights.length+") should match.")}(),function v(w){if(void 0!==s.morphTargets)for(var T=0,A=s.morphTargets.length;T<A;T++){c.morphTargets[T]={},c.morphTargets[T].name=s.morphTargets[T].name,c.morphTargets[T].vertices=[];for(var R=c.morphTargets[T].vertices,P=s.morphTargets[T].vertices,L=0,B=P.length;L<B;L+=3){var U=new z;U.x=P[L]*w,U.y=P[L+1]*w,U.z=P[L+2]*w,R.push(U)}}if(void 0!==s.morphColors&&s.morphColors.length>0){console.warn('THREE.JSONLoader: "morphColors" no longer supported. Using them as face colors.');var F=c.faces,V=s.morphColors[0].colors;for(T=0,A=F.length;T<A;T++)F[T].color.fromArray(V,3*T)}}(d),function y(){var w=[],T=[];void 0!==s.animation&&T.push(s.animation),void 0!==s.animations&&(s.animations.length?T=T.concat(s.animations):T.push(s.animations));for(var A=0;A<T.length;A++){var R=pr.parseAnimation(T[A],c.bones);R&&w.push(R)}if(c.morphTargets){var P=pr.CreateClipsFromMorphTargetSequences(c.morphTargets,10);w=w.concat(P)}w.length>0&&(c.animations=w)}(),c.computeFaceNormals(),c.computeBoundingSphere(),void 0===s.materials||0===s.materials.length)return{geometry:c};var b=Zo.prototype.initMaterials(s.materials,l,this.crossOrigin);return{geometry:c,materials:b}}}),Object.assign(Hf.prototype,{load:function(s,l,c,d){""===this.texturePath&&(this.texturePath=s.substring(0,s.lastIndexOf("/")+1));var p=this;new $s(p.manager).load(s,function(v){var y=null;try{y=JSON.parse(v)}catch(w){return void console.error("THREE:ObjectLoader: Can't parse "+s+".",w.message)}var b=y.metadata;void 0!==b&&void 0!==b.type&&"geometry"!==b.type.toLowerCase()?p.parse(y,l):console.error("THREE.ObjectLoader: Can't load "+s+". Use THREE.JSONLoader instead.")},c,d)},setTexturePath:function(s){this.texturePath=s},setCrossOrigin:function(s){this.crossOrigin=s},parse:function(s,l){var c=this.parseGeometries(s.geometries),d=this.parseImages(s.images,function(){void 0!==l&&l(v)}),p=this.parseTextures(s.textures,d),m=this.parseMaterials(s.materials,p),v=this.parseObject(s.object,c,m);return s.animations&&(v.animations=this.parseAnimations(s.animations)),(void 0===s.images||0===s.images.length)&&void 0!==l&&l(v),v},parseGeometries:function(s){var l={};if(void 0!==s)for(var c=new du,d=new hu,p=0,m=s.length;p<m;p++){var v,y=s[p];switch(y.type){case"PlaneGeometry":case"PlaneBufferGeometry":v=new Re[y.type](y.width,y.height,y.widthSegments,y.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":v=new Re[y.type](y.width,y.height,y.depth,y.widthSegments,y.heightSegments,y.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":v=new Re[y.type](y.radius,y.segments,y.thetaStart,y.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":v=new Re[y.type](y.radiusTop,y.radiusBottom,y.height,y.radialSegments,y.heightSegments,y.openEnded,y.thetaStart,y.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":v=new Re[y.type](y.radius,y.height,y.radialSegments,y.heightSegments,y.openEnded,y.thetaStart,y.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":v=new Re[y.type](y.radius,y.widthSegments,y.heightSegments,y.phiStart,y.phiLength,y.thetaStart,y.thetaLength);break;case"DodecahedronGeometry":case"IcosahedronGeometry":case"OctahedronGeometry":case"TetrahedronGeometry":v=new Re[y.type](y.radius,y.detail);break;case"RingGeometry":case"RingBufferGeometry":v=new Re[y.type](y.innerRadius,y.outerRadius,y.thetaSegments,y.phiSegments,y.thetaStart,y.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":v=new Re[y.type](y.radius,y.tube,y.radialSegments,y.tubularSegments,y.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":v=new Re[y.type](y.radius,y.tube,y.tubularSegments,y.radialSegments,y.p,y.q);break;case"LatheGeometry":case"LatheBufferGeometry":v=new Re[y.type](y.points,y.segments,y.phiStart,y.phiLength);break;case"BufferGeometry":v=d.parse(y);break;case"Geometry":v=c.parse(y.data,this.texturePath).geometry;break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+y.type+'"');continue}v.uuid=y.uuid,void 0!==y.name&&(v.name=y.name),l[y.uuid]=v}return l},parseMaterials:function(s,l){var c={};if(void 0!==s){var d=new zf;d.setTextures(l);for(var p=0,m=s.length;p<m;p++){var v=d.parse(s[p]);c[v.uuid]=v}}return c},parseAnimations:function(s){for(var l=[],c=0;c<s.length;c++){var d=pr.parse(s[c]);l.push(d)}return l},parseImages:function(s,l){var c=this,d={};function p(A){return c.manager.itemStart(A),v.load(A,function(){c.manager.itemEnd(A)},void 0,function(){c.manager.itemError(A)})}if(void 0!==s&&s.length>0){var v=new su(new zr(l));v.setCrossOrigin(this.crossOrigin);for(var y=0,b=s.length;y<b;y++){var w=s[y],T=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(w.url)?w.url:c.texturePath+w.url;d[w.uuid]=p(T)}}return d},parseTextures:function(s,l){function c(b,w){return"number"==typeof b?b:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",b),w[b])}var d={};if(void 0!==s)for(var p=0,m=s.length;p<m;p++){var v=s[p];void 0===v.image&&console.warn('THREE.ObjectLoader: No "image" specified for',v.uuid),void 0===l[v.image]&&console.warn("THREE.ObjectLoader: Undefined image",v.image);var y=new mt(l[v.image]);y.needsUpdate=!0,y.uuid=v.uuid,void 0!==v.name&&(y.name=v.name),void 0!==v.mapping&&(y.mapping=c(v.mapping,Xm)),void 0!==v.offset&&y.offset.fromArray(v.offset),void 0!==v.repeat&&y.repeat.fromArray(v.repeat),void 0!==v.wrap&&(y.wrapS=c(v.wrap[0],qm),y.wrapT=c(v.wrap[1],qm)),void 0!==v.minFilter&&(y.minFilter=c(v.minFilter,Ey)),void 0!==v.magFilter&&(y.magFilter=c(v.magFilter,Ey)),void 0!==v.anisotropy&&(y.anisotropy=v.anisotropy),void 0!==v.flipY&&(y.flipY=v.flipY),d[v.uuid]=y}return d},parseObject:function(){var s=new Wt;return function(c,d,p){var m;function v(L){return void 0===d[L]&&console.warn("THREE.ObjectLoader: Undefined geometry",L),d[L]}function y(L){if(void 0!==L)return void 0===p[L]&&console.warn("THREE.ObjectLoader: Undefined material",L),p[L]}switch(c.type){case"Scene":m=new $c,void 0!==c.background&&Number.isInteger(c.background)&&(m.background=new Tt(c.background)),void 0!==c.fog&&("Fog"===c.fog.type?m.fog=new Qa(c.fog.color,c.fog.near,c.fog.far):"FogExp2"===c.fog.type&&(m.fog=new jc(c.fog.color,c.fog.density)));break;case"PerspectiveCamera":m=new Zi(c.fov,c.aspect,c.near,c.far),void 0!==c.focus&&(m.focus=c.focus),void 0!==c.zoom&&(m.zoom=c.zoom),void 0!==c.filmGauge&&(m.filmGauge=c.filmGauge),void 0!==c.filmOffset&&(m.filmOffset=c.filmOffset),void 0!==c.view&&(m.view=Object.assign({},c.view));break;case"OrthographicCamera":m=new Gs(c.left,c.right,c.top,c.bottom,c.near,c.far);break;case"AmbientLight":m=new Hh(c.color,c.intensity);break;case"DirectionalLight":m=new zh(c.color,c.intensity);break;case"PointLight":m=new Vh(c.color,c.intensity,c.distance,c.decay);break;case"SpotLight":m=new Uf(c.color,c.intensity,c.distance,c.angle,c.penumbra,c.decay);break;case"HemisphereLight":m=new ou(c.color,c.groundColor,c.intensity);break;case"Mesh":var b=v(c.geometry),w=y(c.material);m=b.bones&&b.bones.length>0?new Pf(b,w):new br(b,w);break;case"LOD":m=new qc;break;case"Line":m=new ga(v(c.geometry),y(c.material),c.mode);break;case"LineSegments":m=new Di(v(c.geometry),y(c.material));break;case"PointCloud":case"Points":m=new Ch(v(c.geometry),y(c.material));break;case"Sprite":m=new Xc(y(c.material));break;case"Group":m=new Ah;break;case"SkinnedMesh":console.warn("THREE.ObjectLoader.parseObject() does not support SkinnedMesh type. Instantiates Object3D instead.");default:m=new at}if(m.uuid=c.uuid,void 0!==c.name&&(m.name=c.name),void 0!==c.matrix?(s.fromArray(c.matrix),s.decompose(m.position,m.quaternion,m.scale)):(void 0!==c.position&&m.position.fromArray(c.position),void 0!==c.rotation&&m.rotation.fromArray(c.rotation),void 0!==c.quaternion&&m.quaternion.fromArray(c.quaternion),void 0!==c.scale&&m.scale.fromArray(c.scale)),void 0!==c.castShadow&&(m.castShadow=c.castShadow),void 0!==c.receiveShadow&&(m.receiveShadow=c.receiveShadow),c.shadow&&(void 0!==c.shadow.bias&&(m.shadow.bias=c.shadow.bias),void 0!==c.shadow.radius&&(m.shadow.radius=c.shadow.radius),void 0!==c.shadow.mapSize&&m.shadow.mapSize.fromArray(c.shadow.mapSize),void 0!==c.shadow.camera&&(m.shadow.camera=this.parseObject(c.shadow.camera))),void 0!==c.visible&&(m.visible=c.visible),void 0!==c.userData&&(m.userData=c.userData),void 0!==c.children)for(var T in c.children)m.add(this.parseObject(c.children[T],d,p));if("LOD"===c.type)for(var A=c.levels,R=0;R<A.length;R++){var P=A[R];void 0!==(T=m.getObjectByProperty("uuid",P.object))&&m.addLevel(T,P.distance)}return m}}()}),Gr.prototype={constructor:Gr,getPoint:function(s){return console.warn("THREE.Curve: Warning, getPoint() not implemented!"),null},getPointAt:function(s){var l=this.getUtoTmapping(s);return this.getPoint(l)},getPoints:function(s){s||(s=5);for(var l=[],c=0;c<=s;c++)l.push(this.getPoint(c/s));return l},getSpacedPoints:function(s){s||(s=5);for(var l=[],c=0;c<=s;c++)l.push(this.getPointAt(c/s));return l},getLength:function(){var s=this.getLengths();return s[s.length-1]},getLengths:function(s){if(s||(s=this.__arcLengthDivisions?this.__arcLengthDivisions:200),this.cacheArcLengths&&this.cacheArcLengths.length===s+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var c,p,l=[],d=this.getPoint(0),m=0;for(l.push(0),p=1;p<=s;p++)m+=(c=this.getPoint(p/s)).distanceTo(d),l.push(m),d=c;return this.cacheArcLengths=l,l},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(s,l){var m,c=this.getLengths(),d=0,p=c.length;m=l||s*c[p-1];for(var b,v=0,y=p-1;v<=y;)if((b=c[d=Math.floor(v+(y-v)/2)]-m)<0)v=d+1;else{if(!(b>0)){y=d;break}y=d-1}if(c[d=y]===m)return d/(p-1);var w=c[d];return(d+(m-w)/(c[d+1]-w))/(p-1)},getTangent:function(s){var l=1e-4,c=s-l,d=s+l;c<0&&(c=0),d>1&&(d=1);var p=this.getPoint(c);return this.getPoint(d).clone().sub(p).normalize()},getTangentAt:function(s){var l=this.getUtoTmapping(s);return this.getTangent(l)},computeFrenetFrames:function(s,l){var b,T,c=new z,d=[],p=[],m=[],v=new z,y=new Wt;for(b=0;b<=s;b++)d[b]=this.getTangentAt(b/s),d[b].normalize();p[0]=new z,m[0]=new z;var A=Number.MAX_VALUE,R=Math.abs(d[0].x),P=Math.abs(d[0].y),L=Math.abs(d[0].z);for(R<=A&&(A=R,c.set(1,0,0)),P<=A&&(A=P,c.set(0,1,0)),L<=A&&c.set(0,0,1),v.crossVectors(d[0],c).normalize(),p[0].crossVectors(d[0],v),m[0].crossVectors(d[0],p[0]),b=1;b<=s;b++)p[b]=p[b-1].clone(),m[b]=m[b-1].clone(),v.crossVectors(d[b-1],d[b]),v.length()>Number.EPSILON&&(v.normalize(),T=Math.acos(dn.clamp(d[b-1].dot(d[b]),-1,1)),p[b].applyMatrix4(y.makeRotationAxis(v,T))),m[b].crossVectors(d[b],p[b]);if(!0===l)for(T=Math.acos(dn.clamp(p[0].dot(p[s]),-1,1)),T/=s,d[0].dot(v.crossVectors(p[0],p[s]))>0&&(T=-T),b=1;b<=s;b++)p[b].applyMatrix4(y.makeRotationAxis(d[b],T*b)),m[b].crossVectors(d[b],p[b]);return{tangents:d,normals:p,binormals:m}}},Gr.create=function(s,l){return s.prototype=Object.create(Gr.prototype),s.prototype.constructor=s,s.prototype.getPoint=l,s},(Eo.prototype=Object.create(Gr.prototype)).constructor=Eo,Eo.prototype.isLineCurve=!0,Eo.prototype.getPoint=function(s){if(1===s)return this.v2.clone();var l=this.v2.clone().sub(this.v1);return l.multiplyScalar(s).add(this.v1),l},Eo.prototype.getPointAt=function(s){return this.getPoint(s)},Eo.prototype.getTangent=function(s){return this.v2.clone().sub(this.v1).normalize()},Xh.prototype=Object.assign(Object.create(Gr.prototype),{constructor:Xh,add:function(s){this.curves.push(s)},closePath:function(){var s=this.curves[0].getPoint(0),l=this.curves[this.curves.length-1].getPoint(1);s.equals(l)||this.curves.push(new Eo(l,s))},getPoint:function(s){for(var l=s*this.getLength(),c=this.getCurveLengths(),d=0;d<c.length;){if(c[d]>=l){var p=c[d]-l,m=this.curves[d],v=m.getLength();return m.getPointAt(0===v?0:1-p/v)}d++}return null},getLength:function(){var s=this.getCurveLengths();return s[s.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var s=[],l=0,c=0,d=this.curves.length;c<d;c++)l+=this.curves[c].getLength(),s.push(l);return this.cacheLengths=s,s},getSpacedPoints:function(s){s||(s=40);for(var l=[],c=0;c<=s;c++)l.push(this.getPoint(c/s));return this.autoClose&&l.push(l[0]),l},getPoints:function(s){s=s||12;for(var c,l=[],d=0,p=this.curves;d<p.length;d++)for(var m=p[d],y=m.getPoints(m&&m.isEllipseCurve?2*s:m&&m.isLineCurve?1:m&&m.isSplineCurve?s*m.points.length:s),b=0;b<y.length;b++){var w=y[b];c&&c.equals(w)||(l.push(w),c=w)}return this.autoClose&&l.length>1&&!l[l.length-1].equals(l[0])&&l.push(l[0]),l},createPointsGeometry:function(s){var l=this.getPoints(s);return this.createGeometry(l)},createSpacedPointsGeometry:function(s){var l=this.getSpacedPoints(s);return this.createGeometry(l)},createGeometry:function(s){for(var l=new vn,c=0,d=s.length;c<d;c++){var p=s[c];l.vertices.push(new z(p.x,p.y,p.z||0))}return l}}),(Cs.prototype=Object.create(Gr.prototype)).constructor=Cs,Cs.prototype.isEllipseCurve=!0,Cs.prototype.getPoint=function(s){for(var l=2*Math.PI,c=this.aEndAngle-this.aStartAngle,d=Math.abs(c)<Number.EPSILON;c<0;)c+=l;for(;c>l;)c-=l;c<Number.EPSILON&&(c=d?0:l),!0===this.aClockwise&&!d&&(c===l?c=-l:c-=l);var p=this.aStartAngle+s*c,m=this.aX+this.xRadius*Math.cos(p),v=this.aY+this.yRadius*Math.sin(p);if(0!==this.aRotation){var y=Math.cos(this.aRotation),b=Math.sin(this.aRotation),w=m-this.aX,T=v-this.aY;m=w*y-T*b+this.aX,v=w*b+T*y+this.aY}return new ut(m,v)};var Ma={tangentQuadraticBezier:function(s,l,c,d){return 2*(1-s)*(c-l)+2*s*(d-c)},tangentCubicBezier:function(s,l,c,d,p){return-3*l*(1-s)*(1-s)+3*c*(1-s)*(1-s)-6*s*c*(1-s)+6*s*d*(1-s)-3*s*s*d+3*s*s*p},tangentSpline:function(s,l,c,d,p){return 6*s*s-6*s+(3*s*s-4*s+1)+(-6*s*s+6*s)+(3*s*s-2*s)},interpolate:function(s,l,c,d,p){var m=.5*(c-s),v=.5*(d-l),y=p*p;return(2*l-2*c+m+v)*(p*y)+(-3*l+3*c-2*m-v)*y+m*p+l}};function kl(s){this.points=void 0===s?[]:s}function fu(s,l,c,d){this.v0=s,this.v1=l,this.v2=c,this.v3=d}function wa(s,l,c){this.v0=s,this.v1=l,this.v2=c}(kl.prototype=Object.create(Gr.prototype)).constructor=kl,kl.prototype.isSplineCurve=!0,kl.prototype.getPoint=function(s){var l=this.points,c=(l.length-1)*s,d=Math.floor(c),p=c-d,m=l[0===d?d:d-1],v=l[d],y=l[d>l.length-2?l.length-1:d+1],b=l[d>l.length-3?l.length-1:d+2],w=Ma.interpolate;return new ut(w(m.x,v.x,y.x,b.x,p),w(m.y,v.y,y.y,b.y,p))},(fu.prototype=Object.create(Gr.prototype)).constructor=fu,fu.prototype.getPoint=function(s){var l=Ui.b3;return new ut(l(s,this.v0.x,this.v1.x,this.v2.x,this.v3.x),l(s,this.v0.y,this.v1.y,this.v2.y,this.v3.y))},fu.prototype.getTangent=function(s){var l=Ma.tangentCubicBezier;return new ut(l(s,this.v0.x,this.v1.x,this.v2.x,this.v3.x),l(s,this.v0.y,this.v1.y,this.v2.y,this.v3.y)).normalize()},(wa.prototype=Object.create(Gr.prototype)).constructor=wa,wa.prototype.getPoint=function(s){var l=Ui.b2;return new ut(l(s,this.v0.x,this.v1.x,this.v2.x),l(s,this.v0.y,this.v1.y,this.v2.y))},wa.prototype.getTangent=function(s){var l=Ma.tangentQuadraticBezier;return new ut(l(s,this.v0.x,this.v1.x,this.v2.x),l(s,this.v0.y,this.v1.y,this.v2.y)).normalize()};var l_=Object.assign(Object.create(Xh.prototype),{fromPoints:function(s){this.moveTo(s[0].x,s[0].y);for(var l=1,c=s.length;l<c;l++)this.lineTo(s[l].x,s[l].y)},moveTo:function(s,l){this.currentPoint.set(s,l)},lineTo:function(s,l){var c=new Eo(this.currentPoint.clone(),new ut(s,l));this.curves.push(c),this.currentPoint.set(s,l)},quadraticCurveTo:function(s,l,c,d){var p=new wa(this.currentPoint.clone(),new ut(s,l),new ut(c,d));this.curves.push(p),this.currentPoint.set(c,d)},bezierCurveTo:function(s,l,c,d,p,m){var v=new fu(this.currentPoint.clone(),new ut(s,l),new ut(c,d),new ut(p,m));this.curves.push(v),this.currentPoint.set(p,m)},splineThru:function(s){var c=new kl([this.currentPoint.clone()].concat(s));this.curves.push(c),this.currentPoint.copy(s[s.length-1])},arc:function(s,l,c,d,p,m){this.absarc(s+this.currentPoint.x,l+this.currentPoint.y,c,d,p,m)},absarc:function(s,l,c,d,p,m){this.absellipse(s,l,c,c,d,p,m)},ellipse:function(s,l,c,d,p,m,v,y){this.absellipse(s+this.currentPoint.x,l+this.currentPoint.y,c,d,p,m,v,y)},absellipse:function(s,l,c,d,p,m,v,y){var b=new Cs(s,l,c,d,p,m,v,y);if(this.curves.length>0){var w=b.getPoint(0);w.equals(this.currentPoint)||this.lineTo(w.x,w.y)}this.curves.push(b);var T=b.getPoint(1);this.currentPoint.copy(T)}});function Vl(){qh.apply(this,arguments),this.holes=[]}function qh(s){Xh.call(this),this.currentPoint=new ut,s&&this.fromPoints(s)}function c_(){this.subPaths=[],this.currentPath=null}function u_(s){this.data=s}function Gf(s){this.manager=void 0!==s?s:ar}Vl.prototype=Object.assign(Object.create(l_),{constructor:Vl,getPointsHoles:function(s){for(var l=[],c=0,d=this.holes.length;c<d;c++)l[c]=this.holes[c].getPoints(s);return l},extractAllPoints:function(s){return{shape:this.getPoints(s),holes:this.getPointsHoles(s)}},extractPoints:function(s){return this.extractAllPoints(s)}}),qh.prototype=l_,l_.constructor=qh,c_.prototype={moveTo:function(s,l){this.currentPath=new qh,this.subPaths.push(this.currentPath),this.currentPath.moveTo(s,l)},lineTo:function(s,l){this.currentPath.lineTo(s,l)},quadraticCurveTo:function(s,l,c,d){this.currentPath.quadraticCurveTo(s,l,c,d)},bezierCurveTo:function(s,l,c,d,p,m){this.currentPath.bezierCurveTo(s,l,c,d,p,m)},splineThru:function(s){this.currentPath.splineThru(s)},toShapes:function(s,l){function c(ve){for(var Te=[],Oe=0,Le=ve.length;Oe<Le;Oe++){var Ne=ve[Oe],Qe=new Vl;Qe.curves=Ne.curves,Te.push(Qe)}return Te}function d(ve,Te){for(var Oe=Te.length,Le=!1,Ne=Oe-1,Qe=0;Qe<Oe;Ne=Qe++){var Ye=Te[Ne],He=Te[Qe],ye=He.x-Ye.x,Ge=He.y-Ye.y;if(Math.abs(Ge)>Number.EPSILON){if(Ge<0&&(Ye=Te[Qe],ye=-ye,He=Te[Ne],Ge=-Ge),ve.y<Ye.y||ve.y>He.y)continue;if(ve.y===Ye.y){if(ve.x===Ye.x)return!0}else{var tt=Ge*(ve.x-Ye.x)-ye*(ve.y-Ye.y);if(0===tt)return!0;if(tt<0)continue;Le=!Le}}else{if(ve.y!==Ye.y)continue;if(He.x<=ve.x&&ve.x<=Ye.x||Ye.x<=ve.x&&ve.x<=He.x)return!0}}return Le}var p=Ui.isClockWise,m=this.subPaths;if(0===m.length)return[];if(!0===l)return c(m);var v,y,b,w=[];if(1===m.length)return y=m[0],(b=new Vl).curves=y.curves,w.push(b),w;var T=!p(m[0].getPoints());T=s?!T:T;var B,A=[],R=[],P=[],L=0;R[L]=void 0,P[L]=[];for(var U=0,F=m.length;U<F;U++)v=p(B=(y=m[U]).getPoints()),(v=s?!v:v)?(!T&&R[L]&&L++,R[L]={s:new Vl,p:B},R[L].s.curves=y.curves,T&&L++,P[L]=[]):P[L].push({h:y,p:B[0]});if(!R[0])return c(m);if(R.length>1){for(var V=!1,H=[],J=0,q=R.length;J<q;J++)A[J]=[];for(J=0,q=R.length;J<q;J++)for(var ae=P[J],se=0;se<ae.length;se++){for(var le=ae[se],ue=!0,me=0;me<R.length;me++)d(le.p,R[me].p)&&(J!==me&&H.push({froms:J,tos:me,hole:se}),ue?(ue=!1,A[me].push(le)):V=!0);ue&&A[J].push(le)}H.length>0&&(V||(P=A))}U=0;for(var Fe,Ie=R.length;U<Ie;U++){w.push(b=R[U].s);for(var Z=0,ee=(Fe=P[U]).length;Z<ee;Z++)b.holes.push(Fe[Z].h)}return w}},Object.assign(u_.prototype,{isFont:!0,generateShapes:function(s,l,c){function p(T,A,R){var P=m.glyphs[T]||m.glyphs["?"];if(P){var V,H,J,q,ae,se,le,ue,me,Fe,Ie,L=new c_,B=[],U=Ui.b2,F=Ui.b3;if(P.o)for(var Z=P._cachedOutline||(P._cachedOutline=P.o.split(" ")),ee=0,ve=Z.length;ee<ve;)switch(Z[ee++]){case"m":V=Z[ee++]*A+R,H=Z[ee++]*A,L.moveTo(V,H);break;case"l":V=Z[ee++]*A+R,H=Z[ee++]*A,L.lineTo(V,H);break;case"q":if(J=Z[ee++]*A+R,q=Z[ee++]*A,le=Z[ee++]*A+R,ue=Z[ee++]*A,L.quadraticCurveTo(le,ue,J,q),Ie=B[B.length-1]){ae=Ie.x,se=Ie.y;for(var Oe=1;Oe<=c;Oe++)U(Le=Oe/c,ae,le,J),U(Le,se,ue,q)}break;case"b":if(J=Z[ee++]*A+R,q=Z[ee++]*A,le=Z[ee++]*A+R,ue=Z[ee++]*A,me=Z[ee++]*A+R,Fe=Z[ee++]*A,L.bezierCurveTo(le,ue,me,Fe,J,q),Ie=B[B.length-1])for(ae=Ie.x,se=Ie.y,Oe=1;Oe<=c;Oe++){var Le;F(Le=Oe/c,ae,le,me,J),F(Le,se,ue,Fe,q)}}return{offset:P.ha*A,path:L}}}void 0===l&&(l=100),void 0===c&&(c=4);for(var m=this.data,v=function d(T){for(var A=String(T).split(""),R=l/m.resolution,P=0,L=[],B=0;B<A.length;B++){var U=p(A[B],R,P);P+=U.offset,L.push(U.path)}return L}(s),y=[],b=0,w=v.length;b<w;b++)Array.prototype.push.apply(y,v[b].toShapes());return y}}),Object.assign(Gf.prototype,{load:function(s,l,c,d){var p=this;new $s(this.manager).load(s,function(v){var y;try{y=JSON.parse(v)}catch{console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),y=JSON.parse(v.substring(65,v.length-2))}var b=p.parse(y);l&&l(b)},c,d)},parse:function(s){return new u_(s)}});var rl,Sg={getContext:function(){return void 0===rl&&(rl=new(window.AudioContext||window.webkitAudioContext)),rl},setContext:function(s){rl=s}};function zl(s){this.manager=void 0!==s?s:ar}function Yh(s,l,c,d){zi.call(this,s,l),this.type="RectAreaLight",this.position.set(0,1,0),this.updateMatrix(),this.width=void 0!==c?c:10,this.height=void 0!==d?d:10}function Zh(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Zi,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Zi,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1}function Tg(s,l,c){at.call(this),this.type="CubeCamera";var d=90,m=new Zi(d,1,s,l);m.up.set(0,-1,0),m.lookAt(new z(1,0,0)),this.add(m);var v=new Zi(d,1,s,l);v.up.set(0,-1,0),v.lookAt(new z(-1,0,0)),this.add(v);var y=new Zi(d,1,s,l);y.up.set(0,0,1),y.lookAt(new z(0,1,0)),this.add(y);var b=new Zi(d,1,s,l);b.up.set(0,0,-1),b.lookAt(new z(0,-1,0)),this.add(b);var w=new Zi(d,1,s,l);w.up.set(0,-1,0),w.lookAt(new z(0,0,1)),this.add(w);var T=new Zi(d,1,s,l);T.up.set(0,-1,0),T.lookAt(new z(0,0,-1)),this.add(T),this.renderTarget=new fh(c,c,{format:Lc,magFilter:ws,minFilter:ws}),this.updateCubeMap=function(R,P){null===this.parent&&this.updateMatrixWorld();var L=this.renderTarget,B=L.texture.generateMipmaps;L.texture.generateMipmaps=!1,L.activeCubeFace=0,R.render(P,m,L),L.activeCubeFace=1,R.render(P,v,L),L.activeCubeFace=2,R.render(P,y,L),L.activeCubeFace=3,R.render(P,b,L),L.activeCubeFace=4,R.render(P,w,L),L.texture.generateMipmaps=B,L.activeCubeFace=5,R.render(P,T,L),R.setRenderTarget(null)}}function Wf(){at.call(this),this.type="AudioListener",this.context=Sg.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null}function Hl(s){at.call(this),this.type="Audio",this.context=s.context,this.gain=this.context.createGain(),this.gain.connect(s.getInput()),this.autoplay=!1,this.buffer=null,this.loop=!1,this.startTime=0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.sourceType="empty",this.filters=[]}function Cg(s){Hl.call(this,s),this.panner=this.context.createPanner(),this.panner.connect(this.gain)}function lo(s,l){this.analyser=s.context.createAnalyser(),this.analyser.fftSize=void 0!==l?l:2048,this.data=new Uint8Array(this.analyser.frequencyBinCount),s.getOutput().connect(this.analyser)}function jf(s,l,c){this.binding=s,this.valueSize=c;var p,d=Float64Array;switch(l){case"quaternion":p=this._slerp;break;case"string":case"bool":d=Array,p=this._select;break;default:p=this._lerp}this.buffer=new d(4*c),this._mixBufferRegion=p,this.cumulativeWeight=0,this.useCount=0,this.referenceCount=0}function Ri(s,l,c){this.path=l,this.parsedPath=c||Ri.parseTrackName(l),this.node=Ri.findNode(s,this.parsedPath.nodeName)||s,this.rootNode=s}function Jh(s){this.uuid=dn.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;var l={};this._indicesByUUID=l;for(var c=0,d=arguments.length;c!==d;++c)l[arguments[c].uuid]=c;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};var p=this;this.stats={objects:{get total(){return p._objects.length},get inUse(){return this.total-p.nCachedObjects_}},get bindingsPerObject(){return p._bindings.length}}}function $f(s,l,c){this._mixer=s,this._clip=l,this._localRoot=c||null;for(var d=l.tracks,p=d.length,m=new Array(p),v={endingStart:Tl,endingEnd:Tl},y=0;y!==p;++y){var b=d[y].createInterpolant(null);m[y]=b,b.settings=v}this._interpolantSettings=v,this._interpolants=m,this._propertyBindings=new Array(p),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=sg,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}function pu(s){this._root=s,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}function mu(s){"string"==typeof s&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),s=arguments[1]),this.value=s}function Gl(){kt.call(this),this.type="InstancedBufferGeometry",this.maxInstancedCount=void 0}function Xf(s,l,c,d){this.uuid=dn.generateUUID(),this.data=s,this.itemSize=l,this.offset=c,this.normalized=!0===d}function Wl(s,l){this.uuid=dn.generateUUID(),this.array=s,this.stride=l,this.count=void 0!==s?s.length/l:0,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.onUploadCallback=function(){},this.version=0}function jl(s,l,c){Wl.call(this,s,l),this.meshPerAttribute=c||1}function $l(s,l,c){lt.call(this,s,l),this.meshPerAttribute=c||1}function Ag(s,l,c,d){this.ray=new Yi(s,l),this.near=c||0,this.far=d||1/0,this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function Kh(s,l){return s.distance-l.distance}function ba(s,l,c,d){if(!1!==s.visible&&(s.raycast(l,c),!0===d))for(var p=s.children,m=0,v=p.length;m<v;m++)ba(p[m],l,c,!0)}function Dg(s){this.autoStart=void 0===s||s,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}function h_(s){this.points=s;var d,p,m,v,y,b,w,T,A,l=[],c={x:0,y:0,z:0};function R(P,L,B,U,F,V,H){var J=.5*(B-P),q=.5*(U-L);return(2*(L-B)+J+q)*H+(-3*(L-B)-2*J-q)*V+J*F+L}this.initFromArray=function(P){this.points=[];for(var L=0;L<P.length;L++)this.points[L]={x:P[L][0],y:P[L][1],z:P[L][2]}},this.getPoint=function(P){return d=(this.points.length-1)*P,p=Math.floor(d),m=d-p,l[0]=0===p?p:p-1,l[1]=p,l[2]=p>this.points.length-2?this.points.length-1:p+1,l[3]=p>this.points.length-3?this.points.length-1:p+2,c.x=R((b=this.points[l[0]]).x,(w=this.points[l[1]]).x,(T=this.points[l[2]]).x,(A=this.points[l[3]]).x,m,v=m*m,y=m*v),c.y=R(b.y,w.y,T.y,A.y,m,v,y),c.z=R(b.z,w.z,T.z,A.z,m,v,y),c},this.getControlPointsArray=function(){var P,L,B=this.points.length,U=[];for(P=0;P<B;P++)U[P]=[(L=this.points[P]).x,L.y,L.z];return U},this.getLength=function(P){var L,B,U,F,H=0,J=0,q=new z,ae=new z,se=[],le=0;for(se[0]=0,P||(P=100),U=this.points.length*P,q.copy(this.points[0]),L=1;L<U;L++)F=this.getPoint(B=L/U),ae.copy(F),le+=ae.distanceTo(q),q.copy(F),(H=Math.floor((this.points.length-1)*B))!==J&&(se[H]=le,J=H);return se[se.length]=le,{chunks:se,total:le}},this.reparametrizeByArcLength=function(P){var L,B,F,V,J,q,ae=[],se=new z,le=this.getLength();for(ae.push(se.copy(this.points[0]).clone()),L=1;L<this.points.length;L++){for(J=Math.ceil(P*(le.chunks[L]-le.chunks[L-1])/le.total),F=(L-1)/(this.points.length-1),V=L/(this.points.length-1),B=1;B<J-1;B++)q=this.getPoint(F+B*(1/J)*(V-F)),ae.push(se.copy(q).clone());ae.push(se.copy(this.points[L]).clone())}this.points=ae}}function qf(s,l,c){return this.radius=void 0!==s?s:1,this.phi=void 0!==l?l:0,this.theta=void 0!==c?c:0,this}function Xl(s,l,c){return this.radius=void 0!==s?s:1,this.theta=void 0!==l?l:0,this.y=void 0!==c?c:0,this}function Wr(s,l){br.call(this,s,l),this.animationsMap={},this.animationsList=[];var c=this.geometry.morphTargets.length,d="__default";this.createAnimation(d,0,c-1,c/1),this.setAnimationWeight(d,1)}function Er(s){at.call(this),this.material=s,this.render=function(l){}}function Qh(s,l,c,d){this.object=s,this.size=void 0!==l?l:1;var p=void 0!==c?c:16711680,m=void 0!==d?d:1,v=0,y=this.object.geometry;y&&y.isGeometry?v=3*y.faces.length:y&&y.isBufferGeometry&&(v=y.attributes.normal.count);var b=new kt,w=new On(2*v*3,3);b.addAttribute("position",w),Di.call(this,b,new Ji({color:p,linewidth:m})),this.matrixAutoUpdate=!1,this.update()}function Ki(s){at.call(this),this.light=s,this.light.updateMatrixWorld(),this.matrix=s.matrixWorld,this.matrixAutoUpdate=!1;for(var l=new kt,c=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],d=0,p=1;d<32;d++,p++){var v=d/32*Math.PI*2,y=p/32*Math.PI*2;c.push(Math.cos(v),Math.sin(v),1,Math.cos(y),Math.sin(y),1)}l.addAttribute("position",new On(c,3));var b=new Ji({fog:!1});this.cone=new Di(l,b),this.add(this.cone),this.update()}function sl(s){this.bones=this.getBoneList(s);for(var l=new kt,c=[],d=[],p=new Tt(0,0,1),m=new Tt(0,1,0),v=0;v<this.bones.length;v++){var y=this.bones[v];y.parent&&y.parent.isBone&&(c.push(0,0,0),c.push(0,0,0),d.push(p.r,p.g,p.b),d.push(m.r,m.g,m.b))}l.addAttribute("position",new On(c,3)),l.addAttribute("color",new On(d,3));var b=new Ji({vertexColors:ca,depthTest:!1,depthWrite:!1,transparent:!0});Di.call(this,l,b),this.root=s,this.matrix=s.matrixWorld,this.matrixAutoUpdate=!1,this.update()}function gu(s,l){this.light=s,this.light.updateMatrixWorld();var c=new tl(l,4,2),d=new Hs({wireframe:!0,fog:!1});d.color.copy(this.light.color).multiplyScalar(this.light.intensity),br.call(this,c,d),this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1}function ql(s){at.call(this),this.light=s,this.light.updateMatrixWorld();var l=new Hs({color:s.color,fog:!1}),c=new Hs({color:s.color,fog:!1,wireframe:!0}),d=new kt;d.addAttribute("position",new lt(new Float32Array(18),3)),this.add(new br(d,l)),this.add(new br(d,c)),this.update()}function Ea(s,l){at.call(this),this.light=s,this.light.updateMatrixWorld(),this.matrix=s.matrixWorld,this.matrixAutoUpdate=!1;var c=new el(l);c.rotateY(.5*Math.PI);var d=new Hs({vertexColors:ca,wireframe:!0}),p=c.getAttribute("position"),m=new Float32Array(3*p.count);c.addAttribute("color",new lt(m,3)),this.add(new br(c,d)),this.update()}function Jo(s,l,c,d){s=s||10,l=l||10,c=new Tt(void 0!==c?c:4473924),d=new Tt(void 0!==d?d:8947848);for(var p=l/2,m=2*s/l,v=[],y=[],b=0,w=0,T=-s;b<=l;b++,T+=m){v.push(-s,0,T,s,0,T),v.push(T,0,-s,T,0,s);var A=b===p?c:d;A.toArray(y,w),A.toArray(y,w+=3),A.toArray(y,w+=3),A.toArray(y,w+=3),w+=3}var R=new kt;R.addAttribute("position",new On(v,3)),R.addAttribute("color",new On(y,3));var P=new Ji({vertexColors:ca});Di.call(this,R,P)}function Sa(s,l,c,d,p,m){s=s||10,l=l||16,c=c||8,d=d||64,p=new Tt(void 0!==p?p:4473924),m=new Tt(void 0!==m?m:8947848);var b,w,T,A,R,P,L,v=[],y=[];for(A=0;A<=l;A++)T=A/l*(2*Math.PI),b=Math.sin(T)*s,w=Math.cos(T)*s,v.push(0,0,0),v.push(b,0,w),y.push((L=1&A?p:m).r,L.g,L.b),y.push(L.r,L.g,L.b);for(A=0;A<=c;A++)for(L=1&A?p:m,P=s-s/c*A,R=0;R<d;R++)T=R/d*(2*Math.PI),b=Math.sin(T)*P,w=Math.cos(T)*P,v.push(b,0,w),y.push(L.r,L.g,L.b),T=(R+1)/d*(2*Math.PI),b=Math.sin(T)*P,w=Math.cos(T)*P,v.push(b,0,w),y.push(L.r,L.g,L.b);var B=new kt;B.addAttribute("position",new On(v,3)),B.addAttribute("color",new On(y,3));var U=new Ji({vertexColors:ca});Di.call(this,B,U)}function Ko(s,l,c,d){this.object=s,this.size=void 0!==l?l:1;var p=void 0!==c?c:16776960,m=void 0!==d?d:1,v=0,y=this.object.geometry;y&&y.isGeometry?v=y.faces.length:console.warn("THREE.FaceNormalsHelper: only THREE.Geometry is supported. Use THREE.VertexNormalsHelper, instead.");var b=new kt,w=new On(2*v*3,3);b.addAttribute("position",w),Di.call(this,b,new Ji({color:p,linewidth:m})),this.matrixAutoUpdate=!1,this.update()}function Yl(s,l){at.call(this),this.light=s,this.light.updateMatrixWorld(),this.matrix=s.matrixWorld,this.matrixAutoUpdate=!1,void 0===l&&(l=1);var c=new kt;c.addAttribute("position",new On([-l,l,0,l,l,0,l,-l,0,-l,-l,0,-l,l,0],3));var d=new Ji({fog:!1});this.add(new ga(c,d)),(c=new kt).addAttribute("position",new On([0,0,0,0,0,1],3)),this.add(new ga(c,d)),this.update()}function Zl(s){var l=new kt,c=new Ji({color:16777215,vertexColors:eh}),d=[],p=[],m={},v=new Tt(16755200),y=new Tt(16711680),b=new Tt(43775),w=new Tt(16777215),T=new Tt(3355443);function A(P,L,B){R(P,B),R(L,B)}function R(P,L){d.push(0,0,0),p.push(L.r,L.g,L.b),void 0===m[P]&&(m[P]=[]),m[P].push(d.length/3-1)}A("n1","n2",v),A("n2","n4",v),A("n4","n3",v),A("n3","n1",v),A("f1","f2",v),A("f2","f4",v),A("f4","f3",v),A("f3","f1",v),A("n1","f1",v),A("n2","f2",v),A("n3","f3",v),A("n4","f4",v),A("p","n1",y),A("p","n2",y),A("p","n3",y),A("p","n4",y),A("u1","u2",b),A("u2","u3",b),A("u3","u1",b),A("c","t",w),A("p","c",T),A("cn1","cn2",T),A("cn3","cn4",T),A("cf1","cf2",T),A("cf3","cf4",T),l.addAttribute("position",new On(d,3)),l.addAttribute("color",new On(p,3)),Di.call(this,l,c),this.camera=s,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=s.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=m,this.update()}function So(s,l){void 0===l&&(l=16776960);var c=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),d=new Float32Array(24),p=new kt;p.setIndex(new lt(c,1)),p.addAttribute("position",new lt(d,3)),Di.call(this,p,new Ji({color:l})),void 0!==s&&this.update(s)}Object.assign(zl.prototype,{load:function(s,l,c,d){var p=new $s(this.manager);p.setResponseType("arraybuffer"),p.load(s,function(m){Sg.getContext().decodeAudioData(m,function(y){l(y)})},c,d)}}),Yh.prototype=Object.assign(Object.create(zi.prototype),{constructor:Yh,isRectAreaLight:!0,copy:function(s){return zi.prototype.copy.call(this,s),this.width=s.width,this.height=s.height,this}}),Object.assign(Zh.prototype,{update:function(){var s,l,c,d,p,m,v,y=new Wt,b=new Wt;return function(T){if(s!==this||l!==T.focus||c!==T.fov||d!==T.aspect*this.aspect||p!==T.near||m!==T.far||v!==T.zoom){s=this,l=T.focus,c=T.fov,d=T.aspect*this.aspect,p=T.near,m=T.far,v=T.zoom;var U,F,R=T.projectionMatrix.clone(),P=this.eyeSep/2,L=P*p/l,B=p*Math.tan(dn.DEG2RAD*c*.5)/v;b.elements[12]=-P,y.elements[12]=P,R.elements[0]=2*p/((F=B*d+L)-(U=-B*d+L)),R.elements[8]=(F+U)/(F-U),this.cameraL.projectionMatrix.copy(R),R.elements[0]=2*p/((F=B*d-L)-(U=-B*d-L)),R.elements[8]=(F+U)/(F-U),this.cameraR.projectionMatrix.copy(R)}this.cameraL.matrixWorld.copy(T.matrixWorld).multiply(b),this.cameraR.matrixWorld.copy(T.matrixWorld).multiply(y)}}()}),(Tg.prototype=Object.create(at.prototype)).constructor=Tg,Wf.prototype=Object.assign(Object.create(at.prototype),{constructor:Wf,getInput:function(){return this.gain},removeFilter:function(){null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null)},getFilter:function(){return this.filter},setFilter:function(s){null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=s,this.gain.connect(this.filter),this.filter.connect(this.context.destination)},getMasterVolume:function(){return this.gain.gain.value},setMasterVolume:function(s){this.gain.gain.value=s},updateMatrixWorld:function(){var s=new z,l=new fr,c=new z,d=new z;return function(m){at.prototype.updateMatrixWorld.call(this,m);var v=this.context.listener,y=this.up;this.matrixWorld.decompose(s,l,c),d.set(0,0,-1).applyQuaternion(l),v.positionX?(v.positionX.setValueAtTime(s.x,this.context.currentTime),v.positionY.setValueAtTime(s.y,this.context.currentTime),v.positionZ.setValueAtTime(s.z,this.context.currentTime),v.forwardX.setValueAtTime(d.x,this.context.currentTime),v.forwardY.setValueAtTime(d.y,this.context.currentTime),v.forwardZ.setValueAtTime(d.z,this.context.currentTime),v.upX.setValueAtTime(y.x,this.context.currentTime),v.upY.setValueAtTime(y.y,this.context.currentTime),v.upZ.setValueAtTime(y.z,this.context.currentTime)):(v.setPosition(s.x,s.y,s.z),v.setOrientation(d.x,d.y,d.z,y.x,y.y,y.z))}}()}),Hl.prototype=Object.assign(Object.create(at.prototype),{constructor:Hl,getOutput:function(){return this.gain},setNodeSource:function(s){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=s,this.connect(),this},setBuffer:function(s){return this.buffer=s,this.sourceType="buffer",this.autoplay&&this.play(),this},play:function(){if(!0!==this.isPlaying){if(!1!==this.hasPlaybackControl){var s=this.context.createBufferSource();return s.buffer=this.buffer,s.loop=this.loop,s.onended=this.onEnded.bind(this),s.playbackRate.setValueAtTime(this.playbackRate,this.startTime),s.start(0,this.startTime),this.isPlaying=!0,this.source=s,this.connect()}console.warn("THREE.Audio: this Audio has no playback control.")}else console.warn("THREE.Audio: Audio is already playing.")},pause:function(){if(!1!==this.hasPlaybackControl)return this.source.stop(),this.startTime=this.context.currentTime,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")},stop:function(){if(!1!==this.hasPlaybackControl)return this.source.stop(),this.startTime=0,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")},connect:function(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(var s=1,l=this.filters.length;s<l;s++)this.filters[s-1].connect(this.filters[s]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},disconnect:function(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(var s=1,l=this.filters.length;s<l;s++)this.filters[s-1].disconnect(this.filters[s]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},getFilters:function(){return this.filters},setFilters:function(s){return s||(s=[]),!0===this.isPlaying?(this.disconnect(),this.filters=s,this.connect()):this.filters=s,this},getFilter:function(){return this.getFilters()[0]},setFilter:function(s){return this.setFilters(s?[s]:[])},setPlaybackRate:function(s){if(!1!==this.hasPlaybackControl)return this.playbackRate=s,!0===this.isPlaying&&this.source.playbackRate.setValueAtTime(this.playbackRate,this.context.currentTime),this;console.warn("THREE.Audio: this Audio has no playback control.")},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this.isPlaying=!1},getLoop:function(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop},setLoop:function(s){if(!1!==this.hasPlaybackControl)return this.loop=s,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")},getVolume:function(){return this.gain.gain.value},setVolume:function(s){return this.gain.gain.value=s,this}}),Cg.prototype=Object.assign(Object.create(Hl.prototype),{constructor:Cg,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(s){this.panner.refDistance=s},getRolloffFactor:function(){return this.panner.rolloffFactor},setRolloffFactor:function(s){this.panner.rolloffFactor=s},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(s){this.panner.distanceModel=s},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(s){this.panner.maxDistance=s},updateMatrixWorld:function(){var s=new z;return function(c){at.prototype.updateMatrixWorld.call(this,c),s.setFromMatrixPosition(this.matrixWorld),this.panner.setPosition(s.x,s.y,s.z)}}()}),Object.assign(lo.prototype,{getFrequencyData:function(){return this.analyser.getByteFrequencyData(this.data),this.data},getAverageFrequency:function(){for(var s=0,l=this.getFrequencyData(),c=0;c<l.length;c++)s+=l[c];return s/l.length}}),jf.prototype={constructor:jf,accumulate:function(s,l){var c=this.buffer,d=this.valueSize,p=s*d+d,m=this.cumulativeWeight;if(0===m){for(var v=0;v!==d;++v)c[p+v]=c[v];m=l}else this._mixBufferRegion(c,p,0,l/(m+=l),d);this.cumulativeWeight=m},apply:function(s){var l=this.valueSize,c=this.buffer,d=s*l+l,p=this.cumulativeWeight,m=this.binding;this.cumulativeWeight=0,p<1&&this._mixBufferRegion(c,d,3*l,1-p,l);for(var y=l,b=l+l;y!==b;++y)if(c[y]!==c[y+l]){m.setValue(c,d);break}},saveOriginalState:function(){var l=this.buffer,c=this.valueSize,d=3*c;this.binding.getValue(l,d);for(var p=c,m=d;p!==m;++p)l[p]=l[d+p%c];this.cumulativeWeight=0},restoreOriginalState:function(){this.binding.setValue(this.buffer,3*this.valueSize)},_select:function(s,l,c,d,p){if(d>=.5)for(var m=0;m!==p;++m)s[l+m]=s[c+m]},_slerp:function(s,l,c,d,p){fr.slerpFlat(s,l,s,l,s,c,d)},_lerp:function(s,l,c,d,p){for(var m=1-d,v=0;v!==p;++v){var y=l+v;s[y]=s[y]*m+s[c+v]*d}}},Ri.prototype={constructor:Ri,getValue:function(l,c){this.bind(),this.getValue(l,c)},setValue:function(l,c){this.bind(),this.setValue(l,c)},bind:function(){var s=this.node,l=this.parsedPath,c=l.objectName,d=l.propertyName,p=l.propertyIndex;if(s||(s=Ri.findNode(this.rootNode,l.nodeName)||this.rootNode,this.node=s),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,s){if(c){var m=l.objectIndex;switch(c){case"materials":if(!s.material)return void console.error("  can not bind to material as node does not have a material",this);if(!s.material.materials)return void console.error("  can not bind to material.materials as node.material does not have a materials array",this);s=s.material.materials;break;case"bones":if(!s.skeleton)return void console.error("  can not bind to bones as node does not have a skeleton",this);s=s.skeleton.bones;for(var v=0;v<s.length;v++)if(s[v].name===m){m=v;break}break;default:if(void 0===s[c])return void console.error("  can not bind to objectName of node, undefined",this);s=s[c]}if(void 0!==m){if(void 0===s[m])return void console.error("  trying to bind to objectIndex of objectName, but is undefined:",this,s);s=s[m]}}var y=s[d];if(void 0!==y){var w=this.Versioning.None;void 0!==s.needsUpdate?(w=this.Versioning.NeedsUpdate,this.targetObject=s):void 0!==s.matrixWorldNeedsUpdate&&(w=this.Versioning.MatrixWorldNeedsUpdate,this.targetObject=s);var T=this.BindingType.Direct;if(void 0!==p){if("morphTargetInfluences"===d){if(!s.geometry)return void console.error("  can not bind to morphTargetInfluences becasuse node does not have a geometry",this);if(!s.geometry.morphTargets)return void console.error("  can not bind to morphTargetInfluences becasuse node does not have a geometry.morphTargets",this);for(v=0;v<this.node.geometry.morphTargets.length;v++)if(s.geometry.morphTargets[v].name===p){p=v;break}}T=this.BindingType.ArrayElement,this.resolvedProperty=y,this.propertyIndex=p}else void 0!==y.fromArray&&void 0!==y.toArray?(T=this.BindingType.HasFromToArray,this.resolvedProperty=y):void 0!==y.length?(T=this.BindingType.EntireArray,this.resolvedProperty=y):this.propertyName=d;this.getValue=this.GetterByBindingType[T],this.setValue=this.SetterByBindingTypeAndVersioning[T][w]}else console.error("  trying to update property for track: "+l.nodeName+"."+d+" but it wasn't found.",s)}else console.error("  trying to update node for track: "+this.path+" but it wasn't found.")},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}},Object.assign(Ri.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},_getValue_unbound:Ri.prototype.getValue,_setValue_unbound:Ri.prototype.setValue,BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(l,c){l[c]=this.node[this.propertyName]},function(l,c){for(var d=this.resolvedProperty,p=0,m=d.length;p!==m;++p)l[c++]=d[p]},function(l,c){l[c]=this.resolvedProperty[this.propertyIndex]},function(l,c){this.resolvedProperty.toArray(l,c)}],SetterByBindingTypeAndVersioning:[[function(l,c){this.node[this.propertyName]=l[c]},function(l,c){this.node[this.propertyName]=l[c],this.targetObject.needsUpdate=!0},function(l,c){this.node[this.propertyName]=l[c],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(l,c){for(var d=this.resolvedProperty,p=0,m=d.length;p!==m;++p)d[p]=l[c++]},function(l,c){for(var d=this.resolvedProperty,p=0,m=d.length;p!==m;++p)d[p]=l[c++];this.targetObject.needsUpdate=!0},function(l,c){for(var d=this.resolvedProperty,p=0,m=d.length;p!==m;++p)d[p]=l[c++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(l,c){this.resolvedProperty[this.propertyIndex]=l[c]},function(l,c){this.resolvedProperty[this.propertyIndex]=l[c],this.targetObject.needsUpdate=!0},function(l,c){this.resolvedProperty[this.propertyIndex]=l[c],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(l,c){this.resolvedProperty.fromArray(l,c)},function(l,c){this.resolvedProperty.fromArray(l,c),this.targetObject.needsUpdate=!0},function(l,c){this.resolvedProperty.fromArray(l,c),this.targetObject.matrixWorldNeedsUpdate=!0}]]}),Ri.Composite=function(s,l,c){var d=c||Ri.parseTrackName(l);this._targetGroup=s,this._bindings=s.subscribe_(l,d)},Ri.Composite.prototype={constructor:Ri.Composite,getValue:function(s,l){this.bind();var d=this._bindings[this._targetGroup.nCachedObjects_];void 0!==d&&d.getValue(s,l)},setValue:function(s,l){for(var c=this._bindings,d=this._targetGroup.nCachedObjects_,p=c.length;d!==p;++d)c[d].setValue(s,l)},bind:function(){for(var s=this._bindings,l=this._targetGroup.nCachedObjects_,c=s.length;l!==c;++l)s[l].bind()},unbind:function(){for(var s=this._bindings,l=this._targetGroup.nCachedObjects_,c=s.length;l!==c;++l)s[l].unbind()}},Ri.create=function(s,l,c){return s&&s.isAnimationObjectGroup?new Ri.Composite(s,l,c):new Ri(s,l,c)},Ri.parseTrackName=function(s){var c=/^((?:[\w-]+[\/:])*)([\w-]+)?(?:\.([\w-]+)(?:\[(.+)\])?)?\.([\w-]+)(?:\[(.+)\])?$/.exec(s);if(!c)throw new Error("cannot parse trackName at all: "+s);var d={nodeName:c[2],objectName:c[3],objectIndex:c[4],propertyName:c[5],propertyIndex:c[6]};if(null===d.propertyName||0===d.propertyName.length)throw new Error("can not parse propertyName from trackName: "+s);return d},Ri.findNode=function(s,l){if(!l||""===l||"root"===l||"."===l||-1===l||l===s.name||l===s.uuid)return s;if(s.skeleton){var d=function(v){for(var y=0;y<v.bones.length;y++){var b=v.bones[y];if(b.name===l)return b}return null}(s.skeleton);if(d)return d}if(s.children){var p=function(v){for(var y=0;y<v.length;y++){var b=v[y];if(b.name===l||b.uuid===l)return b;var w=p(b.children);if(w)return w}return null},m=p(s.children);if(m)return m}return null},Jh.prototype={constructor:Jh,isAnimationObjectGroup:!0,add:function(s){for(var l=this._objects,c=l.length,d=this.nCachedObjects_,p=this._indicesByUUID,m=this._paths,v=this._parsedPaths,y=this._bindings,b=y.length,w=0,T=arguments.length;w!==T;++w){var A=arguments[w],R=A.uuid,P=p[R],L=void 0;if(void 0===P){P=c++,p[R]=P,l.push(A);for(var B=0,U=b;B!==U;++B)y[B].push(new Ri(A,m[B],v[B]))}else if(P<d){L=l[P];var F=--d,V=l[F];for(p[V.uuid]=P,l[P]=V,p[R]=F,l[F]=A,B=0,U=b;B!==U;++B){var H=y[B],q=H[P];H[P]=H[F],void 0===q&&(q=new Ri(A,m[B],v[B])),H[F]=q}}else l[P]!==L&&console.error("Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes...")}this.nCachedObjects_=d},remove:function(s){for(var l=this._objects,c=this.nCachedObjects_,d=this._indicesByUUID,p=this._bindings,m=p.length,v=0,y=arguments.length;v!==y;++v){var b=arguments[v],w=b.uuid,T=d[w];if(void 0!==T&&T>=c){var A=c++,R=l[A];d[R.uuid]=T,l[T]=R,d[w]=A,l[A]=b;for(var P=0,L=m;P!==L;++P){var B=p[P],F=B[T];B[T]=B[A],B[A]=F}}}this.nCachedObjects_=c},uncache:function(s){for(var l=this._objects,c=l.length,d=this.nCachedObjects_,p=this._indicesByUUID,m=this._bindings,v=m.length,y=0,b=arguments.length;y!==b;++y){var T=arguments[y].uuid,A=p[T];if(void 0!==A)if(delete p[T],A<d){var R=--d,P=l[R],B=l[L=--c];p[P.uuid]=A,l[A]=P,p[B.uuid]=R,l[R]=B,l.pop();for(var U=0,F=v;U!==F;++U){var J=(V=m[U])[L];V[A]=V[R],V[R]=J,V.pop()}}else{var L;for(p[(B=l[L=--c]).uuid]=A,l[A]=B,l.pop(),U=0,F=v;U!==F;++U){var V;(V=m[U])[A]=V[L],V.pop()}}}this.nCachedObjects_=d},subscribe_:function(s,l){var c=this._bindingsIndicesByPath,d=c[s],p=this._bindings;if(void 0!==d)return p[d];var m=this._paths,v=this._parsedPaths,y=this._objects,w=this.nCachedObjects_,T=new Array(y.length);c[s]=d=p.length,m.push(s),v.push(l),p.push(T);for(var A=w,R=y.length;A!==R;++A)T[A]=new Ri(y[A],s,l);return T},unsubscribe_:function(s){var l=this._bindingsIndicesByPath,c=l[s];if(void 0!==c){var d=this._paths,p=this._parsedPaths,m=this._bindings,v=m.length-1,y=m[v];l[s[v]]=c,m[c]=y,m.pop(),p[c]=p[v],p.pop(),d[c]=d[v],d.pop()}}},$f.prototype={constructor:$f,play:function(){return this._mixer._activateAction(this),this},stop:function(){return this._mixer._deactivateAction(this),this.reset()},reset:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(s){return this._startTime=s,this},setLoop:function(s,l){return this.loop=s,this.repetitions=l,this},setEffectiveWeight:function(s){return this.weight=s,this._effectiveWeight=this.enabled?s:0,this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(s){return this._scheduleFading(s,0,1)},fadeOut:function(s){return this._scheduleFading(s,1,0)},crossFadeFrom:function(s,l,c){if(s.fadeOut(l),this.fadeIn(l),c){var d=this._clip.duration,p=s._clip.duration,v=d/p;s.warp(1,p/d,l),this.warp(v,1,l)}return this},crossFadeTo:function(s,l,c){return s.crossFadeFrom(this,l,c)},stopFading:function(){var s=this._weightInterpolant;return null!==s&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(s)),this},setEffectiveTimeScale:function(s){return this.timeScale=s,this._effectiveTimeScale=this.paused?0:s,this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(s){return this.timeScale=this._clip.duration/s,this.stopWarping()},syncWith:function(s){return this.time=s.time,this.timeScale=s.timeScale,this.stopWarping()},halt:function(s){return this.warp(this._effectiveTimeScale,0,s)},warp:function(s,l,c){var d=this._mixer,p=d.time,m=this._timeScaleInterpolant,v=this.timeScale;null===m&&(m=d._lendControlInterpolant(),this._timeScaleInterpolant=m);var y=m.parameterPositions,b=m.sampleValues;return y[0]=p,y[1]=p+c,b[0]=s/v,b[1]=l/v,this},stopWarping:function(){var s=this._timeScaleInterpolant;return null!==s&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(s)),this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},_update:function(s,l,c,d){var p=this._startTime;if(null!==p){var m=(s-p)*c;if(m<0||0===c)return;this._startTime=null,l=c*m}l*=this._updateTimeScale(s);var v=this._updateTime(l),y=this._updateWeight(s);if(y>0)for(var b=this._interpolants,w=this._propertyBindings,T=0,A=b.length;T!==A;++T)b[T].evaluate(v),w[T].accumulate(d,y)},_updateWeight:function(s){var l=0;if(this.enabled){l=this.weight;var c=this._weightInterpolant;if(null!==c){var d=c.evaluate(s)[0];l*=d,s>c.parameterPositions[1]&&(this.stopFading(),0===d&&(this.enabled=!1))}}return this._effectiveWeight=l,l},_updateTimeScale:function(s){var l=0;if(!this.paused){l=this.timeScale;var c=this._timeScaleInterpolant;null!==c&&(l*=c.evaluate(s)[0],s>c.parameterPositions[1]&&(this.stopWarping(),0===l?this.paused=!0:this.timeScale=l))}return this._effectiveTimeScale=l,l},_updateTime:function(s){var l=this.time+s;if(0===s)return l;var c=this._clip.duration,d=this.loop,p=this._loopCount;if(d===Ay){-1===p&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(l>=c)l=c;else{if(!(l<0))break e;l=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this._mixer.dispatchEvent({type:"finished",action:this,direction:s<0?-1:1})}}else{var m=d===og;if(-1===p&&(s>=0?(p=0,this._setEndings(!0,0===this.repetitions,m)):this._setEndings(0===this.repetitions,!0,m)),l>=c||l<0){var v=Math.floor(l/c);l-=c*v,p+=Math.abs(v);var y=this.repetitions-p;if(y<0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,l=s>0?c:0,this._mixer.dispatchEvent({type:"finished",action:this,direction:s>0?1:-1});else{if(0===y){var b=s<0;this._setEndings(b,!b,m)}else this._setEndings(!1,!1,m);this._loopCount=p,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:v})}}if(m&&1==(1&p))return this.time=l,c-l}return this.time=l,l},_setEndings:function(s,l,c){var d=this._interpolantSettings;c?(d.endingStart=$a,d.endingEnd=$a):(d.endingStart=s?this.zeroSlopeAtStart?$a:Tl:hh,d.endingEnd=l?this.zeroSlopeAtEnd?$a:Tl:hh)},_scheduleFading:function(s,l,c){var d=this._mixer,p=d.time,m=this._weightInterpolant;null===m&&(m=d._lendControlInterpolant(),this._weightInterpolant=m);var v=m.parameterPositions,y=m.sampleValues;return v[0]=p,y[0]=l,v[1]=p+s,y[1]=c,this}},Object.assign(pu.prototype,Tn.prototype,{clipAction:function(s,l){var c=l||this._root,d=c.uuid,p="string"==typeof s?pr.findByName(c,s):s,m=null!==p?p.uuid:s,v=this._actionsByClip[m],y=null;if(void 0!==v){var b=v.actionByRoot[d];if(void 0!==b)return b;y=v.knownActions[0],null===p&&(p=y._clip)}if(null===p)return null;var w=new $f(this,p,l);return this._bindAction(w,y),this._addInactiveAction(w,m,d),w},existingAction:function(s,l){var c=l||this._root,d=c.uuid,p="string"==typeof s?pr.findByName(c,s):s,v=this._actionsByClip[p?p.uuid:s];return void 0!==v&&v.actionByRoot[d]||null},stopAllAction:function(){var s=this._actions,l=this._nActiveActions,c=this._bindings,d=this._nActiveBindings;this._nActiveActions=0,this._nActiveBindings=0;for(var p=0;p!==l;++p)s[p].reset();for(p=0;p!==d;++p)c[p].useCount=0;return this},update:function(s){for(var l=this._actions,c=this._nActiveActions,d=this.time+=s*=this.timeScale,p=Math.sign(s),m=this._accuIndex^=1,v=0;v!==c;++v){var y=l[v];y.enabled&&y._update(d,s,p,m)}var b=this._bindings,w=this._nActiveBindings;for(v=0;v!==w;++v)b[v].apply(m);return this},getRoot:function(){return this._root},uncacheClip:function(s){var l=this._actions,c=s.uuid,d=this._actionsByClip,p=d[c];if(void 0!==p){for(var m=p.knownActions,v=0,y=m.length;v!==y;++v){var b=m[v];this._deactivateAction(b);var w=b._cacheIndex,T=l[l.length-1];b._cacheIndex=null,b._byClipCacheIndex=null,T._cacheIndex=w,l[w]=T,l.pop(),this._removeInactiveBindingsForAction(b)}delete d[c]}},uncacheRoot:function(s){var l=s.uuid,c=this._actionsByClip;for(var d in c){var m=c[d].actionByRoot[l];void 0!==m&&(this._deactivateAction(m),this._removeInactiveAction(m))}var y=this._bindingsByRootAndName[l];if(void 0!==y)for(var b in y){var w=y[b];w.restoreOriginalState(),this._removeInactiveBinding(w)}},uncacheAction:function(s,l){var c=this.existingAction(s,l);null!==c&&(this._deactivateAction(c),this._removeInactiveAction(c))}}),Object.assign(pu.prototype,{_bindAction:function(s,l){var c=s._localRoot||this._root,d=s._clip.tracks,p=d.length,m=s._propertyBindings,v=s._interpolants,y=c.uuid,b=this._bindingsByRootAndName,w=b[y];void 0===w&&(b[y]=w={});for(var T=0;T!==p;++T){var A=d[T],R=A.name,P=w[R];if(void 0!==P)m[T]=P;else{if(void 0!==(P=m[T])){null===P._cacheIndex&&(++P.referenceCount,this._addInactiveBinding(P,y,R));continue}++(P=new jf(Ri.create(c,R,l&&l._propertyBindings[T].binding.parsedPath),A.ValueTypeName,A.getValueSize())).referenceCount,this._addInactiveBinding(P,y,R),m[T]=P}v[T].resultBuffer=P.buffer}},_activateAction:function(s){if(!this._isActiveAction(s)){if(null===s._cacheIndex){var l=(s._localRoot||this._root).uuid,c=s._clip.uuid,d=this._actionsByClip[c];this._bindAction(s,d&&d.knownActions[0]),this._addInactiveAction(s,c,l)}for(var p=s._propertyBindings,m=0,v=p.length;m!==v;++m){var y=p[m];0==y.useCount++&&(this._lendBinding(y),y.saveOriginalState())}this._lendAction(s)}},_deactivateAction:function(s){if(this._isActiveAction(s)){for(var l=s._propertyBindings,c=0,d=l.length;c!==d;++c){var p=l[c];0==--p.useCount&&(p.restoreOriginalState(),this._takeBackBinding(p))}this._takeBackAction(s)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var s=this;this.stats={actions:{get total(){return s._actions.length},get inUse(){return s._nActiveActions}},bindings:{get total(){return s._bindings.length},get inUse(){return s._nActiveBindings}},controlInterpolants:{get total(){return s._controlInterpolants.length},get inUse(){return s._nActiveControlInterpolants}}}},_isActiveAction:function(s){var l=s._cacheIndex;return null!==l&&l<this._nActiveActions},_addInactiveAction:function(s,l,c){var d=this._actions,p=this._actionsByClip,m=p[l];if(void 0===m)m={knownActions:[s],actionByRoot:{}},s._byClipCacheIndex=0,p[l]=m;else{var v=m.knownActions;s._byClipCacheIndex=v.length,v.push(s)}s._cacheIndex=d.length,d.push(s),m.actionByRoot[c]=s},_removeInactiveAction:function(s){var l=this._actions,c=l[l.length-1],d=s._cacheIndex;c._cacheIndex=d,l[d]=c,l.pop(),s._cacheIndex=null;var p=s._clip.uuid,m=this._actionsByClip,v=m[p],y=v.knownActions,b=y[y.length-1],w=s._byClipCacheIndex;b._byClipCacheIndex=w,y[w]=b,y.pop(),s._byClipCacheIndex=null,delete v.actionByRoot[(l._localRoot||this._root).uuid],0===y.length&&delete m[p],this._removeInactiveBindingsForAction(s)},_removeInactiveBindingsForAction:function(s){for(var l=s._propertyBindings,c=0,d=l.length;c!==d;++c){var p=l[c];0==--p.referenceCount&&this._removeInactiveBinding(p)}},_lendAction:function(s){var l=this._actions,c=s._cacheIndex,d=this._nActiveActions++,p=l[d];s._cacheIndex=d,l[d]=s,p._cacheIndex=c,l[c]=p},_takeBackAction:function(s){var l=this._actions,c=s._cacheIndex,d=--this._nActiveActions,p=l[d];s._cacheIndex=d,l[d]=s,p._cacheIndex=c,l[c]=p},_addInactiveBinding:function(s,l,c){var d=this._bindingsByRootAndName,p=d[l],m=this._bindings;void 0===p&&(d[l]=p={}),p[c]=s,s._cacheIndex=m.length,m.push(s)},_removeInactiveBinding:function(s){var l=this._bindings,c=s.binding,d=c.rootNode.uuid,p=c.path,m=this._bindingsByRootAndName,v=m[d],y=l[l.length-1],b=s._cacheIndex;y._cacheIndex=b,l[b]=y,l.pop(),delete v[p];e:{for(var w in v)break e;delete m[d]}},_lendBinding:function(s){var l=this._bindings,c=s._cacheIndex,d=this._nActiveBindings++,p=l[d];s._cacheIndex=d,l[d]=s,p._cacheIndex=c,l[c]=p},_takeBackBinding:function(s){var l=this._bindings,c=s._cacheIndex,d=--this._nActiveBindings,p=l[d];s._cacheIndex=d,l[d]=s,p._cacheIndex=c,l[c]=p},_lendControlInterpolant:function(){var s=this._controlInterpolants,l=this._nActiveControlInterpolants++,c=s[l];return void 0===c&&((c=new Gh(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer)).__cacheIndex=l,s[l]=c),c},_takeBackControlInterpolant:function(s){var l=this._controlInterpolants,c=s.__cacheIndex,d=--this._nActiveControlInterpolants,p=l[d];s.__cacheIndex=d,l[d]=s,p.__cacheIndex=c,l[c]=p},_controlInterpolantsResultBuffer:new Float32Array(1)}),mu.prototype.clone=function(){return new mu(void 0===this.value.clone?this.value:this.value.clone())},(Gl.prototype=Object.create(kt.prototype)).constructor=Gl,Gl.prototype.isInstancedBufferGeometry=!0,Gl.prototype.addGroup=function(s,l,c){this.groups.push({start:s,count:l,materialIndex:c})},Gl.prototype.copy=function(s){var l=s.index;null!==l&&this.setIndex(l.clone());var c=s.attributes;for(var d in c)this.addAttribute(d,c[d].clone());for(var m=s.groups,v=0,y=m.length;v<y;v++){var b=m[v];this.addGroup(b.start,b.count,b.materialIndex)}return this},Xf.prototype={constructor:Xf,isInterleavedBufferAttribute:!0,get count(){return this.data.count},get array(){return this.data.array},setX:function(s,l){return this.data.array[s*this.data.stride+this.offset]=l,this},setY:function(s,l){return this.data.array[s*this.data.stride+this.offset+1]=l,this},setZ:function(s,l){return this.data.array[s*this.data.stride+this.offset+2]=l,this},setW:function(s,l){return this.data.array[s*this.data.stride+this.offset+3]=l,this},getX:function(s){return this.data.array[s*this.data.stride+this.offset]},getY:function(s){return this.data.array[s*this.data.stride+this.offset+1]},getZ:function(s){return this.data.array[s*this.data.stride+this.offset+2]},getW:function(s){return this.data.array[s*this.data.stride+this.offset+3]},setXY:function(s,l,c){return this.data.array[(s=s*this.data.stride+this.offset)+0]=l,this.data.array[s+1]=c,this},setXYZ:function(s,l,c,d){return this.data.array[(s=s*this.data.stride+this.offset)+0]=l,this.data.array[s+1]=c,this.data.array[s+2]=d,this},setXYZW:function(s,l,c,d,p){return this.data.array[(s=s*this.data.stride+this.offset)+0]=l,this.data.array[s+1]=c,this.data.array[s+2]=d,this.data.array[s+3]=p,this}},Wl.prototype={constructor:Wl,isInterleavedBuffer:!0,set needsUpdate(s){!0===s&&this.version++},setArray:function(s){if(Array.isArray(s))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.count=void 0!==s?s.length/this.stride:0,this.array=s},setDynamic:function(s){return this.dynamic=s,this},copy:function(s){return this.array=new s.array.constructor(s.array),this.count=s.count,this.stride=s.stride,this.dynamic=s.dynamic,this},copyAt:function(s,l,c){s*=this.stride,c*=l.stride;for(var d=0,p=this.stride;d<p;d++)this.array[s+d]=l.array[c+d];return this},set:function(s,l){return void 0===l&&(l=0),this.array.set(s,l),this},clone:function(){return(new this.constructor).copy(this)},onUpload:function(s){return this.onUploadCallback=s,this}},(jl.prototype=Object.create(Wl.prototype)).constructor=jl,jl.prototype.isInstancedInterleavedBuffer=!0,jl.prototype.copy=function(s){return Wl.prototype.copy.call(this,s),this.meshPerAttribute=s.meshPerAttribute,this},($l.prototype=Object.create(lt.prototype)).constructor=$l,$l.prototype.isInstancedBufferAttribute=!0,$l.prototype.copy=function(s){return lt.prototype.copy.call(this,s),this.meshPerAttribute=s.meshPerAttribute,this},Ag.prototype={constructor:Ag,linePrecision:1,set:function(s,l){this.ray.set(s,l)},setFromCamera:function(s,l){l&&l.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(l.matrixWorld),this.ray.direction.set(s.x,s.y,.5).unproject(l).sub(this.ray.origin).normalize()):l&&l.isOrthographicCamera?(this.ray.origin.set(s.x,s.y,(l.near+l.far)/(l.near-l.far)).unproject(l),this.ray.direction.set(0,0,-1).transformDirection(l.matrixWorld)):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(s,l){var c=[];return ba(s,this,c,l),c.sort(Kh),c},intersectObjects:function(s,l){var c=[];if(!1===Array.isArray(s))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),c;for(var d=0,p=s.length;d<p;d++)ba(s[d],this,c,l);return c.sort(Kh),c}},Dg.prototype={constructor:Dg,start:function(){this.startTime=(performance||Date).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var s=0;if(this.autoStart&&!this.running&&this.start(),this.running){var l=(performance||Date).now();s=(l-this.oldTime)/1e3,this.oldTime=l,this.elapsedTime+=s}return s}},qf.prototype={constructor:qf,set:function(s,l,c){return this.radius=s,this.phi=l,this.theta=c,this},clone:function(){return(new this.constructor).copy(this)},copy:function(s){return this.radius=s.radius,this.phi=s.phi,this.theta=s.theta,this},makeSafe:function(){var s=1e-6;return this.phi=Math.max(s,Math.min(Math.PI-s,this.phi)),this},setFromVector3:function(s){return this.radius=s.length(),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(s.x,s.z),this.phi=Math.acos(dn.clamp(s.y/this.radius,-1,1))),this}},Xl.prototype={constructor:Xl,set:function(s,l,c){return this.radius=s,this.theta=l,this.y=c,this},clone:function(){return(new this.constructor).copy(this)},copy:function(s){return this.radius=s.radius,this.theta=s.theta,this.y=s.y,this},setFromVector3:function(s){return this.radius=Math.sqrt(s.x*s.x+s.z*s.z),this.theta=Math.atan2(s.x,s.z),this.y=s.y,this}},(Wr.prototype=Object.create(br.prototype)).constructor=Wr,Wr.prototype.createAnimation=function(s,l,c,d){var p={start:l,end:c,length:c-l+1,fps:d,duration:(c-l)/d,lastFrame:0,currentFrame:0,active:!1,time:0,direction:1,weight:1,directionBackwards:!1,mirroredLoop:!1};this.animationsMap[s]=p,this.animationsList.push(p)},Wr.prototype.autoCreateAnimations=function(s){for(var c,l=/([a-z]+)_?(\d+)/i,d={},p=this.geometry,m=0,v=p.morphTargets.length;m<v;m++){var b=p.morphTargets[m].name.match(l);b&&b.length>1&&(d[w=b[1]]||(d[w]={start:1/0,end:-1/0}),m<(T=d[w]).start&&(T.start=m),m>T.end&&(T.end=m),c||(c=w))}for(var w in d){var T;this.createAnimation(w,(T=d[w]).start,T.end,s)}this.firstAnimation=c},Wr.prototype.setAnimationDirectionForward=function(s){var l=this.animationsMap[s];l&&(l.direction=1,l.directionBackwards=!1)},Wr.prototype.setAnimationDirectionBackward=function(s){var l=this.animationsMap[s];l&&(l.direction=-1,l.directionBackwards=!0)},Wr.prototype.setAnimationFPS=function(s,l){var c=this.animationsMap[s];c&&(c.fps=l,c.duration=(c.end-c.start)/c.fps)},Wr.prototype.setAnimationDuration=function(s,l){var c=this.animationsMap[s];c&&(c.duration=l,c.fps=(c.end-c.start)/c.duration)},Wr.prototype.setAnimationWeight=function(s,l){var c=this.animationsMap[s];c&&(c.weight=l)},Wr.prototype.setAnimationTime=function(s,l){var c=this.animationsMap[s];c&&(c.time=l)},Wr.prototype.getAnimationTime=function(s){var l=0,c=this.animationsMap[s];return c&&(l=c.time),l},Wr.prototype.getAnimationDuration=function(s){var l=-1,c=this.animationsMap[s];return c&&(l=c.duration),l},Wr.prototype.playAnimation=function(s){var l=this.animationsMap[s];l?(l.time=0,l.active=!0):console.warn("THREE.MorphBlendMesh: animation["+s+"] undefined in .playAnimation()")},Wr.prototype.stopAnimation=function(s){var l=this.animationsMap[s];l&&(l.active=!1)},Wr.prototype.update=function(s){for(var l=0,c=this.animationsList.length;l<c;l++){var d=this.animationsList[l];if(d.active){var p=d.duration/d.length;d.time+=d.direction*s,d.mirroredLoop?(d.time>d.duration||d.time<0)&&(d.direction*=-1,d.time>d.duration&&(d.time=d.duration,d.directionBackwards=!0),d.time<0&&(d.time=0,d.directionBackwards=!1)):(d.time=d.time%d.duration,d.time<0&&(d.time+=d.duration));var m=d.start+dn.clamp(Math.floor(d.time/p),0,d.length-1),v=d.weight;m!==d.currentFrame&&(this.morphTargetInfluences[d.lastFrame]=0,this.morphTargetInfluences[d.currentFrame]=1*v,this.morphTargetInfluences[m]=0,d.lastFrame=d.currentFrame,d.currentFrame=m);var y=d.time%p/p;d.directionBackwards&&(y=1-y),d.currentFrame!==d.lastFrame?(this.morphTargetInfluences[d.currentFrame]=y*v,this.morphTargetInfluences[d.lastFrame]=(1-y)*v):this.morphTargetInfluences[d.currentFrame]=v}}},(Er.prototype=Object.create(at.prototype)).constructor=Er,Er.prototype.isImmediateRenderObject=!0,(Qh.prototype=Object.create(Di.prototype)).constructor=Qh,Qh.prototype.update=function(){var s=new z,l=new z,c=new es;return function(){var p=["a","b","c"];this.object.updateMatrixWorld(!0),c.getNormalMatrix(this.object.matrixWorld);var m=this.object.matrixWorld,v=this.geometry.attributes.position,y=this.object.geometry;if(y&&y.isGeometry)for(var b=y.vertices,w=y.faces,T=0,A=0,R=w.length;A<R;A++)for(var P=w[A],L=0,B=P.vertexNormals.length;L<B;L++){var F=P.vertexNormals[L];s.copy(b[P[p[L]]]).applyMatrix4(m),l.copy(F).applyMatrix3(c).normalize().multiplyScalar(this.size).add(s),v.setXYZ(T,s.x,s.y,s.z),v.setXYZ(T+=1,l.x,l.y,l.z),T+=1}else if(y&&y.isBufferGeometry){var V=y.attributes.position,H=y.attributes.normal;for(T=0,L=0,B=V.count;L<B;L++)s.set(V.getX(L),V.getY(L),V.getZ(L)).applyMatrix4(m),l.set(H.getX(L),H.getY(L),H.getZ(L)),l.applyMatrix3(c).normalize().multiplyScalar(this.size).add(s),v.setXYZ(T,s.x,s.y,s.z),v.setXYZ(T+=1,l.x,l.y,l.z),T+=1}return v.needsUpdate=!0,this}}(),(Ki.prototype=Object.create(at.prototype)).constructor=Ki,Ki.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},Ki.prototype.update=function(){var s=new z,l=new z;return function(){var d=this.light.distance?this.light.distance:1e3,p=d*Math.tan(this.light.angle);this.cone.scale.set(p,p,d),s.setFromMatrixPosition(this.light.matrixWorld),l.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(l.sub(s)),this.cone.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)}}(),(sl.prototype=Object.create(Di.prototype)).constructor=sl,sl.prototype.getBoneList=function(s){var l=[];s&&s.isBone&&l.push(s);for(var c=0;c<s.children.length;c++)l.push.apply(l,this.getBoneList(s.children[c]));return l},sl.prototype.update=function(){var s=new z,l=new Wt,c=new Wt;return function(){var p=this.geometry,m=p.getAttribute("position");c.getInverse(this.root.matrixWorld);for(var v=0,y=0;v<this.bones.length;v++){var b=this.bones[v];b.parent&&b.parent.isBone&&(l.multiplyMatrices(c,b.matrixWorld),s.setFromMatrixPosition(l),m.setXYZ(y,s.x,s.y,s.z),l.multiplyMatrices(c,b.parent.matrixWorld),s.setFromMatrixPosition(l),m.setXYZ(y+1,s.x,s.y,s.z),y+=2)}p.getAttribute("position").needsUpdate=!0}}(),(gu.prototype=Object.create(br.prototype)).constructor=gu,gu.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},gu.prototype.update=function(){this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)},(ql.prototype=Object.create(at.prototype)).constructor=ql,ql.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose(),this.children[1].geometry.dispose(),this.children[1].material.dispose()},ql.prototype.update=function(){var s=new z,l=new z;return function(){var d=this.children[0],p=this.children[1];if(this.light.target){s.setFromMatrixPosition(this.light.matrixWorld),l.setFromMatrixPosition(this.light.target.matrixWorld);var m=l.clone().sub(s);d.lookAt(m),p.lookAt(m)}d.material.color.copy(this.light.color).multiplyScalar(this.light.intensity),p.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);var v=.5*this.light.width,y=.5*this.light.height,b=d.geometry.getAttribute("position"),w=b.array;w[0]=v,w[1]=-y,w[2]=0,w[3]=v,w[4]=y,w[5]=0,w[6]=-v,w[7]=y,w[8]=0,w[9]=-v,w[10]=y,w[11]=0,w[12]=-v,w[13]=-y,w[14]=0,w[15]=v,w[16]=-y,w[17]=0,b.needsUpdate=!0}}(),(Ea.prototype=Object.create(at.prototype)).constructor=Ea,Ea.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},Ea.prototype.update=function(){var s=new z,l=new Tt,c=new Tt;return function(){var p=this.children[0],m=p.geometry.getAttribute("color");l.copy(this.light.color).multiplyScalar(this.light.intensity),c.copy(this.light.groundColor).multiplyScalar(this.light.intensity);for(var v=0,y=m.count;v<y;v++){var b=v<y/2?l:c;m.setXYZ(v,b.r,b.g,b.b)}p.lookAt(s.setFromMatrixPosition(this.light.matrixWorld).negate()),m.needsUpdate=!0}}(),(Jo.prototype=Object.create(Di.prototype)).constructor=Jo,(Sa.prototype=Object.create(Di.prototype)).constructor=Sa,(Ko.prototype=Object.create(Di.prototype)).constructor=Ko,Ko.prototype.update=function(){var s=new z,l=new z,c=new es;return function(){this.object.updateMatrixWorld(!0),c.getNormalMatrix(this.object.matrixWorld);for(var p=this.object.matrixWorld,m=this.geometry.attributes.position,v=this.object.geometry,y=v.vertices,b=v.faces,w=0,T=0,A=b.length;T<A;T++){var R=b[T],P=R.normal;s.copy(y[R.a]).add(y[R.b]).add(y[R.c]).divideScalar(3).applyMatrix4(p),l.copy(P).applyMatrix3(c).normalize().multiplyScalar(this.size).add(s),m.setXYZ(w,s.x,s.y,s.z),m.setXYZ(w+=1,l.x,l.y,l.z),w+=1}return m.needsUpdate=!0,this}}(),(Yl.prototype=Object.create(at.prototype)).constructor=Yl,Yl.prototype.dispose=function(){var s=this.children[0],l=this.children[1];s.geometry.dispose(),s.material.dispose(),l.geometry.dispose(),l.material.dispose()},Yl.prototype.update=function(){var s=new z,l=new z,c=new z;return function(){s.setFromMatrixPosition(this.light.matrixWorld),l.setFromMatrixPosition(this.light.target.matrixWorld),c.subVectors(l,s);var p=this.children[0],m=this.children[1];p.lookAt(c),p.material.color.copy(this.light.color).multiplyScalar(this.light.intensity),m.lookAt(c),m.scale.z=c.length()}}(),(Zl.prototype=Object.create(Di.prototype)).constructor=Zl,Zl.prototype.update=function(){var s,l,c=new z,d=new us;function p(m,v,y,b){c.set(v,y,b).unproject(d);var w=l[m];if(void 0!==w)for(var T=s.getAttribute("position"),A=0,R=w.length;A<R;A++)T.setXYZ(w[A],c.x,c.y,c.z)}return function(){s=this.geometry,l=this.pointMap,d.projectionMatrix.copy(this.camera.projectionMatrix),p("c",0,0,-1),p("t",0,0,1),p("n1",-1,-1,-1),p("n2",1,-1,-1),p("n3",-1,1,-1),p("n4",1,1,-1),p("f1",-1,-1,1),p("f2",1,-1,1),p("f3",-1,1,1),p("f4",1,1,1),p("u1",.7,1.1,-1),p("u2",-.7,1.1,-1),p("u3",0,2,-1),p("cf1",-1,0,1),p("cf2",1,0,1),p("cf3",0,-1,1),p("cf4",0,1,1),p("cn1",-1,0,-1),p("cn2",1,0,-1),p("cn3",0,-1,-1),p("cn4",0,1,-1),s.getAttribute("position").needsUpdate=!0}}(),(So.prototype=Object.create(Di.prototype)).constructor=So,So.prototype.update=function(){var s=new Vs;return function(c){if(c&&c.isBox3?s.copy(c):s.setFromObject(c),!s.isEmpty()){var d=s.min,p=s.max,m=this.geometry.attributes.position,v=m.array;v[0]=p.x,v[1]=p.y,v[2]=p.z,v[3]=d.x,v[4]=p.y,v[5]=p.z,v[6]=d.x,v[7]=d.y,v[8]=p.z,v[9]=p.x,v[10]=d.y,v[11]=p.z,v[12]=p.x,v[13]=p.y,v[14]=d.z,v[15]=d.x,v[16]=p.y,v[17]=d.z,v[18]=d.x,v[19]=d.y,v[20]=d.z,v[21]=p.x,v[22]=d.y,v[23]=d.z,m.needsUpdate=!0,this.geometry.computeBoundingSphere()}}}();var ww=new kt;ww.addAttribute("position",new On([0,0,0,0,1,0],3));var d_=new qo(0,.5,1,5,1);function vu(s,l,c,d,p,m){at.call(this),void 0===d&&(d=16776960),void 0===c&&(c=1),void 0===p&&(p=.2*c),void 0===m&&(m=.2*p),this.position.copy(l),this.line=new ga(ww,new Ji({color:d})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new br(d_,new Hs({color:d})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(s),this.setLength(c,p,m)}function Rg(s){var l=[0,0,0,s=s||1,0,0,0,0,0,0,s,0,0,0,0,0,0,s],d=new kt;d.addAttribute("position",new On(l,3)),d.addAttribute("color",new On([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));var p=new Ji({vertexColors:ca});Di.call(this,d,p)}d_.translate(0,-.5,0),(vu.prototype=Object.create(at.prototype)).constructor=vu,vu.prototype.setDirection=function(){var l,s=new z;return function(d){d.y>.99999?this.quaternion.set(0,0,0,1):d.y<-.99999?this.quaternion.set(1,0,0,0):(s.set(d.z,0,-d.x).normalize(),l=Math.acos(d.y),this.quaternion.setFromAxisAngle(s,l))}}(),vu.prototype.setLength=function(s,l,c){void 0===l&&(l=.2*s),void 0===c&&(c=.2*l),this.line.scale.set(1,Math.max(0,s-l),1),this.line.updateMatrix(),this.cone.scale.set(c,l,c),this.cone.position.y=s,this.cone.updateMatrix()},vu.prototype.setColor=function(s){this.line.material.color.copy(s),this.cone.material.color.copy(s)},(Rg.prototype=Object.create(Di.prototype)).constructor=Rg;var f_=function(){var s=new z,l=new p,c=new p,d=new p;function p(){}return p.prototype.init=function(m,v,y,b){this.c0=m,this.c1=y,this.c2=-3*m+3*v-2*y-b,this.c3=2*m-2*v+y+b},p.prototype.initNonuniformCatmullRom=function(m,v,y,b,w,T,A){var R=(v-m)/w-(y-m)/(w+T)+(y-v)/T,P=(y-v)/T-(b-v)/(T+A)+(b-y)/A;this.init(v,y,R*=T,P*=T)},p.prototype.initCatmullRom=function(m,v,y,b,w){this.init(v,y,w*(y-m),w*(b-v))},p.prototype.calc=function(m){var v=m*m;return this.c0+this.c1*m+this.c2*v+this.c3*(v*m)},Gr.create(function(m){this.points=m||[],this.closed=!1},function(m){var y,b,w,T,A,R,P,L,v=this.points;if((T=v.length)<2&&console.log("duh, you need at least 2 points"),w=(y=(T-(this.closed?0:1))*m)-(b=Math.floor(y)),this.closed?b+=b>0?0:(Math.floor(Math.abs(b)/v.length)+1)*v.length:0===w&&b===T-1&&(b=T-2,w=1),this.closed||b>0?A=v[(b-1)%T]:(s.subVectors(v[0],v[1]).add(v[0]),A=s),R=v[b%T],P=v[(b+1)%T],this.closed||b+2<T?L=v[(b+2)%T]:(s.subVectors(v[T-1],v[T-2]).add(v[T-1]),L=s),void 0===this.type||"centripetal"===this.type||"chordal"===this.type){var B="chordal"===this.type?.5:.25,U=Math.pow(A.distanceToSquared(R),B),F=Math.pow(R.distanceToSquared(P),B),V=Math.pow(P.distanceToSquared(L),B);F<1e-4&&(F=1),U<1e-4&&(U=F),V<1e-4&&(V=F),l.initNonuniformCatmullRom(A.x,R.x,P.x,L.x,U,F,V),c.initNonuniformCatmullRom(A.y,R.y,P.y,L.y,U,F,V),d.initNonuniformCatmullRom(A.z,R.z,P.z,L.z,U,F,V)}else if("catmullrom"===this.type){var H=void 0!==this.tension?this.tension:.5;l.initCatmullRom(A.x,R.x,P.x,L.x,H),c.initCatmullRom(A.y,R.y,P.y,L.y,H),d.initCatmullRom(A.z,R.z,P.z,L.z,H)}return new z(l.calc(w),c.calc(w),d.calc(w))})}(),kA=Gr.create(function(s){console.warn("THREE.SplineCurve3 will be deprecated. Please use THREE.CatmullRomCurve3"),this.points=void 0===s?[]:s},function(s){var l=this.points,c=(l.length-1)*s,d=Math.floor(c),p=c-d,m=l[0==d?d:d-1],v=l[d],y=l[d>l.length-2?l.length-1:d+1],b=l[d>l.length-3?l.length-1:d+2],w=Ma.interpolate;return new z(w(m.x,v.x,y.x,b.x,p),w(m.y,v.y,y.y,b.y,p),w(m.z,v.z,y.z,b.z,p))}),VA=Gr.create(function(s,l,c,d){this.v0=s,this.v1=l,this.v2=c,this.v3=d},function(s){var l=Ui.b3;return new z(l(s,this.v0.x,this.v1.x,this.v2.x,this.v3.x),l(s,this.v0.y,this.v1.y,this.v2.y,this.v3.y),l(s,this.v0.z,this.v1.z,this.v2.z,this.v3.z))}),zA=Gr.create(function(s,l,c){this.v0=s,this.v1=l,this.v2=c},function(s){var l=Ui.b2;return new z(l(s,this.v0.x,this.v1.x,this.v2.x),l(s,this.v0.y,this.v1.y,this.v2.y),l(s,this.v0.z,this.v1.z,this.v2.z))}),yu=Gr.create(function(s,l){this.v1=s,this.v2=l},function(s){if(1===s)return this.v2.clone();var l=new z;return l.subVectors(this.v2,this.v1),l.multiplyScalar(s),l.add(this.v1),l});function Yf(s,l,c,d,p,m){Cs.call(this,s,l,c,c,d,p,m)}(Yf.prototype=Object.create(Cs.prototype)).constructor=Yf;var bw={createMultiMaterialObject:function(s,l){for(var c=new Ah,d=0,p=l.length;d<p;d++)c.add(new br(s,l[d]));return c},detach:function(s,l,c){s.applyMatrix(l.matrixWorld),l.remove(s),c.add(s)},attach:function(s,l,c){var d=new Wt;d.getInverse(c.matrixWorld),s.applyMatrix(d),l.remove(s),c.add(s)}};function Sr(s,l,c,d,p,m,v){return console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),new zs(s,l,c,p,m,v)}var Ew=0,ed=1;function Sw(s){return console.warn("THREE.MeshFaceMaterial has been renamed to THREE.MultiMaterial."),new kh(s)}function co(s,l){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new Ch(s,l)}function _u(s){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new Xc(s)}function p_(s,l){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new Ch(s,l)}function Zf(s){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new bo(s)}function td(s){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new bo(s)}function Tw(s){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new bo(s)}function HA(s,l,c){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new z(s,l,c)}function Cw(s,l){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setDynamic( true ) instead."),new lt(s,l).setDynamic(!0)}function GA(s,l){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new bh(s,l)}function qs(s,l){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new wf(s,l)}function Ig(s,l){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new bf(s,l)}function xu(s,l){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new Ef(s,l)}function WA(s,l){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new Ja(s,l)}function m_(s,l){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new Sf(s,l)}function Aw(s,l){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new Ka(s,l)}function Dw(s,l){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new On(s,l)}function Rw(s,l){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new Tf(s,l)}function g_(s){console.warn("THREE.ClosedSplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),f_.call(this,s),this.type="catmullrom",this.closed=!0}function Iw(s,l){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new So(s,l)}function Pw(s,l){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new Di(new tu(s.geometry),new Ji({color:void 0!==l?l:16777215}))}function Pg(s,l){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new Di(new Il(s.geometry),new Ji({color:void 0!==l?l:16777215}))}function Jf(s){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new $s(s)}g_.prototype=Object.create(f_.prototype),Jo.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},Object.assign(pa.prototype,{center:function(s){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(s)},empty:function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(s){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(s)},size:function(s){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(s)}}),Object.assign(Vs.prototype,{center:function(s){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(s)},empty:function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(s){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(s)},isIntersectionSphere:function(s){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(s)},size:function(s){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(s)}}),ma.prototype.center=function(s){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(s)},dn.random16=function(){return console.warn("THREE.Math.random16() has been deprecated. Use Math.random() instead."),Math.random()},Object.assign(es.prototype,{flattenToArrayOffset:function(s,l){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(s,l)},multiplyVector3:function(s){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),s.applyMatrix3(this)},multiplyVector3Array:function(s){return console.warn("THREE.Matrix3: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead."),this.applyToVector3Array(s)},applyToBuffer:function(s,l,c){return console.warn("THREE.Matrix3: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead."),this.applyToBufferAttribute(s)}}),Object.assign(Wt.prototype,{extractPosition:function(s){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(s)},flattenToArrayOffset:function(s,l){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(s,l)},getPosition:function(){var s;return function(){return void 0===s&&(s=new z),console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),s.setFromMatrixColumn(this,3)}}(),setRotationFromQuaternion:function(s){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(s)},multiplyVector3:function(s){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) or vector.applyProjection( matrix ) instead."),s.applyProjection(this)},multiplyVector4:function(s){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),s.applyMatrix4(this)},multiplyVector3Array:function(s){return console.warn("THREE.Matrix4: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead."),this.applyToVector3Array(s)},rotateAxis:function(s){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),s.transformDirection(this)},crossVector:function(s){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),s.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBuffer:function(s,l,c){return console.warn("THREE.Matrix4: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead."),this.applyToBufferAttribute(s)}}),si.prototype.isIntersectionLine=function(s){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(s)},fr.prototype.multiplyVector3=function(s){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),s.applyQuaternion(this)},Object.assign(Yi.prototype,{isIntersectionBox:function(s){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(s)},isIntersectionPlane:function(s){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(s)},isIntersectionSphere:function(s){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(s)}}),Object.assign(Vl.prototype,{extrude:function(s){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new js(this,s)},makeGeometry:function(s){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new eu(this,s)}}),Object.assign(z.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(s){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(s)},getScaleFromMatrix:function(s){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(s)},getColumnFromMatrix:function(s,l){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(l,s)}}),vn.prototype.computeTangents=function(){console.warn("THREE.Geometry: .computeTangents() has been removed.")},Object.assign(at.prototype,{getChildByName:function(s){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(s)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(s,l){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(l,s)}}),Object.defineProperties(at.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(s){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=s}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Object.defineProperties(qc.prototype,{objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}}),Zi.prototype.setLens=function(s,l){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==l&&(this.filmGauge=l),this.setFocalLength(s)},Object.defineProperties(zi.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(s){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=s}},shadowCameraLeft:{set:function(s){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=s}},shadowCameraRight:{set:function(s){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=s}},shadowCameraTop:{set:function(s){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=s}},shadowCameraBottom:{set:function(s){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=s}},shadowCameraNear:{set:function(s){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=s}},shadowCameraFar:{set:function(s){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=s}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(s){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=s}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(s){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=s}},shadowMapHeight:{set:function(s){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=s}}}),Object.defineProperties(lt.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}}}),Object.assign(kt.prototype,{addIndex:function(s){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(s)},addDrawCall:function(s,l,c){void 0!==c&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(s,l)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")}}),Object.defineProperties(kt.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Object.defineProperties(mu.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this}}}),Object.defineProperties(wn.prototype,{wrapAround:{get:function(){console.warn("THREE."+this.type+": .wrapAround has been removed.")},set:function(){console.warn("THREE."+this.type+": .wrapAround has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE."+this.type+": .wrapRGB has been removed."),new Tt}}}),Object.defineProperties(ds.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}}),Object.defineProperties(Qr.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(s){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=s}}}),Tn.prototype=Object.assign(Object.create({constructor:Tn,apply:function(s){console.warn("THREE.EventDispatcher: .apply is deprecated, just inherit or Object.assign the prototype to mix-in."),Object.assign(s,this)}}),Tn.prototype),Object.assign(Th.prototype,{supportsFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},supportsInstancedArrays:function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(s){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(s)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")}}),Object.defineProperties(Th.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(s){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=s}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(s){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=s}},shadowMapCullFace:{get:function(){return this.shadowMap.cullFace},set:function(s){console.warn("THREE.WebGLRenderer: .shadowMapCullFace is now .shadowMap.cullFace."),this.shadowMap.cullFace=s}}}),Object.defineProperties(cs.prototype,{cullFace:{get:function(){return this.renderReverseSided?Ga:er},set:function(s){var l=s!==er;console.warn("WebGLRenderer: .shadowMap.cullFace is deprecated. Set .shadowMap.renderReverseSided to "+l+"."),this.renderReverseSided=l}}}),Object.defineProperties(Xa.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(s){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=s}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(s){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=s}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(s){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=s}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(s){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=s}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(s){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=s}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(s){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=s}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(s){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=s}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(s){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=s}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(s){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=s}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(s){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=s}}}),Hl.prototype.load=function(s){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");var l=this;return(new zl).load(s,function(d){l.setBuffer(d)}),this},lo.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()};var Lw={merge:function(s,l,c){var d;console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead."),l.isMesh&&(l.matrixAutoUpdate&&l.updateMatrix(),d=l.matrix,l=l.geometry),s.merge(l,d,c)},center:function(s){return console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."),s.center()}},Kf={crossOrigin:void 0,loadTexture:function(s,l,c,d){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");var p=new Ff;p.setCrossOrigin(this.crossOrigin);var m=p.load(s,c,void 0,d);return l&&(m.mapping=l),m},loadTextureCube:function(s,l,c,d){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var p=new Eg;p.setCrossOrigin(this.crossOrigin);var m=p.load(s,c,void 0,d);return l&&(m.mapping=l),m},loadCompressedTexture:function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},loadCompressedTextureCube:function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")}};function Nw(){console.error("THREE.Projector has been moved to /examples/js/renderers/Projector.js."),this.projectVector=function(s,l){console.warn("THREE.Projector: .projectVector() is now vector.project()."),s.project(l)},this.unprojectVector=function(s,l){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject()."),s.unproject(l)},this.pickingRay=function(){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")}}function Qf(){console.error("THREE.CanvasRenderer has been moved to /examples/js/renderers/CanvasRenderer.js"),this.domElement=document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),this.clear=function(){},this.render=function(){},this.setClearColor=function(){},this.setSize=function(){}}}},Um=>{Um(Um.s=11)}]);